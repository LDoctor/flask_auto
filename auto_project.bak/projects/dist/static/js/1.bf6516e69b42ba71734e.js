webpackJsonp([1,9,17,26,46,51,55,57,86],{"0KBE":function(e,t){},"0QBt":function(e,t){},"19lc":function(e,t){},"1nnc":function(e,t){},"1o0s":function(e,t){},"2F89":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("1JPr"),s=a("aA9S"),l=a.n(s),r={props:{show:Boolean,pool_name:String},data:function(){return{loading:!1,zpool_data:{},statusClass:{ONLINE:{class:"cloud-success-color",content:this.lang.ZFS.online},DEGRADED:{class:"cloud-warning-color",content:this.lang.ZFS.degraded},FAULTED:{class:"cloud-warning-color",content:this.lang.ZFS.faulted},OFFLINE:{class:"cloud-warning-color",content:this.lang.ZFS.offline},UNAVAIL:{class:"cloud-error-color",content:this.lang.ZFS.unavail},AVAIL:{class:"cloud-success-color",content:this.lang.ZFS.available},REMOVED:{class:"cloud-warning-color",content:this.lang.ZFS.removed}}}},methods:{innerTableData:function(e){var t=[],a=this.zpool_data.disk_config;for(var o in a)if(o===e){(t=l()([],a[o])).shift();break}return t},pageSelect:function(e){this.pageNum=e},closeModal:function(e){l()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getPoolDetail()},getPoolDetail:function(){var e=this,t=this.common.formatMsg(this.api.storage.zpool_detail,{pool_name:e.pool_name});this.loading=!0,this.checkError(this.$http({url:t,method:"get"}),function(t){e.zpool_data=t.data,e.loading=!1},function(){e.loading=!1})}},computed:{tableData:function(){var e=[],t=this.zpool_data.disk_config,a=this.zpool_data.spares;if("stripe"!==this.zpool_data.pool_type){for(var o in t)"disk"!==o&&e.push(t[o][0]);e=e.concat(a)}else e=t.disk;return e}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{id:"zpoolDisplayStatus",title:e.lang.ZFS.zpool+e.lang.ZFS.displayStatus,visible:e.show,modal:!0,top:"8vh",width:"45%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"60px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-form-item",{attrs:{label:e.lang.common.name}},[a("span",[e._v(e._s(e.zpool_data.name))])]),e._v(" "),a("el-form-item",{attrs:{label:e.lang.common.status}},[a("span",[e._v(e._s(e.zpool_data.state?e.statusClass[e.zpool_data.state].content:""))])]),e._v(" "),a("el-form-item",{attrs:{label:e.lang.ZFS.error}},[a("span",[e._v(e._s(e.zpool_data.errors))])]),e._v(" "),a("el-table",{staticClass:"cloud-table list",staticStyle:{width:"100%"},attrs:{data:e.tableData}},["stripe"!==e.zpool_data.pool_type?a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-table",{staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"show-header":!1,data:e.innerTableData(t.row.name)}},[a("el-table-column",{attrs:{width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{prop:"state"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:e.statusClass[t.row.state].class},[e._v("\n                                    "+e._s(e.statusClass[t.row.state].content)+"\n                                ")])]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"read"}}),e._v(" "),a("el-table-column",{attrs:{prop:"write"}}),e._v(" "),a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                "+e._s(t.row.cksum+" "+(t.row.errors?t.row.errors:""))+"\n                            ")]}}],null,!0)})],1)]}}],null,!1,89292694)}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:e.lang.common.name}}),e._v(" "),a("el-table-column",{attrs:{prop:"state",label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return["stripe"===e.zpool_data.pool_type?a("span",{class:e.statusClass[t.row.state].class},[e._v("\n                        "+e._s(e.statusClass[t.row.state].content)+"\n                    ")]):a("span",[e._v(e._s(e.statusClass[t.row.state].content))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"read",label:e.lang.ZFS.read}}),e._v(" "),a("el-table-column",{attrs:{prop:"write",label:e.lang.ZFS.write}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.ZFS.checksum},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.cksum?t.row.cksum+" "+(t.row.errors?t.row.errors:""):"")+"\n                ")]}}])})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.back))])],1)],1)},staticRenderFns:[]};var i=a("C7Lr")(r,n,!1,function(e){a("HUsr"),a("kbEo")},"data-v-01bd3580",null).exports,c={data:function(){return{loading:!0,showDisplayStatus:!1,dialogVisible:!1,tipDialogMsg:"",tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,operateOptions:[{value:"displayStatus",label:this.lang.ZFS.displayStatus}],operateValue:""}},created:function(){this.getList()},components:{"pana-breadcrumb":o.a,displayStatus:i},methods:{sort:function(e){this.tableData=this.common.sort(e,this.tableData,["free","used"])},selectNotOne:function(){return 1!==this.multipleSelection.length},moreOperateDisabled:function(e){if(this.selectNotOne())return!0},operateValueChange:function(){switch(this.operateValue){case"displayStatus":this.showDisplayStatus=!0,this.operateValue=""}},closeDisplayStatus:function(){this.showDisplayStatus=!1},notSelect:function(){return this.multipleSelection.length<=0},getList:function(){var e=this;this.checkError(this.$http({url:this.api.storage.zpool,method:"get"}),function(t){e.loading=!1,e.tableData=t.data})},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e}},computed:{clearDisabled:function(){if(this.notSelect())return!0},filterData:function(){var e=this.search,t=[];return t=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-select",{staticClass:"more-operation",attrs:{disabled:e.notSelect(),placeholder:e.lang.common.moreOperation},on:{change:e.operateValueChange},model:{value:e.operateValue,callback:function(t){e.operateValue=t},expression:"operateValue"}},e._l(e.operateOptions,function(t){return a("el-option",{key:t.value,attrs:{disabled:e.moreOperateDisabled(t.value),label:t.label,value:t.value}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rga(255, 255, 255)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.common.name}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"pool_type",label:e.lang.ZFS.diskStructure},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.lang.ZFS.diskStructureValue[t.row.pool_type])+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"state",label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.lang.ZFS.statusValue[t.row.state])+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"used",label:e.lang.ZFS.usedSpace}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"free",label:e.lang.ZFS.availableSpace}})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("display-status",{attrs:{pool_name:e.multipleSelection[0]&&e.multipleSelection[0].name,show:e.showDisplayStatus},on:{closeModal:e.closeDisplayStatus}})],1)},staticRenderFns:[]};var d=a("C7Lr")(c,u,!1,function(e){a("0QBt")},"data-v-421dfa77",null);t.default=d.exports},"2ykP":function(e,t){},"3ITk":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("1JPr"),s=a("/n4h"),l=a("aA9S"),r=a.n(l),n={props:{show:Boolean,id:String},data:function(){return{data:{},loading:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getSnapshotDetail()},getSnapshotDetail:function(){var e=this,t=e.common.formatMsg(e.api.storage.getSnapshotDetail,{id:e.id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.loading=!1,e.data=t.data[0]})},closeModal:function(){r()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.volume.snapshotDetail,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cloud-detail cloud-detail-modal",attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[e.data.hasOwnProperty("name")?a("table",[a("tr",[a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.volume.snapshotName))]),e._v(" "),a("td",[e._v(e._s(e.data.name))]),e._v(" "),a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.volume.cloudDiskName))]),e._v(" "),a("td",[e._v(e._s(e.data.volumeName))])]),e._v(" "),a("tr",[a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.volume.createTime))]),e._v(" "),a("td",[e._v(e._s(e._f("utc2beijing")(e.data.created)))]),e._v(" "),a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.volume.sizeGB))]),e._v(" "),a("td",[e._v(e._s(e.data.size))])]),e._v(" "),a("tr",[a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.volume.state))]),e._v(" "),a("td",[e._v(e._s(e.lang.volume.snapshotStatus[e.data.status]))]),e._v(" "),a("td",{staticClass:"cloud-label"}),e._v(" "),a("td")])]):e._e()]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.closeModal}},[e._v(e._s(e.lang.common.close))])],1)])},staticRenderFns:[]};var c=a("C7Lr")(n,i,!1,function(e){a("q/Q3")},"data-v-143bd11c",null).exports,u={data:function(){return{activeName:"dataDisk",snapshotData:{},snapshotId:"",showDetail:!1,loading:!0,dialogVisible:!1,tipDialogMsg:"",operate:"",tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10}},components:{"pana-breadcrumb":o.a,cloudTipDialog:s.a,panaDetail:c},mounted:function(){var e=this;this.getList(),this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var a=t.event_type.split(".");"snapshot"===a[0]&&"end"===a[2]&&e.getList()}})},methods:{detail:function(e){this.snapshotId=e,this.showDetail=!0},closeDetail:function(){this.showDetail=!1},tabChange:function(){"sysDisk"===this.activeName?this.tableData=this.snapshotData.sys_disks:this.tableData=this.snapshotData.data_disks},sort:function(e){this.tableData=this.common.sort(e,this.tableData,["size"])},getList:function(){var e=this;e.loading=!0,this.checkError(this.$http({url:this.api.storage.getSnapshot,method:"get"}),function(t){e.loading=!1,e.snapshotData=t.data,e.tabChange()})},deleteConfirm:function(){this.operate="delete",this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.deleteSnapshotConfirm},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"delete":this.delete()}},delete:function(){var e=this,t=[];this.multipleSelection.forEach(function(a){e.wsEventQueue.push(a.id),t.push(a.id)});var a=this.api.storage.deleteSnapshot;this.checkError(this.$http({url:a,method:"POST",data:{ids:t}}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.volume.deletingSnapshot})})},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e}},computed:{notSelect:function(){return 0===this.multipleSelection.length},filterData:function(){var e=this.search,t=[],a=this.tableData;return t=""===e?a:this.common.cloudFilter(a,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-tabs",{on:{"tab-click":e.tabChange},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.lang.volume.dataDiskSnapshot,name:"dataDisk"}},[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:e.notSelect},on:{click:e.deleteConfirm}},[e._v("\n                            "+e._s(e.lang.common.delete)+"\n                        ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.volume.sysDiskSnapshot,name:"sysDisk"}},[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:e.notSelect},on:{click:e.deleteConfirm}},[e._v("\n                            "+e._s(e.lang.common.delete)+"\n                        ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.volume.snapshotName},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.detail(t.row.id)}}},[e._v("\n                            "+e._s(t.row.name)+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"volumeName",label:e.lang.volume.cloudDiskName}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"size",label:e.lang.volume.sizeGB}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"status",label:e.lang.volume.state},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"status",class:{"cloud-success":"available"===t.row.status||"in-use"===t.row.status,"bg-blue":"creating"===t.row.status||"deleting"===t.row.status||"attaching"===t.row.status||"detaching"===t.row.status||"error-deleting"===t.row.status,"cloud-warning":"inavailable"===t.row.status,"cloud-error":"error"===t.row.status}},[e._v(e._s(e.lang.volume.snapshotStatus[t.row.status]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"description",label:e.lang.common.description},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{attrs:{"popper-class":"description-tooltip",disabled:null==t.row.description||t.row.description.length<=30,effect:"light",content:t.row.description,placement:"top"}},[null==t.row.description||t.row.description.length<=30?a("span",[e._v("\n                                "+e._s(t.row.description)+"\n                            ")]):a("span",[e._v(e._s(t.row.description.substr(0,50))+" ...")])])]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"created",label:e.lang.volume.createTime},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e._f("utc2beijing")(t.row.created))+"\n                    ")]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1)],1),e._v(" "),a("pana-detail",{attrs:{show:e.showDetail,id:e.snapshotId},on:{closeModal:e.closeDetail}}),e._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible},on:{cancel:function(t){e.dialogVisible=!1},confirm:e.dialogConfirm}},[e._v("\n        "+e._s(e.tipDialogMsg)+"\n    ")])],1)},staticRenderFns:[]};var m=a("C7Lr")(u,d,!1,function(e){a("wSwB"),a("sSbh")},"data-v-3e77077d",null);t.default=m.exports},"5BR7":function(e,t){},"5ziM":function(e,t){},"7vDJ":function(e,t){},"87CJ":function(e,t){},"8HiS":function(e,t){},"8kvs":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("/n4h"),s=a("1JPr"),l=a("aA9S"),r=a.n(l),n={props:{show:Boolean},data:function(){return{advancedOptions:!1,free:0,form:{name:"",compression:"off",dedup:"off",casesensitivity:"sensitive",atime:"on",size:"",unit:"G",copies:1,recordsize:"128K",parent:"UD_POOL/UDNAS",type:"filesystem"},rules:{name:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{min:1,max:32,message:this.lang.volume.volumeNameLengthRule},{validator:this.common.validateName4,trigger:"blur"}],size:[{required:!0,type:"integer",min:1,message:"请输入整数，最小值为1",trigger:"blur"},{validator:this.validateSize,trigger:"blur"}]}}},methods:{validateSize:function(e,t,a){var o=this.common.formatCapacity(this.free,"B",2),s=o.value?Math.floor(o.value):o.value,l=o.unit;(""===t||null==t||isNaN(t))&&a(),(t=this.common.switchCapacity(t,this.form.unit+"B",l,0))<=s?a():a(Error(this.common.formatMsg(this.lang.volume.invalidSizeMax,{max:s,unit:l})))},sizeUnitChange:function(){this.$refs.form.validateField("size")},advancedOptionsChange:function(){this.advancedOptions=!this.advancedOptions},confirm:function(){var e=this,t=this;this.$refs.form.validate(function(a){if(!a)return!1;t.advancedOptions||(delete t.form.copies,delete t.form.recordsize);var o=r()({},t.form);t.closeModal(),e.checkError(e.$http({url:e.api.storage.dataset,method:"POST",data:o}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.createVolumeSuccess})})})},closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){var e=this;this.$refs.form&&this.$refs.form.resetFields(),this.checkError(this.$http({url:this.api.storage.zfs,method:"get"}),function(t){t.data.some(function(t){if("UD_POOL/UDNAS"===t.path)return e.free=t.all_size.free,!0})})}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.volume.createVolume,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"160px",rules:e.rules}},[a("el-form-item",{attrs:{label:e.lang.volume.volumeName,prop:"name"}},[a("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.compressionLevel}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.compression,callback:function(t){e.$set(e.form,"compression",t)},expression:"form.compression"}},e._l(e.lang.volume.compressionLabel,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.ZFSDeduplication}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.dedup,callback:function(t){e.$set(e.form,"dedup",t)},expression:"form.dedup"}},e._l(e.lang.volume.dedupValue,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.caseSensitive}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.casesensitivity,callback:function(t){e.$set(e.form,"casesensitivity",t)},expression:"form.casesensitivity"}},e._l(e.lang.volume.caseSensitivityValue,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.recordFileDisplayTime}},[a("el-radio",{attrs:{label:"on"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.on))]),e._v(" "),a("el-radio",{attrs:{label:"off"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.off))])],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.spaceQuota,prop:"size"}},[a("el-col",{attrs:{span:14}},[a("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:e.lang.common.input,type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.size,callback:function(t){e.$set(e.form,"size",e._n(t))},expression:"form.size"}})],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"14px"},attrs:{span:9}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},on:{change:e.sizeUnitChange},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.lang.volume.unitValue,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),e._v(" "),a("el-form-item",{class:{"cloud-expand-icon":e.advancedOptions}},[a("el-button",{attrs:{type:"text"},on:{click:e.advancedOptionsChange}},[e._v("\n        "+e._s(e.lang.volume.advancedOptions)+"\n        "),a("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}})])],1),e._v(" "),e.advancedOptions?a("div",[a("el-form-item",{attrs:{label:e.lang.volume.copies}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.copies,callback:function(t){e.$set(e.form,"copies",t)},expression:"form.copies"}},e._l(e.lang.volume.copiesValue,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.recordSize}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.recordsize,callback:function(t){e.$set(e.form,"recordsize",t)},expression:"form.recordsize"}},e._l(e.lang.volume.recordSizeValue,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(n,i,!1,function(e){a("Rrz6")},"data-v-dcb69820",null).exports,u={props:{show:Boolean,volumeData:Array},data:function(){return{advancedOptions:!1,form:{name:"",compression:"off",dedup:"off",casesensitivity:"sensitive",atime:"on",size:"",unit:"G",copies:1,recordsize:"128K",parent:"UD_POOL/UD_NAS",type:"filesystem"},rules:{size:[{type:"integer",min:1,message:"请输入整数，最小值为1",trigger:"blur"}]}}},methods:{advancedOptionsChange:function(){this.advancedOptions=!this.advancedOptions},confirm:function(){var e=this,t=this;this.$refs.form.validate(function(a){if(!a)return!1;t.advancedOptions||(delete t.form.copies,delete t.form.recordsize);var o=r()({},t.form),s=t.common.formatMsg(e.api.storage.dataset_detail,{zfs_id:t.volumeData.guid});t.closeModal(),e.checkError(e.$http({url:s,method:"put",data:o}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.editVolumeSuccess})})})},closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){for(var e in this.$refs.form&&this.$refs.form.resetFields(),this.volumeData)e in this.form&&(this.form[e]=this.volumeData[e]);var t=this.volumeData.recordsize/1024;this.form.recordsize=1024===t?t/1024+"M":t+"K"}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.volume.updateVolume,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"160px",rules:e.rules}},[a("el-form-item",{attrs:{label:e.lang.volume.volumeName}},[a("span",[e._v(e._s(e.form.name))])]),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.compressionLevel}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.compression,callback:function(t){e.$set(e.form,"compression",t)},expression:"form.compression"}},e._l(e.lang.volume.compressionLabel,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.ZFSDeduplication}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.dedup,callback:function(t){e.$set(e.form,"dedup",t)},expression:"form.dedup"}},e._l(e.lang.volume.dedupValue,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.caseSensitive}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:"",disabled:!0},model:{value:e.form.casesensitivity,callback:function(t){e.$set(e.form,"casesensitivity",t)},expression:"form.casesensitivity"}},e._l(e.lang.volume.caseSensitivityValue,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.recordFileDisplayTime}},[a("el-radio",{attrs:{label:"on"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.on))]),e._v(" "),a("el-radio",{attrs:{label:"off"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.off))])],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.spaceQuota,prop:"size"}},[a("el-col",{attrs:{span:14}},[a("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:e.lang.common.input,type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.size,callback:function(t){e.$set(e.form,"size",e._n(t))},expression:"form.size"}})],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"14px"},attrs:{span:9}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.lang.volume.unitValue,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),e._v(" "),a("div",{attrs:{id:"advancedOptions"},on:{click:e.advancedOptionsChange}},[a("el-form-item",{class:{"cloud-expand-icon":e.advancedOptions},attrs:{label:e.lang.volume.advancedOptions}},[a("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}})])],1),e._v(" "),e.advancedOptions?a("div",[a("el-form-item",{attrs:{label:e.lang.volume.copies}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.copies,callback:function(t){e.$set(e.form,"copies",t)},expression:"form.copies"}},e._l(e.lang.volume.copiesValue,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.volume.recordSize}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},on:{change:e.selectResource},model:{value:e.form.recordsize,callback:function(t){e.$set(e.form,"recordsize",t)},expression:"form.recordsize"}},e._l(e.lang.volume.recordSizeValue,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var m=a("C7Lr")(u,d,!1,function(e){a("Jq5B"),a("Cj/H")},"data-v-4338b78c",null).exports,p={props:{show:Boolean,zfs_id:String},data:function(){return{form:{name:""},rules:{name:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{min:1,max:32,message:this.lang.volume.snapshotNameLengthRule},{validator:this.common.validateName5,trigger:"blur"}]}}},methods:{confirm:function(){var e=this,t=this;this.$refs.form.validate(function(a){if(!a)return!1;var o=r()({},t.form),s=t.common.formatMsg(t.api.storage.dataset_detail_snapshot,{zfs_id:t.zfs_id});t.closeModal(),e.checkError(e.$http({url:s,method:"POST",data:o}),function(){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.createSnapshotSuccess})})})},closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){this.$refs.form&&this.$refs.form.resetFields()}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.volume.createSnapshot,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[a("el-form-item",{attrs:{label:e.lang.common.name,prop:"name"}},[a("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var h=a("C7Lr")(p,g,!1,function(e){a("Gpj9"),a("Y7P2")},"data-v-4026ae2c",null).exports,f={data:function(){return{loading:!0,showCreateVolume:!1,showUpdateVolume:!1,showCreateSnapshot:!1,dialogVisible:!1,tipDialogMsg:"",tableData:[],volumeData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,operate:""}},mounted:function(){this.getList()},components:{"pana-breadcrumb":s.a,cloudTipDialog:o.a,createVolume:c,updateVolume:m,createSnapshot:h},methods:{sort:function(e){this.tableData=this.common.sort(e,this.tableData,["size","used"])},handleEdit:function(e,t){this.showUpdateVolume=!0,this.volumeData=t},deleteConfirm:function(){this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.confirmDelete,this.operate="delete"},closeCreateVolume:function(){this.showCreateVolume=!1},closeUpdateVolume:function(){this.showUpdateVolume=!1},closeCreateSnapshot:function(){this.showCreateSnapshot=!1},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"delete":this.delete()}},delete:function(){var e=this,t=e.common.formatMsg(e.api.storage.dataset_detail,{zfs_id:e.multipleSelection[0].guid});this.checkError(this.$http({url:t,method:"delete"}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.common.formatMsg(e.lang.volume.deleteVolumeSuccess,{name:e.multipleSelection[0].name})})})},getList:function(){var e=this;this.checkError(this.$http({url:this.api.storage.dataset,method:"get"}),function(t){e.loading=!1,e.tableData=t.data,e.tableData.map(function(e){"gzip"===e.compression&&(e.compression="gzip-6")})})},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e}},computed:{selectNotOne:function(){return 1!==this.multipleSelection.length},filterData:function(){var e=this.search,t=[];return t=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreateVolume=!0}}},[e._v("\n                    "+e._s(e.lang.common.found)+"\n                ")]),e._v(" "),a("el-button",{attrs:{disabled:e.selectNotOne},on:{click:e.deleteConfirm}},[e._v("\n                    "+e._s(e.lang.common.delete)+"\n                ")]),e._v(" "),a("el-button",{attrs:{disabled:e.selectNotOne},on:{click:function(t){e.showCreateSnapshot=!0}}},[e._v("\n                    "+e._s(e.lang.volume.createSnapshot)+"\n                ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.common.name}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"compressratio",label:e.lang.volume.compressionRatio}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"compression",label:e.lang.volume.compressionLevel},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s("off"===t.row.compression?e.lang.volume.compressionLabel[t.row.compression]:t.row.compression)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"used",label:e.lang.volume.usedSpace}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"size",label:e.lang.volume.spaceQuota},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.size+e.lang.volume.unitValue[t.row.unit])+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v(e._s(e.lang.common.update)+"\n                    ")])]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible},on:{cancel:function(t){e.dialogVisible=!1},confirm:e.dialogConfirm}},[e._v("\n        "+e._s(e.tipDialogMsg)+"\n    ")]),e._v(" "),a("create-volume",{attrs:{show:e.showCreateVolume},on:{closeModal:e.closeCreateVolume,getList:e.getList}}),e._v(" "),a("update-volume",{attrs:{show:e.showUpdateVolume,volumeData:e.volumeData},on:{closeModal:e.closeUpdateVolume,getList:e.getList}}),e._v(" "),a("create-snapshot",{attrs:{show:e.showCreateSnapshot,zfs_id:e.multipleSelection[0]&&e.multipleSelection[0].guid},on:{closeModal:e.closeCreateSnapshot,getList:e.getList}})],1)},staticRenderFns:[]};var v=a("C7Lr")(f,b,!1,function(e){a("2ykP")},"data-v-6958a0be",null);t.default=v.exports},CG9h:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("1JPr"),s=a("IXf9"),l=a("2F89"),r=a("8kvs"),n=a("fgAE"),i=a("3ITk"),c=a("hESZ"),u=a("wEst"),d=a("PQmD"),m=a("oFYa"),p=a("ZqEf"),g={name:"pool-storage-detail",components:{"pana-breadcrumb":o.a,"disk-manage":s.default,"zpool-manage":l.default,"volume-manage":r.default,"snapshot-manage":n.default,"pana-user-manage":c.a,"pana-group-manage":u.a,"pana-file-share":d.default,"pana-object-share":m.default,"pana-cloud-disk":p.default,"pana-cloud-disk-snapshot":i.default},props:{id:String},data:function(){return{activeName:"diskManage",recentChange:[],secondary:{engine:"diskManage",blockManage:"diskManage",zpool:"zfsManage",volume:"zfsManage",fileShare:"shareManage",objectShare:"shareManage",user:"userManage",group:"userManage",volumeSnapshot:"snapshotManage",blockSnapshot:"snapshotManage"},activeSecondary:"engine"}},computed:{poolId:function(){return this.$route.params.id}},methods:{beforeLeave:function(e){return e===this.activeName||this.recentChange.indexOf(e)>-1},commandAction:function(e){this.secondary.hasOwnProperty(e)&&(this.activeName=this.secondary[e],this.activeSecondary=e)}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{back:!0}}),e._v(" "),a("el-main",[a("el-tabs",{attrs:{"before-leave":e.beforeLeave},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"diskManage"}},[a("el-dropdown",{attrs:{slot:"label",trigger:"click"},on:{command:e.commandAction},slot:"label"},[a("span",{staticClass:"el-dropdown-link tab-label"},[e._v("\n                        "+e._s(e.lang.storagePool.diskManage)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"engine"}},[e._v(e._s(e.lang.storagePool.engine))]),e._v(" "),a("el-dropdown-item",{attrs:{command:"blockManage"}},[e._v(e._s(e.lang.storagePool.blockManage))])],1)],1),e._v(" "),"engine"===e.activeSecondary?a("div",[a("disk-manage")],1):e._e(),e._v(" "),"blockManage"===e.activeSecondary?a("div",[a("pana-cloud-disk")],1):a("div")],1),e._v(" "),a("el-tab-pane",{attrs:{name:"zfsManage"}},[a("el-dropdown",{attrs:{slot:"label",trigger:"click"},on:{command:e.commandAction},slot:"label"},[a("span",{staticClass:"el-dropdown-link tab-label"},[e._v("\n                        "+e._s(e.lang.storagePool.zfsManage)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"zpool"}},[e._v(e._s(e.lang.storagePool.zpool))]),e._v(" "),a("el-dropdown-item",{attrs:{command:"volume"}},[e._v(e._s(e.lang.storagePool.volume))])],1)],1),e._v(" "),"zpool"===e.activeSecondary?a("div",[a("zpool-manage")],1):e._e(),e._v(" "),"volume"===e.activeSecondary?a("div",[a("volume-manage")],1):a("div")],1),e._v(" "),a("el-tab-pane",{attrs:{name:"shareManage"}},[a("el-dropdown",{attrs:{slot:"label",trigger:"click"},on:{command:e.commandAction},slot:"label"},[a("span",{staticClass:"el-dropdown-link tab-label"},[e._v("\n                        "+e._s(e.lang.storagePool.shareManage)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"fileShare"}},[e._v(e._s(e.lang.storagePool.fileShare))]),e._v(" "),a("el-dropdown-item",{attrs:{command:"objectShare"}},[e._v(e._s(e.lang.storagePool.objectShare))])],1)],1),e._v(" "),"fileShare"===e.activeSecondary?a("div",[a("pana-file-share")],1):e._e(),e._v(" "),"objectShare"===e.activeSecondary?a("div",[a("pana-object-share")],1):a("div")],1),e._v(" "),a("el-tab-pane",{attrs:{name:"userManage"}},[a("el-dropdown",{attrs:{slot:"label",trigger:"click"},on:{command:e.commandAction},slot:"label"},[a("span",{staticClass:"el-dropdown-link tab-label"},[e._v("\n                        "+e._s(e.lang.storagePool.userManage)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"user"}},[e._v(e._s(e.lang.storagePool.user))]),e._v(" "),a("el-dropdown-item",{attrs:{command:"group"}},[e._v(e._s(e.lang.storagePool.group))])],1)],1),e._v(" "),"user"===e.activeSecondary?a("div",[a("pana-user-manage",{attrs:{poolId:e.id}})],1):e._e(),e._v(" "),"group"===e.activeSecondary?a("div",[a("pana-group-manage",{attrs:{poolId:e.id}})],1):a("div")],1),e._v(" "),a("el-tab-pane",{attrs:{name:"snapshotManage"}},[a("el-dropdown",{attrs:{slot:"label",trigger:"click"},on:{command:e.commandAction},slot:"label"},[a("span",{staticClass:"el-dropdown-link tab-label"},[e._v("\n                        "+e._s(e.lang.storagePool.snapshotManage)),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"volumeSnapshot"}},[e._v(e._s(e.lang.storagePool.volumeSnapshot))]),e._v(" "),a("el-dropdown-item",{attrs:{command:"blockSnapshot"}},[e._v(e._s(e.lang.storagePool.blockSnapshot))])],1)],1),e._v(" "),"volumeSnapshot"===e.activeSecondary?a("div",[a("snapshot-manage")],1):e._e(),e._v(" "),"blockSnapshot"===e.activeSecondary?a("div",[a("pana-cloud-disk-snapshot")],1):a("div")],1)],1)],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(g,h,!1,function(e){a("DAnP")},"data-v-2c586a43",null);t.default=f.exports},"Cj/H":function(e,t){},DAnP:function(e,t){},EuCd:function(e,t){},FSDC:function(e,t){},FxZD:function(e,t){},Gpj9:function(e,t){},HUsr:function(e,t){},HzXi:function(e,t){},IXf9:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("1JPr"),s=a("/n4h"),l=a("aA9S"),r=a.n(l),n={props:{show:Boolean,diskData:Array},data:function(){return{form:{disk_user:""},rules:{disk_user:[{required:!0,message:this.lang.common.required_item,trigger:"change"}]},zpools:[],loading:!1}},methods:{formatSize:function(e){return this.common.formatCapacity(e,"B")},confirm:function(){var e=this,t=this;this.$refs.form.validate(function(a){if(!a)return!1;var o=[];t.diskData.forEach(function(e){o.push(e.name)});var s={names:o,disk_user:e.form.disk_user};t.closeModal(),e.checkError(t.$http({url:e.api.storage.disk_action,method:"put",data:s}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.disk.configHotSpareDiskSuccess})})})},closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getZpool()},getZpool:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.storage.zpool,method:"get"}),function(t){e.zpools=t.data,e.form.disk_user=e.zpools[0]&&e.zpools[0].name,e.loading=!1},function(){e.loading=!1})}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{id:"configHotSpare",title:e.lang.disk.configHotSpareDisk,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-form-item",{attrs:{label:e.lang.disk.selectedDisk}},[a("el-table",{staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.diskData,"highlight-current-row":""}},[a("el-table-column",{attrs:{prop:"name",label:e.lang.disk.slot}}),e._v(" "),a("el-table-column",{attrs:{prop:"model",label:e.lang.disk.type}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.disk.capacity},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.formatSize(t.row.size).value+e.formatSize(t.row.size).unit)+"\n                    ")]}}])})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.disk.zpool,prop:"disk_user"}},[a("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.disk_user,callback:function(t){e.$set(e.form,"disk_user",t)},expression:"form.disk_user"}},e._l(e.zpools,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(n,i,!1,function(e){a("HzXi"),a("bwJI")},"data-v-249d50de",null).exports,u={data:function(){return{loading:!0,showConfigHotSpare:!1,dialogVisible:!1,tipDialogMsg:"",operate:"",tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10}},mounted:function(){this.getList()},components:{"pana-breadcrumb":o.a,cloudTipDialog:s.a,configHotSpare:c},methods:{formatSize:function(e){return this.common.formatCapacity(e,"B")},sort:function(e){this.tableData=this.common.sort(e,this.tableData,["size"])},formatStatus:function(e,t){return e<=1?this.lang.volume.status[e]:this.common.formatMsg(this.lang.volume.statusShow,{status:this.lang.volume.status[e],disk_user:t})},initializeDiskConfirm:function(){this.operate="initializeDisk",this.dialogVisible=!0,this.tipDialogMsg=this.lang.disk.initializeDiskConfirm},removeHotSpareConfirm:function(){this.operate="removeHotSpare",this.dialogVisible=!0,this.tipDialogMsg=this.lang.disk.removeHotSpareConfirm},closeConfigHotSpare:function(){this.showConfigHotSpare=!1},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"initializeDisk":this.initializeDisk();break;case"removeHotSpare":this.removeHotSpare()}},initializeDisk:function(){var e=this,t=[];this.multipleSelection.forEach(function(e){t.push(e.name)});var a=this.api.storage.disk;this.checkError(this.$http({url:a,data:{names:t},method:"POST"}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.disk.initializeDiskSuccess})})},removeHotSpare:function(){var e=this,t=[];this.multipleSelection.forEach(function(e){t.push(e.name)});var a=this.api.storage.disk_action;this.checkError(this.$http({url:a,data:{names:t},method:"POST"}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.disk.removeHotSpareSuccess})})},notSelect:function(){return this.multipleSelection.length<=0},getList:function(){var e=this;this.checkError(this.$http({url:this.api.storage.disk,method:"get"}),function(t){e.loading=!1,e.tableData=t.data})},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e}},computed:{filterData:function(){var e=this.search,t=[];return t=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)},initializeDisabled:function(){return!!this.notSelect()||this.multipleSelection.some(function(e){return 0!==e.disk_state})},configHotSpareDisabled:function(){return!!this.notSelect()||this.multipleSelection.some(function(e){return 1!==e.disk_state})},removeHotSpareDisabled:function(){return!!this.notSelect()||this.multipleSelection.some(function(e){return 3!==e.disk_state})}},watch:{search:function(){this.pageNum=1}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:e.initializeDisabled,type:"primary"},on:{click:e.initializeDiskConfirm}},[e.initializeDisabled?a("div",[a("el-tooltip",{attrs:{content:e.lang.disk.initializeCondition,placement:"top"}},[a("div",[e._v(e._s(e.lang.disk.initializeDisk))])])],1):a("div",[a("div",[e._v(e._s(e.lang.disk.initializeDisk))])])]),e._v(" "),a("el-button",{attrs:{disabled:e.configHotSpareDisabled},on:{click:function(t){e.showConfigHotSpare=!0}}},[e.configHotSpareDisabled?a("div",[a("el-tooltip",{attrs:{content:e.lang.disk.configHotSpareCondition,placement:"top"}},[a("div",[e._v(e._s(e.lang.disk.configHotSpareDisk))])])],1):a("div",[a("div",[e._v(e._s(e.lang.disk.configHotSpareDisk))])])]),e._v(" "),a("el-button",{attrs:{disabled:e.removeHotSpareDisabled},on:{click:e.removeHotSpareConfirm}},[e._v("\n                    "+e._s(e.lang.disk.removeHotSpareDisk)+"\n                ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.disk.slot}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"model",label:e.lang.disk.type}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"vendor",label:e.lang.disk.manufacturer}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"serial",label:e.lang.disk.productNumber}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"size",label:e.lang.disk.capacity},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.formatSize(t.row.size).value+e.formatSize(t.row.size).unit)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"disk_state",label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.formatStatus(t.row.disk_state,t.row.disk_user))+"\n                ")]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1),e._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible},on:{cancel:function(t){e.dialogVisible=!1},confirm:e.dialogConfirm}},[e._v("\n            "+e._s(e.tipDialogMsg)+"\n        ")]),e._v(" "),a("config-hot-spare",{attrs:{diskData:e.multipleSelection,show:e.showConfigHotSpare},on:{closeModal:e.closeConfigHotSpare,getList:e.getList}})],1)],1)},staticRenderFns:[]};var m=a("C7Lr")(u,d,!1,function(e){a("l7DD")},"data-v-db24ad38",null);t.default=m.exports},Jq5B:function(e,t){},Oi0q:function(e,t){},PQmD:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("3cXf"),s=a.n(o),l=a("1JPr"),r=a("aA9S"),n=a.n(r),i={name:"pana-create-file",props:{show:Boolean},watch:{"form.cifs":function(e){"yes"===e?this.services.push("cifs"):this.services.splice(this.services.indexOf("cifs"),1)},"form.nfs":function(e){"yes"===e?this.services.push("nfs"):this.services.splice(this.services.indexOf("nfs"),1)},services:function(e){0===e.length?(this.nextStep=0,this.completeIndex=0):e.indexOf("cifs")>-1?(this.nextStep=1,this.completeIndex=1,e.indexOf("nfs")>-1&&(this.completeIndex=2)):(this.nextStep=2,this.completeIndex=2)},users:function(e,t){var a=this;e=this.common.deepCopyByJson(e),t=(t=this.common.deepCopyByJson(t)).filter(function(t){return!(e.indexOf(t)>-1)||(e.splice(e.indexOf(t),1),!1)}),this.usersInfo=this.usersInfo.filter(function(e){return!(t.indexOf(e.name)>-1)||(a.form.read_user.splice(a.form.read_user.indexOf(e),1),a.form.write_user.splice(a.form.write_user.indexOf(e),1),a.form.admin_users.splice(a.form.admin_users.indexOf(e),1),!1)}),e.map(function(e){a.usersInfo.push({name:e,access:"ro",show:!1}),a.form.read_user.push(e)})},groups:function(e,t){var a=this;e=this.common.deepCopyByJson(e),t=(t=this.common.deepCopyByJson(t)).filter(function(t){return!(e.indexOf(t)>-1)||(e.splice(e.indexOf(t),1),!1)}),this.groupInfo=this.groupInfo.filter(function(e){return!(t.indexOf(e.name)>-1)||(a.form.read_group.splice(a.form.read_group.indexOf(e),1),a.form.write_group.splice(a.form.write_group.indexOf(e),1),a.form.admin_groups.splice(a.form.admin_groups.indexOf(e),1),!1)}),e.map(function(e){a.groupInfo.push({name:e,access:"ro",show:!1}),a.form.read_group.push(e)})}},methods:{closeModal:function(e){e=e||!1,n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.file_form&&this.$refs.file_form.resetFields(),this.getVolumeList(),this.getSystemType()},getVolumeList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.dataset.dataset,method:"get"}),function(t){e.volumes=t.data,e.volumes.length>0&&(e.form.volume=e.volumes[0].path),e.loading=!1},function(){e.loading=!1})},validateIpAddressLen:function(e,t,a){var o=this,s=""===o.form[e.conmsg]||null==o.form[e.conmsg]?[]:o.form[e.conmsg].split("\n");e.items.map(function(e){null!=e.start&&null!=e.end&&o.common.arrayMerge(s,o.getIpInRange(e.start,e.end))}),s.length<=50?a():a(new Error(e.message))},createFileShare:function(){this.disable=!0;var e=this;this.$refs.file_form.validate(function(t){if(t){e.form.hosts_allow=""===e.form.hosts_allow||null==e.form.hosts_allow?[]:e.form.hosts_allow.split("\n"),e.form.hosts_deny=""===e.form.hosts_deny||null==e.form.hosts_deny?[]:e.form.hosts_deny.split("\n"),e.form.access_host=""===e.form.access_host||null==e.form.access_host?[]:e.form.access_host.split("\n"),e.form.write_host=""===e.form.write_host||null==e.form.write_host?[]:e.form.write_host.split("\n"),e.getAllRangeColumn(),delete e.form.allow_range,delete e.form.deny_range,delete e.form.nfs_allow_range,delete e.form.nfs_deny_range;var a=e.common.deepCopyByJson(e.common.dropEmptyParameter(e.form));e.form.hosts_allow="",e.form.hosts_deny="",e.form.access_host="",e.form.write_host="",e.checkError(e.$http({url:e.api.shares.shares,method:"post",data:a}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageFileShare.createFileShareSuccess}),e.closeModal(!0)},function(){e.closeModal(!1)})}else e.disable=!1})},checkStep:function(e){var t=this;!0===e?this.$refs.file_form.validate(function(e){e&&(t.stepIndex=t.nextStep,t.nextStep=t.completeIndex)}):(2===this.stepIndex?this.services.indexOf("cifs")>-1?this.stepIndex=1:this.stepIndex=0:this.stepIndex--,null!=this.$refs.file_form&&this.$refs.file_form.clearValidate()),2===this.stepIndex&&this.getSquashBase()},validateShareName:function(e,t,a){null==t||""===t||!0===/^[A-Za-z0-9][A-Za-z0-9_]*$/.test(t)?a():a(new Error(e.message))},validateIpEndRange:function(e,t,a){null!=e.start&&""!==e.start&&null!=t&&""!==t||a(),this.common.getLargerIp(e.start,t)===e.start?a(Error(e.message)):a()},newAddress:function(e){e.push({start:null,end:null})},deleteAddress:function(e,t){e.splice(t,1)},validateIpRange:function(){var e=["hosts_allow","hosts_deny","access_host","write_host"];!0===this.allowIpRange&&this.form.allow_range.map(function(t,a){e.push("allow_range."+a+".start"),e.push("allow_range."+a+".end")}),!0===this.denyIpRange&&this.form.deny_range.map(function(t,a){e.push("deny_range."+a+".start"),e.push("deny_range."+a+".end")}),!0===this.nfsAllowIpRange&&this.form.nfs_allow_range.map(function(t,a){e.push("nfs_allow_range."+a+".start"),e.push("nfs_allow_range."+a+".end")}),!0===this.nfsDenyIpRange&&this.form.nfs_deny_range.map(function(t,a){e.push("nfs_deny_range."+a+".start"),e.push("nfs_deny_range."+a+".end")});var t=!0;return this.$refs.file_form.validateField(e,function(e){t=null==e||""===e}),t},selectUser:function(){this.showSelectUser=!0,this.userOrigin=[],this.getUserList()},selectGroup:function(){this.showSelectGroup=!0,this.groupOrigin=[],this.getGroupList()},getUserList:function(e){var t=this,a=!0===e?"?t=nfs":"";this.checkError(this.$http({url:this.api.user.user+a,method:"get"}),function(e){t.userOrigin=e.data})},getGroupList:function(e){var t=this,a=!0===e?"?t=nfs":"";this.checkError(this.$http({url:this.api.group.group+a,method:"get"}),function(e){t.groupOrigin=e.data})},getSelectedUser:function(){this.users=this.preUsers,this.closeChildDialog()},getSelectedGroup:function(){this.groups=this.preGroups,this.closeChildDialog()},closeChildDialog:function(){this.preGroups=[],this.preUsers=[],this.showSelectUser=!1,this.showSelectGroup=!1},userAccessChange:function(e){var t=this.form.read_user.indexOf(e.name),a=this.form.write_user.indexOf(e.name),o=this.form.admin_users.indexOf(e.name);switch(e.access){case"ro":this.form.read_user.push(e.name),a>-1&&this.form.write_user.splice(a,1),o>-1&&this.form.admin_users.splice(o,1);break;case"rw":this.form.write_user.push(e.name),t>-1&&this.form.read_user.splice(t,1),o>-1&&this.form.admin_users.splice(o,1);break;case"super":this.form.admin_users.push(e.name),t>-1&&this.form.read_user.splice(t,1),a>-1&&this.form.write_user.splice(a,1)}e.show=!1},groupAccessChange:function(e){var t=this.form.read_group.indexOf(e.name),a=this.form.write_group.indexOf(e.name),o=this.form.admin_groups.indexOf(e.name);switch(e.access){case"ro":this.form.read_group.push(e.name),a>-1&&this.form.write_group.splice(a,1),o>-1&&this.form.admin_groups.splice(o,1);break;case"rw":this.form.write_group.push(e.name),t>-1&&this.form.read_group.splice(t,1),o>-1&&this.form.admin_groups.splice(o,1);break;case"super":this.form.admin_groups.push(e.name),t>-1&&this.form.read_group.splice(t,1),a>-1&&this.form.write_group.splice(a,1)}e.show=!1},getSquashBase:function(){this.getUserList(!0),this.getGroupList(!0)},getAllRangeColumn:function(){var e=this;this.form.allow_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.hosts_allow,e.getIpInRange(t.start,t.end))}),this.form.deny_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.hosts_deny,e.getIpInRange(t.start,t.end))}),this.form.nfs_allow_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.access_host,e.getIpInRange(t.start,t.end))}),this.form.nfs_deny_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.write_host,e.getIpInRange(t.start,t.end))})},getIpInRange:function(e,t){if(null==e||null==t||""===e||""===t)return[];for(var a=e,o=[];this.common.getLargerIp(a,t)===t&&(o.push(a),a!==t);){for(var s=a.split(".").reverse(),l=0;l<4&&-1!==l;){if(!(s[l]>=255)){s[l]++,l=-1;break}l++}a=s.reverse().join("."),o.push(a)}return o},getSystemType:function(){var e=this;this.checkError(this.$http({url:this.api.storage.get_type,method:"get"}),function(t){e.systemType=t.data})}},data:function(){return{labelWidth:"120px",form:{name:"",volume:"",cifs:"no",nfs:"no",browseable:"yes",read_only:"no",create_mask:"0744",directory_mask:"0755",hosts_allow:"",hosts_deny:"",guest_ok:"no",read_user:[],write_user:[],admin_users:[],read_group:[],write_group:[],admin_groups:[],sync:"no",access_host:"",write_host:"",no_root_squash:"no",squash_user:"",squash_group:"",allow_range:[{start:"",end:""}],deny_range:[{start:"",end:""}],nfs_allow_range:[{start:"",end:""}],nfs_deny_range:[{start:"",end:""}]},stepIndex:0,nextStep:0,completeIndex:0,accessControl:"allow",nfsAccessControl:"allow",allowIpRange:!1,denyIpRange:!1,nfsAllowIpRange:!1,nfsDenyIpRange:!1,rules:{name:[{required:!0,message:this.lang.poolStorageFileShare.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.poolStorageFileShare.nameLengthRule,trigger:"blur"},{validator:this.validateShareName,message:this.lang.poolStorageFileShare.nameFormatRule,trigger:"blur"}],volume:[{required:!0,message:this.lang.poolStorageFileShare.volumeRequiredRule,trigger:"blur"}],create_mask:[{required:!0,message:this.lang.poolStorageFileShare.createMaskRequiredRule,trigger:"blur"},{validator:this.validateLinuxMask,message:this.lang.poolStorageFileShare.createMaskFormatRule,trigger:"blur"}],directory_mask:[{required:!0,message:this.lang.poolStorageFileShare.directoryMaskRequiredRule,trigger:"blur"},{validator:this.validateLinuxMask,message:this.lang.poolStorageFileShare.directoryMaskFormatRule,trigger:"blur"}],hosts_allow:[{validator:this.common.validateDnsServers,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}],hosts_deny:[{validator:this.common.validateDnsServers,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}],access_host:[{validator:this.common.validateDnsServers,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}],write_host:[{validator:this.common.validateDnsServers,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}]},langStepConfig:[this.lang.poolStorageFileShare.baseSeting,this.lang.poolStorageFileShare.cifs,this.lang.poolStorageFileShare.nfs],volumes:[],services:[],users:[],groups:[],preUsers:[],preGroups:[],userOrigin:[],groupOrigin:[],usersInfo:[],groupInfo:[],cifs:!1,nfs:!1,accessConf:{ro:this.lang.poolStorageFileShare.roAccess,rw:this.lang.poolStorageFileShare.rwAccess,super:this.lang.poolStorageFileShare.superAccess},showSelectUser:!1,showSelectGroup:!1,disable:!1,loading:!1,systemType:""}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageFileShare.createShare,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"file_form",attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-steps",{attrs:{active:e.stepIndex,"align-center":!0,"process-status":"finish","finish-status":"success"}},e._l(e.langStepConfig,function(e,t){return a("el-step",{key:t,attrs:{title:e,icon:"fa fa-circle"}})}),1),e._v(" "),0===e.stepIndex?a("div",{staticClass:"step-padding-top"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.shareName,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageFileShare.shareNamePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.volumeName,"label-width":e.labelWidth,prop:"volume"}},[a("el-select",{attrs:{filterable:"",placeholder:e.lang.poolStorageFileShare.volumeNamePlaceholder,width:"100%"},model:{value:e.form.volume,callback:function(t){e.$set(e.form,"volume",t)},expression:"form.volume"}},e._l(e.volumes,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.path}})}),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.pool.share,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.cifs,"true-label":"yes","false-label":"no"},model:{value:e.form.cifs,callback:function(t){e.$set(e.form,"cifs",t)},expression:"form.cifs"}}),e._v(" "),a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.nfs,"true-label":"yes","false-label":"no"},model:{value:e.form.nfs,callback:function(t){e.$set(e.form,"nfs",t)},expression:"form.nfs"}})],1)],1)],1)],1)],1):e._e(),e._v(" "),1===e.stepIndex?a("div",{staticClass:"step-padding-top"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.browseable,"true-label":"yes","false-label":"no"},model:{value:e.form.browseable,callback:function(t){e.$set(e.form,"browseable",t)},expression:"form.browseable"}}),e._v(" "),a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.readonly,"true-label":"yes","false-label":"no"},model:{value:e.form.read_only,callback:function(t){e.$set(e.form,"read_only",t)},expression:"form.read_only"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.createMask,"label-width":e.labelWidth,prop:"create_mask"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageFileShare.createMaskPlaceholder},model:{value:e.form.create_mask,callback:function(t){e.$set(e.form,"create_mask",t)},expression:"form.create_mask"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.directoryMask,"label-width":e.labelWidth,prop:"directory_mask"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageFileShare.directoryMaskPlaceholder},model:{value:e.form.directory_mask,callback:function(t){e.$set(e.form,"directory_mask",t)},expression:"form.directory_mask"}})],1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"space-between"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.ipAccessControl))]),e._v(" "),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.poolStorageFileShare.accessIpInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"fa fa-question-circle"})])],1),e._v(" "),a("el-tabs",{attrs:{"tab-position":"left","before-leave":e.validateIpRange},model:{value:e.accessControl,callback:function(t){e.accessControl=t},expression:"accessControl"}},[a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.allowAccessIp,name:"allow"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"hosts_allow"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.hosts_allow,callback:function(t){e.$set(e.form,"hosts_allow",t)},expression:"form.hosts_allow"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.allowIpRange,callback:function(t){e.allowIpRange=t},expression:"allowIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.allowIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},[e._l(e.form.allow_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"allow_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"allow_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.allow_range,conmsg:"hosts_allow",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.allow_range.length?a("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.deleteAddress(e.form.allow_range,o)}}},[e._v("\n                                                    "+e._s(e.lang.common.delete)+"\n                                                ")]):e._e()],1)],1)],1)}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.newAddress(e.form.allow_range)}}},[e._v("\n                                        "+e._s(e.lang.common.create)+"\n                                    ")])],2)],1)],1)],1):e._e()],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.denyAccessIp,name:"deny"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"hosts_deny"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.hosts_deny,callback:function(t){e.$set(e.form,"hosts_deny",t)},expression:"form.hosts_deny"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.denyIpRange,callback:function(t){e.denyIpRange=t},expression:"denyIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.denyIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},[e._l(e.form.deny_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"deny_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"deny_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.deny_range,conmsg:"hosts_deny",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.deny_range.length?a("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.deleteAddress(e.form.deny_range,o)}}},[e._v("\n                                                    "+e._s(e.lang.common.delete)+"\n                                                ")]):e._e()],1)],1)],1)}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.newAddress(e.form.deny_range)}}},[e._v("\n                                        "+e._s(e.lang.common.create)+"\n                                    ")])],2)],1)],1)],1):e._e()],1)],1),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"start"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.userGroupAccessControl))])]),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.anonymousAccess,"label-width":e.labelWidth}},[a("el-radio-group",{model:{value:e.form.guest_ok,callback:function(t){e.$set(e.form,"guest_ok",t)},expression:"form.guest_ok"}},[a("el-radio",{attrs:{label:"yes"}},[e._v(e._s(e.lang.common.yes))]),e._v(" "),a("el-radio",{attrs:{label:"no"}},[e._v(e._s(e.lang.common.no))])],1)],1)],1)],1),e._v(" "),"no"===e.form.guest_ok?a("div",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("span",[e._v(e._s(e.lang.poolStorageFileShare.userAccess))]),e._v(" "),a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:e.selectUser}},[e._v(e._s(e.lang.common.update))])],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-table",{ref:"singleTable",staticClass:"cloud-table modal-table",staticStyle:{width:"100%"},attrs:{data:e.usersInfo,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.username,sortable:"",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.access,sortable:"",prop:"access",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:function(e){t.row.show=!t.row.show}}},[e._v("\n                                            "+e._s(e.accessConf[t.row.access])+"\n                                            "),!1===t.row.show?a("i",{staticClass:"fa fa-lock",staticStyle:{"margin-left":"10px"}}):a("i",{staticClass:"fa fa-unlock",staticStyle:{"margin-left":"10px"}})])]}}],null,!1,27438355)}),e._v(" "),a("el-table-column",{attrs:{width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.row.show,expression:"scope.row.show"}],on:{change:function(a){return e.userAccessChange(t.row)}},model:{value:t.row.access,callback:function(a){e.$set(t.row,"access",a)},expression:"scope.row.access"}},[a("el-radio",{attrs:{label:"ro"}},[e._v(e._s(e.lang.poolStorageFileShare.roAccess))]),e._v(" "),a("el-radio",{attrs:{label:"rw"}},[e._v(e._s(e.lang.poolStorageFileShare.rwAccess))]),e._v(" "),a("el-radio",{attrs:{label:"super"}},[e._v(e._s(e.lang.poolStorageFileShare.superAccess))])],1)]}}],null,!1,3710881091)})],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"space-between"}},[a("span",[e._v(e._s(e.lang.poolStorageFileShare.groupAccess))]),e._v(" "),a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:e.selectGroup}},[e._v(e._s(e.lang.common.update))])],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-table",{ref:"singleTable",staticClass:"cloud-table modal-table",staticStyle:{width:"100%"},attrs:{data:e.groupInfo,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.groupName,sortable:"",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.access,sortable:"",prop:"access",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:function(e){t.row.show=!t.row.show}}},[e._v("\n                                            "+e._s(e.accessConf[t.row.access])+"\n                                            "),!1===t.row.show?a("i",{staticClass:"fa fa-lock",staticStyle:{"margin-left":"10px"}}):a("i",{staticClass:"fa fa-unlock",staticStyle:{"margin-left":"10px"}})])]}}],null,!1,27438355)}),e._v(" "),a("el-table-column",{attrs:{width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.row.show,expression:"scope.row.show"}],on:{change:function(a){return e.groupAccessChange(t.row)}},model:{value:t.row.access,callback:function(a){e.$set(t.row,"access",a)},expression:"scope.row.access"}},[a("el-radio",{attrs:{label:"ro"}},[e._v(e._s(e.lang.poolStorageFileShare.roAccess))]),e._v(" "),a("el-radio",{attrs:{label:"rw"}},[e._v(e._s(e.lang.poolStorageFileShare.rwAccess))]),e._v(" "),a("el-radio",{attrs:{label:"super"}},[e._v(e._s(e.lang.poolStorageFileShare.superAccess))])],1)]}}],null,!1,727300877)})],1)],1)],1)],1)],1):e._e()],1):e._e(),e._v(" "),2===e.stepIndex?a("div",{staticClass:"step-padding-top"},["FreeBSD"!==e.systemType?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.dataSync,"label-width":e.labelWidth}},[a("el-radio-group",{model:{value:e.form.sync,callback:function(t){e.$set(e.form,"sync",t)},expression:"form.sync"}},[a("el-radio",{attrs:{label:"yes"}},[e._v(e._s(e.lang.common.yes))]),e._v(" "),a("el-radio",{attrs:{label:"no"}},[e._v(e._s(e.lang.common.no))])],1)],1)],1)],1):e._e(),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"space-between"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.ipAccessControl))]),e._v(" "),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.poolStorageFileShare.accessIpInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"fa fa-question-circle"})])],1),e._v(" "),a("el-tabs",{attrs:{"tab-position":"left","before-leave":e.validateIpRange},model:{value:e.nfsAccessControl,callback:function(t){e.nfsAccessControl=t},expression:"nfsAccessControl"}},[a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.allowAccessIp,name:"allow"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"access_host"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.access_host,callback:function(t){e.$set(e.form,"access_host",t)},expression:"form.access_host"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.nfsAllowIpRange,callback:function(t){e.nfsAllowIpRange=t},expression:"nfsAllowIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.nfsAllowIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},[e._l(e.form.nfs_allow_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"nfs_allow_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"nfs_allow_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.nfs_allow_range,conmsg:"access_host",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.nfs_allow_range.length?a("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.deleteAddress(e.form.nfs_allow_range,o)}}},[e._v("\n                                                    "+e._s(e.lang.common.delete)+"\n                                                ")]):e._e()],1)],1)],1)}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.newAddress(e.form.nfs_allow_range)}}},[e._v("\n                                        "+e._s(e.lang.common.create)+"\n                                    ")])],2)],1)],1)],1):e._e()],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.denyAccessIp,name:"deny"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"write_host"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.write_host,callback:function(t){e.$set(e.form,"write_host",t)},expression:"form.write_host"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.nfsDenyIpRange,callback:function(t){e.nfsDenyIpRange=t},expression:"nfsDenyIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.nfsDenyIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},e._l(e.form.nfs_deny_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"nfs_deny_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"nfs_deny_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.nfs_deny_range,conmsg:"write_host",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.nfs_deny_range.length?a("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.deleteAddress(e.form.nfs_deny_range,o)}}},[e._v("\n                                                    "+e._s(e.lang.common.delete)+"\n                                                ")]):e._e()],1)],1)],1)}),1),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.newAddress(e.form.nfs_deny_range)}}},[e._v("\n                                    "+e._s(e.lang.common.create)+"\n                                ")])],1)],1)],1):e._e()],1)],1),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"start"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.userGroupAccessControl))])]),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.denySquashUser,"label-width":e.labelWidth}},[a("el-radio-group",{model:{value:e.form.no_root_squash,callback:function(t){e.$set(e.form,"no_root_squash",t)},expression:"form.no_root_squash"}},[a("el-radio",{attrs:{label:"yes"}},[e._v(e._s(e.lang.common.yes))]),e._v(" "),a("el-radio",{attrs:{label:"no"}},[e._v(e._s(e.lang.common.no))])],1)],1)],1)],1),e._v(" "),"no"===e.form.no_root_squash?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.squashUser,"label-width":e.labelWidth}},[a("el-select",{attrs:{filterable:"",placeholder:e.lang.poolStorageFileShare.userPlaceholder,width:"100%"},model:{value:e.form.squash_user,callback:function(t){e.$set(e.form,"squash_user",t)},expression:"form.squash_user"}},e._l(e.userOrigin,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})}),1)],1)],1)],1):e._e(),e._v(" "),"no"===e.form.no_root_squash?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.squashGroup,"label-width":e.labelWidth}},[a("el-select",{attrs:{filterable:"",placeholder:e.lang.poolStorageFileShare.groupPlaceholder,width:"100%"},model:{value:e.form.squash_group,callback:function(t){e.$set(e.form,"squash_group",t)},expression:"form.squash_group"}},e._l(e.groupOrigin,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})}),1)],1)],1)],1):e._e()],1):e._e()],1),e._v(" "),a("el-dialog",{attrs:{title:e.lang.poolStorageFileShare.selectUser,visible:e.showSelectUser,"append-to-body":"",width:"40%"},on:{close:e.closeChildDialog,open:function(t){e.preUsers=e.users}}},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.member}},[a("el-col",{attrs:{span:24}},[a("el-transfer",{attrs:{filterable:"",titles:[e.lang.poolStorageFileShare.availableMember,e.lang.poolStorageGroup.selectedMember],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},props:{label:"name",key:"name"},data:e.userOrigin},model:{value:e.preUsers,callback:function(t){e.preUsers=t},expression:"preUsers"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeChildDialog}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getSelectedUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.lang.poolStorageFileShare.selectGroup,visible:e.showSelectGroup,"append-to-body":"",width:"40%"},on:{close:e.closeChildDialog,open:function(t){e.preGroups=e.groups}}},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.userGroup}},[a("el-col",{attrs:{span:24}},[a("el-transfer",{attrs:{filterable:"",titles:[e.lang.poolStorageFileShare.availableGroup,e.lang.poolStorageFileShare.selectedGroup],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},props:{label:"name",key:"name"},data:e.groupOrigin},model:{value:e.preGroups,callback:function(t){e.preGroups=t},expression:"preGroups"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeChildDialog}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getSelectedGroup}},[e._v(e._s(e.lang.common.confirm))])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.stepIndex>0?a("el-button",{on:{click:function(t){return e.checkStep(!1)}}},[e._v(e._s(e.lang.common.prevStep))]):e._e(),e._v(" "),e.stepIndex!==e.nextStep?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.checkStep(!0)}}},[e._v(e._s(e.lang.common.nextStep))]):e._e(),e._v(" "),e.stepIndex===e.completeIndex?a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createFileShare}},[e._v(e._s(e.lang.common.complete))]):e._e(),e._v(" "),a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))])],1)],1)},staticRenderFns:[]};var u=a("C7Lr")(i,c,!1,function(e){a("Oi0q"),a("XNQU")},"data-v-750af840",null).exports,d={name:"pana-delete-user",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteUser:function(){this.closeModal(!0)}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.poolStorageFileShare.confirmDeleteFileShare))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},p=a("C7Lr")(d,m,!1,null,null,null).exports,g={name:"pana-create-file",components:{"pana-ip-input":a("Cj+A").a},props:{show:Boolean,shareName:String},watch:{"form.cifs":function(e){"yes"===e?this.services.push("cifs"):this.services.splice(this.services.indexOf("cifs"),1)},"form.nfs":function(e){"yes"===e?this.services.push("nfs"):this.services.splice(this.services.indexOf("nfs"),1)},services:function(e){0===e.length?(this.nextStep=0,this.completeIndex=0):e.indexOf("cifs")>-1?(this.nextStep=1,this.completeIndex=1,e.indexOf("nfs")>-1&&(this.completeIndex=2)):(this.nextStep=2,this.completeIndex=2)},users:function(e,t){var a=this;e=this.common.deepCopyByJson(e),t=(t=this.common.deepCopyByJson(t)).filter(function(t){return!(e.indexOf(t)>-1)||(e.splice(e.indexOf(t),1),!1)}),this.usersInfo=this.usersInfo.filter(function(e){return!(t.indexOf(e.name)>-1)||(a.form.read_user.splice(a.form.read_user.indexOf(e),1),a.form.write_user.splice(a.form.write_user.indexOf(e),1),a.form.admin_users.splice(a.form.admin_users.indexOf(e),1),!1)}),e.map(function(e){a.usersInfo.push({name:e,access:"ro",show:!1}),a.form.read_user.push(e)})},groups:function(e,t){var a=this;e=this.common.deepCopyByJson(e),t=(t=this.common.deepCopyByJson(t)).filter(function(t){return!(e.indexOf(t)>-1)||(e.splice(e.indexOf(t),1),!1)}),this.groupInfo=this.groupInfo.filter(function(e){return!(t.indexOf(e.name)>-1)||(a.form.read_group.splice(a.form.read_group.indexOf(e),1),a.form.write_group.splice(a.form.write_group.indexOf(e),1),a.form.admin_groups.splice(a.form.admin_groups.indexOf(e),1),!1)}),e.map(function(e){a.groupInfo.push({name:e,access:"ro",show:!1}),a.form.read_group.push(e)})}},methods:{closeModal:function(e){e=e||!1,n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getShareInfo(),this.getVolumeList(),this.getSystemType()},getShareInfo:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.common.formatMsg(this.api.shares.shares_detail,{name:this.shareName}),method:"get"}),function(t){var a=t.data[0],o=["hosts_allow","hosts_deny","write_host","access_host"];for(var s in a)a.hasOwnProperty(s)&&e.form.hasOwnProperty(s)&&(-1===o.indexOf(s)?e.form[s]=a[s]:e.form[s]=a[s].join("\n"));null!=a.read_user&&a.read_user.map(function(t){e.users.push(t),e.usersInfo.push({name:t,access:"ro",show:!1})}),null!=a.write_user&&a.write_user.map(function(t){e.users.push(t),e.usersInfo.push({name:t,access:"rw",show:!1})}),null!=a.admin_users&&a.admin_users.map(function(t){e.users.push(t),e.usersInfo.push({name:t,access:"super",show:!1})}),null!=a.read_group&&a.read_group.map(function(t){e.groups.push(t),e.groupInfo.push({name:t,access:"ro",show:!1})}),null!=a.write_group&&a.write_group.map(function(t){e.groups.push(t),e.groupInfo.push({name:t,access:"rw",show:!1})}),null!=a.admin_groups&&a.admin_groups.map(function(t){e.groups.push(t),e.groupInfo.push({name:t,access:"super",show:!1})}),e.loading=!1})},getVolumeList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.dataset.dataset,method:"get"}),function(t){e.loading=!1,e.volumes=t.data},function(){e.loading=!1})},validateIpAddressLen:function(e,t,a){var o=this,s=""===o.form[e.conmsg]||null==o.form[e.conmsg]?[]:o.form[e.conmsg].split("\n");e.items.map(function(e){null!=e.start&&null!=e.end&&o.common.arrayMerge(s,o.getIpInRange(e.start,e.end))}),s.length<=50?a():a(new Error(e.message))},editFileShare:function(){this.disable=!0;var e=this;this.$refs.form.validate(function(t){if(t){e.form.hosts_allow=""===e.form.hosts_allow||null==e.form.hosts_allow?[]:e.form.hosts_allow.split("\n"),e.form.hosts_deny=""===e.form.hosts_deny||null==e.form.hosts_deny?[]:e.form.hosts_deny.split("\n"),e.form.access_host=""===e.form.access_host||null==e.form.access_host?[]:e.form.access_host.split("\n"),e.form.write_host=""===e.form.write_host||null==e.form.write_host?[]:e.form.write_host.split("\n"),e.getAllRangeColumn(),delete e.form.allow_range,delete e.form.deny_range,delete e.form.nfs_allow_range,delete e.form.nfs_deny_range;var a=e.common.deepCopyByJson(e.common.dropEmptyParameter(e.form));e.form.hosts_allow="",e.form.hosts_deny="",e.form.access_host="",e.form.write_host="",e.checkError(e.$http({url:e.common.formatMsg(e.api.shares.shares_detail,{name:e.shareName}),method:"put",data:a}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageFileShare.editFileShareSuccess}),e.closeModal(!0)},function(){e.disable=!1})}else e.disable=!1})},checkStep:function(e){var t=this;!0===e?this.$refs.form.validate(function(e){e&&(t.stepIndex=t.nextStep,t.nextStep=t.completeIndex)}):(2===this.stepIndex?this.services.indexOf("cifs")>-1?this.stepIndex=1:this.stepIndex=0:this.stepIndex--,null!=this.$refs.form&&this.$refs.form.clearValidate()),2===this.stepIndex&&this.getSquashBase()},validateShareName:function(e,t,a){null==t||""===t||!0===/^[A-Za-z0-9][A-Za-z0-9_]*$/.test(t)?a():a(new Error(e.message))},validateIpEndRange:function(e,t,a){null!=e.start&&""!==e.start&&null!=t&&""!==t||a(),this.common.getLargerIp(e.start,t)===e.start?a(Error(e.message)):a()},newAddress:function(e){e.push({start:null,end:null})},deleteAddress:function(e,t){e.splice(t,1)},validateIpRange:function(){var e=["hosts_allow","hosts_deny","access_host","write_host"];!0===this.allowIpRange&&this.form.allow_range.map(function(t,a){e.push("allow_range."+a+".start"),e.push("allow_range."+a+".end")}),!0===this.denyIpRange&&this.form.deny_range.map(function(t,a){e.push("deny_range."+a+".start"),e.push("deny_range."+a+".end")}),!0===this.nfsAllowIpRange&&this.form.nfs_allow_range.map(function(t,a){e.push("nfs_allow_range."+a+".start"),e.push("nfs_allow_range."+a+".end")}),!0===this.nfsDenyIpRange&&this.form.nfs_deny_range.map(function(t,a){e.push("nfs_deny_range."+a+".start"),e.push("nfs_deny_range."+a+".end")});var t=!0;return this.$refs.form.validateField(e,function(e){t=null==e||""===e}),t},selectUser:function(){this.showSelectUser=!0,this.getUserList()},selectGroup:function(){this.showSelectGroup=!0,this.getGroupList()},getUserList:function(e){var t=this,a=!0===e?"?t=nfs":"";this.checkError(this.$http({url:this.api.user.user+a,method:"get"}),function(e){t.userOrigin=e.data})},getGroupList:function(e){var t=this,a=!0===e?"?t=nfs":"";this.checkError(this.$http({url:this.api.group.group+a,method:"get"}),function(e){t.groupOrigin=e.data})},getSelectedUser:function(){this.users=this.preUsers,this.closeChildDialog()},getSelectedGroup:function(){this.groups=this.preGroups,this.closeChildDialog()},closeChildDialog:function(){this.preGroups=[],this.preUsers=[],this.showSelectUser=!1,this.showSelectGroup=!1},userAccessChange:function(e){var t=this.form.read_user.indexOf(e.name),a=this.form.write_user.indexOf(e.name),o=this.form.admin_users.indexOf(e.name);switch(e.access){case"ro":this.form.read_user.push(e.name),a>-1&&this.form.write_user.splice(a,1),o>-1&&this.form.admin_users.splice(o,1);break;case"rw":this.form.write_user.push(e.name),t>-1&&this.form.read_user.splice(t,1),o>-1&&this.form.admin_users.splice(o,1);break;case"super":this.form.admin_users.push(e.name),t>-1&&this.form.read_user.splice(t,1),a>-1&&this.form.write_user.splice(a,1)}e.show=!1},groupAccessChange:function(e){var t=this.form.read_group.indexOf(e.name),a=this.form.write_group.indexOf(e.name),o=this.form.admin_groups.indexOf(e.name);switch(e.access){case"ro":this.form.read_group.push(e.name),a>-1&&this.form.write_group.splice(a,1),o>-1&&this.form.admin_groups.splice(o,1);break;case"rw":this.form.write_group.push(e.name),t>-1&&this.form.read_group.splice(t,1),o>-1&&this.form.admin_groups.splice(o,1);break;case"super":this.form.admin_groups.push(e.name),t>-1&&this.form.read_group.splice(t,1),a>-1&&this.form.write_group.splice(a,1)}e.show=!1},getSquashBase:function(){0===this.userOrigin.length&&this.getUserList(!0),0===this.groupOrigin.length&&this.getGroupList(!0)},getAllRangeColumn:function(){var e=this;this.form.allow_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.hosts_allow,e.getIpInRange(t.start,t.end))}),this.form.deny_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.hosts_deny,e.getIpInRange(t.start,t.end))}),this.form.nfs_allow_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.access_host,e.getIpInRange(t.start,t.end))}),this.form.nfs_deny_range.map(function(t){null!=t.start&&null!=t.end&&e.common.arrayMerge(e.form.write_host,e.getIpInRange(t.start,t.end))})},getIpInRange:function(e,t){if(null==e||null==t||""===e||""===t)return[];for(var a=e,o=[];this.common.getLargerIp(a,t)===t&&(o.push(a),a!==t);){for(var s=a.split(".").reverse(),l=0;l<4&&-1!==l;){if(!(s[l]>=255)){s[l]++,l=-1;break}l++}a=s.reverse().join("."),o.push(a)}return o},validateIps:function(e,t,a){""!==t&&null!=t||a();var o=!0,s=/^((?=(\b|\D))(((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))\.){3}((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))(?=(\b|\D))|\*)$/;t.split("\n").map(function(e){!1===s.test(e)&&(o=!1)}),!0===o?a():a(new Error(e.message))},getSystemType:function(){var e=this;this.checkError(this.$http({url:this.api.storage.get_type,method:"get"}),function(t){e.systemType=t.data})}},data:function(){return{labelWidth:"120px",form:{name:"",volume:"",cifs:"no",nfs:"no",browseable:"yes",read_only:"no",create_mask:"0744",directory_mask:"0755",hosts_allow:"",hosts_deny:"",guest_ok:"no",read_user:[],write_user:[],admin_users:[],read_group:[],write_group:[],admin_groups:[],sync:"no",access_host:"",write_host:"",no_root_squash:"no",squash_user:"",squash_group:"",allow_range:[{start:"",end:""}],deny_range:[{start:"",end:""}],nfs_allow_range:[{start:"",end:""}],nfs_deny_range:[{start:"",end:""}]},stepIndex:0,nextStep:0,completeIndex:0,accessControl:"allow",nfsAccessControl:"allow",allowIpRange:!1,denyIpRange:!1,nfsAllowIpRange:!1,nfsDenyIpRange:!1,rules:{name:[{required:!0,message:this.lang.poolStorageFileShare.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.poolStorageFileShare.nameLengthRule,trigger:"blur"},{validator:this.validateShareName,message:this.lang.poolStorageFileShare.nameFormatRule,trigger:"blur"}],volume:[{required:!0,message:this.lang.poolStorageFileShare.volumeRequiredRule,trigger:"blur"}],create_mask:[{required:!0,message:this.lang.poolStorageFileShare.createMaskRequiredRule,trigger:"blur"},{validator:this.validateLinuxMask,message:this.lang.poolStorageFileShare.createMaskFormatRule,trigger:"blur"}],directory_mask:[{required:!0,message:this.lang.poolStorageFileShare.directoryMaskRequiredRule,trigger:"blur"},{validator:this.validateLinuxMask,message:this.lang.poolStorageFileShare.directoryMaskFormatRule,trigger:"blur"}],hosts_allow:[{validator:this.validateIps,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}],hosts_deny:[{validator:this.validateIps,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}],access_host:[{validator:this.validateIps,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}],write_host:[{validator:this.validateIps,message:this.lang.poolStorageFileShare.hostsFormatRule,trigger:"blur"},{validator:this.common.validateDnsServersLen,message:"ip名单不能超过50条",trigger:"blur"}]},langStepConfig:[this.lang.poolStorageFileShare.baseSeting,this.lang.poolStorageFileShare.cifs,this.lang.poolStorageFileShare.nfs],volumes:[],services:[],users:[],groups:[],preUsers:[],preGroups:[],userOrigin:[],groupOrigin:[],usersInfo:[],groupInfo:[],cifs:!1,nfs:!1,accessConf:{ro:this.lang.poolStorageFileShare.roAccess,rw:this.lang.poolStorageFileShare.rwAccess,super:this.lang.poolStorageFileShare.superAccess},showSelectUser:!1,showSelectGroup:!1,disable:!1,loading:!1,systemType:""}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageFileShare.editFile,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-steps",{attrs:{active:e.stepIndex,"align-center":!0,"process-status":"finish","finish-status":"success"}},e._l(e.langStepConfig,function(e,t){return a("el-step",{key:t,attrs:{title:e,icon:"fa fa-circle"}})}),1),e._v(" "),0===e.stepIndex?a("div",{staticClass:"step-padding-top"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.shareName,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageFileShare.shareNamePlaceholder,disabled:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.volumeName,"label-width":e.labelWidth,prop:"volume"}},[a("el-select",{attrs:{filterable:"",placeholder:e.lang.poolStorageFileShare.volumeNamePlaceholder,disabled:"",width:"100%"},model:{value:e.form.volume,callback:function(t){e.$set(e.form,"volume",t)},expression:"form.volume"}},e._l(e.volumes,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.path}})}),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.pool.share,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.cifs,"true-label":"yes","false-label":"no"},model:{value:e.form.cifs,callback:function(t){e.$set(e.form,"cifs",t)},expression:"form.cifs"}}),e._v(" "),a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.nfs,"true-label":"yes","false-label":"no"},model:{value:e.form.nfs,callback:function(t){e.$set(e.form,"nfs",t)},expression:"form.nfs"}})],1)],1)],1)],1)],1):e._e(),e._v(" "),1===e.stepIndex?a("div",{staticClass:"step-padding-top"},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.browseable,"true-label":"yes","false-label":"no"},model:{value:e.form.browseable,callback:function(t){e.$set(e.form,"browseable",t)},expression:"form.browseable"}}),e._v(" "),a("el-checkbox",{attrs:{label:e.lang.poolStorageFileShare.readonly,"true-label":"yes","false-label":"no"},model:{value:e.form.read_only,callback:function(t){e.$set(e.form,"read_only",t)},expression:"form.read_only"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.createMask,"label-width":e.labelWidth,prop:"create_mask"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageFileShare.createMaskPlaceholder},model:{value:e.form.create_mask,callback:function(t){e.$set(e.form,"create_mask",t)},expression:"form.create_mask"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.directoryMask,"label-width":e.labelWidth,prop:"directory_mask"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageFileShare.directoryMaskPlaceholder},model:{value:e.form.directory_mask,callback:function(t){e.$set(e.form,"directory_mask",t)},expression:"form.directory_mask"}})],1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"space-between"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.ipAccessControl))]),e._v(" "),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.poolStorageFileShare.accessIpInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"fa fa-question-circle"})])],1),e._v(" "),a("el-tabs",{attrs:{"tab-position":"left","before-leave":e.validateIpRange},model:{value:e.accessControl,callback:function(t){e.accessControl=t},expression:"accessControl"}},[a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.allowAccessIp,name:"allow"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"hosts_allow"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.hosts_allow,callback:function(t){e.$set(e.form,"hosts_allow",t)},expression:"form.hosts_allow"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.allowIpRange,callback:function(t){e.allowIpRange=t},expression:"allowIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.allowIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},e._l(e.form.allow_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"allow_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"allow_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.allow_range,conmsg:"hosts_allow",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.allow_range.length?a("el-button",{staticClass:"fa fa-minus",staticStyle:{color:"#67C23A"},attrs:{type:"text"},on:{click:function(t){return e.deleteAddress(e.form.allow_range,o)}}}):e._e(),e._v(" "),e.form.allow_range.length-1===o?a("el-button",{staticClass:"fa fa-plus",attrs:{type:"text"},on:{click:function(t){return e.newAddress(e.form.allow_range)}}}):e._e()],1)],1)],1)}),1)],1)],1)],1):e._e()],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.denyAccessIp,name:"deny"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"hosts_deny"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.hosts_deny,callback:function(t){e.$set(e.form,"hosts_deny",t)},expression:"form.hosts_deny"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.denyIpRange,callback:function(t){e.denyIpRange=t},expression:"denyIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.denyIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},e._l(e.form.deny_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"deny_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"deny_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.deny_range,conmsg:"hosts_deny",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.deny_range.length?a("el-button",{staticClass:"fa fa-minus",staticStyle:{color:"#67C23A"},attrs:{type:"text"},on:{click:function(t){return e.deleteAddress(e.form.deny_range,o)}}}):e._e(),e._v(" "),e.form.deny_range.length-1===o?a("el-button",{staticClass:"fa fa-plus",attrs:{type:"text"},on:{click:function(t){return e.newAddress(e.form.deny_range)}}}):e._e()],1)],1)],1)}),1)],1)],1)],1):e._e()],1)],1),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"start"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.userGroupAccessControl))])]),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.anonymousAccess,"label-width":e.labelWidth}},[a("el-radio-group",{model:{value:e.form.guest_ok,callback:function(t){e.$set(e.form,"guest_ok",t)},expression:"form.guest_ok"}},[a("el-radio",{attrs:{label:"yes"}},[e._v(e._s(e.lang.common.yes))]),e._v(" "),a("el-radio",{attrs:{label:"no"}},[e._v(e._s(e.lang.common.no))])],1)],1)],1)],1),e._v(" "),"no"===e.form.guest_ok?a("div",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("span",[e._v(e._s(e.lang.poolStorageFileShare.userAccess))]),e._v(" "),a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:e.selectUser}},[e._v(e._s(e.lang.common.update))])],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-table",{ref:"singleTable",staticClass:"cloud-table modal-table",staticStyle:{width:"100%"},attrs:{data:e.usersInfo,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.username,sortable:"",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.access,sortable:"",prop:"access",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:function(e){t.row.show=!t.row.show}}},[e._v("\n                                            "+e._s(e.accessConf[t.row.access])+"\n                                            "),!1===t.row.show?a("i",{staticClass:"fa fa-lock",staticStyle:{"margin-left":"10px"}}):a("i",{staticClass:"fa fa-unlock",staticStyle:{"margin-left":"10px"}})])]}}],null,!1,27438355)}),e._v(" "),a("el-table-column",{attrs:{width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.row.show,expression:"scope.row.show"}],on:{change:function(a){return e.userAccessChange(t.row)}},model:{value:t.row.access,callback:function(a){e.$set(t.row,"access",a)},expression:"scope.row.access"}},[a("el-radio",{attrs:{label:"ro"}},[e._v(e._s(e.lang.poolStorageFileShare.roAccess))]),e._v(" "),a("el-radio",{attrs:{label:"rw"}},[e._v(e._s(e.lang.poolStorageFileShare.rwAccess))]),e._v(" "),a("el-radio",{attrs:{label:"super"}},[e._v(e._s(e.lang.poolStorageFileShare.superAccess))])],1)]}}],null,!1,3710881091)})],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"space-between"}},[a("span",[e._v(e._s(e.lang.poolStorageFileShare.groupAccess))]),e._v(" "),a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:e.selectGroup}},[e._v(e._s(e.lang.common.update))])],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-table",{ref:"singleTable",staticClass:"cloud-table modal-table",staticStyle:{width:"100%"},attrs:{data:e.groupInfo,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.groupName,sortable:"",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.access,sortable:"",prop:"access",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{padding:"0"},attrs:{type:"text"},on:{click:function(e){t.row.show=!t.row.show}}},[e._v("\n                                            "+e._s(e.accessConf[t.row.access])+"\n                                            "),!1===t.row.show?a("i",{staticClass:"fa fa-lock",staticStyle:{"margin-left":"10px"}}):a("i",{staticClass:"fa fa-unlock",staticStyle:{"margin-left":"10px"}})])]}}],null,!1,27438355)}),e._v(" "),a("el-table-column",{attrs:{width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{directives:[{name:"show",rawName:"v-show",value:t.row.show,expression:"scope.row.show"}],on:{change:function(a){return e.groupAccessChange(t.row)}},model:{value:t.row.access,callback:function(a){e.$set(t.row,"access",a)},expression:"scope.row.access"}},[a("el-radio",{attrs:{label:"ro"}},[e._v(e._s(e.lang.poolStorageFileShare.roAccess))]),e._v(" "),a("el-radio",{attrs:{label:"rw"}},[e._v(e._s(e.lang.poolStorageFileShare.rwAccess))]),e._v(" "),a("el-radio",{attrs:{label:"super"}},[e._v(e._s(e.lang.poolStorageFileShare.superAccess))])],1)]}}],null,!1,727300877)})],1)],1)],1)],1)],1):e._e()],1):e._e(),e._v(" "),2===e.stepIndex?a("div",{staticClass:"step-padding-top"},["FreeBSD"!==e.systemType?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.dataSync,"label-width":e.labelWidth}},[a("el-radio-group",{model:{value:e.form.sync,callback:function(t){e.$set(e.form,"sync",t)},expression:"form.sync"}},[a("el-radio",{attrs:{label:"yes"}},[e._v(e._s(e.lang.common.yes))]),e._v(" "),a("el-radio",{attrs:{label:"no"}},[e._v(e._s(e.lang.common.no))])],1)],1)],1)],1):e._e(),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"space-between"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.ipAccessControl))]),e._v(" "),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.poolStorageFileShare.accessIpInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"fa fa-question-circle"})])],1),e._v(" "),a("el-tabs",{attrs:{"tab-position":"left","before-leave":e.validateIpRange},model:{value:e.nfsAccessControl,callback:function(t){e.nfsAccessControl=t},expression:"nfsAccessControl"}},[a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.allowAccessIp,name:"allow"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"access_host"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.access_host,callback:function(t){e.$set(e.form,"access_host",t)},expression:"form.access_host"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.nfsAllowIpRange,callback:function(t){e.nfsAllowIpRange=t},expression:"nfsAllowIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.nfsAllowIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},e._l(e.form.nfs_allow_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"nfs_allow_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"nfs_allow_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.nfs_allow_range,conmsg:"access_host",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.nfs_allow_range.length?a("el-button",{staticClass:"fa fa-minus",staticStyle:{color:"#67C23A"},attrs:{type:"text"},on:{click:function(t){return e.deleteAddress(e.form.nfs_allow_range,o)}}}):e._e(),e._v(" "),e.form.nfs_allow_range.length-1===o?a("el-button",{staticClass:"fa fa-plus",attrs:{type:"text"},on:{click:function(t){return e.newAddress(e.form.nfs_allow_range)}}}):e._e()],1)],1)],1)}),1)],1)],1)],1):e._e()],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.poolStorageFileShare.denyAccessIp,name:"deny"}},[a("el-row",{staticClass:"ip-textarea",attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipAddress,"label-width":e.labelWidth,prop:"write_host"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.poolStorageFileShare.hostsPlaceholder},model:{value:e.form.write_host,callback:function(t){e.$set(e.form,"write_host",t)},expression:"form.write_host"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.useRangeSeting,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.nfsDenyIpRange,callback:function(t){e.nfsDenyIpRange=t},expression:"nfsDenyIpRange"}})],1)],1)],1)],1),e._v(" "),!0===e.nfsDenyIpRange?a("div",[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.ipRange,"label-width":e.labelWidth}},e._l(e.form.nfs_deny_range,function(t,o){return a("el-row",{key:o,staticClass:"ip-range",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"nfs_deny_range."+o+".start",rules:[{required:!0,message:e.lang.poolStorageFileShare.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.poolStorageFileShare.ipFormatRule,trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.start,callback:function(a){e.$set(t,"start",a)},expression:"item.start"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"nfs_deny_range."+o+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.poolStorageFileShare.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpAddressLen,message:"ip名单不能超过50条",items:e.form.nfs_deny_range,conmsg:"write_host",trigger:"blur"}]}},[a("el-input",{staticClass:"address",model:{value:t.end,callback:function(a){e.$set(t,"end",a)},expression:"item.end"}})],1),e._v(" "),a("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[1!==e.form.nfs_deny_range.length?a("el-button",{staticClass:"fa fa-minus",staticStyle:{color:"#67C23A"},attrs:{type:"text"},on:{click:function(t){return e.deleteAddress(e.form.nfs_deny_range,o)}}}):e._e(),e._v(" "),e.form.nfs_deny_range.length-1===o?a("el-button",{staticClass:"fa fa-plus",attrs:{type:"text"},on:{click:function(t){return e.newAddress(e.form.nfs_deny_range)}}}):e._e()],1)],1)],1)}),1)],1)],1)],1):e._e()],1)],1),e._v(" "),a("el-row",{staticClass:"hr-row",attrs:{type:"flex",justify:"start"}},[a("span",{staticStyle:{display:"inline-block","margin-left":"20px"}},[e._v(e._s(e.lang.poolStorageFileShare.userGroupAccessControl))])]),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.denySquashUser,"label-width":e.labelWidth}},[a("el-radio-group",{model:{value:e.form.no_root_squash,callback:function(t){e.$set(e.form,"no_root_squash",t)},expression:"form.no_root_squash"}},[a("el-radio",{attrs:{label:"yes"}},[e._v(e._s(e.lang.common.yes))]),e._v(" "),a("el-radio",{attrs:{label:"no"}},[e._v(e._s(e.lang.common.no))])],1)],1)],1)],1),e._v(" "),"no"===e.form.no_root_squash?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.squashUser,"label-width":e.labelWidth}},[a("el-select",{attrs:{filterable:"",placeholder:e.lang.poolStorageFileShare.userPlaceholder,width:"100%"},model:{value:e.form.squash_user,callback:function(t){e.$set(e.form,"squash_user",t)},expression:"form.squash_user"}},e._l(e.userOrigin,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})}),1)],1)],1)],1):e._e(),e._v(" "),"no"===e.form.no_root_squash?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.squashGroup,"label-width":e.labelWidth}},[a("el-select",{attrs:{filterable:"",placeholder:e.lang.poolStorageFileShare.groupPlaceholder,width:"100%"},model:{value:e.form.squash_group,callback:function(t){e.$set(e.form,"squash_group",t)},expression:"form.squash_group"}},e._l(e.groupOrigin,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})}),1)],1)],1)],1):e._e()],1):e._e()],1),e._v(" "),a("el-dialog",{staticClass:"transfer-dialog",attrs:{title:e.lang.poolStorageFileShare.selectUser,visible:e.showSelectUser,"append-to-body":"",width:"40%"},on:{close:e.closeChildDialog,open:function(t){e.preUsers=e.users}}},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.member}},[a("el-col",{attrs:{span:24}},[a("el-transfer",{attrs:{filterable:"",titles:[e.lang.poolStorageFileShare.availableMember,e.lang.poolStorageGroup.selectedMember],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},props:{label:"name",key:"name"},data:e.userOrigin},model:{value:e.preUsers,callback:function(t){e.preUsers=t},expression:"preUsers"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeChildDialog}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getSelectedUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1),e._v(" "),a("el-dialog",{staticClass:"transfer-dialog",attrs:{title:e.lang.poolStorageFileShare.selectGroup,visible:e.showSelectGroup,"append-to-body":"",width:"40%"},on:{close:e.closeChildDialog,open:function(t){e.preGroups=e.groups}}},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:e.lang.poolStorageFileShare.userGroup}},[a("el-col",{attrs:{span:24}},[a("el-transfer",{attrs:{filterable:"",titles:[e.lang.poolStorageFileShare.availableGroup,e.lang.poolStorageFileShare.selectedGroup],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},props:{label:"name",key:"name"},data:e.groupOrigin},model:{value:e.preGroups,callback:function(t){e.preGroups=t},expression:"preGroups"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeChildDialog}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.getSelectedGroup}},[e._v(e._s(e.lang.common.confirm))])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.stepIndex>0?a("el-button",{on:{click:function(t){return e.checkStep(!1)}}},[e._v(e._s(e.lang.common.prevStep))]):e._e(),e._v(" "),e.stepIndex!==e.nextStep?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.checkStep(!0)}}},[e._v(e._s(e.lang.common.nextStep))]):e._e(),e._v(" "),e.stepIndex===e.completeIndex?a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.editFileShare}},[e._v(e._s(e.lang.common.complete))]):e._e(),e._v(" "),a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))])],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(g,h,!1,function(e){a("FxZD"),a("lOtg")},"data-v-1b9aec4e",null).exports,b={name:"file-share",components:{"pana-breadcrumb":l.a,"pana-create-file":u,"pana-delete-file":p,"pana-edit-file":f},data:function(){return{showShadow:!1,pageSize:10,fileSearch:"",fileOrigin:[],fileSelectionNames:[],filePage:1,showCreateFile:!1,showDeleteFile:!1,showEditFile:!1,status:{yes:this.lang.common.yes,no:this.lang.common.no},editObjName:"",loading:!1}},computed:{fileFilter:function(){var e=this;return this.fileOrigin.filter(function(t){return""===e.fileSearch||-1!==s()(t).search(e.fileSearch)})},fileTable:function(){return this.fileFilter.length>this.pageSize?this.fileFilter.slice((this.filePage-1)*this.pageSize,this.filePage*this.pageSize):this.fileFilter}},methods:{switchFilePage:function(e){this.filePage=e},editFile:function(e){this.editObjName=e.name,this.showEditFile=!0},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.fileOrigin=this.fileOrigin.sort(function(a,o){return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t})},closeCreateFile:function(e){!0===e&&this.getFileList(),this.showCreateFile=!1},closeEditFile:function(e){!0===e&&this.getFileList(),this.showEditFile=!1},closeDeleteFile:function(e){var t=this;this.showDeleteFile=!1,!0===e&&this.checkError(this.$http({url:this.api.shares.shares_batch_delete,method:"post",data:{names:this.fileSelectionNames}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.poolStorageFileShare.deleteFileShareSuccess}),t.getFileList()})},getFileList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.shares.shares,method:"get"}),function(t){e.loading=!1,null==t.data?e.showShadow=!0:e.fileOrigin=t.data},function(){e.loading=!1})},selectFileNames:function(e){var t=[];e.forEach(function(e){t.push(e.name)}),this.fileSelectionNames=t},editUser:function(e){this.editObj=this.common.deepCopyByJson(e),this.showEditFile=!0}},mounted:function(){this.getFileList()},watch:{fileSearch:function(){this.filePage=1}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"parent-div"},[a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getFileList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:function(t){e.showCreateFile=!0}}},[e._v("\n                        "+e._s(e.lang.common.create)+"\n                    ")]),e._v(" "),a("el-button",{attrs:{disabled:e.loading||0===e.fileSelectionNames.length},on:{click:function(t){e.showDeleteFile=!0}}},[e._v("\n                        "+e._s(e.lang.common.delete)+"\n                    ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.fileSearch,callback:function(t){e.fileSearch=t},expression:"fileSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getFileList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.fileTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectFileNames,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.shareName,sortable:"custom",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.supportCifs,sortable:"custom",prop:"cifs"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.status[t.row.cifs])+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.supportNfs,sortable:"custom",prop:"nfs"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.status[t.row.nfs])+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageFileShare.volumeName,sortable:"custom",prop:"volume"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editFile(t.row)}}},[e._v("\n                            "+e._s(e.lang.common.update)+"\n                        ")])]}}])})],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.fileFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.fileFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchFilePage}},[e._t("default",[a("span",{staticClass:"pagination-slot"},[e._v("\n                        "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.filePage,total:this.fileFilter.length}))+"\n                    ")])])],2):e._e()],1)],1),e._v(" "),a("pana-create-file",{attrs:{show:e.showCreateFile},on:{closeModal:e.closeCreateFile}}),e._v(" "),a("pana-delete-file",{attrs:{show:e.showDeleteFile},on:{closeModal:e.closeDeleteFile}}),e._v(" "),a("pana-edit-file",{attrs:{show:e.showEditFile,shareName:e.editObjName},on:{closeModal:e.closeEditFile}})],1),e._v(" "),e.showShadow?a("div",{staticClass:"none-service"},[a("div",{staticClass:"info"},[e._v(e._s(e.lang.poolStorageFileShare.noneServiceInfo))])]):e._e()],1)},staticRenderFns:[]};var _=a("C7Lr")(b,v,!1,function(e){a("fsgw")},"data-v-1e1cd11c",null);t.default=_.exports},Rrz6:function(e,t){},XNQU:function(e,t){},Y7P2:function(e,t){},ZqEf:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("3cXf"),s=a.n(o),l=a("1JPr"),r=a("aA9S"),n=a.n(r),i=a("yRx0"),c={name:"pana-create-cloud-disk",props:{show:Boolean},components:{"pana-info":i.a},computed:{cloudDiskFilter:function(){var e=this;return this.cloudDiskOrigin.filter(function(t){return""===e.cloudDiskSearch||-1!==s()(t).search(e.cloudDiskSearch)})},imageFilter:function(){var e=this;return this.imageOrigin.filter(function(t){return""===e.imageSearch||-1!==s()(t).search(e.imageSearch)})},snapshotFilter:function(){var e=this;return this.snapshotOrigin.filter(function(t){return""===e.snapshotSearch||-1!==s()(t).search(e.snapshotSearch)})}},methods:{showDetail:function(){this.quotaDetail?this.dialogWid="670px":this.dialogWid="860px",this.quotaDetail=!this.quotaDetail},getQuotaDetail:function(){var e=this;this.checkError(this.$http({method:"get",url:e.api.quota.get_pool_quota,params:{check:"stg"}}),function(t){var a=t.data,o=Number(a.gigabytes_total-a.gigabytes_used);e.loading=!1,e.gigabytes_total=a.gigabytes_total,e.gigabytes_used=a.gigabytes_used,e.gigabytes_used_val=e.gigabytes_used,e.gigabytesPercent=e.gigabytes_used/e.gigabytes_total*100,e.gigabytesPercentVal=e.gigabytesPercent,e.volumeQuota=o>0?o:0},function(){e.loading=!1})},closeModal:function(e){e=e||!1,n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){var e=this;this.loading=!0,this.$nextTick(function(){null!=e.$refs.volume_form&&e.$refs.volume_form.resetFields(),e.getQuotaDetail(),e.getPoolData()})},emptyuDiskFn:function(){this.usedFn(this.form.size)},usedFn:function(e){this.gigabytes_used_val=this.gigabytes_used+Number(e),this.gigabytesPercentVal=this.gigabytes_used_val/this.gigabytes_total*100},getPoolData:function(){var e=this;this.loading=!0,this.checkError(this.$http({method:"get",url:this.api.storage.get_pools}),function(t){e.resourceOptions=t.data,e.resourceOptions.length>0&&(e.form.volume_type=e.resourceOptions[0].volumeTypeId),e.loading=!1},function(){e.loading=!1})},createVolume:function(){var e=this,t=this.form,a=!1;switch(this.disable=!0,this.diskType){case"emptyDisk":t.size=e.blankSize,delete t.source_volid,delete t.snapshot_id,delete t.imageRef;break;case"cloudDisk":delete t.snapshot_id,delete t.imageRef,a=e.emptyCloudDisk;break;case"image":delete t.source_volid,delete t.snapshot_id,a=e.emptyImage;break;case"snapshot":delete t.source_volid,delete t.imageRef,a=e.emptySnapShot}this.$refs.volume_form.validate(function(o){o&&e.volumeQuota>=e.form.size&&!1===a?e.checkError(e.$http({url:e.api.storage.post_volumes,method:"post",data:t}),function(t){e.wsEventQueue.push(t.data.id),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.cloudDisk.creatingVolume}),e.closeModal(!0)},function(){e.disable=!1}):e.disable=!1})},switchResource:function(){switch(this.diskType){case"emptyDisk":this.form.size=this.blankSize,this.usedFn(this.form.size);break;case"cloudDisk":this.getVolumeList();break;case"image":this.getImageList();break;case"snapshot":this.getSnapshotList()}},getVolumeList:function(){var e=this;this.cloudLoading=!0,this.checkError(this.$http({url:e.api.storage.get_volumes,method:"get"}),function(t){e.cloudLoading=!1;var a=t.data.data_disks;a=a.concat(t.data.sys_disks),e.cloudDiskOrigin=a.filter(function(e){return"available"===e.status.toLowerCase()||"in-use"===e.status.toLowerCase()}),e.cloudDiskOrigin.length>0?(e.form.source_volid=e.cloudDiskOrigin[0].id,e.volumeOptions=[{disPlayName:e.cloudDiskOrigin[0].display_name,volumeTypeId:e.cloudDiskOrigin[0].volume_type_id}],e.form.volume_type=e.cloudDiskOrigin[0].volume_type_id,e.form.size=e.cloudDiskOrigin[0].size,e.usedFn(e.form.size)):(e.emptyCloudDisk=!0,e.usedFn(0))},function(){e.cloudLoading=!1})},getImageList:function(){var e=this;this.imageLoading=!0,this.checkError(this.$http({url:this.api.cloud.get_images,method:"get"}),function(t){e.imageLoading=!1,e.imageOrigin=t.data,t.data.length>0?(e.form.imageRef=e.imageOrigin[0].id,e.form.size=e.imageOrigin[0].vol_size,e.usedFn(e.form.size),e.emptyImage=!1):(e.emptyImage=!0,e.usedFn(0))},function(){e.imageLoading=!1})},getSnapshotList:function(){var e=this;this.snapshotLoading=!0,this.checkError(this.$http({url:this.api.storage.getSnapshot,method:"get"}),function(t){e.snapshotLoading=!1,e.snapshotOrigin=t.data.data_disks.concat(t.data.sys_disks),e.snapshotOrigin.length>0?(e.form.snapshot_id=e.snapshotOrigin[0].id,e.form.size=e.snapshotOrigin[0].size,e.usedFn(e.form.size),e.emptySnapShot=!1):(e.emptySnapShot=!0,e.usedFn(0))},function(){e.snapshotLoading=!1})},validateVolumeName:function(e,t,a){""===t||null==t||/^[A-Za-z0-9_\-.\u4E00-\u9FA5]*$/.test(t)?a():a(new Error(e.message))},changeSourceId:function(e){this.form.size=e.size,this.usedFn(this.form.size),this.volumeOptions=[{disPlayName:e.display_name,volumeTypeId:e.volume_type_id}],this.form.volume_type=e.volume_type_id}},data:function(){return{labelWidth:"100px",diskType:"emptyDisk",quotaDetail:!1,dialogWid:"35%",form:{name:"",size:null,volume_type:"",description:"",multiattach:!1,source_volid:"",imageRef:"",snapshot_id:""},rules:{name:[{required:!0,message:this.lang.cloudDisk.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.cloudDisk.nameLengthRule,trigger:"blur"},{validator:this.validateVolumeName,message:this.lang.cloudDisk.nameFormatRule,trigger:"blur"}],size:[{required:!0,message:this.lang.cloudDisk.nameRequiredRule,trigger:"blur"},{validator:this.common.validateIntegerType,message:this.lang.cloudDisk.sizeIntegerType,trigger:"blur"},{validator:this.common.validateNumberRange,min:1,message:this.lang.cloudDisk.sizeIntegerType,trigger:"blur"}],volume_type:[{required:!0,message:this.lang.cloudDisk.sourceVolidRequired,trigger:"blur"}]},loading:!0,poolLoading:!1,pageSize:10,resourceOptions:[],volumeOptions:[],Options:[],checked:!0,cloudDiskSearch:"",cloudDiskOrigin:[],cloudDiskPage:1,cloudDisk:"",imageSearch:"",imageOrigin:[],imagePage:1,image:{},snapshotData:[],snapshotSearch:"",snapshotOrigin:[],snapshot:{},cloudLoading:!1,imageLoading:!1,snapshotLoading:!1,emptyCloudDisk:!1,emptyImage:!1,emptySnapShot:!1,disable:!1,blankSize:null,gigabytes_total:0,gigabytes_used:0,gigabytes_used_val:0,volumeQuota:0,gigabytesPercent:0,gigabytesPercentVal:0}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.cloudDisk.createCloudDisk,width:e.dialogWid,visible:e.show,modal:!0},on:{close:e.closeModal,opened:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"volume_form",staticStyle:{width:"500px",float:"left"},attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("pana-info",{directives:[{name:"show",rawName:"v-show",value:null!=e.form.size&&e.form.size>e.volumeQuota,expression:"form.size != null && form.size > volumeQuota"}],attrs:{content:e.common.formatMsg(e.lang.cloudDisk.currentVolumeQuota,{quotaValue:e.volumeQuota}),bgStyle:"error"}}),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.cloudDiskName,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.cloudDisk.cloudDisnNamePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.selectSource,"label-width":e.labelWidth}},[a("el-radio-group",{on:{change:e.switchResource},model:{value:e.diskType,callback:function(t){e.diskType=t},expression:"diskType"}},[a("el-radio-button",{attrs:{name:"diskType",label:"emptyDisk"}},[e._v(e._s(e.lang.cloudDisk.emptyDisk))]),e._v(" "),a("el-radio-button",{attrs:{name:"diskType",label:"cloudDisk"}},[e._v(e._s(e.lang.cloudDisk.cloudDisk))]),e._v(" "),a("el-radio-button",{attrs:{name:"diskType",label:"image"}},[e._v(e._s(e.lang.cloudDisk.image))]),e._v(" "),a("el-radio-button",{attrs:{name:"diskType",label:"snapshot"}},[e._v(e._s(e.lang.cloudDisk.snapshot))])],1)],1)],1)],1),e._v(" "),"emptyDisk"===e.diskType?a("div",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.common.configuration,"label-width":e.labelWidth,prop:"size"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.cloudDisk.diskSizePlaceholder},on:{blur:e.emptyuDiskFn,change:function(t){e.form.size=e.blankSize}},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.blankSize,callback:function(t){e.blankSize=t},expression:"blankSize"}})],1),e._v(" "),a("el-col",{staticClass:"unit",attrs:{span:4}},[e._v("\n                            "+e._s(e.lang.common.GB)+"\n                        ")])],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.descriptionInfo,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",placeholder:e.lang.cloudDisk.descInfoPlaceholder,rows:3},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1)],1):e._e(),e._v(" "),"cloudDisk"===e.diskType?a("div",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{placeholder:e.lang.cloudDisk.diskSearchPlaceholder,"suffix-icon":"el-icon-search"},model:{value:e.cloudDiskSearch,callback:function(t){e.cloudDiskSearch=t},expression:"cloudDiskSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{staticClass:"refresh",attrs:{type:"primary"},on:{click:e.getVolumeList}},[e._v("\n                        "+e._s(e.lang.common.refresh)+"\n                    ")])],1)],1),e._v(" "),a("el-row",{staticClass:"originTable",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.cloudLoading,expression:"cloudLoading"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)","max-height":"330",data:e.cloudDiskFilter,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{width:"30px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.id,name:"volume"},on:{change:function(a){return e.changeSourceId(t.row)}},model:{value:e.form.source_volid,callback:function(t){e.$set(e.form,"source_volid",t)},expression:"form.source_volid"}})]}}],null,!1,887635175)}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.diskName,sortable:"",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.sizeGB,sortable:"",prop:"size"}})],1),e._v(" "),e.emptyCloudDisk?a("span",{staticClass:"pana-error-info"},[e._v(e._s(e.lang.cloudDisk.atLeastOneDisk))]):e._e()],1)],1)],1):e._e(),e._v(" "),"image"===e.diskType?a("div",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{placeholder:e.lang.cloudDisk.imageSearchPlaceholder,"suffix-icon":"el-icon-search"},model:{value:e.imageSearch,callback:function(t){e.imageSearch=t},expression:"imageSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{staticClass:"refresh",attrs:{type:"primary"},on:{click:e.getImageList}},[e._v("\n                        "+e._s(e.lang.common.refresh)+"\n                    ")])],1)],1),e._v(" "),a("el-row",{staticClass:"originTable",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.imageLoading,expression:"imageLoading"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)","max-height":"330",data:e.imageFilter,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{width:"30px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{label:t.row.id,name:"image"},on:{change:function(a){e.form.size=t.row.vol_size,e.usedFn(e.form.size)}},model:{value:e.form.imageRef,callback:function(t){e.$set(e.form,"imageRef",t)},expression:"form.imageRef"}})]}}],null,!1,643975147)}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.imageName,sortable:"",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.imageType,sortable:"",prop:"disk_format"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.systemArchitecture,sortable:"",prop:"arch"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.operatingSystem,sortable:"",prop:"os_type"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.minDisks,sortable:"",prop:"min_disk"}})],1),e._v(" "),e.emptyImage?a("span",{staticClass:"pana-error-info"},[e._v(e._s(e.lang.cloudDisk.atLeastOneImage))]):e._e()],1)],1)],1):e._e(),e._v(" "),"snapshot"===e.diskType?a("div",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{placeholder:e.lang.cloudDisk.snapshotSearchPlaceholder,"suffix-icon":"el-icon-search"},model:{value:e.snapshotSearch,callback:function(t){e.snapshotSearch=t},expression:"snapshotSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-button",{staticClass:"refresh",attrs:{type:"primary"},on:{click:e.getSnapshotList}},[e._v("\n                        "+e._s(e.lang.common.refresh)+"\n                    ")])],1)],1),e._v(" "),a("el-row",{staticClass:"originTable",attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.snapshotLoading,expression:"snapshotLoading"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)","max-height":"330",data:e.snapshotFilter,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{width:"30px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio",{attrs:{name:"snapshot",label:t.row.id},on:{change:function(a){e.form.size=t.row.size,e.usedFn(e.form.size)}},model:{value:e.form.snapshot_id,callback:function(t){e.$set(e.form,"snapshot_id",t)},expression:"form.snapshot_id"}})]}}],null,!1,2682703202)}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.snapshotName,prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.cloudDiskName,prop:"volumeName"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.sizeGB,prop:"size"}})],1),e._v(" "),e.emptySnapShot?a("span",{staticClass:"pana-error-info"},[e._v(e._s(e.lang.cloudDisk.atLeastOneSnapShot))]):e._e()],1)],1)],1):e._e(),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.resourcePool,"label-width":e.labelWidth,prop:"volume_type"}},[a("el-select",{attrs:{filterable:"",disabled:"cloudDisk"===e.diskType,placeholder:e.lang.cloudDisk.poolSelectPlaceholder,width:"100%"},model:{value:e.form.volume_type,callback:function(t){e.$set(e.form,"volume_type",t)},expression:"form.volume_type"}},e._l("cloudDisk"===e.diskType?e.volumeOptions:e.resourceOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.disPlayName,value:e.volumeTypeId}})}),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:16}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.shareVolume,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{model:{value:e.form.multiattach,callback:function(t){e.$set(e.form,"multiattach",t)},expression:"form.multiattach"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-form-item",[a("span",{staticStyle:{color:"#51a3ff",cursor:"pointer"},on:{click:e.showDetail}},[e._v(e._s(e.lang.cloudDisk.quotaDetail)+">>")])])],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.quotaDetail,expression:"quotaDetail"}],staticStyle:{width:"300px",height:"400px",float:"right"}},[a("div",{staticClass:"quota-detail-all"},[a("div",{staticClass:"quota-detail-item"},[a("div",{staticClass:"quota-detail-text clearfix"},[a("span",{staticClass:"quota-detail-unit"},[e._v(e._s(e.lang.cloudDisk.diskQuata)+"（GB）")]),e._v(" "),a("span",{staticClass:"quota-detail-num"},[e._v(e._s(e.lang.cloudDisk.used)+e._s(e.gigabytes_used_val)+"/"+e._s(e.gigabytes_total))])]),e._v(" "),a("el-progress",{attrs:{percentage:e.gigabytesPercentVal,"show-text":!1}})],1)])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createVolume}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var d=a("C7Lr")(c,u,!1,function(e){a("i4vV")},"data-v-70fc6988",null).exports,m={name:"pana-deleteCloudDisk",props:{show:Boolean,force:{type:Boolean,default:!1}},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteVolume:function(){this.closeModal(!0)}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-main",[!1===e.force?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.cloudDisk.confirmDeleteDisk))])],1):a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.cloudDisk.confirmForceDeleteDisk))])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteVolume}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var g=a("C7Lr")(m,p,!1,function(e){a("19lc")},"data-v-51f062f6",null).exports,h={name:"pana-edit-volume",props:{show:Boolean,volume:Object,isSys:{default:!1,type:Boolean}},methods:{closeModal:function(e){n()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.form.name=this.volume.name,this.form.description=this.volume.description,this.form.bootable=this.volume.bootable},editVolume:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?e.checkError(e.$http({url:e.common.formatMsg(e.api.storage.put_volumes_detail,{vid:e.volume.id}),method:"put",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.cloudDisk.editVolumeSuccess}),e.closeModal(!0)},function(){e.closeModal(!1)}):e.disable=!1})},validateVolumeName:function(e,t,a){""===t||null==t||/^[A-Za-z0-9_\-.\u4E00-\u9FA5]*$/.test(t)?a():a(new Error(e.message))}},data:function(){return{labelWidth:"100px",diskType:"emptyDisk",form:{name:"",description:"",bootable:!1},rules:{name:[{required:!0,message:this.lang.cloudDisk.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.cloudDisk.nameLengthRule,trigger:"blur"},{validator:this.validateVolumeName,message:this.lang.cloudDisk.nameFormatRule,trigger:"blur"}]},poolLoading:!1,pageSize:10,resourceOptions:[],checked:!0,cloudDiskSearch:"",cloudDiskOrigin:[],cloudDiskPage:1,cloudDisk:{},imageSearch:"",imageOrigin:[],imagePage:1,image:{},snapshotSearch:"",snapshotOrigin:[],snapshot:{},disable:!1}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.poolLoading,expression:"poolLoading"}],attrs:{title:e.lang.cloudDisk.editVolume,width:"40%",visible:e.show,modal:!0},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.cloudDiskName,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{required:"",placeholder:e.lang.cloudDisk.cloudDisnNamePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.descriptionInfo,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",placeholder:e.lang.cloudDisk.descInfoPlaceholder,rows:3},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.bootable,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("el-checkbox",{attrs:{disabled:e.isSys},model:{value:e.form.bootable,callback:function(t){e.$set(e.form,"bootable",t)},expression:"form.bootable"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.editVolume}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var b=a("C7Lr")(h,f,!1,function(e){a("0KBE")},"data-v-40e121b4",null).exports,v={name:"pana-extend-volume",props:{show:Boolean,volume:Object},components:{"pana-info":i.a},computed:{size:function(){return null==this.volume?0:this.volume.size}},methods:{newSizeFn:function(){this.gigabytes_used_val=this.form.new_size/1+this.gigabytes_used/1,this.gigabytesPercentVal=this.gigabytes_used_val/this.gigabytes_total*100},closeModal:function(e,t,a){n()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",{fresh:e,id:t,name:a})},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getQuotaDetail(),this.form.new_size=this.size},getQuotaDetail:function(){var e=this;this.checkError(this.$http({method:"get",url:e.api.quota.get_pool_quota,params:{check:"stg"}}),function(t){var a=t.data,o=Number(a.gigabytes_total-a.gigabytes_used);e.poolLoading=!1,e.gigabytes_total=a.gigabytes_total,e.gigabytes_used=a.gigabytes_used,e.gigabytes_used_val=a.gigabytes_used,e.gigabytesPercent=a.gigabytes_used/a.gigabytes_total*100,e.gigabytesPercentVal=e.gigabytesPercent,e.volumeQuota=o>0?o:0},function(){e.poolLoading=!1})},extendVolume:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t&&e.form.new_size-e.size<=e.volumeQuota?(e.wsEventQueue.push(e.volume.id),e.checkError(e.$http({url:e.common.formatMsg(e.api.storage.post_volumes_detail_extensions,{volume_id:e.volume.id}),method:"post",data:e.common.dropEmptyParameter(e.form)}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.cloudDisk.extendingVolume}),e.closeModal(!0,e.volume.id,e.volume.name)},function(){e.closeModal(!1)})):e.disable=!1})},validateVolumeName:function(e,t,a){""===t||null==t||/^[A-Za-z0-9_\-.\u4E00-\u9FA5]*$/.test(t)?a():a(new Error(e.message))},validateSizeMin:function(e,t,a){parseFloat(t)>parseFloat(e.currentSize)?a():a(new Error(e.message))}},data:function(){return{labelWidth:"100px",form:{new_size:""},poolLoading:!0,pageSize:10,disable:!1,gigabytes_total:0,gigabytes_used:0,gigabytes_used_val:0,volumeQuota:0,gigabytesPercent:0,gigabytesPercentVal:0}}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.cloudDisk.extendVolume,width:"40%",visible:e.show,modal:!0},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.poolLoading,expression:"poolLoading"}],ref:"form",attrs:{"label-position":"right",model:e.form}},[a("pana-info",{directives:[{name:"show",rawName:"v-show",value:null!=e.form.new_size&&e.form.new_size-e.size>e.volumeQuota,expression:"form.new_size != null && (form.new_size - size) > volumeQuota"}],attrs:{content:e.common.formatMsg(e.lang.cloudDisk.overVolumeQuota,{quotaValue:e.volumeQuota,maxSize:e.volumeQuota+e.size}),bgStyle:"error"}}),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.common.configuration,"label-width":e.labelWidth,prop:"new_size",rules:[{required:!0,message:this.lang.cloudDisk.nameRequiredRule,trigger:"blur"},{validator:this.common.validateIntegerType,message:this.lang.cloudDisk.sizeIntegerType,trigger:"blur"},{validator:this.validateSizeMin,currentSize:this.size,message:this.common.formatMsg(this.lang.cloudDisk.extendMinSize,{size:this.size}),trigger:"blur"}]}},[a("el-col",{attrs:{span:16}},[a("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",placeholder:e.lang.cloudDisk.diskSizePlaceholder},on:{input:e.newSizeFn},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.new_size,callback:function(t){e.$set(e.form,"new_size",t)},expression:"form.new_size"}})],1),e._v(" "),a("el-col",{staticClass:"unit",attrs:{span:4}},[e._v("\n                        "+e._s(e.lang.common.GB)+"\n                    ")])],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.projectQuota,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:16}},[a("div",{staticClass:"clearfix"},[a("span",{staticClass:"fl"},[e._v(e._s(e.lang.cloudDisk.diskQuata))]),e._v(" "),null!=e.volume?a("span",{staticClass:"fr"},[e._v(e._s(e.lang.cloudDisk.used)+e._s(parseInt(e.gigabytes_used)+parseInt(""===e.form.new_size?0:e.form.new_size)-parseInt(e.volume.size))+"/"+e._s(e.gigabytes_total))]):e._e()]),e._v(" "),a("el-progress",{attrs:{percentage:e.gigabytesPercentVal,"show-text":!1}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.extendVolume}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var y=a("C7Lr")(v,_,!1,function(e){a("ka4P")},"data-v-6fa64d07",null).exports,w={name:"pana-extend-volume",props:{show:Boolean,volume:Object},methods:{closeModal:function(e,t,a){n()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",{fresh:e,id:t,name:a})},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getVmList()},getVmList:function(){var e=this,t=JSON.parse(sessionStorage.getItem("panaCurrentPool"));this.loading=!0,this.checkError(e.$http({url:e.common.formatMsg(e.api.storage.get_detach_volumes_detail,{volume_id:this.volume.id}),method:"get"}),function(a){e.volumeDetail=a.data[0],e.checkError(e.$http({url:e.common.formatMsg(e.api.cloud.get_pools_detail_servers,{pool_id:t.id}),method:"get"}),function(t){e.loading=!1,e.vms=t.data.filter(function(t){return"fixedImageInstanceName"!==t.name&&-1===e.volumeDetail.instance.indexOf(t.name)}),t.data.length>0&&(e.form.server_id=e.vms[0].uid)},function(){e.loading=!1})},function(){e.loading=!1})},chargeVolume:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?e.checkError(e.$http({url:e.common.formatMsg(e.api.storage.post_volumes_detail_attachments,{vid:e.volume.id}),method:"post",data:e.common.dropEmptyParameter(e.form)}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.cloudDisk.chargingVolume}),e.closeModal(!0,e.volume.id,e.volume.name)},function(){e.closeModal(!1)}):e.disable=!1})}},data:function(){return{labelWidth:"100px",form:{server_id:""},vms:[],volumeDetail:{},loading:!1,pageSize:10,disable:!1}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.cloudDisk.charge,width:"20%",visible:e.show,modal:!0},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"right",model:e.form,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.selectVm,"label-width":e.labelWidth,prop:"server_id"}},[a("el-col",{attrs:{span:16}},[a("el-select",{attrs:{filterable:"",placeholder:e.vms.length>0?e.lang.cloudDisk.vmSelectPlaceholder:e.lang.cloudDisk.noValidVmPlaceholder,width:"100%"},model:{value:e.form.server_id,callback:function(t){e.$set(e.form,"server_id",t)},expression:"form.server_id"}},e._l(e.vms,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.uid}})}),1)],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.chargeVolume}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var k=a("C7Lr")(w,S,!1,function(e){a("qT68")},"data-v-2f59dea6",null).exports,x={name:"pana-extend-volume",props:{show:Boolean,volume:Object},methods:{closeModal:function(e,t,a){n()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",{fresh:e,id:t,name:a})},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getVmList()},getVmList:function(){var e=this;this.loading=!0,this.checkError(e.$http({url:e.common.formatMsg(e.api.storage.get_detach_volumes_detail,{volume_id:this.volume.id}),method:"get"}),function(t){e.loading=!1,e.vms=t.data[0].insnameAndId,t.data.length>0&&(e.form.server_id=e.vms[0].id)},function(){e.loading=!1})},dischargeVolume:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?e.checkError(e.$http({url:e.common.formatMsg(e.api.storage.post_volumes_detail_detachments,{vid:e.volume.id}),method:"post",data:e.common.dropEmptyParameter(e.form)}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.cloudDisk.dischargingVolume}),e.closeModal(!0,e.volume.id,e.volume.name)},function(){e.closeModal(!1)}):e.disable=!1})}},data:function(){return{labelWidth:"100px",form:{server_id:""},vms:[],loading:!1,pageSize:10,disable:!1}}},C={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.cloudDisk.discharge,width:"30%",visible:e.show,modal:!0},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"right",model:e.form,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.selectVm,"label-width":e.labelWidth,prop:"server_id"}},[a("el-col",{attrs:{span:16}},[a("el-select",{attrs:{filterable:"",placeholder:e.vms.length>0?e.lang.cloudDisk.vmSelectPlaceholder:e.lang.cloudDisk.noValidVmPlaceholder,width:"100%"},model:{value:e.form.server_id,callback:function(t){e.$set(e.form,"server_id",t)},expression:"form.server_id"}},e._l(e.vms,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.dischargeVolume}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var D=a("C7Lr")(x,C,!1,function(e){a("7vDJ")},"data-v-07b976be",null).exports,F={name:"pana-extend-volume",props:{show:Boolean,volume:Object},methods:{closeModal:function(e){n()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate()},createSnapshot:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?e.checkError(e.$http({url:e.api.storage.getSnapshot,method:"post",data:{name:[e.form.name],description:e.form.description,volume_id:[e.volume.id]}}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.cloudDisk.createSnapshotSuccess}),e.closeModal(!0)},function(){e.closeModal(!1)}):e.disable=!1})},validateName:function(e,t,a){""===t||null==t||/^[A-Za-z0-9\-.\u4E00-\u9FA5]*$/.test(t)?a():a(new Error(e.message))}},data:function(){return{labelWidth:"100px",form:{name:"",description:""},rules:{name:[{required:!0,message:this.lang.cloudDisk.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.cloudDisk.snapshotRangeRule,trigger:"blur"},{validator:this.validateName,message:this.lang.cloudDisk.snapshotFormatRule,trigger:"blur"}]},pageSize:10,disable:!1}}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.cloudDisk.createSnapshot,width:"30%",visible:e.show,modal:!0},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.snapshotInfo,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.cloudDisk.snapshotPlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.cloudDisk.descriptionInfo,"label-width":e.labelWidth,prop:"description"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.cloudDisk.descriptionPlaceholder},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createSnapshot}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var M=a("C7Lr")(F,$,!1,function(e){a("tQoQ")},"data-v-5110b7a8",null).exports,R={name:"pana-deleteCloudDisk",props:{show:Boolean,force:{type:Boolean,default:!1}},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteVolume:function(){this.closeModal(!0)}}},I={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-main",[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.cloudDisk.confirmResetVolume))])],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteVolume}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var j=a("C7Lr")(R,I,!1,function(e){a("flHN")},"data-v-7a481c52",null).exports,O={name:"cloudDisk",components:{"pana-breadcrumb":l.a,"pana-createCloudDisk":d,"pana-deleteCloudDisk":g,"pana-edit-volume":b,"pana-extend-volume":y,"pana-charge-volume":k,"pana-discharge-volume":D,"pana-create-snapshot":M,"pana-reset-volume":j},computed:{dataFilter:function(){var e=this;return this.dataOrigin.filter(function(t){return""===e.dataSearch||-1!==s()(t).search(e.dataSearch)})},dataTable:function(){return this.dataFilter.length>this.pageSize?this.dataFilter.slice((this.dataPage-1)*this.pageSize,this.dataPage*this.pageSize):this.dataFilter},sysFilter:function(){var e=this;return this.sysOrigin.filter(function(t){return""===e.sysSearch||-1!==s()(t).search(e.sysSearch)})},sysTable:function(){return this.sysFilter.length>this.pageSize?this.sysFilter.slice((this.sysPage-1)*this.pageSize,this.sysPage*this.pageSize):this.sysFilter},cacheFilter:function(){var e=this;return this.cacheOrigin.filter(function(t){return""===e.cacheSearch||-1!==s()(t).search(e.cacheSearch)})},cacheTable:function(){return this.cacheFilter.length>this.pageSize?this.cacheFilter.slice((this.cachePage-1)*this.pageSize,this.cachePage*this.pageSize):this.cacheFilter}},data:function(){return{config:{available:{style:"cloud-success",title:this.lang.cloudDisk.available},unrecognized:{style:"cloud-warning",title:this.lang.cloudDisk.extending},reserved:{style:"cloud-success",title:this.lang.cloudDisk.reserved},"in-use":{style:"cloud-success",title:this.lang.cloudDisk.in_use},"awaiting-transfer":{style:"cloud-warning",title:this.lang.cloudDisk.awaiting_transfer},creating:{style:"cloud-warning",title:this.lang.cloudDisk.creating},attaching:{style:"cloud-warning",title:this.lang.cloudDisk.attaching},detaching:{style:"cloud-warning",title:this.lang.cloudDisk.detaching},maintenance:{style:"cloud-warning",title:this.lang.cloudDisk.maintenance},"backing-up":{style:"cloud-warning",title:this.lang.cloudDisk.backing_up},"restoring-backup":{style:"cloud-warning",title:this.lang.cloudDisk.restoring_backup},deleting:{style:"cloud-warning",title:this.lang.cloudDisk.deleting},downloading:{style:"cloud-warning",title:this.lang.cloudDisk.downloading},uploading:{style:"cloud-warning",title:this.lang.cloudDisk.uploading},retyping:{style:"cloud-warning",title:this.lang.cloudDisk.retyping},extending:{style:"cloud-warning",title:this.lang.cloudDisk.extending},error:{style:"cloud-error",title:this.lang.cloudDisk.error},error_deleting:{style:"cloud-error",title:this.lang.cloudDisk.error_deleting},"error_backing-up":{style:"cloud-error",title:this.lang.cloudDisk.error_backing_up},error_restoring:{style:"cloud-error",title:this.lang.cloudDisk.error_restoring},error_extending:{style:"cloud-error",title:this.lang.cloudDisk.error_extending}},activeName:"dataDisk",pageSize:10,dataSearch:"",dataOrigin:[],dataPage:1,dataSelectionIds:[],sysSearch:"",sysOrigin:[],sysPage:1,sysSelectionIds:[],cacheSearch:"",cacheOrigin:[],cachePage:1,cacheSelectionIds:[],createCloudDisk:!1,deleteCloudDisk:!1,showEditVolume:!1,showExtendVolume:!1,showChargeVolume:!1,showDischargeVolume:!1,showCreateSnapshot:!1,showResetVolume:!1,editObj:null,force:!1,loading:!1,dataSelections:[],sysSelections:[],cacheSelections:[],isSys:!1,doing:{},hasSnapshotVolume:!1,delSnapshotVolume:!1,disbledDeleteStr:this.lang.cloudDisk.atLeastOneDisk,hasSnapshotLoading:!1}},methods:{handleEdit:function(e,t){this.isSys=!0===t,this.editObj=e,this.showEditVolume=!0},switchDataPage:function(e){this.dataPage=e},switchSysPage:function(e){this.sysPage=e},switchCachePage:function(e){this.cachePage=e},sortChangeData:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.dataOrigin=this.dataOrigin.sort(function(a,o){switch(e.prop){case"size":return(a[e.prop]-o[e.prop])*t;default:return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t}})},sortChangeSys:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.sysOrigin=this.sysOrigin.sort(function(a,o){switch(e.prop){case"size":return(a[e.prop]-o[e.prop])*t;default:return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t}})},sortChangeCache:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.cacheOrigin=this.cacheOrigin.sort(function(a,o){switch(e.prop){case"size":return(a[e.prop]-o[e.prop])*t;default:return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t}})},showModal:function(){this.createCloudDisk=!0},closeCreateDisk:function(e){!0===e&&this.getDisks(),this.createCloudDisk=!1},closeEditVolume:function(e){!0===e&&this.getDisks(),this.showEditVolume=!1},closeExtendVolume:function(e){!0===e.fresh&&this.getDisks(),this.showExtendVolume=!1},closeChargeVolume:function(e){var t=this;if(!0===e.fresh){var a=new Date,o=setInterval(function(){(new Date).getTime()-a>12e4&&clearInterval(o),t.$http({url:t.common.formatMsg(t.api.storage.get_volumes_detail,{vid:e.id}),method:"get"}).then(function(a){"in-use"===a.data.data.status?(t.$notify({title:t.lang.common.success,type:"success",message:t.common.formatMsg(t.lang.cloudDisk.chargeVolumeSuccess,{name:e.name})}),clearInterval(o),t.getDisks()):"unrecognize"!==a.data.data.status&&"attaching"!==a.data.data.status&&(t.$notify({title:t.lang.common.error,type:"error",message:t.common.formatMsg(t.lang.cloudDisk.chargeVolumeFailed,{name:e.name})}),clearInterval(o),t.getDisks())})},3e3);this.timer.push(o),this.getDisks()}this.showChargeVolume=!1},closeDischargeVolume:function(e){var t=this;if(!0===e.fresh){var a=(new Date).getTime(),o=setInterval(function(){(new Date).getTime()-a>12e4&&clearInterval(o),t.$http({url:t.common.formatMsg(t.api.storage.get_volumes_detail,{vid:e.id}),method:"get"}).then(function(a){"available"===a.data.data.status?(t.$notify({title:t.lang.common.success,type:"success",message:t.common.formatMsg(t.lang.cloudDisk.dischargeVolumeSuccess,{name:e.name})}),clearInterval(o),t.getDisks()):"unrecognize"!==a.data.data.status&&"detaching"!==a.data.data.status&&(t.$notify({title:t.lang.common.error,type:"error",message:t.common.formatMsg(t.lang.cloudDisk.dischargeVolumeFailed,{name:e.name})}),clearInterval(o),t.getDisks())})},3e3);this.timer.push(o),this.getDisks()}this.showDischargeVolume=!1},closeCreateSnapshot:function(e){!0===e&&this.getDisks(),this.showCreateSnapshot=!1},closeDeleteDisk:function(e){var t=this,a=[],o=[];if(this.deleteCloudDisk=!1,!0===e){switch(this.activeName){case"dataDisk":a=this.dataSelectionIds,o=this.dataSelections;break;case"sysDisk":a=this.sysSelectionIds,o=this.sysSelections;break;case"cacheDisk":a=this.cacheSelectionIds,o=this.cacheSelections}o.map(function(e){t.doing[e.id]=e.name});var s=this.api.storage.delete_volumes+this.common.formatGetUrl({id:a,force:this.force}),l=(new Date).getTime();this.checkError(this.$http.delete(s),function(){var e=this;t.$notify({title:t.lang.common.success,type:"success",message:t.lang.cloudDisk.deletingCloudDisk}),a.map(function(a){var o=setInterval(function(){(new Date).getTime()-l>12e4&&clearInterval(o),t.$http({url:t.common.formatMsg(t.api.storage.get_volumes_detail,{vid:a}),method:"get"}).then(function(e){"1404"===e.data.code||1===parseInt(e.data.code)?(t.$notify({title:t.lang.common.success,type:"success",message:t.common.formatMsg(t.lang.cloudDisk.deleteVolumeSuccess,{name:t.doing[a]})}),clearInterval(o),t.getDisks()):"error"!==e.data.data.status&&"error-deleting"!==e.data.data.status||(t.$notify({title:t.lang.common.error,type:"error",message:t.common.formatMsg(t.lang.cloudDisk.deleteVolumeFailed,{name:t.doing[a]})}),clearInterval(o),t.getDisks())})},3e3);e.timer.push(o)}),t.getDisks()})}},closeResetVolume:function(e){var t=this;this.showResetVolume=!1,!0===e&&this.checkError(this.$http({url:this.api.storage.post_volumes_detail_resets,method:"post",data:{vid:this.sysSelectionIds[0]}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.cloudDisk.resetVolumeSuccess}),t.getDisks(),t.sysSelectionIds=[]})},getDisks:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.storage.get_volumes,method:"get"}),function(t){e.dataOrigin=t.data.data_disks,e.sysOrigin=t.data.sys_disks,e.cacheOrigin=t.data.cache_disks,e.loading=!1},function(){e.loading=!1})},selectDiskIds:function(e){var t=[],a=this;switch(e.forEach(function(e){t.push(e.id)}),this.activeName){case"dataDisk":this.dataSelectionIds=t,this.dataSelections=e;break;case"sysDisk":this.sysSelectionIds=t,this.sysSelections=e;break;case"cacheDisk":this.cacheSelectionIds=t,this.cacheSelections=e}t.length>0?(this.hasSnapshotLoading=!0,this.checkError(this.$http({url:this.api.storage.getSnapshot,method:"get"}),function(e){a.hasSnapshotLoading=!1,a.hasSnapshotVolume=!1,e.data.data_disks.concat(e.data.sys_disks).map(function(e){t.indexOf(e.volumeId)>-1&&(a.hasSnapshotVolume=!0)}),!0===a.hasSnapshotVolume&&(a.disbledDeleteStr=a.lang.cloudDisk.onlyDeleteNoSnapshot)},function(){a.hasSnapshotLoading=!1}),a.delSnapshotVolume=!1,e.forEach(function(e){if("in-use"==e.status)return a.delSnapshotVolume=!0,a.disbledDelete="所选包含已加载的云硬盘不可删除，卸载后再执行删除操作"})):a.disbledDeleteStr=a.lang.cloudDisk.atLeastOneDisk},deleteVolume:function(e){this.force=e,this.deleteCloudDisk=!0},checkOperation:function(e){switch(e){case"charge":this.showChargeVolume=!0;break;case"discharge":this.showDischargeVolume=!0;break;case"create-snapshot":this.showCreateSnapshot=!0;break;case"force-delete":this.deleteVolume(!0);break;case"extend":this.showExtendVolume=!0}}},mounted:function(){var e=this;this.getDisks(),this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var a=t.event_type.split(".");"volume"===a[0]&&"end"===a[2]&&e.getDisks()}})},destroyed:function(){this.common.clearTimer(this)},watch:{dataSearch:function(){this.dataPage=1},cacheSearch:function(){this.sysPage=1},sysSearch:function(){this.cachePage=1}}},z={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getDisks}}),e._v(" "),a("el-main",[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.lang.cloudDisk.dataDisk,name:"dataDisk"}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{type:"primary"},on:{click:e.showModal}},[e._v("\n                            "+e._s(e.lang.common.create)+"\n                        ")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{disabled:0!==e.dataSelectionIds.length&&!1===e.hasSnapshotVolume&&!1===e.delSnapshotVolume,effect:"dark",placement:"top-start",content:!0===e.delSnapshotVolume?e.disbledDelete:e.disbledDeleteStr}},[a("span",{staticClass:"more-operation"},[a("el-button",{attrs:{disabled:!0===e.hasSnapshotLoading||0===e.dataSelectionIds.length||!0===e.hasSnapshotVolume||!0===e.delSnapshotVolume},on:{click:function(t){return e.deleteVolume(!1)}}},[!0===e.hasSnapshotLoading?a("i",{staticClass:"el-icon-loading"}):e._e(),e._v("\n                                    "+e._s(e.lang.common.delete)+"\n                                ")])],1)]),e._v(" "),a("el-dropdown",{staticClass:"more-operation",on:{command:e.checkOperation}},[a("el-button",{attrs:{type:"default",disabled:0===e.dataSelectionIds.length}},[e._v("\n                                "+e._s(e.lang.cloudDisk.moreOperation)+"\n                                "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{disabled:1!==e.dataSelectionIds.length||"available"!==e.dataSelections[0].status&&!("in-use"===e.dataSelections[0].status&&!0===e.dataSelections[0].multiattach),command:"charge"}},[e._v("\n                                    "+e._s(e.lang.cloudDisk.charge)+"\n                                ")]),e._v(" "),a("el-dropdown-item",{attrs:{disabled:1!==e.dataSelectionIds.length||"in-use"!==e.dataSelections[0].status,command:"discharge"}},[e._v("\n                                    "+e._s(e.lang.cloudDisk.discharge)+"\n                                ")]),e._v(" "),a("el-dropdown-item",{attrs:{disabled:1!==e.dataSelectionIds.length||"available"!==e.dataSelections[0].status&&"in-use"!==e.dataSelections[0].status,command:"create-snapshot"}},[e._v("\n                                    "+e._s(e.lang.cloudDisk.createSnapshot)+"\n                                ")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{disabled:!(1===e.dataSelectionIds.length&&"available"!==e.dataSelections[0].status),effect:"dark",content:e.lang.cloudDisk.onlyAvailableCanExtend,placement:"top-start"}},[a("span",[a("el-dropdown-item",{attrs:{disabled:1!==e.dataSelectionIds.length||"available"!==e.dataSelections[0].status,command:"extend"}},[e._v("\n                                        "+e._s(e.lang.cloudDisk.extend)+"\n                                    ")])],1)]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{disabled:0!==e.dataSelectionIds.length&&!1===e.hasSnapshotVolume,effect:"dark",placement:"top-start",content:e.disbledDeleteStr}},[a("span",[a("el-dropdown-item",{attrs:{disabled:0!==e.dataSelectionIds.length&&!0===e.hasSnapshotVolume,command:"force-delete"},on:{click:function(t){return e.deleteVolume(!0)}}},[e._v("\n                                            "+e._s(e.lang.cloudDisk.forceDelete)+"\n                                        ")])],1)])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.dataSearch,callback:function(t){e.dataSearch=t},expression:"dataSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getDisks}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.dataTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectDiskIds,"sort-change":e.sortChangeData}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.name,sortable:"custom",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.configGB,sortable:"custom",prop:"size"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.status,sortable:"custom",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=e.config[t.row.status.toLowerCase()]?a("span",{class:["status",e.config[t.row.status.toLowerCase()].style]},[e._v("\n                            "+e._s(e.config[t.row.status.toLowerCase()].title)+"\n                        ")]):a("span",{staticClass:"status cloud-error"},[e._v("\n                            "+e._s(e.lang.common.unknown)+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.storagePool,sortable:"custom",prop:"display_name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.bootable,sortable:"custom",prop:"bootable"},scopedSlots:e._u([{key:"default",fn:function(t){return[!0===e.common.forceBoolean(t.row.bootable)?a("span",[e._v("\n                            "+e._s(e.lang.cloudDisk.bootable)+"\n                        ")]):a("span",[e._v("\n                            "+e._s(e.lang.cloudDisk.unbootable)+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.shareVolume,sortable:"custom",prop:"multiattach"},scopedSlots:e._u([{key:"default",fn:function(t){return[!0===e.common.forceBoolean(t.row.multiattach)?a("span",[e._v("\n                            "+e._s(e.lang.common.yes)+"\n                        ")]):a("span",[e._v("\n                            "+e._s(e.lang.common.no)+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.description,sortable:"custom",prop:"description"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("\n                                "+e._s(e.lang.common.update)+"\n                            ")])]}}])})],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.dataFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.dataFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchDataPage}},[e._t("default",[a("span",{staticClass:"pagination-slot"},[e._v("\n                            "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.dataPage,total:this.dataFilter.length}))+"\n                        ")])])],2):e._e()],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.cloudDisk.sysDisk,name:"sysDisk"}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:6}},[a("el-tooltip",{staticClass:"item",attrs:{disabled:1===e.sysSelectionIds.length&&"retyping"===e.sysSelections[0].status,effect:"dark",content:e.lang.cloudDisk.resetStatusInfo,placement:"top"}},[a("span",[a("el-button",{attrs:{disabled:1!==e.sysSelectionIds.length||"retyping"!==e.sysSelections[0].status},on:{click:function(t){e.showResetVolume=!0}}},[e._v("\n                                "+e._s(e.lang.cloudDisk.resetStatus)+"\n                            ")])],1)])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.sysSearch,callback:function(t){e.sysSearch=t},expression:"sysSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getDisks}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.sysTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectDiskIds,"sort-change":e.sortChangeSys}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.name,sortable:"custom",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.configGB,sortable:"custom",prop:"size"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.status,sortable:"custom",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=e.config[t.row.status.toLowerCase()]?a("span",{class:["status",e.config[t.row.status.toLowerCase()].style]},[e._v("\n                            "+e._s(e.config[t.row.status.toLowerCase()].title)+"\n                        ")]):a("span",{staticClass:"status cloud-error"},[e._v("\n                            "+e._s(e.lang.common.unknown)+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.storagePool,sortable:"custom",prop:"display_name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.description,sortable:"custom",prop:"description"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"#"},on:{click:function(a){return e.handleEdit(t.row,!0)}}},[e._v("\n                                "+e._s(e.lang.common.update)+"\n                            ")])]}}])})],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.sysFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.sysFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchSysPage}},[e._t("default",[a("span",{staticClass:"pagination-slot"},[e._v("\n                            "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.sysPage,total:this.sysFilter.length}))+"\n                        ")])])],2):e._e()],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.cloudDisk.cacheDisk,name:"cacheDisk"}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{disabled:0===e.cacheSelectionIds.length},on:{click:function(t){e.deleteCloudDisk=!0}}},[e._v("\n                            "+e._s(e.lang.common.delete)+"\n                        ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.cacheSearch,callback:function(t){e.cacheSearch=t},expression:"cacheSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getDisks}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.cacheTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectDiskIds,"sort-change":e.sortChangeCache}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.name,prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.configGB,prop:"size"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.status,prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=e.config[t.row.status.toLowerCase()]?a("span",{class:["status",e.config[t.row.status.toLowerCase()].style]},[e._v("\n                             "+e._s(e.config[t.row.status.toLowerCase()].title)+"\n                        ")]):a("span",{staticClass:"status cloud-error"},[e._v("\n                             "+e._s(e.lang.common.unknown)+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.cloudDisk.storagePool,prop:"display_name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.description,prop:"description"}})],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.cacheFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.cacheFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchCachePage}}):e._e()],1)],1)],1)],1),e._v(" "),a("pana-createCloudDisk",{attrs:{show:e.createCloudDisk},on:{closeModal:e.closeCreateDisk}}),e._v(" "),a("pana-deleteCloudDisk",{attrs:{show:e.deleteCloudDisk},on:{closeModal:e.closeDeleteDisk}}),e._v(" "),a("pana-edit-volume",{attrs:{show:e.showEditVolume,force:e.force,volume:e.editObj,isSys:e.isSys},on:{closeModal:e.closeEditVolume}}),e._v(" "),a("pana-extend-volume",{attrs:{show:e.showExtendVolume,volume:e.dataSelections[0]},on:{closeModal:e.closeExtendVolume}}),e._v(" "),a("pana-charge-volume",{attrs:{show:e.showChargeVolume,volume:e.dataSelections[0]},on:{closeModal:e.closeChargeVolume}}),e._v(" "),a("pana-discharge-volume",{attrs:{show:e.showDischargeVolume,volume:e.dataSelections[0]},on:{closeModal:e.closeDischargeVolume}}),e._v(" "),a("pana-create-snapshot",{attrs:{show:e.showCreateSnapshot,volume:e.dataSelections[0]},on:{closeModal:e.closeCreateSnapshot}}),e._v(" "),a("pana-reset-volume",{attrs:{show:e.showResetVolume},on:{closeModal:e.closeResetVolume}})],1)},staticRenderFns:[]};var P=a("C7Lr")(O,z,!1,function(e){a("EuCd")},"data-v-26e778a6",null);t.default=P.exports},bwJI:function(e,t){},fgAE:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("1JPr"),s=a("/n4h"),l={data:function(){return{loading:!0,dialogVisible:!1,tipDialogMsg:"",operate:"",tableData:[],volumeData:[],volumeId:"",multipleSelection:[],search:"",pageNum:1,pageSize:10,canRollBack:!1}},mounted:function(){this.getList(),this.getVolumeList()},components:{"pana-breadcrumb":o.a,cloudTipDialog:s.a},methods:{sort:function(e){this.tableData=this.common.sort(e,this.tableData,["size","used"])},getVolumeList:function(){var e=this;this.checkError(this.$http({url:this.api.storage.dataset,method:"get"}),function(t){e.volumeData=t.data})},getList:function(){var e=this;e.loading=!0;var t="";this.volumeId&&"all"!==this.volumeId&&(t=this.common.formatGetUrl({source:this.volumeId})),this.checkError(this.$http({url:this.api.storage.dataset_snapshot+t,method:"get"}),function(t){e.loading=!1,e.tableData=t.data})},selectVolume:function(){this.getList()},rollbackConfirm:function(){this.operate="rollback",this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.rollbackConfirm},deleteConfirm:function(){this.operate="delete",this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.deleteSnapshotConfirm},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"rollback":this.rollback();break;case"delete":this.delete()}},rollback:function(){var e=this,t=this.multipleSelection[0].guid,a=this.common.formatMsg(this.api.storage.dataset_snapshot_rollback,{snap_id:t});this.checkError(this.$http({url:a,method:"POST"}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.volume.snapshotRollbackSuccess})})},delete:function(){var e=this,t=this.multipleSelection[0].guid,a=this.common.formatMsg(this.api.storage.dataset_snapshot_detail,{snap_id:t});this.checkError(this.$http({url:a,method:"DELETE"}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.common.formatMsg(e.lang.volume.deleteSnapshotSuccess,{name:e.multipleSelection[0].name})})})},notSelect:function(){return this.multipleSelection.length<=0},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e;var t=[],a=this;1===e.length&&(this.tableData.forEach(function(o){o.parent===e[0].parent&&o.name!==e[0].name&&t.push({name:o.name,creation:a.moment(o.creation).valueOf(),guid:o.guid,parent:o.parent})}),this.canRollBack=this.moment(e[0].creation).valueOf()>Math.max.apply(Math,t.map(function(e){return e.creation})))}},computed:{selectNotOne:function(){return 1!==this.multipleSelection.length},filterData:function(){var e=this.search,t=[],a=this.tableData;return t=""===e?a:this.common.cloudFilter(a,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:e.selectNotOne||!1===e.selectNotOne&&!1===e.canRollBack},on:{click:e.rollbackConfirm}},[!1===e.canRollBack&&1===e.multipleSelection.length?a("div",[a("el-tooltip",{attrs:{content:e.lang.volume.supportLatestSnapshot,placement:"top"}},[a("div",[e._v(e._s(e.lang.volume.rollback))])])],1):e._e(),e._v(" "),0===e.multipleSelection.length?a("div",[a("el-tooltip",{attrs:{content:e.lang.volume.selectLeastOne,placement:"top"}},[a("div",[e._v(e._s(e.lang.volume.rollback))])])],1):e._e(),e._v(" "),e.multipleSelection.length>1?a("div",[a("el-tooltip",{attrs:{content:e.lang.volume.selcetOne,placement:"top"}},[a("div",[e._v(e._s(e.lang.volume.rollback))])])],1):e._e(),e._v(" "),1===e.multipleSelection.length&&!0===e.canRollBack?a("div",[e._v("\n                    \t"+e._s(e.lang.volume.rollback)+"\n                    ")]):e._e()]),e._v(" "),a("el-button",{attrs:{disabled:e.selectNotOne},on:{click:e.deleteConfirm}},[e._v("\n                    "+e._s(e.lang.common.delete)+"\n                ")]),e._v(" "),a("el-select",{attrs:{placeholder:e.lang.volume.selectVolume},on:{change:e.selectVolume},model:{value:e.volumeId,callback:function(t){e.volumeId=t},expression:"volumeId"}},[a("el-option",{attrs:{label:e.lang.volume.all,value:"all"}}),e._v(" "),e._l(e.volumeData,function(e){return a("el-option",{key:e.guid,attrs:{label:e.name,value:e.guid}})})],2)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.common.name}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"parent",label:e.lang.volume.vloumeName}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"creation",label:e.lang.volume.createTime}})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible},on:{cancel:function(t){e.dialogVisible=!1},confirm:e.dialogConfirm}},[a("div",{domProps:{innerHTML:e._s(e.tipDialogMsg)}})])],1)},staticRenderFns:[]};var n=a("C7Lr")(l,r,!1,function(e){a("1nnc")},"data-v-6e21eda9",null);t.default=n.exports},fhoo:function(e,t){},flHN:function(e,t){},fsgw:function(e,t){},"gE/C":function(e,t){},hESZ:function(e,t,a){"use strict";var o=a("3cXf"),s=a.n(o),l=a("aA9S"),r=a.n(l),n={name:"createUser",data:function(){return{labelWidth:"120px",loading:!1,form:{name:"",password:"",confirmPassword:"",groups:[]},rules:{name:[{required:!0,message:this.lang.poolStorageUser.userRequiredRule,trigger:"blur"},{min:1,max:18,message:this.lang.poolStorageUser.userRangeRule,trigger:"blur"},{validator:this.common.validateStorageName,message:this.lang.poolStorageUser.userFormatRule,trigger:"blur"}],password:[{required:!0,message:this.lang.userManage.passwordRequiredRule,trigger:"blur"},{min:6,max:16,message:this.lang.userManage.passwordRangeRule,trigger:"blur"}]},groupList:[],disable:!1}},props:{show:Boolean},methods:{closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getGroupList()},createUser:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?(delete e.form.confirmPassword,e.form=e.common.dropEmptyParameter(e.form),null==e.form.group&&(e.form.group=[]),e.checkError(e.$http({url:e.api.user.user,method:"post",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageUser.createUserSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},getGroupList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.group.group,method:"get"}),function(t){e.loading=!1,e.groupList=t.data},function(){e.loading=!1})},confirmPassword:function(e,t,a){t===e.password?a():a(Error(e.message))}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageUser.createUser,visible:e.show,width:"40%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.user,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.userPlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.password,"label-width":e.labelWidth,prop:"password"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.passwordPlaceholder,type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.cfmPassword,"label-width":e.labelWidth,prop:"confirmPassword",rules:[{validator:this.confirmPassword,message:this.lang.poolStorageUser.cfmPasswordNotSameRule,password:this.form.password,trigger:"blur"},{required:!0,message:this.lang.poolStorageUser.cfmPasswordRequiredRule,trigger:"blur"}]}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.cfmPasswordPlaceholder,type:"password"},model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.selectGroup,"label-width":e.labelWidth}},[a("el-select",{attrs:{filterable:"",multiple:"",placeholder:e.lang.poolStorageUser.groupSelectPlaceyholder,width:"100%"},model:{value:e.form.groups,callback:function(t){e.$set(e.form,"groups",t)},expression:"form.groups"}},e._l(e.groupList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})}),1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(n,i,!1,function(e){a("vlkZ")},"data-v-6278ab9c",null).exports,u={name:"pana-delete-user",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteUser:function(){this.closeModal(!0)}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.userManage.deleteUserInfo))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},m=a("C7Lr")(u,d,!1,null,null,null).exports,p={name:"createUser",data:function(){return{labelWidth:"120px",loading:!1,form:{name:"",user_id:"",groups:[]},rules:{name:[{required:!0,message:this.lang.poolStorageUser.userRequiredRule,trigger:"blur"},{min:1,max:18,message:this.lang.poolStorageUser.userRangeRule,trigger:"blur"},{validator:this.common.validateStorageName,message:this.lang.poolStorageUser.userFormatRule,trigger:"blur"}],user_id:[{required:!0,message:this.lang.poolStorageUser.userIdRequiredRule,trigger:"blur"},{validator:this.common.validateNumberRange,min:1e3,max:65532,message:this.lang.poolStorageUser.userIdNumberRange,trigger:"blur"},{validator:this.common.validateNumberType,message:this.lang.poolStorageUser.userIdNumberType,trigger:"blur"}]},groupList:[],disable:!1,originUserName:null}},props:{show:Boolean,user:Object},methods:{closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getGroupList(),this.form=this.user,delete this.form.password,this.originUserName=this.user.name},editUser:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?(e.form=e.common.dropEmptyParameter(e.form),delete e.form.password,null==e.form.groups&&(e.form.groups=[]),e.checkError(e.$http({url:e.common.formatMsg(e.api.user.user_detail,{user_name:e.originUserName}),method:"put",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageUser.editUserSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},getGroupList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.group.group,method:"get"}),function(t){e.loading=!1,e.groupList=t.data},function(){e.loading=!1})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageUser.editUser,visible:e.show,width:"40%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.user,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.userPlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.userId,"label-width":e.labelWidth,prop:"user_id"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.userIdPlaceholder},model:{value:e.form.user_id,callback:function(t){e.$set(e.form,"user_id",t)},expression:"form.user_id"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.selectGroup,"label-width":e.labelWidth}},[a("el-select",{attrs:{filterable:"",multiple:"",placeholder:e.lang.poolStorageUser.groupSelectPlaceyholder,width:"100%"},model:{value:e.form.groups,callback:function(t){e.$set(e.form,"groups",t)},expression:"form.groups"}},e._l(e.groupList,function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})}),1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.editUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var h=a("C7Lr")(p,g,!1,function(e){a("5BR7")},"data-v-4235ed59",null).exports,f={name:"createUser",data:function(){return{labelWidth:"120px",form:{name:"",password:"",confirmPassword:null,user_id:"",groups:[]},rules:{password:[{required:!0,message:this.lang.userManage.passwordRequiredRule,trigger:"blur"},{min:6,max:16,message:this.lang.userManage.passwordRangeRule,trigger:"blur"}]},groupList:[],disable:!1,originUserName:null}},props:{show:Boolean,user:Object},methods:{closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.form=this.user},resetPassword:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?(e.form=e.common.dropEmptyParameter(e.form),delete e.form.confirmPassword,null==e.form.groups&&(e.form.groups=[]),e.checkError(e.$http({url:e.common.formatMsg(e.api.user.user_detail,{user_name:e.form.name}),method:"put",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageUser.resetPasswordSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},validateConfirmPassword:function(e,t,a){t===this.form.password?a():a(Error(e.message))}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageUser.resetPassword,visible:e.show,width:"40%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.password,"label-width":e.labelWidth,prop:"password"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.passwordPlaceholder,type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageUser.cfmPassword,"label-width":e.labelWidth,prop:"confirmPassword",rules:[{required:!0,message:this.lang.poolStorageUser.cfmPasswordRequiredRule,trigger:"blur"},{validator:e.validateConfirmPassword,message:e.lang.poolStorageUser.cfmPasswordNotSameRule,trigger:"blur"}]}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.cfmPasswordPlaceholder,type:"password"},model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.resetPassword}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var v=a("C7Lr")(f,b,!1,function(e){a("1o0s")},"data-v-07a13d5e",null).exports,_=a("zsLt"),y=a.n(_),w={name:"pana-add-staff",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,r()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){this.messageSuccess=!0,null!=this.$refs.form&&this.$refs.form.clearValidate();var e=sessionStorage.getItem("panaCurrentPool");this.poolList=null==e?[]:JSON.parse(e),this.getShowUserList()},getShowUserList:function(){var e=this;this.checkError(this.$http({url:this.api.user.user,method:"get"}),function(t){e.getUserList(t)})},getUserList:function(e){var t=this;this.checkError(this.$http({url:this.api.management.get_users_state+"?size=0",method:"get"}),function(a){var o=new y.a(a.data.map(function(e){return e.name||e.username}));e.data.filter(function(e){return!o.delete(e.name||e.username)});a.data.filter(function(e){return o.has(e.name||e.username)}).map(function(e){e.user_name_department=e.username+(e.department?" - "+e.department.department_name:""),t.allUsers.push(e)})})},addUser:function(){var e=this;0!=this.selectedUsers.length?this.checkError(this.$http({url:this.common.formatMsg(this.api.storage.post_storage_pool_gateway_users,{pool_id:this.poolList.id}),method:"post",data:{users:e.selectedUsers}}),function(t){e.messageSuccess=!1,e.importPrompt=t.message}):e.$notify({title:e.lang.common.error,type:"error",message:e.lang.poolStorageUser.errorNoUser})}},data:function(){return{labelWidth:"100px",departments:[],form:{},allUsers:[],selectedUsers:[],departmentLoading:!1,poolList:[],messageSuccess:!0,importPrompt:""}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageUser.importUser,width:"30%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[1==e.messageSuccess?a("el-row",{attrs:{justify:"center"}},[a("el-col",{attrs:{span:24}},[a("span",{staticClass:"initial-import-user"},[e._v(e._s(e.lang.departmentManage.initialImportUser))])])],1):e._e(),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[1==e.messageSuccess?a("el-transfer",{attrs:{filterable:"",titles:[e.lang.departmentManage.availableStaff,e.lang.departmentManage.selectedStaff],props:{label:"user_name_department",key:"id"},format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},data:e.allUsers},model:{value:e.selectedUsers,callback:function(t){e.selectedUsers=t},expression:"selectedUsers"}}):e._e(),e._v(" "),0==e.messageSuccess?a("span",[e._v(e._s(e.importPrompt))]):e._e()],1),e._v(" "),1==e.messageSuccess?a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v(e._s(e.lang.common.confirm))])],1):e._e(),e._v(" "),0==e.messageSuccess?a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.closeModal(!0)}}},[e._v(e._s(e.lang.common.confirm))])],1):e._e()],1)},staticRenderFns:[]};var k={name:"cloudDisk",components:{"pana-create-user":c,"pana-delete-user":m,"pana-edit-user":h,"pana-reset-password":v,"pana-import-user":a("C7Lr")(w,S,!1,function(e){a("5ziM"),a("xcf8")},"data-v-4520213a",null).exports},data:function(){return{pageSize:10,userSearch:"",userOrigin:[],userSelectionNames:[],userPage:1,showCreateUser:!1,showDeleteUser:!1,showEditUser:!1,showResetPassword:!1,showImportUser:!1,loading:!1,editObj:null,showImportPrompt:!1}},computed:{userFilter:function(){var e=this;return this.userOrigin.filter(function(t){return""===e.userSearch||-1!==s()(t).search(e.userSearch)})},userTable:function(){return this.userFilter.length>this.pageSize?this.userFilter.slice((this.userPage-1)*this.pageSize,this.userPage*this.pageSize):this.userFilter}},methods:{switchUserPage:function(e){this.userPage=e},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.userOrigin=this.userOrigin.sort(function(a,o){switch(e.prop){case"user_id":return(a[e.prop]-o[e.prop])*t;default:return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t}})},closeCreateUser:function(e){!0===e&&this.getUserList(),this.showCreateUser=!1},closeEditUser:function(e){!0===e&&this.getUserList(),this.showEditUser=!1},closeDeleteUser:function(e){var t=this;this.showDeleteUser=!1,!0===e&&(this.checkError(this.$http({url:this.api.user.user_action,method:"post",data:{names:this.userSelectionNames}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.poolStorageUser.deleteUserSuccess}),t.getUserList()}),t.userSelectionNames=[])},getUserList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.user.user,method:"get"}),function(t){e.loading=!1,e.userOrigin=t.data},function(){e.loading=!1})},selectUserNames:function(e){var t=[];e.forEach(function(e){t.push(e.name)}),this.userSelectionNames=t},editUser:function(e){this.editObj=this.common.deepCopyByJson(e),this.showEditUser=!0},resetPassword:function(e){this.editObj=this.common.deepCopyByJson(e),this.showResetPassword=!0},closeImportUser:function(e){console.log(e,"isImport");this.showImportUser=!1,!0===e&&this.getUserList()}},mounted:function(){this.getUserList()}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreateUser=!0}}},[e._v(e._s(e.lang.common.create))]),e._v(" "),a("el-button",{attrs:{disabled:0===e.userSelectionNames.length},on:{click:function(t){e.showDeleteUser=!0}}},[e._v(e._s(e.lang.common.delete))])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.userSearch,callback:function(t){e.userSearch=t},expression:"userSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getUserList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.userTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectUserNames,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageUser.user,sortable:"custom",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageUser.userId,sortable:"custom",prop:"user_id"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageUser.groupName},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.groups,function(t,o){return a("div",{key:o},[e._v(e._s(t))])})}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editUser(t.row)}}},[e._v(e._s(e.lang.common.update))]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.resetPassword(t.row)}}},[e._v(e._s(e.lang.poolStorageUser.resetPassword))])]}}])})],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.userFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.userFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchUserPage}},[e._t("default",[a("span",{staticClass:"pagination-slot"},[e._v(e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.userPage,total:this.userFilter.length})))])])],2):e._e()],1),e._v(" "),a("pana-create-user",{attrs:{show:e.showCreateUser},on:{closeModal:e.closeCreateUser}}),e._v(" "),a("pana-delete-user",{attrs:{show:e.showDeleteUser},on:{closeModal:e.closeDeleteUser}}),e._v(" "),a("pana-edit-user",{attrs:{show:e.showEditUser,user:e.editObj},on:{closeModal:e.closeEditUser}}),e._v(" "),a("pana-reset-password",{attrs:{show:e.showResetPassword,user:e.editObj},on:{closeModal:function(t){e.showResetPassword=!1}}}),e._v(" "),a("pana-import-user",{attrs:{show:e.showImportUser},on:{closeModal:e.closeImportUser}})],1)},staticRenderFns:[]};var C=a("C7Lr")(k,x,!1,function(e){a("8HiS")},"data-v-3e4e2ec0",null);t.a=C.exports},i4vV:function(e,t){},"jeg/":function(e,t){},ka4P:function(e,t){},kbEo:function(e,t){},l7DD:function(e,t){},lOtg:function(e,t){},nedn:function(e,t){},oFYa:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("3cXf"),s=a.n(o),l=a("1JPr"),r=a("aA9S"),n=a.n(r),i={name:"pana-create-obj",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate()},createObj:function(){var e=this,t=this.form;this.disable=!0,this.$refs.form.validate(function(a){a?e.checkError(e.$http({url:e.api.buckets.buckets,method:"post",data:t}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageObjShare.createObjSuccess}),e.closeModal(!0)},function(){e.disable=!1}):e.disable=!1})},validateObjectShareName:function(e,t,a){null==t||""===t||!0===/^[a-z0-9][a-z0-9\-.]*[a-z0-9]$/.test(t)&&!1===/^\d+\.\d+\.\d+\.\d+$/.test(t)?a():a(new Error(e.message))}},data:function(){return{labelWidth:"100px",form:{name:""},rules:{name:[{required:!0,message:this.lang.poolStorageObjShare.nameRequiredRule,trigger:"blur"},{min:3,max:63,message:this.lang.poolStorageObjShare.nameLengthRule,trigger:"blur"},{validator:this.validateObjectShareName,message:this.lang.poolStorageObjShare.nameFormatRule,trigger:"blur"}]},disable:!1}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageObjShare.createObj,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[a("el-row",[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:e.lang.common.name,"label-width":e.labelWidth,prop:"name"}},[a("el-input",{attrs:{required:"",placeholder:e.lang.poolStorageObjShare.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createObj}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var u=a("C7Lr")(i,c,!1,function(e){a("gE/C")},"data-v-328ac10e",null).exports,d={name:"pana-delete-obj",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteObj:function(){this.closeModal(!0)}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.poolStorageObjShare.confirmDeleteObjShare))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteObj}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},p=a("C7Lr")(d,m,!1,null,null,null).exports,g={name:"pana-create-obj",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getObjectKeys()},getObjectKeys:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.objectkeys.objectkeys,method:"get"}),function(t){e.form.access_key=t.data.accessKey,e.form.secret_key=t.data.secretKey,e.loading=!1},function(){e.loading=!1})},manageKey:function(){var e=this,t=this.form;this.disable=!0,this.$refs.form.validate(function(a){a?e.checkError(e.$http({url:e.api.objectkeys.objectkeys_configure,method:"post",data:t}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageObjShare.keyManageSuccess}),e.closeModal(!0)},function(){e.disable=!1}):e.disable=!1})},validateAccessKey:function(e,t,a){null==t||""===t||!0===/^[A-Za-z0-9_]*$/.test(t)?a():a(new Error(e.message))}},data:function(){return{labelWidth:"100px",loading:!1,form:{access_key:"",secret_key:""},rules:{access_key:[{required:!0,message:this.lang.poolStorageObjShare.itemRequiredRule,trigger:"blur"},{min:3,max:64,message:this.lang.poolStorageObjShare.accessKeyLengthRule,trigger:"blur"},{validator:this.validateAccessKey,message:this.lang.poolStorageObjShare.accessKeyFormatRule,trigger:"blur"}],secret_key:[{required:!0,message:this.lang.poolStorageObjShare.itemRequiredRule,trigger:"blur"},{min:8,max:128,message:this.lang.poolStorageObjShare.secretKeyLengthRule,trigger:"blur"}]},disableAccessKey:!0,disableSecretKey:!0,showAccessKey:!0,showSecretKey:!0,disable:!1}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageObjShare.keysManage,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageObjShare.accessKey,"label-width":e.labelWidth,prop:"access_key"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:!0===e.showAccessKey?"password":"text",readonly:e.disableAccessKey,placeholder:e.lang.poolStorageObjShare.itemPlaceholder},model:{value:e.form.access_key,callback:function(t){e.$set(e.form,"access_key",t)},expression:"form.access_key"}},[a("i",{class:["fa",!0===e.showAccessKey?"fa-eye-slash":"fa-eye"].join(" "),attrs:{slot:"suffix"},on:{click:function(t){e.showAccessKey=!e.showAccessKey}},slot:"suffix"})])],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"default",plain:""},on:{click:function(t){e.disableAccessKey=!e.disableAccessKey}}},[e._v("\n                            "+e._s(e.lang.common.update)+"\n                        ")])],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageObjShare.secretKey,"label-width":e.labelWidth,prop:"secret_key"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:!0===e.showSecretKey?"password":"text",readonly:e.disableSecretKey,placeholder:e.lang.poolStorageObjShare.itemPlaceholder},model:{value:e.form.secret_key,callback:function(t){e.$set(e.form,"secret_key",t)},expression:"form.secret_key"}},[a("i",{class:["fa",!0===e.showSecretKey?"fa-eye-slash":"fa-eye"].join(" "),attrs:{slot:"suffix"},on:{click:function(t){e.showSecretKey=!e.showSecretKey}},slot:"suffix"})])],1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"default",plain:""},on:{click:function(t){e.disableSecretKey=!e.disableSecretKey}}},[e._v("\n                            "+e._s(e.lang.common.update)+"\n                        ")])],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.manageKey}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(g,h,!1,function(e){a("fhoo")},"data-v-003b0229",null).exports,b={name:"file-share",components:{"pana-breadcrumb":l.a,"pana-create-obj":u,"pana-delete-obj":p,"pana-key-manage":f},data:function(){return{showShadow:!1,pageSize:10,objSearch:"",objOrigin:[],objSelectionNames:[],objPage:1,showCreateObj:!1,showDeleteObj:!1,showKeyManage:!1,currentSelectObjs:[],disableDeleteMessage:this.lang.poolStorageObjShare.noneSeletion,denyDelete:!0,loading:!1}},computed:{objFilter:function(){var e=this;return this.objOrigin.filter(function(t){return""===e.objSearch||-1!==s()(t).search(e.objSearch)})},objTable:function(){return this.objFilter.length>this.pageSize?this.objFilter.slice((this.objPage-1)*this.pageSize,this.objPage*this.pageSize):this.objFilter}},watch:{currentSelectObjs:function(){var e=this,t=[];if(0===this.currentSelectObjs.length)this.denyDelete=!0,this.disableDeleteMessage=this.lang.poolStorageObjShare.noneSeletion;else{var a=!0;this.currentSelectObjs.map(function(o){!1===o.is_empty&&(a=!1),!1===a?(e.denyDelete=!0,e.disableDeleteMessage=e.lang.poolStorageObjShare.hasUsedSelection):(e.denyDelete=!1,e.disableDeleteMessage=""),t.push(o.name)})}},objSearch:function(){this.objPage=1}},methods:{switchObjPage:function(e){this.objPage=e},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.objOrigin=this.objOrigin.sort(function(a,o){return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t})},closeCreateObj:function(e){!0===e&&this.getObjList(),this.showCreateObj=!1},closeDeleteObj:function(e){var t=this;this.showDeleteObj=!1,!0===e&&this.checkError(this.$http({url:this.api.buckets.buckets_batch_delete,method:"post",data:{buckets:this.objSelectionNames}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.poolStorageObjShare.deleteObjSuccess}),t.getObjList()})},getObjList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.buckets.buckets,method:"get"}),function(t){e.loading=!1,null==t.data?e.showShadow=!0:e.objOrigin=t.data},function(){e.loading=!1})},selectObjNames:function(e){this.currentSelectObjs=e;var t=[];e.forEach(function(e){t.push(e.name)}),this.objSelectionNames=t}},mounted:function(){this.getObjList()}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"parent-div"},[a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getObjList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:function(t){e.showCreateObj=!0}}},[e._v("\n                        "+e._s(e.lang.common.create)+"\n                    ")]),e._v(" "),a("el-button",{attrs:{disabled:e.loading||e.denyDelete},on:{click:function(t){e.showDeleteObj=!0}}},[!0===e.denyDelete?a("el-tooltip",{attrs:{content:e.disableDeleteMessage,placement:"top"}},[a("span",[e._v("\n                                "+e._s(e.lang.common.delete)+"\n                            ")])]):a("span",[e._v("\n                            "+e._s(e.lang.common.delete)+"\n                        ")])],1),e._v(" "),a("el-button",{attrs:{disabled:e.loading},on:{click:function(t){e.showKeyManage=!0}}},[e._v("\n                        "+e._s(e.lang.poolStorageObjShare.keysManage)+"\n                    ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.objSearch,callback:function(t){e.objSearch=t},expression:"objSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getObjList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.objTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectObjNames,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageObjShare.shareName,sortable:"custom",prop:"name","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageObjShare.accessAddress,sortable:"custom","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.address,function(t,o){return a("div",{key:o},[e._v("\n                            "+e._s(t)+"\n                        ")])})}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageObjShare.createTime,sortable:"custom",prop:"time"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e._f("utc2beijing")(t.row.time))+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageObjShare.shareStatus,sortable:"custom",prop:"is_empty"},scopedSlots:e._u([{key:"default",fn:function(t){return[!1===t.row.is_empty?a("span",{staticClass:"status cloud-default"},[e._v("\n                        "+e._s(e.lang.poolStorageObjShare.used)+"\n                    ")]):a("span",{staticClass:"status cloud-info"},[e._v("\n                        "+e._s(e.lang.poolStorageObjShare.unused)+"\n                    ")])]}}])})],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.objFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.objFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchObjPage}},[e._t("default",[a("span",{staticClass:"pagination-slot"},[e._v("\n                            "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.objPage,total:this.objFilter.length}))+"\n                        ")])])],2):e._e()],1)],1),e._v(" "),a("pana-create-obj",{attrs:{show:e.showCreateObj},on:{closeModal:e.closeCreateObj}}),e._v(" "),a("pana-delete-obj",{attrs:{show:e.showDeleteObj},on:{closeModal:e.closeDeleteObj}}),e._v(" "),a("pana-key-manage",{attrs:{show:e.showKeyManage},on:{closeModal:function(t){e.showKeyManage=!1}}})],1),e._v(" "),e.showShadow?a("div",{staticClass:"none-service"},[a("div",{staticClass:"info"},[e._v(e._s(e.lang.poolStorageObjShare.noneServiceInfo))])]):e._e()],1)},staticRenderFns:[]};var _=a("C7Lr")(b,v,!1,function(e){a("nedn")},"data-v-8ea92e08",null);t.default=_.exports},"q/Q3":function(e,t){},qT68:function(e,t){},sSbh:function(e,t){},tQoQ:function(e,t){},vlkZ:function(e,t){},wEst:function(e,t,a){"use strict";var o=a("3cXf"),s=a.n(o),l=a("aA9S"),r=a.n(l),n={name:"createGroup",data:function(){return{labelWidth:"60px",loading:!1,form:{name:"",members:[]},rules:{name:[{required:!0,message:this.lang.poolStorageGroup.groupRequiredRule,trigger:"blur"},{min:1,max:18,message:this.lang.poolStorageGroup.groupRangeRule,trigger:"blur"},{validator:this.common.validateStorageName,message:this.lang.poolStorageGroup.groupFormatRule,trigger:"blur"}]},userList:[],disable:!1}},props:{show:Boolean},methods:{closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getUserList()},createGroup:function(){var e=this;this.disable=!0,this.form=this.common.dropEmptyParameter(this.form),this.$refs.form.validate(function(t){t?e.checkError(e.$http({url:e.api.group.group,method:"post",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageGroup.createGroupSuccess}),e.closeModal(!0)},function(){e.disable=!1}):e.disable=!1})},getUserList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.user.user,method:"get"}),function(t){e.loading=!1,e.userList=t.data},function(){e.loading=!1})}}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"transfer-dialog",attrs:{title:e.lang.poolStorageGroup.createGroup,visible:e.show,width:"45%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageGroup.group,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageGroup.groupPlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageGroup.member,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:24}},[a("el-transfer",{attrs:{filterable:"",titles:[e.lang.poolStorageGroup.availableMember,e.lang.poolStorageGroup.selectedMember],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},props:{label:"name",key:"name"},data:e.userList},model:{value:e.form.members,callback:function(t){e.$set(e.form,"members",t)},expression:"form.members"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createGroup}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var c=a("C7Lr")(n,i,!1,function(e){a("jeg/")},null,null).exports,u={name:"pana-delete-user",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteUser:function(){this.closeModal(!0)}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.poolStorageGroup.confirmDeleteGroup))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},m=a("C7Lr")(u,d,!1,null,null,null).exports,p={name:"createGroup",data:function(){return{labelWidth:"120px",form:{name:"",group_id:"",members:[]},rules:{name:[{required:!0,message:this.lang.poolStorageGroup.groupRequiredRule,trigger:"blur"},{min:1,max:18,message:this.lang.poolStorageGroup.groupRangeRule,trigger:"blur"},{validator:this.common.validateStorageName,message:this.lang.poolStorageGroup.groupFormatRule,trigger:"blur"}],group_id:[{required:!0,message:this.lang.poolStorageGroup.groupIdRequiredRule,trigger:"blur"},{validator:this.common.validateNumberRange,min:1e3,max:65532,message:this.lang.poolStorageGroup.groupIdNumberRange,trigger:"blur"},{validator:this.common.validateNumberType,message:this.lang.poolStorageGroup.groupIdNumberType,trigger:"blur"}]},disable:!1,originGroupName:null}},props:{show:Boolean,group:Object},methods:{closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.form=this.group,this.originGroupName=this.group.name},editGroup:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?(e.form=e.common.dropEmptyParameter(e.form),null==e.form.members&&(e.form.members=[]),e.checkError(e.$http({url:e.common.formatMsg(e.api.group.group_detail,{group_name:e.originGroupName}),method:"put",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageGroup.editGroupSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageGroup.editGroup,visible:e.show,width:"40%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageGroup.group,"label-width":e.labelWidth,prop:"name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageUser.groupPlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageGroup.groupId,"label-width":e.labelWidth,prop:"group_id"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.poolStorageGroup.groupIdPlaceholder},model:{value:e.form.group_id,callback:function(t){e.$set(e.form,"group_id",t)},expression:"form.group_id"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.editGroup}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},h=a("C7Lr")(p,g,!1,null,null,null).exports,f={name:"createGroup",data:function(){return{labelWidth:"60px",loading:!1,form:{name:"",group_id:"",members:[]},rules:{name:[{required:!0,message:this.lang.poolStorageGroup.groupRequiredRule,trigger:"blur"},{min:1,max:18,message:this.lang.poolStorageGroup.groupRangeRule,trigger:"blur"},{validator:this.common.validateStorageName,message:this.lang.poolStorageGroup.groupFormatRule,trigger:"blur"}]},userList:[],disable:!1}},props:{show:Boolean,group:Object},methods:{closeModal:function(e){r()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.form=this.group,this.getUserList()},manageMember:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?(e.form=e.common.dropEmptyParameter(e.form),null==e.form.members&&(e.form.members=[]),e.checkError(e.$http({url:e.common.formatMsg(e.api.group.group_detail,{group_name:e.form.name}),method:"put",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.poolStorageGroup.manageMemberSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},getUserList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.user.user,method:"get"}),function(t){e.userList=t.data,e.loading=!1},function(){e.loading=!1})}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageGroup.manageMember,visible:e.show,width:"45%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.poolStorageGroup.member,"label-width":e.labelWidth}},[a("el-col",{attrs:{span:24}},[a("el-transfer",{attrs:{filterable:"",titles:[e.lang.poolStorageGroup.availableMember,e.lang.poolStorageGroup.selectedMember],format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},props:{label:"name",key:"name"},data:e.userList},model:{value:e.form.members,callback:function(t){e.$set(e.form,"members",t)},expression:"form.members"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.manageMember}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},v=a("C7Lr")(f,b,!1,null,null,null).exports,_={name:"createUser",props:{show:Boolean,members:{type:Array,default:function(){return[]}}},computed:{memberCount:function(){return null==this.members?0:this.members.length}},methods:{closeModal:function(){this.$emit("closeModal",!1)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate()}}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.poolStorageGroup.checkMember,visible:e.show,width:"40%"},on:{close:e.closeModal,open:e.initForm}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:23}},[a("el-table",{ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.members,"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{label:e.lang.poolStorageGroup.username},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.common.formatMsg(e.lang.poolStorageGroup.memberCount,{count:this.memberCount}),align:"right"}})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.close))])],1)],1)},staticRenderFns:[]};var w={name:"cloudDisk",components:{"pana-create-group":c,"pana-delete-group":m,"pana-edit-group":h,"pana-manage-member":v,"pana-check-member":a("C7Lr")(_,y,!1,function(e){a("FSDC")},"data-v-b8f368b0",null).exports},data:function(){return{pageSize:10,groupSearch:"",groupOrigin:[],groupSelectionNames:[],groupPage:1,showCreateGroup:!1,showDeleteGroup:!1,showEditGroup:!1,showManageMember:!1,showCheckMember:!1,editObj:null,members:null,loading:!1}},computed:{groupFilter:function(){var e=this;return this.groupOrigin.filter(function(t){return""===e.groupSearch||-1!==s()(t).search(e.groupSearch)})},groupTable:function(){return this.groupFilter.length>this.pageSize?this.groupFilter.slice((this.groupPage-1)*this.pageSize,this.groupPage*this.pageSize):this.groupFilter}},methods:{switchGroupPage:function(e){this.groupPage=e},closeCreateGroup:function(e){!0===e&&this.getGroupList(),this.showCreateGroup=!1},closeEditGroup:function(e){!0===e&&this.getGroupList(),this.showEditGroup=!1},closeManageGroup:function(e){!0===e&&this.getGroupList(),this.showManageMember=!1},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.groupOrigin=this.groupOrigin.sort(function(a,o){switch(e.prop){case"group_id":return(a[e.prop]-o[e.prop])*t;default:return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t}})},closeDeleteGroup:function(e){var t=this;this.showDeleteGroup=!1,!0===e&&this.checkError(this.$http({url:this.api.group.group_action,method:"post",data:{names:this.groupSelectionNames}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.poolStorageGroup.deleteGroupSuccess}),t.getGroupList()})},getGroupList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.group.group,method:"get"}),function(t){e.loading=!1,e.groupOrigin=t.data},function(){e.loading=!1})},selectGroupNames:function(e){var t=[];e.forEach(function(e){t.push(e.name)}),this.groupSelectionNames=t},editGroup:function(e){this.editObj=this.common.deepCopyByJson(e),this.showEditGroup=!0},manageMember:function(e){this.editObj=this.common.deepCopyByJson(e),this.showManageMember=!0},checkMember:function(e){this.members=this.common.deepCopyByJson(e),this.showCheckMember=!0}},mounted:function(){this.getGroupList()}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreateGroup=!0}}},[e._v("\n                "+e._s(e.lang.common.create)+"\n            ")]),e._v(" "),a("el-button",{attrs:{disabled:0===e.groupSelectionNames.length},on:{click:function(t){e.showDeleteGroup=!0}}},[e._v("\n                "+e._s(e.lang.common.delete)+"\n            ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.groupSearch,callback:function(t){e.groupSearch=t},expression:"groupSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getGroupList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.groupTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectGroupNames,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageGroup.group,sortable:"custom",prop:"name"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.poolStorageGroup.groupId,sortable:"custom",prop:"group_id"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editGroup(t.row)}}},[e._v("\n                    "+e._s(e.lang.common.update)+"\n                ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.manageMember(t.row)}}},[e._v("\n                    "+e._s(e.lang.poolStorageGroup.manageMember)+"\n                ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.checkMember(t.row.members)}}},[e._v("\n                    "+e._s(e.lang.poolStorageGroup.checkMember)+"\n                ")])]}}])})],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.groupFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.groupFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchGroupPage}},[e._t("default",[a("span",{staticClass:"pagination-slot"},[e._v("\n                    "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.groupPage,total:this.groupFilter.length}))+"\n                ")])])],2):e._e()],1),e._v(" "),a("pana-create-group",{attrs:{show:e.showCreateGroup},on:{closeModal:e.closeCreateGroup}}),e._v(" "),a("pana-delete-group",{attrs:{show:e.showDeleteGroup},on:{closeModal:e.closeDeleteGroup}}),e._v(" "),a("pana-edit-group",{attrs:{show:e.showEditGroup,group:e.editObj},on:{closeModal:e.closeEditGroup}}),e._v(" "),a("pana-manage-member",{attrs:{show:e.showManageMember,group:e.editObj},on:{closeModal:e.closeManageGroup}}),e._v(" "),a("pana-check-member",{attrs:{show:e.showCheckMember,members:e.members},on:{closeModal:function(t){e.showCheckMember=!1}}})],1)},staticRenderFns:[]};var k=a("C7Lr")(w,S,!1,function(e){a("87CJ")},"data-v-3c4dc5d8",null);t.a=k.exports},wSwB:function(e,t){},xcf8:function(e,t){}});