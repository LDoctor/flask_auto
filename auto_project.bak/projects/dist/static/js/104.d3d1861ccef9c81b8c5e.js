webpackJsonp([104],{PKjS:function(t,e){},uNQ6:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a={components:{"pana-breadcrumb":i("1JPr").a},data:function(){return{acquisitionCycle:300,time:15e5,date:"",currentData:{},diskThroughput:{},nicBandwidth:{},disks:[],disk:"",nics:[],nic:"",enddate:{disabledDate:function(t){return t.getTime()>Date.now()-864e5}},poolsizeInfo:"",pooltotal:"",poolused:"",poolredundancy:"",fileavailable:"",objectavailable:"",totalprecent:"",fileRedundancy:"",objectRedundancy:""}},methods:{getsizeInfo:function(){var t=this,e=this.$route.params.id,i=this.common.formatMsg(this.api.storage.getsizeInfo,{pool_id:e});this.checkError(this.$http({url:i,method:"get"}),function(e){t.poolsizeInfo=e.data,t.pooltotal=t.common.formatCapacity(e.data.total_size,"B",2),t.poolused=e.data.block_used+e.data.file_used+e.data.object_used,t.poolredundancy=e.data.total_redundancy,t.fileavailable=e.data.file_size-e.data.file_used-e.data.file_redundancy,t.objectavailable=e.data.object_size-e.data.object_used-e.data.object_redundancy,t.totalprecent=t.poolused/e.data.total_size*100,t.fileRedundancy=t.poolsizeInfo.file_size-t.poolsizeInfo.file_free-t.poolsizeInfo.file_used,t.objectRedundancy=t.poolsizeInfo.object_size-t.poolsizeInfo.object_free-t.poolsizeInfo.object_used,t.initEcharts("poolchart",t.poolsizeInfo.total_used,t.poolsizeInfo.total_free,t.poolsizeInfo.total_redundancy,t.poolsizeInfo.total_size),t.initEcharts("filechart",t.poolsizeInfo.file_used,t.poolsizeInfo.file_free,t.poolsizeInfo.file_redundancy,t.poolsizeInfo.file_size),t.initEcharts("objectchart",t.poolsizeInfo.object_used,t.poolsizeInfo.object_free,t.poolsizeInfo.object_redundancy,t.poolsizeInfo.object_size),t.initEcharts("blockchart",t.poolsizeInfo.block_used,t.poolsizeInfo.block_free,t.poolsizeInfo.block_redundancy,t.poolsizeInfo.block_size)})},initEcharts:function(t,e,i,a,o){var s=this.$echarts.init(document.getElementById(t)),n=this;s.clear();var l={color:["#30c9ae","#ced7e5","#60abfc"],tooltip:{trigger:"item",confine:!0,formatter:function(t){var e=n.common.formatCapacity(t.data.value,"B",2);return t.data.name+"<br>"+e.value+e.unit}},title:{text:this.lang.storageSurvey.totalQuota+"\n"+this.common.formatCapacity(o,"B",1).value+this.common.formatCapacity(o,"B",1).unit,left:"center",top:"40%",textStyle:{color:"#3c3c3c",align:"center",fontSize:"14"}},series:[{type:"pie",radius:["50%","65%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:e,name:this.lang.storageSurvey.allocated},{value:i,name:this.lang.storageSurvey.unallocated},{value:a,name:this.lang.storageSurvey.totalredundancy}]}]};s.setOption(l,!0)},changepool:function(){this.diskThroughput={},this.nicBandwidth={},this.disks=[],this.nics=[],this.disk="",this.nic="",this.get_disks(),this.get_nics()},onSubmit:function(){this.disk?this.getDiskThroughput(this.disk):this.get_disks(),this.nic?this.getNicBandwidth(this.nic):this.get_nics()},get_disks:function(){var t=this,e=this.common.formatMsg(this.api.storage.getdiskList,{pool_id:this.$route.params.id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.disks=e.data.data,t.disks.length>0&&setTimeout(function(){t.disk=t.disks[0].name,t.getDiskThroughput(t.disk)},0)})},get_nics:function(){var t=this,e=this.common.formatMsg(this.api.storage.getNetworkcardList,{pool_id:this.$route.params.id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.nics=e.data.data,t.nics.length>0&&(setTimeout(function(){t.nic=t.nics[0].name},0),t.getNicBandwidth(t.nics[0].name))})},setChartParam:function(){var t=Date.parse(new Date),e="",i={precision:this.acquisitionCycle};return""===this.time?(t=Date.parse(this.date[1])+864e5,e=Date.parse(this.date[0])):e=t-this.time,i.end_time=t,i.start_time=e,i},getDiskThroughput:function(t){var e=this,i=e.setChartParam();i.path=t,i.start_time=i.start_time-3e5,i=this.common.formatGetUrl(i),this.checkError(this.$http({url:this.common.formatMsg(this.api.storage.getiopsList,{pool_id:this.$route.params.id})+i,method:"get"}),function(t){e.diskThroughput=t.data.data,setTimeout(function(){e.chartInit({elementId:"disk-throughput",legend:e.lang.storageSurvey.iopsLegend,yAxisLabel:"Bps",data:e.diskThroughput})},0)})},getNicBandwidth:function(t){var e=this,i=e.setChartParam();i.interface=t,i.start_time=i.start_time-3e5,i=this.common.formatGetUrl(i),this.checkError(this.$http({url:this.common.formatMsg(this.api.storage.getbandwidth,{pool_id:this.$route.params.id})+i,method:"get"}),function(t){e.nicBandwidth=t.data.data,setTimeout(function(){e.chartInit({elementId:"nic-bandwidth",legend:e.lang.componentMonitor.nicBandwidthLegend,yAxisLabel:"bps",data:e.nicBandwidth})},0)})},diskChange:function(){this.getDiskThroughput(this.disk)},nicChange:function(){this.getNicBandwidth(this.nic)},chartInit:function(t){var e=this,i=this.$echarts.init(document.getElementById(t.elementId)),a=t.data,o=[],s="",n=[],l={},r=[];for(var c in i.clear(),a.values.forEach(function(t){s=15e5===e.time?e.moment(t[0]).format("HH:mm"):e.moment(t[0]).format("MM-DD HH:mm"),o.push(s),a.columns.forEach(function(e,i){i>0&&(l.hasOwnProperty(e)||(l[e]=[]),l[e].push(t[i].toFixed(2)))})}),l)r.push({name:t.legend[c],type:"line",data:l[c]}),n.push(t.legend[c]);var d={title:{text:t.title,textStyle:{fontSize:14,fontWeight:"normal"},left:"10%"},tooltip:{trigger:"axis"},color:["#1990ff","#2fc25c","#b460fe"],legend:{data:n,bottom:0,left:"center",icon:"rect",textStyle:{fontSize:12},itemHeight:6},grid:{left:"12%",top:"5%"},xAxis:{type:"category",boundaryGap:!1,data:o},yAxis:{type:"value",axisLabel:{formatter:"{value} "+t.yAxisLabel}},series:r};i.setOption(d)},refresh:function(){this.getsizeInfo(),this.onSubmit()},init:function(){var t=this;["disk-throughput","nic-bandwidth","poolchart","filechart","objectchart","blockchart"].forEach(function(e){t.$echarts.init(t.$refs[e]).resize()})}},mounted:function(){var t=this;this.getsizeInfo(),this.onSubmit(),this.interval=setInterval(function(){t.refresh()},6e4),window.addEventListener("resize",this.init,20)},destroyed:function(){window.removeEventListener("resize",this.init,20),clearInterval(this.interval)}},o={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-container",{staticClass:"storagediv",attrs:{type:"flex",direction:"vertical"}},[i("pana-breadcrumb"),t._v(" "),i("el-main",{staticClass:"el-main"},[i("el-row",{staticClass:"spacedetail",attrs:{gutter:20}},[i("el-col",{attrs:{span:6}},[i("div",{staticClass:"distribution-details"},[i("div",{staticClass:"echartstitle"},[i("span",[t._v(t._s(t.lang.storageSurvey.pooltotal))])]),t._v(" "),i("div",{staticClass:"left"},[i("div",{ref:"poolchart",attrs:{id:"poolchart"}})]),t._v(" "),i("div",{staticClass:"right pie-legend"},[i("ul",[i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.allocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.total_used,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.total_used,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.unallocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.total_free,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.total_free,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.totalredundancy)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.total_redundancy,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.total_redundancy,"B",2).unit))])])])])])])]),t._v(" "),i("el-col",{attrs:{span:6}},[i("div",{staticClass:"distribution-details"},[i("div",{staticClass:"echartstitle"},[i("span",[t._v(t._s(t.lang.storageSurvey.fileStorage))])]),t._v(" "),i("div",{staticClass:"left"},[i("div",{ref:"filechart",attrs:{id:"filechart"}})]),t._v(" "),i("div",{staticClass:"right pie-legend"},[i("ul",[i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.allocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.file_used,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.file_used,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.unallocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.file_free,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.file_free,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.totalredundancy)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.file_redundancy,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.file_redundancy,"B",2).unit))])])])])])])]),t._v(" "),i("el-col",{attrs:{span:6}},[i("div",{staticClass:"distribution-details"},[i("div",{staticClass:"echartstitle"},[i("span",[t._v(t._s(t.lang.storageSurvey.objectStorage))])]),t._v(" "),i("div",{staticClass:"left"},[i("div",{ref:"objectchart",attrs:{id:"objectchart"}})]),t._v(" "),i("div",{staticClass:"right pie-legend"},[i("ul",[i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.allocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.object_used,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.object_used,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.unallocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.object_free,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.object_free,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.totalredundancy)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.object_redundancy,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.object_redundancy,"B",2).unit))])])])])])])]),t._v(" "),i("el-col",{attrs:{span:6}},[i("div",{staticClass:"distribution-details"},[i("div",{staticClass:"echartstitle"},[i("span",[t._v(t._s(t.lang.storageSurvey.blockStorage))])]),t._v(" "),i("div",{staticClass:"left"},[i("div",{ref:"blockchart",attrs:{id:"blockchart"}})]),t._v(" "),i("div",{staticClass:"right pie-legend"},[i("ul",[i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.allocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.block_used,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.block_used,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.unallocated)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.block_free,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.block_free,"B",2).unit))])])]),t._v(" "),i("li",{staticClass:"li-horizontal"},[i("div",[i("i"),t._v(t._s(t.lang.storageSurvey.totalredundancy)),i("span",[t._v(t._s(this.common.formatCapacity(t.poolsizeInfo.block_redundancy,"B",2).value)+t._s(this.common.formatCapacity(t.poolsizeInfo.block_redundancy,"B",2).unit))])])])])])])])],1),t._v(" "),i("el-row",{staticStyle:{"margin-top":"20px","border-bottom":"1px solid #e0e0e0",background:"#fff",padding:"10px"}},[i("el-col",{staticStyle:{"min-width":"268px"},attrs:{span:4}},[i("span",[t._v("采集周期:")]),t._v(" "),i("el-select",{attrs:{filterable:""},model:{value:t.acquisitionCycle,callback:function(e){t.acquisitionCycle=e},expression:"acquisitionCycle"}},t._l(t.lang.componentMonitor.acquisitionCycleOptions,function(t){return i("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})}),1)],1),t._v(" "),i("el-col",{staticClass:"timeselect",staticStyle:{"min-width":"812px"},attrs:{span:13}},[i("el-radio-group",{staticStyle:{"margin-top":"-4px"},on:{change:function(e){t.date=""}},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}},t._l(t.lang.componentMonitor.timeOptions,function(e){return i("el-radio-button",{key:e.value,attrs:{label:e.value}},[t._v("\n\t\t\t\t\t\t"+t._s(e.text)+"\n\t\t\t\t\t")])}),1),t._v(" "),i("el-date-picker",{class:{active:!t.time&&t.date},attrs:{type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.enddate},on:{input:function(e){t.time=""}},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}}),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("查询")])],1)],1),t._v(" "),i("el-row",{staticClass:"chart-row",staticStyle:{"padding-bottom":"10px"},attrs:{gutter:20}},[i("el-col",{attrs:{span:12}},[i("div",{staticClass:"chart-div"},[i("div",{staticClass:"niclist"},[i("span",{staticClass:"el-form-item__label row-title",staticStyle:{"padding-left":"20px"}},[t._v("磁盘")]),t._v(" "),i("el-select",{attrs:{filterable:""},on:{change:t.diskChange},model:{value:t.disk,callback:function(e){t.disk=e},expression:"disk"}},t._l(t.disks,function(t){return i("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}),1)],1),t._v(" "),i("div",{staticClass:"disktitle"},[t._v("IOPS")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.diskThroughput.hasOwnProperty("values")&&0!==t.diskThroughput.values.length,expression:"diskThroughput.hasOwnProperty('values') && diskThroughput.values.length!==0"}],ref:"disk-throughput",staticClass:"chart",attrs:{id:"disk-throughput"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"{}"==JSON.stringify(t.diskThroughput),expression:"JSON.stringify(diskThroughput)=='{}'"}],staticClass:"no-data"},[t._v("\n\t\t\t\t\t\t"+t._s(t.lang.componentMonitor.noData)+"\n\t\t\t\t\t")])])]),t._v(" "),i("el-col",{attrs:{span:12}},[i("div",{staticClass:"chart-div"},[i("div",{staticClass:"bandwidths"},[i("span",{staticClass:"el-form-item__label row-title"},[t._v(t._s(t.lang.componentMonitor.nic))]),t._v(" "),i("el-select",{attrs:{filterable:""},on:{change:t.nicChange},model:{value:t.nic,callback:function(e){t.nic=e},expression:"nic"}},t._l(t.nics,function(t){return i("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}),1)],1),t._v(" "),i("div",{staticClass:"bandwidth"},[t._v("带宽")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.nicBandwidth.hasOwnProperty("values")&&0!==t.nicBandwidth.values.length,expression:"nicBandwidth.hasOwnProperty('values') && nicBandwidth.values.length!==0"}],ref:"nic-bandwidth",staticClass:"chart",attrs:{id:"nic-bandwidth"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"{}"==JSON.stringify(t.nicBandwidth),expression:"JSON.stringify(nicBandwidth)=='{}'"}],staticClass:"no-data"},[t._v("\n\t\t\t\t\t\t"+t._s(t.lang.componentMonitor.noData)+"\n\t\t\t\t\t")])])])],1)],1)],1)},staticRenderFns:[]};var s=i("C7Lr")(a,o,!1,function(t){i("PKjS")},"data-v-2c0e8c5e",null);e.default=s.exports}});