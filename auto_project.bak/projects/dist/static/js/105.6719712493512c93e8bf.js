webpackJsonp([105],{pOr5:function(t,a){},tYMI:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s={name:"ccsurvey",components:{"pana-breadcrumb":e("1JPr").a},data:function(){return{tableData:[],poolactive:"",poolerror:"",pooltotal:"",chartData:[],xdata:[],poolname:[],quotaDetail:"",acquisitionCycle:60,time:15e5,date:"",enddate:{disabledDate:function(t){return t.getTime()>Date.now()-864e5}},netWorkData:"",cpuData:"",memData:"",storageData:"",cpuNullData:!0,memNullData:!0,storageNullData:!0,networkNullData:!0}},methods:{getPoolQuota:function(){var t=this;this.checkError(this.$http({url:this.api.cloud.get_pool_quota,method:"get"}),function(a){t.quotaDetail=a.data,t.onSubmit()})},getpoolStatus:function(){var t=this;this.checkError(this.$http({url:this.api.survey.getpool_status,method:"get"}),function(a){t.poolactive=a.data.pool_active,t.poolerror=a.data.pool_error,t.pooltotal=a.data.pool_total,t.echartsInit(t.poolactive,t.poolerror,t.pooltotal)})},setChartParam:function(){var t=Date.parse(new Date),a="",e={precision:this.acquisitionCycle};return""===this.time?(t=Date.parse(this.date[1])+864e5,a=Date.parse(this.date[0])):a=t-this.time,e.end_time=t,e.start_time=a,e.chart="",e},getNetworkRate:function(){var t=this,a=t.setChartParam();a.start_time=this.moment(this.moment(a.start_time-3e5).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.end_time=this.moment(this.moment(a.end_time).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.chart="net",a=this.common.formatGetUrl(a),this.checkError(this.$http({url:this.api.cloud.get_network_rate+a,method:"get"}),function(a){t.netWorkData=a.data.data,0===t.netWorkData.time.length?t.networkNullData=!1:(t.networkNullData=!0,setTimeout(function(){t.lineChart({elementId:"network-rate",legend:t.lang.survey.networkLegend,yAxisLabel:"KB/s",data:t.netWorkData})},0))})},getCpuRate:function(){var t=this,a=t.setChartParam();a.start_time=this.moment(this.moment(a.start_time-3e5).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.end_time=this.moment(this.moment(a.end_time).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.chart="cpu",a=this.common.formatGetUrl(a),this.checkError(this.$http({url:this.api.cloud.get_network_rate+a,method:"get"}),function(a){t.cpuData=a.data.data,0===t.cpuData.vm_cpu.length?t.cpuNullData=!1:(t.cpuNullData=!0,setTimeout(function(){t.siglelinechart({elementId:"cpu-rate",yAxisLabel:"核",data:t.cpuData})},0))})},getMemRate:function(){var t=this,a=t.setChartParam();a.start_time=this.moment(this.moment(a.start_time-3e5).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.end_time=this.moment(this.moment(a.end_time).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.chart="mem",a=this.common.formatGetUrl(a),this.checkError(this.$http({url:this.api.cloud.get_network_rate+a,method:"get"}),function(a){t.memData=a.data.data,0===t.memData.vm_mem.length?t.memNullData=!1:(t.memNullData=!0,setTimeout(function(){t.siglelinechart({elementId:"mem-rate",yAxisLabel:"GB",data:t.memData})},0))})},getStorageRate:function(){var t=this,a=t.setChartParam();a.start_time=this.moment(this.moment(a.start_time-3e5).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.end_time=this.moment(this.moment(a.end_time).format("YYYY-MM-DD HH:mm:ss")).utc().format(),a.chart="disk",a=this.common.formatGetUrl(a),this.checkError(this.$http({url:this.api.cloud.get_network_rate+a,method:"get"}),function(a){t.storageData=a.data.data,0===t.storageData.vm_disk.length?t.storageNullData=!1:(t.storageNullData=!0,setTimeout(function(){t.siglelinechart({elementId:"storage-rate",yAxisLabel:"GB",data:t.storageData})},0))})},echartsInit:function(t,a,e){var s=this.$echarts.init(document.getElementById("piechart")),i={color:["#30C9AD","#EABE27"],graphic:{type:"text",top:"center",left:"center",textAlign:"center",style:{text:"    "+e+"\n"+this.lang.survey.pooltotal,fill:"#A2ACBA",fontSize:16}},series:[{name:this.lang.survey.businessPool,type:"pie",radius:["45%","60%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:t,name:"正常: "+t},{value:a,name:"异常: "+a}]}]};s.setOption(i,!0)},lineChart:function(t){var a=this.$echarts.init(document.getElementById(t.elementId)),e="",s=[],i=[],o=[],r=[],l=this;t.data.time.forEach(function(t,a){e=15e5===l.time?l.moment(t).tz("Asia/Shanghai").format("HH:mm"):l.moment(t).tz("Asia/Shanghai").format("MM-DD HH:mm"),s.push(e)}),t.data.network.forEach(function(t,a){i.push(null===t[0]?"暂无数据":t[0]),o.push(null===t[1]?"暂无数据":t[1])}),r.push({name:"流入",type:"line",data:i,smooth:!0,symbol:"none",areaStyle:{normal:{color:new this.$echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#60ABFC"},{offset:1,color:"#fff"}],!1),shadowColor:"rgba(0, 0, 0, 0.1)",shadowBlur:10}}},{name:"流出",type:"line",data:o,smooth:!0,symbol:"none",areaStyle:{normal:{color:new this.$echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#3EC1A6"},{offset:1,color:"#fff"}],!1),shadowColor:"rgba(0, 0, 0, 0.1)",shadowBlur:10}}});var n={tooltip:{trigger:"axis",formatter:function(t){for(var a=[],e="",s="",i="",o=0;o<t.length;o++)e=t[o].value,s=t[o].color,i=t[o].seriesName,"暂无数据"===e?e="暂无数据":0===e?e="0B/s":e<1024?e+=" B/s":e>1024&&e<1048576?e=Math.round(e/1024)+"KB/s":e>1048576&&e<1073741824?e=Math.round(e/1048576)+"MB/s":e>1073741824&&e<1099511627776?e=Math.round(e/1073741824)+"GB/s":e>1099511627776&&e<0x4000000000000&&(e=Math.round(e/1099511627776)+"TB/s"),a.push('<span style="background:'+s+';width:10px;height:10px;border-radius:5px;display:inline-block;line-height:10px;margin-right:5px"></span>'+i+" : "+e+"</br>");return a.join("")}},color:["#60ABFC","#3EC1A6"],grid:{left:"8%",top:"10%"},legend:{data:["流入","流出"],icon:"circle",right:"10%",itemWidth:10,itemHeight:10,textStyle:{fontSize:12}},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value",axisLabel:{formatter:function(t){if(0==t)return t="0B/s";if(t<1024)t+=" B/s";else{if(t>1024&&t<1048576)return t=Math.round(t/1024)+"KB/s";if(t>1048576&&t<1073741824)return t=Math.round(t/1048576)+"MB/s";if(t>1073741824&&t<1099511627776)return t=Math.round(t/1073741824)+"GB/s";if(t>1099511627776&&t<0x4000000000000)return t=Math.round(t/1099511627776)+"TB/s"}}}},series:r};a.setOption(n)},siglelinechart:function(t){var a=this.$echarts.init(document.getElementById(t.elementId)),e="",s=[],i=[],o="",r=this,l="";"cpu-rate"===t.elementId?(e="#3EC1A6",t.data.vm_cpu.forEach(function(t){i.push({value:null===t[1]?"暂无数据":t[1],userate:null===t[2]?"暂无数据":t[2].toFixed(1),total:null===t[0]?"暂无数据":t[0]})}),l=Math.ceil(r.quotaDetail.cpu_total)):"mem-rate"===t.elementId?(e="#60ABFC",t.data.vm_mem.forEach(function(t){i.push({value:null===t[1]?"暂无数据":t[1],userate:null===t[2]?"暂无数据":t[2].toFixed(1),total:null===t[0]?"暂无数据":t[0]})}),l=Math.ceil(r.quotaDetail.mem_total)):"storage-rate"===t.elementId&&(e="#8C6AEE",t.data.vm_disk.forEach(function(t){i.push({value:null===t[1]?"暂无数据":t[1],userate:null===t[2]?"暂无数据":t[2].toFixed(1),total:null===t[0]?"暂无数据":t[0]})}),l=Math.ceil(r.quotaDetail.storage_total)),t.data.time.forEach(function(t){o=15e5===r.time?r.moment(t).tz("Asia/Shanghai").format("HH:mm"):r.moment(t).tz("Asia/Shanghai").format("MM-DD HH:mm"),s.push(o)});var n={tooltip:{trigger:"axis",formatter:function(a){if("mem-rate"===t.elementId){var e=[];return"暂无数据"===a[0].data.total?e.push("<span></span>总数 : 暂无数据</br>"):e.push("<span></span>总数 : "+r.common.formatCapacity(a[0].data.total,"GB").value+r.common.formatCapacity(a[0].data.total,"GB").unit+"</br>"),"暂无数据"===a[0].data.value?e.push("<span></span>已使用 : 暂无数据</br>"):e.push("<span></span>已使用 : "+r.common.formatCapacity(a[0].data.value,"GB").value+r.common.formatCapacity(a[0].data.value,"GB").unit+"</br>"),"暂无数据"===a[0].data.userate?e.push("<span></span> 使用率: 暂无数据</br>"):e.push("<span></span> 使用率: "+a[0].data.userate+"%</br>"),e.join("")}if("storage-rate"===t.elementId){e=[];return"暂无数据"===a[0].data.total?e.push("<span></span>总数 : 暂无数据</br>"):e.push("<span></span>总数 : "+r.common.formatCapacity(a[0].data.total,"GB").value+r.common.formatCapacity(a[0].data.total,"GB").unit+"</br>"),"暂无数据"===a[0].data.value?e.push("<span></span>已使用 : 暂无数据</br>"):e.push("<span></span>已使用 : "+r.common.formatCapacity(a[0].data.value,"GB").value+r.common.formatCapacity(a[0].data.value,"GB").unit+"</br>"),"暂无数据"===a[0].data.userate?e.push("<span></span> 使用率: 暂无数据</br>"):e.push("<span></span> 使用率: "+a[0].data.userate+"%</br>"),e.join("")}if("cpu-rate"===t.elementId){e=[];return"暂无数据"===a[0].data.total?e.push("<span></span> 总核数: 暂无数据</br>"):e.push("<span></span> 总核数: "+a[0].data.total+"核</br>"),"暂无数据"===a[0].data.value?e.push("<span></span> 已使用: 暂无数据</br>"):e.push("<span></span> 已使用: "+a[0].data.value+"核</br>"),"暂无数据"===a[0].data.userate?e.push("<span></span> 使用率: 暂无数据"):e.push("<span></span> 使用率: "+a[0].data.userate+"%"),e.join("")}}},grid:{left:"6%",top:"10%"},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value",max:l},series:[{data:i,type:"line",smooth:!0,symbol:"none",itemStyle:{normal:{lineStyle:{color:e}}},areaStyle:{normal:{color:new this.$echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:e},{offset:1,color:"#fff"}],!1),shadowColor:"rgba(0, 0, 0, 0.1)",shadowBlur:10}}}]};a.setOption(n)},onSubmit:function(){this.cpuNullData=!0,this.memNullData=!0,this.storageNullData=!0,this.networkNullData=!0,this.getNetworkRate(),this.getCpuRate(),this.getMemRate(),this.getStorageRate()},refresh:function(){60==this.acquisitionCycle&&this.onSubmit()},init:function(){var t=this;["cpu-rate","mem-rate","storage-rate","network-rate","myEchart"].forEach(function(a){t.$echarts.init(t.$refs[a]).resize()})}},mounted:function(){var t=this;this.common.is_system_admin()?(this.getPoolQuota(),this.getpoolStatus(),this.interval=setInterval(function(){t.refresh()},2e4),window.addEventListener("resize",this.init,20)):this.$router.push({name:"resourceList"})},destroyed:function(){window.removeEventListener("resize",this.init,20),clearInterval(this.interval)}},i={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("el-container",{staticClass:"storagediv",attrs:{type:"flex",direction:"vertical"}},[e("pana-breadcrumb"),t._v(" "),e("el-main",{staticClass:"el-main"},[e("el-row",{staticClass:"toplist",attrs:{gutter:20}},[e("el-col",{staticClass:"echartlist",attrs:{span:6}},[e("div",{staticClass:"topbox"},[e("el-col",{attrs:{span:16}},[e("div",{staticClass:"chart-tilte"},[t._v(t._s(t.lang.resource.resourcePool))]),t._v(" "),e("div",{ref:"myEchart",attrs:{id:"piechart"}})]),t._v(" "),e("el-col",{staticClass:"echartlist",attrs:{span:8}},[e("div",{staticClass:"pie-legend"},[e("ul",[e("li",{staticClass:"li-horizontal"},[e("div",[e("i"),t._v(t._s(t.lang.survey.poolactive)+"："),e("span",[t._v(t._s(t.poolactive))])])]),t._v(" "),e("li",{staticClass:"li-horizontal"},[e("div",[e("i"),t._v(t._s(t.lang.survey.poolabnormal)+"："),e("span",[t._v(t._s(t.poolerror))])])])])])])],1)]),t._v(" "),e("el-col",{staticClass:"echartlist",attrs:{span:6}},[e("div",{staticClass:"topbox"},[e("div",{staticClass:"cpuinfo"},[e("div",{staticClass:"cpubox"},[e("div",{staticClass:"cpuleft"},[e("img",{attrs:{src:"/static/image/icon1.png"}})]),t._v(" "),e("div",{staticClass:"cupright"},[e("p",{staticClass:"moudle-name"},[t._v("CPU")]),t._v(" "),e("p",{staticClass:"totalcpu-num"},[t._v(t._s(t.quotaDetail.cpu_total)+t._s(t.lang.survey.nucleus))])])]),t._v(" "),e("el-progress",{attrs:{"show-text":!1,"stroke-width":18,percentage:t.quotaDetail.cpu_used/t.quotaDetail.cpu_total*100}}),t._v(" "),e("p",{staticClass:"cpuuseinfo"},[e("i",{staticClass:"fa fa-pie-chart",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.lang.survey.used)+": "),e("span",[t._v(t._s(t.quotaDetail.cpu_used)+"核")])])],1)])]),t._v(" "),e("el-col",{staticClass:"echartlist",attrs:{span:6}},[e("div",{staticClass:"topbox"},[e("div",{staticClass:"cpuinfo"},[e("div",{staticClass:"cpubox"},[e("div",{staticClass:"cpuleft"},[e("img",{attrs:{src:"/static/image/icon2.png"}})]),t._v(" "),e("div",{staticClass:"cupright"},[e("p",{staticClass:"moudle-name"},[t._v(t._s(t.lang.survey.memory))]),t._v(" "),e("p",{staticClass:"totalcpu-num"},[t._v(t._s(t.common.formatCapacity(t.quotaDetail.mem_total,"GB").value)+" "+t._s(t.common.formatCapacity(t.quotaDetail.mem_total,"GB").unit))])])]),t._v(" "),e("el-progress",{attrs:{"show-text":!1,"stroke-width":18,color:"#30c9ad",percentage:t.quotaDetail.mem_used/t.quotaDetail.mem_total*100}}),t._v(" "),e("p",{staticClass:"cpuuseinfo"},[e("i",{staticClass:"fa fa-pie-chart",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.lang.survey.used)+": "),e("span",[t._v(t._s(t.common.formatCapacity(t.quotaDetail.mem_used,"GB").value)+" "+t._s(t.common.formatCapacity(t.quotaDetail.mem_used,"GB").unit))])])],1)])]),t._v(" "),e("el-col",{staticClass:"echartlist",attrs:{span:6}},[e("div",{staticClass:"topbox"},[e("div",{staticClass:"cpuinfo"},[e("div",{staticClass:"cpubox"},[e("div",{staticClass:"cpuleft"},[e("img",{attrs:{src:"/static/image/icon3.png"}})]),t._v(" "),e("div",{staticClass:"cupright"},[e("p",{staticClass:"moudle-name"},[t._v(t._s(t.lang.survey.storage))]),t._v(" "),e("p",{staticClass:"totalcpu-num"},[t._v(t._s(t.common.formatCapacity(t.quotaDetail.storage_total,"GB").value)+" "+t._s(t.common.formatCapacity(t.quotaDetail.storage_total,"GB").unit))])])]),t._v(" "),e("el-progress",{attrs:{"show-text":!1,"stroke-width":18,color:"#35c5ea",percentage:t.quotaDetail.storage_used/t.quotaDetail.storage_total*100}}),t._v(" "),e("p",{staticClass:"cpuuseinfo"},[e("i",{staticClass:"fa fa-pie-chart",attrs:{"aria-hidden":"true"}}),t._v(t._s(t.lang.survey.used)+": "),e("span",[t._v(t._s(t.common.formatCapacity(t.quotaDetail.storage_used,"GB").value)+" "+t._s(t.common.formatCapacity(t.quotaDetail.storage_used,"GB").unit))])])],1)])])],1),t._v(" "),e("el-row",{staticClass:"acquisition-cycle"},[e("el-col",{staticStyle:{"min-width":"268px"},attrs:{span:4}},[e("span",[t._v(t._s(t.lang.survey.acquisitionCycle)+":")]),t._v(" "),e("el-select",{attrs:{filterable:""},model:{value:t.acquisitionCycle,callback:function(a){t.acquisitionCycle=a},expression:"acquisitionCycle"}},t._l(t.lang.survey.acquisitionCycleOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})}),1)],1),t._v(" "),e("el-col",{staticClass:"timeselect",staticStyle:{"min-width":"812px"},attrs:{span:13}},[e("el-radio-group",{staticStyle:{"margin-top":"-4px"},on:{change:function(a){t.date=""}},model:{value:t.time,callback:function(a){t.time=a},expression:"time"}},t._l(t.lang.componentMonitor.timeOptions,function(a){return e("el-radio-button",{key:a.value,attrs:{label:a.value}},[t._v("\n\t\t\t\t\t\t"+t._s(a.text)+"\n\t\t\t\t\t")])}),1),t._v(" "),e("el-date-picker",{class:{active:!t.time&&t.date},attrs:{type:"daterange","range-separator":"-","start-placeholder":t.lang.survey.startDate,"end-placeholder":t.lang.survey.endDate,"picker-options":t.enddate},on:{input:function(a){t.time=""}},model:{value:t.date,callback:function(a){t.date=a},expression:"date"}}),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.lang.survey.search))])],1)],1),t._v(" "),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"top5-div"},[e("div",{staticClass:"linechart-title"},[t._v(t._s(t.lang.survey.cpu))]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.cpuNullData,expression:"cpuNullData===true"}],ref:"cpu-rate",attrs:{id:"cpu-rate"}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!1===t.cpuNullData,expression:"cpuNullData===false"}],staticClass:"nodata"},[t._v(t._s(t.lang.survey.noData))])])]),t._v(" "),e("el-col",{attrs:{span:12}},[e("div",{staticClass:"top5-div"},[e("div",{staticClass:"linechart-title"},[t._v(t._s(t.lang.survey.mem))]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.memNullData,expression:"memNullData===true"}],ref:"mem-rate",attrs:{id:"mem-rate"}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!1===t.memNullData,expression:"memNullData===false"}],staticClass:"nodata"},[t._v(t._s(t.lang.survey.noData))])])])],1),t._v(" "),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"top5-div"},[e("div",{staticClass:"nvme-tile"},[e("div",{staticClass:"linechart-title"},[t._v(t._s(t.lang.survey.storage))])]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.storageNullData,expression:"storageNullData===true"}],ref:"storage-rate",attrs:{id:"storage-rate"}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!1===t.storageNullData,expression:"storageNullData===false"}],staticClass:"nodata"},[t._v(t._s(t.lang.survey.noData))])])]),t._v(" "),e("el-col",{attrs:{span:12}},[e("div",{staticClass:"top5-div"},[e("div",{staticClass:"linechart-title"},[t._v(t._s(t.lang.survey.network))]),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!0===t.networkNullData,expression:"networkNullData===true"}],ref:"network-rate",attrs:{id:"network-rate"}}),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!1===t.networkNullData,expression:"networkNullData===false"}],staticClass:"nodata"},[t._v(t._s(t.lang.survey.noData))])])])],1)],1)],1)},staticRenderFns:[]};var o=e("C7Lr")(s,i,!1,function(t){e("pOr5")},"data-v-1dded1a4",null);a.default=o.exports}});