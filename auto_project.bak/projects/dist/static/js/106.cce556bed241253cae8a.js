webpackJsonp([106],{"/PP3":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("aA9S"),r=a.n(o),n={name:"cloudDisk",components:{"pana-breadcrumb":a("1JPr").a},data:function(){return{sortParam:"",downloadClick:!1,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},form:{operator_name:"",audit_type:"",description:"",state:"",create_time:""},pageSize:10,operateSearch:"",operateOrigin:[],operateSelectionIds:[],operatePage:1,auditTypes:{1:this.lang.auditLog.auditTypeUser,2:this.lang.auditLog.auditTypeDepartment,5:this.lang.auditLog.auditTypeLogin,61:this.lang.auditLog.auditTypeFirewall,62:this.lang.auditLog.auditTypeAffinityGroup,63:this.lang.auditLog.auditTypePool,64:this.lang.auditLog.auditTypeFlavors,65:this.lang.auditLog.auditTypeVirNet,66:this.lang.auditLog.auditTypeCloudCom,67:this.lang.auditLog.auditTypeRouter,68:this.lang.auditLog.auditTypeSecGroup,69:this.lang.auditLog.auditTypeImageManage,70:this.lang.auditLog.auditTypeQos,71:this.lang.auditLog.auditTypeImageMake,72:this.lang.auditLog.auditTypeNetwork,73:this.lang.auditLog.auditTypeCloudDisk,90:this.lang.auditLog.auditTypeCeph,91:this.lang.auditLog.auditTypeTime,100:this.lang.auditLog.auditTypeTrash,101:this.lang.auditLog.auditTypeKeyPairs,103:this.lang.auditLog.auditTypeAlarm,104:this.lang.auditLog.auditTypePoolSurvey,105:this.lang.auditLog.auditTypeMonitor,106:this.lang.auditLog.auditTypeLoadBalance,107:this.lang.auditLog.auditTypeBigData,108:this.lang.auditLog.auditTypeMaintenance,109:this.lang.auditLog.auditTypeSnapshot,110:this.lang.auditLog.auditTypeDataCenter,111:this.lang.auditLog.auditTypeStorageManage,112:this.lang.auditLog.auditTypeSoftwareAuth,113:this.lang.auditLog.auditTypeSurvey,114:this.lang.auditLog.auditTypeSystemConfig,115:this.lang.auditLog.auditTypePlanTask,116:this.lang.auditLog.auditTypeSpider},loading:!1,advanceSearchExpand:!1,total:0}},methods:{advanceSearch:function(){this.operatePage=1,this.getOperateLogs()},downloadLog:function(){var t=this;t.downloadClick=!0,this.$http({url:this.api.management.download_logs,method:"get"}).then(function(e){if(t.downloadClick=!1,null!=e.data.code&&0!==e.data.code)t.$notify({title:t.lang.common.error,type:"error",message:e.data.message});else{var a=new Blob(["\ufeff"+e.data],{type:"text/csv;charset=utf-8"}),o=document.createElement("a"),r=window.URL.createObjectURL(a),n=e.headers["content-disposition"],i=/filename="?([^"^;]+)"?/.exec(decodeURIComponent(n));t.common.isArray(i)?o.download=i[1]:o.download="file",o.href=r,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(r)}})},switchOperatePage:function(t){this.operatePage=t,this.getOperateLogs()},sortChange:function(t){t.order?"ascending"===t.order?this.sortParam=t.prop:this.sortParam="-"+t.prop:this.sortParam="",this.getOperateLogs()},getOperateLogs:function(){var t,e=this,a={type:0,search:this.operateSearch,page:this.operatePage};if(e.sortParam&&(a.sort=e.sortParam),e.advanceSearchExpand){r()(a,e.form),null!==e.form.state?a.state=e.form.state.replace(/( |^)[a-z]/g,function(t){return t.toUpperCase()}):e.form.state;var o=e.form.create_time;o&&o.length>1&&(o[0]===o[1]&&(o[1]=o[1]+864e5),a.create_time=Math.round(o[0]/1e3)+"_"+Math.round(o[1]/1e3))}t=this.common.formatGetUrl(a),this.loading=!0,this.checkError(this.$http({url:this.api.management.get_logs+t,method:"get"}),function(t){e.loading=!1,e.operateOrigin=t.data,e.total=t.total},function(){e.loading=!1})},selectOperateIds:function(t){var e=[];t.forEach(function(t){e.push(t.id)}),this.operateSelectionIds=e},formatRole:function(t){return this.auditTypes[t.audit_type]},search:function(){this.operatePage=1,this.getOperateLogs()},advanceSearchExpandChange:function(){this.advanceSearchExpand=!this.advanceSearchExpand,this.resetForm("form")},resetForm:function(t){this.$refs[t]&&this.$refs[t].resetFields()}},mounted:function(){this.getOperateLogs()}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:t.getOperateLogs}}),t._v(" "),a("el-main",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"primary",disabled:t.downloadClick},on:{click:t.downloadLog}},[t._v("\n                    "+t._s(t.lang.auditLog.export)+"\n                ")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},on:{change:t.search},model:{value:t.operateSearch,callback:function(e){t.operateSearch=e},expression:"operateSearch"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getOperateLogs}})],1),t._v(" "),a("el-col",{class:{"cloud-expand-icon":t.advanceSearchExpand},attrs:{span:6}},[a("el-button",{attrs:{type:"text"},on:{click:t.advanceSearchExpandChange}},[t._v("\n                            "+t._s(t.lang.auditLog.advanceSearch)+"\n                            "),a("i",{staticClass:"el-icon-arrow-right",attrs:{"aria-hidden":"true"}})])],1)],1)],1)],1),t._v(" "),t.advanceSearchExpand?a("el-form",{ref:"form",staticClass:"advance-search-form",attrs:{model:t.form,"label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.operateLog.operator,prop:"operator_name"}},[a("el-input",{attrs:{placeholder:t.lang.auditLog.input+t.lang.auditLog.operator},model:{value:t.form.operator_name,callback:function(e){t.$set(t.form,"operator_name",e)},expression:"form.operator_name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.operateLog.operationType,prop:"audit_type"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:t.form.audit_type,callback:function(e){t.$set(t.form,"audit_type",e)},expression:"form.audit_type"}},t._l(t.auditTypes,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})}),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.common.description,prop:"description"}},[a("el-input",{attrs:{placeholder:t.lang.auditLog.placeholder},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.common.status,prop:"state"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:t.form.state,callback:function(e){t.$set(t.form,"state",e)},expression:"form.state"}},t._l(t.lang.operateLog.statusObj,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})}),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.operateLog.actionTime,prop:"create_time"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":t.pickerOptions},model:{value:t.form.create_time,callback:function(e){t.$set(t.form,"create_time",e)},expression:"form.create_time"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary"},on:{click:t.advanceSearch}},[t._v(t._s(t.lang.auditLog.inquire))]),t._v(" "),a("el-button",{on:{click:function(e){return t.resetForm("form")}}},[t._v("\n                            "+t._s(t.lang.auditLog.reset)+"\n                        ")])],1)],1)],1)],1):t._e(),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:t.operateOrigin,"tooltip-effect":"dark"},on:{"selection-change":t.selectOperateIds,"sort-change":t.sortChange}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"operator_name",label:t.lang.operateLog.operator}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"audit_type",label:t.lang.operateLog.operationType,formatter:t.formatRole,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"ip",label:t.lang.operateLog.ip,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"description",label:t.lang.common.description,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"state",label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"status",class:{"cloud-success":e.row.state,"cloud-error":!e.row.state}},[t._v("\n                        "+t._s(t.lang.operateLog.statusObj[e.row.state])+"\n                    ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"create_time",label:t.lang.operateLog.actionTime},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("utc2beijing")(e.row.create_time))+"\n                ")]}}])})],1),t._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.total>t.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.total,"current-page":t.operatePage},on:{"current-change":t.switchOperatePage}},[t._t("default",[a("span",{staticClass:"pagination-slot"},[t._v("\n                        "+t._s(t.common.formatMsg(t.lang.common.paginationMsg,{current:this.operatePage,total:this.total}))+"\n                    ")])])],2):t._e()],1)],1)],1)},staticRenderFns:[]};var l=a("C7Lr")(n,i,!1,function(t){a("ptAM")},"data-v-1d43fb52",null);e.default=l.exports},ptAM:function(t,e){}});