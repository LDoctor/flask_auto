webpackJsonp([13],{DvQL:function(e,t){},LPo7:function(e,t){},TTCX:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("1JPr"),o=a("aA9S"),n=a.n(o),l={props:{show:Boolean,storServerId:String},components:{},data:function(){return{loading:!0,pools:[],components:[],noSelectVolume:!1,diskIds:{},systemOptions:[],dataDiskOptions:[],form:{jobType:"0",serverId:"",systemDisk:[],dataDisk:[],holdNumber:1,frequency:"",unit:"",startTime:""},pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}],disabledDate:function(e){return e.getTime()<Date.now()-864e5}},confirmDisabled:!1,rules:{serverId:[{required:!0,message:this.lang.common.required_item,trigger:"blur"}],startTime:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validateCurrentTime,message:this.lang.planTask.timeInvalid,trigger:"blur"}]}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getComponentList()},getComponentList:function(){var e=this,t=JSON.parse(sessionStorage.getItem("panaCurrentPool")).id;this.loading=!0,this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.get_pools_detail_servers,{pool_id:t}),method:"get"}),function(t){e.components=t.data,t.data.length>0&&(e.form.serverId=e.components[0].uid,e.getDiskInfo()),e.loading=!1},function(){e.loading=!1})},validateTimeInterval:function(e){var t=this;e&&""!==t.form.frequency?setTimeout(function(){t.$refs.form.validateField("frequency",function(e){if(e)return!1})},0):t.$refs.form.clearValidate()},getDiskInfo:function(){var e=this,t=e.common.formatMsg(e.api.cloud.server_snapshot_volumes,{server_id:e.form.serverId});this.loading=!0,e.form.systemDisk=[],e.form.dataDisk=[],e.systemOptions=[],e.dataDiskOptions=[],this.checkError(this.$http({url:t,method:"get"}),function(t){var a=t.data.diskInfo;e.diskIds=t.data.diskId,(a=(a=(a=(a=a.filter(function(e){return"iso"!=e.diskFormat&&("in-use"==e.status||"available"==e.status)})).filter(function(e){return!e.magrationing})).filter(function(e){return e.storageLimit&&e.storageLimit.snapshots})).filter(function(e){return!(e.storageLimit&&!e.storageLimit.share_volumes_snapshots&&e.attachments.length>1)})).forEach(function(t){"true"===t.bootable&&t.device.endsWith("da")?e.systemOptions.push(t):e.dataDiskOptions.push(t)}),e.loading=!1},function(){e.loading=!1})},confirm:function(){var e,t,a=!0,s=this,o={},n=s.form.systemDisk.concat(s.form.dataDisk);return this.$refs.form.validate(function(e){e||(a=!1)}),!!a&&(0===n.length?(s.noSelectVolume=!0,!1):(this.confirmDisabled=!0,e=this.api.operation.post_jobs_add,o.volumeIds=n,o.serverId=s.form.serverId,o.startTime=s.moment(s.form.startTime).format("YYYY-MM-DD HH:mm"),o.unit=s.form.unit||"once",o.jobType=parseInt(s.form.jobType),s.form.unit&&(o.holdNumber=s.form.holdNumber,o.frequency=s.form.frequency),t=s.lang.resource.operationSuccess,s.closeModal(!1),void this.checkError(this.$http({url:e,data:o,method:"POST"}),function(e){s.$emit("getList"),s.$notify({title:s.lang.common.success,type:"success",message:t})})))},closeModal:function(){n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{maxTimeInterval:function(){switch(this.form.unit){case"hour":return 168;case"day":return 31;case"week":case"month":return 99}},isStorageServer:function(){return this.storServerId===this.form.serverId}}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{id:"create-plan-task",title:e.lang.planTask.create,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-alert",{attrs:{title:e.lang.resource.snapshotInfo,type:"bg-blue",closable:!1}}),e._v(" "),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"120px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-form-item",{attrs:{label:e.lang.planTask.taskType}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.jobType,callback:function(t){e.$set(e.form,"jobType",t)},expression:"form.jobType"}},e._l(e.lang.planTask.jobType,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.planTask.selectComponent,prop:"serverId"}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:""},on:{change:e.getDiskInfo},model:{value:e.form.serverId,callback:function(t){e.$set(e.form,"serverId",t)},expression:"form.serverId"}},e._l(e.components,function(e){return a("el-option",{key:e.uid,attrs:{label:e.name,value:e.uid}})}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.componentSystemDisk}},[a("el-col",{attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotDiskInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"el-icon-info"})])],1),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:"",multiple:"",disabled:0===e.systemOptions.length,placeholder:0===e.systemOptions.length?e.lang.resource.componentSystemDiskPlaceholder[1]:e.lang.resource.componentSystemDiskPlaceholder[0]},model:{value:e.form.systemDisk,callback:function(t){e.$set(e.form,"systemDisk",t)},expression:"form.systemDisk"}},e._l(e.systemOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.componentDataDisk}},[a("el-col",{attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotDiskInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"el-icon-info"})])],1),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:"",multiple:"",disabled:0===e.dataDiskOptions.length||e.isStorageServer,placeholder:0===e.dataDiskOptions.length?e.lang.resource.dataDiskPlaceholder[1]:e.lang.resource.dataDiskPlaceholder[0]},model:{value:e.form.dataDisk,callback:function(t){e.$set(e.form,"dataDisk",t)},expression:"form.dataDisk"}},e._l(e.dataDiskOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),e.noSelectVolume&&0===e.form.systemDisk.length&&0===e.form.dataDisk.length?a("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.noSelectSnapVolume))]):e._e()],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.executionFrequency}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:""},on:{change:e.validateTimeInterval},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.lang.resource.executionFrequencyValue,function(e){return a("el-option",{key:e.unit,attrs:{label:e.name,value:e.unit}})}),1)],1)],1),e._v(" "),e.form.unit?a("el-form-item",{attrs:{label:e.lang.resource.timeInterval,prop:"frequency",rules:[{required:!0,message:e.lang.common.required_item,trigger:"blur"},{type:"integer",min:1,max:e.maxTimeInterval,message:e.common.formatMsg(e.lang.resource.invalidTimeInterval,{max:e.maxTimeInterval}),trigger:"blur"}]}},[a("el-col",{attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.timeIntervalInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"el-icon-info"})])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:e.lang.resource.timeIntervalPlaceholder,type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.frequency,callback:function(t){e.$set(e.form,"frequency",e._n(t))},expression:"form.frequency"}})],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:4}},[e._v("\n                "+e._s(e.lang.resource.timeUnit[e.form.unit])+"\n            ")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.executionFirstTime,prop:"startTime"}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:e.lang.resource.datePlaceholder,align:"right","picker-options":e.pickerOptions},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1)],1),e._v(" "),e.form.unit?a("el-form-item",{attrs:{label:e.lang.resource.snapshotsReservations}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.holdNumber,callback:function(t){e.$set(e.form,"holdNumber",t)},expression:"form.holdNumber"}},e._l(e.lang.resource.snapshotsReservationsValue,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.confirmDisabled},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var i=a("C7Lr")(l,r,!1,function(e){a("n1Fu"),a("sjcE")},"data-v-6d8ede2a",null).exports,c={props:{show:Boolean,task:Object},data:function(){return{activeName:"basicInfo",loading:!0,taskLog:[],pageNum:1,pageSize:10}},methods:{pageSelect:function(e){this.pageNum=e},initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getTaskLog()},getTaskLog:function(){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.operation.get_jobs_detail,{id:this.task.scheduleJobId}),method:"get"}),function(t){e.loading=!1,e.taskLog=t.data},function(){e.loading=!1})},closeModal:function(){n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{pagedData:function(){var e=this.taskLog;return e.length<=this.pageSize?e:this.common.pagination(e,this.pageSize,this.pageNum)}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{id:"task-detail",title:e.lang.planTask.taskDetail,visible:e.show,modal:!0,width:"75%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.lang.planTask.basicInfo,name:"basicInfo"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cloud-detail"},[e.task.hasOwnProperty("scheduleJobId")?a("table",[a("tr",[a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.planTask.taskNumber))]),e._v(" "),a("td",[e._v(e._s(e.task.scheduleJobId))]),e._v(" "),a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.planTask.taskType))]),e._v(" "),a("td",[e._v(e._s(e.lang.planTask.jobType[e.task.jobType]))])]),e._v(" "),a("tr",[a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.planTask.componentName))]),e._v(" "),a("td",[e._v(e._s(e.task.serverName))]),e._v(" "),a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.planTask.cloudDiskName))]),e._v(" "),a("td",[e._v(e._s(e.task.volumeNames.join()))])]),e._v(" "),a("tr",[a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.planTask.prevRun))]),e._v(" "),a("td",[e._v(e._s(e.task.previousFireTime&&e.moment(e.task.previousFireTime).format("YYYY-MM-DD HH:mm:ss")))]),e._v(" "),a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.planTask.nextRun))]),e._v(" "),a("td",[e._v(e._s(e.task.nextFireTime&&e.moment(e.task.nextFireTime).format("YYYY-MM-DD HH:mm:ss")))])]),e._v(" "),a("tr",[a("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.planTask.saveNumber))]),e._v(" "),a("td",[e._v(e._s(e.task.holdNumber))]),e._v(" "),a("td",{staticClass:"cloud-label"}),e._v(" "),a("td")])]):e._e()])]),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.planTask.taskLog,name:"log"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData}},[a("el-table-column",{attrs:{prop:"userName",label:e.lang.planTask.userName}}),e._v(" "),a("el-table-column",{attrs:{prop:"volumeName",label:e.lang.planTask.cloudDisk}}),e._v(" "),a("el-table-column",{attrs:{prop:"resultTime",label:e.lang.planTask.runTime},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.resultTime&&e.moment(t.row.resultTime).format("YYYY-MM-DD HH:mm:ss"))+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"resultCode",label:e.lang.planTask.runResult},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(e.lang.planTask.taskResult[t.row.resultCode])+"\n                    ")]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.taskLog.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.taskLog.length,"page-size":e.pageSize,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1)],1)],1)},staticRenderFns:[]};var u=a("C7Lr")(c,m,!1,function(e){a("zRSX")},null,null).exports,d={props:{show:Boolean,storServerId:String,task:Object},data:function(){return{loading:!0,pools:[],components:[],noSelectVolume:!1,diskIds:{},systemOptions:[],dataDiskOptions:[],form:{jobType:"0",poolId:"",serverId:"",systemDisk:[],dataDisk:[],holdNumber:1,frequency:"",unit:"",startTime:""},pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}],disabledDate:function(e){return e.getTime()<Date.now()-864e5}},confirmDisabled:!1,rules:{startTime:[{required:!0,message:this.lang.common.required_item,trigger:"blur"}]}}},methods:{initForm:function(){var e={name:this.task.serverName,uid:this.task.serverId};this.$refs.form&&this.$refs.form.resetFields(),this.components.push(e),this.form.serverId=this.task.serverId,this.form.unit="once"===this.task.unit?"":this.task.unit,this.form.frequency=this.task.frequency,this.form.holdNumber=this.task.holdNumber,this.form.startTime=this.task.nextFireTime,this.getDiskInfo()},validateTimeInterval:function(e){var t=this;e&&""!==t.form.frequency?setTimeout(function(){t.$refs.form.validateField("frequency",function(e){if(e)return!1})},0):t.$refs.form.clearValidate()},getDiskInfo:function(){var e=this,t=e.task.scheduleJobId,a=e.common.formatMsg(e.api.cloud.server_schedule_volumes,{server_id:e.form.serverId}),s=e.common.formatGetUrl({job_id:t});this.loading=!0,this.checkError(this.$http({url:a+s,method:"get"}),function(t){var a=t.data.diskInfo,s="";e.diskIds=t.data.diskId,(a=(a=(a=(a=a.filter(function(e){return"iso"!=e.diskFormat&&("in-use"==e.status||"available"==e.status)})).filter(function(e){return!e.magrationing})).filter(function(e){return e.storageLimit&&e.storageLimit.snapshots})).filter(function(e){return!(e.storageLimit&&!e.storageLimit.share_volumes_snapshots&&e.attachments.length>1)})).forEach(function(t){s=t.id,"true"===t.bootable&&t.device.endsWith("da")?(e.systemOptions.push(t),e.task.volumeIdsArray.indexOf(s)>-1&&e.form.systemDisk.push(s)):(e.dataDiskOptions.push(t),e.task.volumeIdsArray.indexOf(s)>-1&&e.form.dataDisk.push(s))}),e.loading=!1},function(){e.loading=!1})},timeChange:function(e){var t=Date.parse(new Date)+3e5;Date.parse(e)<t&&(this.form.startTime=t)},confirm:function(){var e,t,a=!0,s=this,o={},n=s.form.systemDisk.concat(s.form.dataDisk);return this.$refs.form.validate(function(e){e||(a=!1)}),!!a&&(0===n.length?(s.noSelectVolume=!0,!1):(this.confirmDisabled=!0,e=this.api.operation.post_jobs_edit,o.volumeIds=n,o.serverId=s.form.serverId,o.startTime=s.moment(s.form.startTime).format("YYYY-MM-DD HH:mm"),o.unit=s.form.unit||"once",o.jobType=parseInt(s.form.jobType),o.scheduleJobId=s.task.scheduleJobId,o.jobGroup=s.task.jobGroup,o.jobName=s.task.jobName,s.form.unit&&(o.holdNumber=s.form.holdNumber,o.frequency=s.form.frequency),t=s.lang.resource.operationSuccess,s.closeModal(!1),void this.checkError(this.$http({url:e,data:o,method:"POST"}),function(e){s.$emit("getList"),s.$notify({title:s.lang.common.success,type:"success",message:t})})))},closeModal:function(){n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{maxTimeInterval:function(){switch(this.form.unit){case"hour":return 168;case"day":return 31;case"week":case"month":return 99}}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{id:"create-plan-task",title:e.lang.planTask.edit,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[a("el-alert",{attrs:{title:e.lang.resource.snapshotInfo,type:"bg-blue",closable:!1}}),e._v(" "),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"120px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-form-item",{attrs:{label:e.lang.planTask.taskType}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:"",disabled:!0},model:{value:e.form.jobType,callback:function(t){e.$set(e.form,"jobType",t)},expression:"form.jobType"}},e._l(e.lang.planTask.jobType,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.planTask.selectComponent,prop:"serverId"}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:"",disabled:!0},model:{value:e.form.serverId,callback:function(t){e.$set(e.form,"serverId",t)},expression:"form.serverId"}},e._l(e.components,function(e){return a("el-option",{key:e.uid,attrs:{label:e.name,value:e.uid}})}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.componentSystemDisk}},[a("el-col",{attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotDiskInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"el-icon-info"})])],1),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:"",multiple:"",disabled:0===e.systemOptions.length,placeholder:0===e.systemOptions.length?e.lang.resource.componentSystemDiskPlaceholder[1]:e.lang.resource.componentSystemDiskPlaceholder[0]},model:{value:e.form.systemDisk,callback:function(t){e.$set(e.form,"systemDisk",t)},expression:"form.systemDisk"}},e._l(e.systemOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.componentDataDisk}},[a("el-col",{attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotDiskInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"el-icon-info"})])],1),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:"",multiple:"",disabled:0===e.dataDiskOptions.length||e.storServerId===e.form.serverId,placeholder:0===e.dataDiskOptions.length?e.lang.resource.dataDiskPlaceholder[1]:e.lang.resource.dataDiskPlaceholder[0]},model:{value:e.form.dataDisk,callback:function(t){e.$set(e.form,"dataDisk",t)},expression:"form.dataDisk"}},e._l(e.dataDiskOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),e.noSelectVolume&&0===e.form.systemDisk.length&&0===e.form.dataDisk.length?a("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.noSelectSnapVolume))]):e._e()],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.executionFrequency}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:""},on:{change:e.validateTimeInterval},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.lang.resource.executionFrequencyValue,function(e){return a("el-option",{key:e.unit,attrs:{label:e.name,value:e.unit}})}),1)],1)],1),e._v(" "),e.form.unit?a("el-form-item",{attrs:{label:e.lang.resource.timeInterval,prop:"frequency",rules:[{required:!0,message:e.lang.common.required_item,trigger:"blur"},{type:"integer",min:1,max:e.maxTimeInterval,message:e.common.formatMsg(e.lang.resource.invalidTimeInterval,{max:e.maxTimeInterval}),trigger:"blur"}]}},[a("el-col",{attrs:{span:1}},[a("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[a("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.timeIntervalInfo)},slot:"content"}),e._v(" "),a("i",{staticClass:"el-icon-info"})])],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:e.lang.resource.timeIntervalPlaceholder,type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.frequency,callback:function(t){e.$set(e.form,"frequency",e._n(t))},expression:"form.frequency"}})],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:4}},[e._v("\n                "+e._s(e.lang.resource.timeUnit[e.form.unit])+"\n            ")])],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:e.lang.resource.executionFirstTime,prop:"startTime"}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:e.lang.resource.datePlaceholder,align:"right","picker-options":e.pickerOptions},on:{change:e.timeChange},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1)],1),e._v(" "),e.form.unit?a("el-form-item",{attrs:{label:e.lang.resource.snapshotsReservations}},[a("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),a("el-col",{attrs:{span:23}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.holdNumber,callback:function(t){e.$set(e.form,"holdNumber",t)},expression:"form.holdNumber"}},e._l(e.lang.resource.snapshotsReservationsValue,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.confirmDisabled},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(d,p,!1,function(e){a("jS5Y"),a("xgW7")},"data-v-314202c0",null).exports,g={name:"pana-start",props:{show:Boolean,tasks:Array},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},confirm:function(){var e=this,t=this.api.operation.post_jobs_batch_delete,a=[];this.tasks.forEach(function(e){a.push(e.scheduleJobId)}),e.closeModal(),this.checkError(this.$http({url:t,method:"POST",data:{ids:a}}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.planTask.deleteSuccess})})}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.planTask.deleteConfirm))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},v=a("C7Lr")(g,h,!1,null,null,null).exports,b={data:function(){return{status:{},task:{},showCreate:!1,showDetail:!1,showEdit:!1,showDelete:!1,active:!0,loading:!0,tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,storServerId:""}},created:function(){var e=JSON.parse(sessionStorage.getItem("panaCurrentPool"));this.getList(),e.hasOwnProperty("stor_server_id")&&(this.storServerId=e.stor_server_id)},components:{detail:u,panaBreadcrumb:s.a,create:i,edit:f,deleteTask:v},methods:{detail:function(e){this.showDetail=!0,this.task=e},sort:function(e){this.tableData=this.common.sort(e,this.tableData,["scheduleJobId","nextFireTime","previousFireTime","holdNumber"])},getList:function(){var e=this,t={};e.loading=!0,this.checkError(this.$http({url:this.api.operation.get_jobs,method:"get"}),function(a){e.loading=!1,e.tableData=a.data,e.tableData.forEach(function(e){t[e.scheduleJobId]="NORMAL"===e.status}),e.status=t})},statusChange:function(e){var t=this,a={id:e},s="";s=t.status[e]?t.api.operation.post_jobs_schedult_jobs:t.api.operation.post_jobs_pause,this.checkError(this.$http({url:s,data:a,method:"post"}),function(e){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.planTask.operateSuccess})})},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e},closeCreate:function(){this.showCreate=!1},closeDetail:function(){this.showDetail=!1},closeEdit:function(){this.showEdit=!1},closeDelete:function(){this.showDelete=!1}},computed:{selectedTask:function(){return this.multipleSelection.length>0?this.multipleSelection[0]:{}},filterData:function(){var e=this.search,t=[];return t=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},k={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mainDiv"},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreate=!0}}},[e._v(e._s(e.lang.planTask.create))]),e._v(" "),a("el-button",{attrs:{disabled:1!==e.multipleSelection.length},on:{click:function(t){e.showEdit=!0}}},[e._v(e._s(e.lang.planTask.edit))]),e._v(" "),a("el-button",{attrs:{disabled:e.multipleSelection.length<=0},on:{click:function(t){e.showDelete=!0}}},[e._v(e._s(e.lang.planTask.delete))])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"scheduleJobId",label:e.lang.planTask.taskNumber},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.detail(t.row)}}},[e._v(e._s(t.row.scheduleJobId))])]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"serverName",label:e.lang.planTask.componentName},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.detail(t.row)}}},[e._v(e._s(t.row.serverName))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"volumeNames",label:e.lang.planTask.cloudDiskName},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.volumeNames.join())+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"previousFireTime",label:e.lang.planTask.prevRun},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.previousFireTime&&e.moment(t.row.previousFireTime).format("YYYY-MM-DD HH:mm:ss"))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"nextFireTime",label:e.lang.planTask.nextRun},scopedSlots:e._u([{key:"default",fn:function(t){return["PAUSED"===t.row.status&&t.row.previousFireTime&&"once"===t.row.unit?e._e():a("span",[e._v("\n                        "+e._s(e.moment(t.row.nextFireTime).format("YYYY-MM-DD HH:mm:ss"))+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"holdNumber",label:e.lang.planTask.saveNumber}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"jobType",label:e.lang.planTask.taskType},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.lang.planTask.jobType[t.row.jobType])+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"PAUSED"===t.row.status&&t.row.previousFireTime&&"once"===t.row.unit?e.lang.planTask.activeDisable:e.lang.planTask.statusValue[t.row.status],placement:"left"}},[a("el-switch",{key:t.row.scheduleJobId,attrs:{disabled:"PAUSED"===t.row.status&&t.row.previousFireTime&&"once"===t.row.unit,"active-color":"#1abc9c"},on:{change:function(a){return e.statusChange(t.row.scheduleJobId)}},model:{value:e.status[t.row.scheduleJobId],callback:function(a){e.$set(e.status,t.row.scheduleJobId,a)},expression:"status[scope.row.scheduleJobId]"}})],1)]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("create",{attrs:{show:e.showCreate,storServerId:e.storServerId},on:{getList:e.getList,closeModal:e.closeCreate}}),e._v(" "),a("detail",{attrs:{show:e.showDetail,task:e.task},on:{closeModal:e.closeDetail}}),e._v(" "),a("edit",{attrs:{show:e.showEdit,task:e.selectedTask,storServerId:e.storServerId},on:{getList:e.getList,closeModal:e.closeEdit}}),e._v(" "),a("delete-task",{attrs:{show:e.showDelete,tasks:e.multipleSelection},on:{getList:e.getList,closeModal:e.closeDelete}})],1)},staticRenderFns:[]};var _=a("C7Lr")(b,k,!1,function(e){a("DvQL"),a("LPo7")},"data-v-060a7940",null);t.default=_.exports},jS5Y:function(e,t){},n1Fu:function(e,t){},sjcE:function(e,t){},xgW7:function(e,t){},zRSX:function(e,t){}});