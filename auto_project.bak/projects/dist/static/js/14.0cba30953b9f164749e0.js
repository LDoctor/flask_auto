webpackJsonp([14],{HcU1:function(e,t){},Sx4v:function(e,t){},TCjc:function(e,t){},Ykxa:function(e,t){},aLHe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("3cXf"),r=a.n(n),o=a("1JPr"),l=a("aA9S"),s=a.n(l),i={name:"pana-create-department",props:{show:Boolean,deptArr:Array},computed:{deptMenu:function(){var e=JSON.parse(r()(this.deptArr)),t={},a=[];if(e.length>0){for(var n=0;n<e.length;n++)null==e[n].parent_id&&(e[n].parent_id=0),!0===this.common.isArray(t[e[n].parent_id])?t[e[n].parent_id].push(e[n]):t[e[n].parent_id]=[e[n]];a=this.formatMenu(t,0)}return a.unshift({id:"0",department_name:this.lang.departmentManage.selectDepPlaceholder}),a}},methods:{closeModal:function(e){e=e||!1,s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.departmentLoading=!1},createDepartment:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?(e.disable=!1,e.form.parent_id=e.departments[e.departments.length-1],"0"===e.form.parent_id.toString()&&delete e.form.parent_id,e.form=e.common.dropEmptyParameter(e.form),e.checkError(e.$http({url:e.api.management.post_departments,method:"post",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.departmentManage.createDepartmentSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},formatMenu:function(e,t){for(var a=e[t],n=0;n<a.length;n++)null!=e[a[n].id]?(a[n].children=this.formatMenu(e,a[n].id),a[n].isLeaf=!1):a[n].isLeaf=!0;return a}},data:function(){return{labelWidth:"100px",departments:["0"],form:{department_name:"",description:"",parent_id:""},rules:{department_name:[{required:!0,message:this.lang.router.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.departmentManage.nameRangeRule,trigger:"blur"},{validator:this.common.validateDefaultName,message:this.lang.departmentManage.nameFormatRule,trigger:"blur"}],description:[{min:1,max:100,message:this.lang.departmentManage.descriptionRangeRule,trigger:"blur"}]},departmentLoading:!1,disable:!1}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.departmentManage.create,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.departmentLoading,expression:"departmentLoading"}],ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.departmentManage.departmentName,"label-width":e.labelWidth,prop:"department_name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.departmentManage.departmentNamePlaceholder},model:{value:e.form.department_name,callback:function(t){e.$set(e.form,"department_name",t)},expression:"form.department_name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.common.description,"label-width":e.labelWidth,prop:"description"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.departmentManage.descriptionPlaceholder},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.departmentManage.selectParentDepartment,"label-width":e.labelWidth}},[a("el-cascader",{attrs:{placeholder:e.lang.departmentManage.selectDepPlaceholder,"change-on-select":"",options:e.deptMenu,"expand-trigger":"hover",props:{label:"department_name",value:"id"}},model:{value:e.departments,callback:function(t){e.departments=t},expression:"departments"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createDepartment}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var m=a("C7Lr")(i,d,!1,function(e){a("TCjc"),a("Ykxa")},"data-v-7b2baf5e",null).exports,p={name:"pana-delete-department",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteDepartment:function(){this.closeModal(!0)}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.departmentManage.deleteDepartmentInfo))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteDepartment}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},u=a("C7Lr")(p,c,!1,null,null,null).exports,f={name:"pana-edit-department",props:{show:Boolean,departmentObj:Object,deptArr:Array},computed:{deptMenu:function(){var e=JSON.parse(r()(this.deptArr)),t={},a=[];if(e.length>0&&null!=this.departmentObj){for(var n=0;n<e.length;n++)null==e[n].parent_id&&(e[n].parent_id=0),!0===this.common.isArray(t[e[n].parent_id])?t[e[n].parent_id].push(e[n]):t[e[n].parent_id]=[e[n]];a=this.formatMenu(t,0)}return a.unshift({id:"0",department_name:this.lang.departmentManage.selectDepPlaceholder}),a}},methods:{closeModal:function(e){e=e||!1,s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.form.department_name=this.departmentObj.department_name,this.form.description=this.departmentObj.description,this.departments=this.getDepartmentPath(),this.departments.pop(),0===this.departments.length&&this.departments.push("0"),this.departmentLoading=!1},editDepartment:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){t?(e.form=e.common.dropEmptyParameter(e.form),e.form.parent_id=0===parseInt(e.departments[e.departments.length-1])?null:e.departments[e.departments.length-1],e.checkError(e.$http({url:e.common.formatMsg(e.api.management.put_departments_detail,{id:e.departmentObj.id}),method:"put",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.departmentManage.editDepartmentSuccess}),e.disable=!1,e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},getDepartmentPath:function(){var e={};Array().map.call(this.deptArr,function(t){null==t.parent_id&&(t.parent_id="0"),e[t.id]=t.parent_id});var t=[],a=this.departmentObj.id;if(null!=a)for(;"0"!==a&&null!=a;)t.unshift(a),a=e[a];return t},formatMenu:function(e,t,a){var n=e[t];a=!0===a;for(var r=0;r<n.length;r++){var o=!1;!0!==a&&n[r].id!==this.departmentObj.id||(o=!0,n[r].disabled=!0),null!=e[n[r].id]?(n[r].children=this.formatMenu(e,n[r].id,o),n[r].isLeaf=!1):n[r].isLeaf=!0}return n}},data:function(){return{labelWidth:"100px",departments:["0"],form:{department_name:"",description:"",parent_id:""},rules:{department_name:[{required:!0,message:this.lang.router.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.departmentManage.nameRangeRule,trigger:"blur"},{validator:this.common.validateDefaultName,message:this.lang.departmentManage.nameFormatRule,trigger:"blur"}],description:[{min:1,max:100,message:this.lang.departmentManage.descriptionRangeRule,trigger:"blur"}]},departmentLoading:!0,disable:!1}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.departmentLoading,expression:"departmentLoading"}],attrs:{title:e.lang.departmentManage.editDepartment,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.departmentManage.departmentName,"label-width":e.labelWidth,prop:"department_name"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.departmentManage.departmentNamePlaceholder},model:{value:e.form.department_name,callback:function(t){e.$set(e.form,"department_name",t)},expression:"form.department_name"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.common.description,"label-width":e.labelWidth,prop:"description"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.departmentManage.descriptionPlaceholder},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.departmentManage.selectParentDepartment,"label-width":e.labelWidth}},[a("el-cascader",{attrs:{placeholder:e.lang.departmentManage.selectDepPlaceholder,"change-on-select":"",options:e.deptMenu,"expand-trigger":"hover",props:{label:"department_name",value:"id"}},model:{value:e.departments,callback:function(t){e.departments=t},expression:"departments"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.editDepartment}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var h=a("C7Lr")(f,g,!1,function(e){a("HcU1"),a("Sx4v")},"data-v-f233a5ce",null).exports,_=a("rVsN"),v=a.n(_),b={name:"pana-add-staff",props:{show:Boolean,departmentId:String},methods:{closeModal:function(e){e=e||!1,s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){var e=this;null!=this.$refs.form&&this.$refs.form.clearValidate();var t=this.getUserList(),a=this.getCurrentDepartmentUser();e.departmentLoading=!0,v.a.all([t,a]).then(function(){e.allUsers=e.freedomUsers.concat(e.currentUsers).filter(function(e){return""!==e.realname});var t=[];e.currentUsers.map(function(e){t.push(e.id)}),e.selectedUsers=t,e.departmentLoading=!1}).catch(function(t){e.$notify({title:this.lang.common.error,type:"error",message:t.toString()}),e.departmentLoading=!1})},addStaff:function(){var e=this;this.form.parent_id=this.departments[this.departments.length-1];var t=[];this.currentUsers.filter(function(t){var a=e.selectedUsers.indexOf(t.id);return!(a>=0)||(e.selectedUsers.splice(a,1),!1)}).map(function(e){t.push(e.id)});var a={add_users:this.selectedUsers,del_users:t};this.checkError(this.$http({url:this.common.formatMsg(this.api.management.post_departments_detail,{id:this.departmentId}),method:"post",data:a}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.departmentManage.addStaffSuccess}),e.closeModal(!0)})},formatMenu:function(e,t){for(var a=e[t],n=0;n<a.length;n++)null!=e[a[n].id]?(a[n].children=this.formatMenu(e,a[n].id),a[n].isLeaf=!1):a[n].isLeaf=!0;return a},getUserList:function(){var e=this;return new v.a(function(t,a){var n=e;e.checkError(e.$http({url:e.api.management.get_users+"?department_id=0&size=0",method:"get"}),function(e){n.freedomUsers=e.data;var a=[];e.data.map(function(e){a.push(e.id)}),n.freedomIds=a,t(e.data)},function(){a()})})},getCurrentDepartmentUser:function(){var e=this;return new v.a(function(t,a){var n=e;e.checkError(e.$http({url:e.api.management.get_users+"?department_id="+e.departmentId+"&size=0",method:"get"}),function(e){n.currentUsers=e.data,t(e.data)},function(){a()})})}},data:function(){return{labelWidth:"100px",departments:[],form:{department_name:"",description:"",parent_id:""},rules:{department_name:[{required:!0,message:this.lang.router.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.departmentManage.nameRangeRule,trigger:"blur"},{validator:this.common.validateDefaultName,message:this.lang.departmentManage.nameFormatRule,trigger:"blur"}],description:[{min:1,max:100,message:this.lang.departmentManage.descriptionRangeRule,trigger:"blur"}]},currentUsers:[],freedomUsers:[],allUsers:[],selectedUsers:[],freedomIds:[],departmentLoading:!1}}},M={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.departmentManage.addStaff,width:"30%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.departmentLoading,expression:"departmentLoading"}],ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-transfer",{attrs:{filterable:"",titles:[e.lang.departmentManage.availableStaff,e.lang.departmentManage.selectedStaff],props:{label:"realname",key:"id"},format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},data:e.allUsers},model:{value:e.selectedUsers,callback:function(t){e.selectedUsers=t},expression:"selectedUsers"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addStaff}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var w=a("C7Lr")(b,M,!1,function(e){a("qwTI"),a("i4jj")},"data-v-04e4e173",null).exports,y={name:"department-manage",components:{"pana-breadcrumb":o.a,"pana-create-department":m,"pana-delete-department":u,"pana-edit-department":h,"pana-add-staff":w},data:function(){return{pageSize:10,departmentOrigin:[],departmentSearch:"",departmentSelectionIds:[],departmentPage:1,showCreateDepartment:!1,showDeleteDepartment:!1,showEditDepartment:!1,showAddStaff:!1,departmentTotal:0,departmentObj:null,loading:!1,role:"normal",auth:["admin","super"]}},computed:{departmentFilter:function(){var e=this;return this.departmentOrigin.filter(function(t){return""===e.departmentSearch||-1!==r()(t).search(e.departmentSearch)})},departmentTable:function(){return this.departmentFilter.length>this.pageSize?this.departmentFilter.slice((this.departmentPage-1)*this.pageSize,this.departmentPage*this.pageSize):this.departmentFilter}},methods:{switchDepartmentPage:function(e){this.departmentPage=e},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.departmentOrigin=this.departmentOrigin.sort(function(a,n){return a[e.prop]=null==a[e.prop]?"":a[e.prop],n[e.prop]=null==n[e.prop]?"":n[e.prop],(a[e.prop]>n[e.prop]?1:-1)*t})},closeCreateDepartment:function(e){!0===e&&this.getDepartmentList(),this.showCreateDepartment=!1},closeDeleteDepartment:function(e){var t=this;if(this.showDeleteDepartment=!1,!0===e){var a=this.api.management.delete_departments+this.common.formatGetUrl({id:this.departmentSelectionIds});this.checkError(this.$http.delete(a),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.departmentManage.deleteDepartmentSuccess}),t.getDepartmentList()},function(){t.getDepartmentList()}),t.departmentSelectionIds=[]}},getDepartmentList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.management.get_departments+"?size=0",method:"get"}),function(t){e.loading=!1,e.departmentOrigin=t.data},function(){e.loading=!1})},selectDepartmentIds:function(e){var t=[];e.forEach(function(e){t.push(e.id)}),this.departmentSelectionIds=t},editDepartment:function(e){this.departmentObj=e,this.showEditDepartment=!0},closeEditDepartment:function(e){this.showEditDepartment=!1,!0===e&&this.getDepartmentList()},closeAddStaff:function(e){e&&this.getDepartmentList(),this.showAddStaff=!1},getChildren:function(e){}},mounted:function(){this.role=JSON.parse(sessionStorage.getItem("panaUser")).role,this.getDepartmentList()},watch:{departmentSearch:function(){this.departmentPage=1}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb"),e._v(" "),a("el-main",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[e.auth.indexOf(e.role)>-1?a("div",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreateDepartment=!0}}},[e._v("\n                        "+e._s(e.lang.departmentManage.create)+"\n                    ")]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:1!==e.departmentSelectionIds.length},on:{click:function(t){e.showAddStaff=!0}}},[e._v("\n                        "+e._s(e.lang.departmentManage.addStaff)+"\n                    ")]),e._v(" "),a("el-button",{attrs:{disabled:0===e.departmentSelectionIds.length},on:{click:function(t){e.showDeleteDepartment=!0}}},[e._v("\n                        "+e._s(e.lang.common.delete)+"\n                    ")])],1):e._e()]),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.departmentSearch,callback:function(t){e.departmentSearch=t},expression:"departmentSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getDepartmentList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.departmentTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectDepartmentIds,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{prop:"department_name",sortable:"custom",label:e.lang.common.name}}),e._v(" "),a("el-table-column",{attrs:{prop:"parent_name",sortable:"custom",label:e.lang.departmentManage.parentName},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(null==t.row.parent_id||"0"===t.row.parent_id.toString()?"":t.row.parent_name)+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"description",sortable:"custom",label:e.lang.common.description,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",sortable:"custom",label:e.lang.common.create_time},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e._f("utc2beijing")(t.row.create_time))+"\n                ")]}}])}),e._v(" "),e.auth.indexOf(e.role)>-1?a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editDepartment(t.row)}}},[e._v("\n                        "+e._s(e.lang.common.edit)+"\n                    ")])]}}],null,!1,2407846577)}):e._e()],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.departmentFilter.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.departmentFilter.length},on:{"current-change":e.switchDepartmentPage}},[e._t("default",[a("span",{staticClass:"pagination-slot"},[e._v("\n                        "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.departmentPage,total:this.departmentFilter.length}))+"\n                    ")])])],2):e._e()],1),e._v(" "),a("pana-create-department",{attrs:{show:e.showCreateDepartment,deptArr:e.departmentOrigin},on:{closeModal:e.closeCreateDepartment}}),e._v(" "),a("pana-delete-department",{attrs:{show:e.showDeleteDepartment},on:{closeModal:e.closeDeleteDepartment}}),e._v(" "),a("pana-edit-department",{attrs:{show:e.showEditDepartment,departmentObj:e.departmentObj,deptArr:e.departmentOrigin},on:{closeModal:e.closeEditDepartment}}),e._v(" "),a("pana-add-staff",{attrs:{show:e.showAddStaff,departmentId:e.departmentSelectionIds[0]},on:{closeModal:e.closeAddStaff}})],1)],1)},staticRenderFns:[]};var x=a("C7Lr")(y,D,!1,function(e){a("flpu")},"data-v-2e3cd652",null);t.default=x.exports},flpu:function(e,t){},i4jj:function(e,t){},qwTI:function(e,t){}});