webpackJsonp([15],{KH7x:function(t,e,o){"use strict";e.__esModule=!0;var a=l(o("MGgt")),s=l(o("HzJ8"));function l(t){return t&&t.__esModule?t:{default:t}}e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,a.default)(Object(t)))return function(t,e){var o=[],a=!0,l=!1,i=void 0;try{for(var n,r=(0,s.default)(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){l=!0,i=t}finally{try{!a&&r.return&&r.return()}finally{if(l)throw i}}return o}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},MGgt:function(t,e,o){t.exports={default:o("PSm8"),__esModule:!0}},McD1:function(t,e){},PJf7:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("3cXf"),s=o.n(a),l=o("/n4h"),i=o("1JPr"),n=o("KH7x"),r=o.n(n),c=o("aA9S"),u=o.n(c),d={name:"pana-bond-public",props:{show:Boolean,poolId:[String,Number]},methods:{closeModal:function(t){t=t||!1,u()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",t)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getBaseInfo()},setConfiguration:function(){var t=this;this.disable=!0,this.$refs.form.validate(function(e){if(e){var o={};!0===t.form.remote_share||!0===t.form.tv?o.floating_ip_id=t.form.floating_ip:o.floating_ip_id=null,o.services={},o.services.RemoteShare=t.form.remote_share,o.services.TV=t.form.tv,t.checkError(t.$http({url:t.common.formatMsg(t.api.cloud.post_pool_detail_services,{pool_id:t.poolId}),method:"post",data:o}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.setConfigurationSuccess}),t.closeModal(!0)},function(){t.closeModal(!1)})}else t.disable=!1})},getBaseInfo:function(){var t=this;this.checkError([this.$http({url:this.api.cloud.get_floatingips,method:"get"}),this.$http({url:this.common.formatMsg(this.api.cloud.get_pool_detail_services,{pool_id:this.poolId}),method:"get"})],function(e){var o,a=void 0,s=r()(e,2);a=s[0],null!=(o=s[1]).data.floating_ip&&(t.form.floating_ip=o.data.floating_ip.id),t.publicIps=a.data.filter(function(e){return null==e.fixed_ip_address||e.id===t.form.floating_ip}),t.form.tv=o.data.services.TV,t.form.remote_share=o.data.services.RemoteShare,t.publicIps.length>0&&(""===t.form.floating_ip||null==t.form.floating_ip)&&(t.form.floating_ip=t.publicIps[0].id),t.loading=!1},function(){t.loading=!1})}},data:function(){return{labelWidth:"150px",loading:!0,form:{tv:!1,remote_share:!1,floating_ip:""},rules:{floating_ip:[{required:!0,message:this.lang.resource.publicIpRequiredRule,trigger:"blur"}]},publicIps:[],disable:!1,activeColor:"#13ce66",inactiveColor:"#eee"}}},p={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.configuration,width:"25%",visible:t.show,modal:!0},on:{open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"right",model:t.form,rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-row",{staticClass:"pana-row-switch",attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:t.lang.resource.vnc,"label-width":t.labelWidth,prop:"tv"}},[o("el-switch",{attrs:{"active-color":t.activeColor,"inactive-color":t.inactiveColor},model:{value:t.form.tv,callback:function(e){t.$set(t.form,"tv",e)},expression:"form.tv"}})],1)],1)],1),t._v(" "),o("el-row",{staticClass:"pana-row-switch",attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:t.lang.resource.remoteShare,"label-width":t.labelWidth,prop:"remote_share"}},[o("el-switch",{attrs:{"active-color":t.activeColor,"inactive-color":t.inactiveColor},model:{value:t.form.remote_share,callback:function(e){t.$set(t.form,"remote_share",e)},expression:"form.remote_share"}})],1)],1)],1),t._v(" "),!0===t.form.tv||!0===t.form.remote_share?o("el-row",{staticClass:"pana-row-switch",attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:t.lang.resource.setPublicIp,"label-width":t.labelWidth,prop:"floating_ip"}},[o("el-select",{attrs:{filterable:"",placeholder:t.lang.resource.publicIpPlaceholder,width:"100%"},model:{value:t.form.floating_ip,callback:function(e){t.$set(t.form,"floating_ip",e)},expression:"form.floating_ip"}},t._l(t.publicIps,function(t,e){return o("el-option",{key:e,attrs:{label:t.floating_ip_address,value:t.id}})}),1)],1)],1)],1):t._e()],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.disable},on:{click:t.setConfiguration}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var m={name:"resourceList",data:function(){return{self:this,loading:!0,dialogVisible:!1,tipDialogMsg:"",tile:!1,titleSelected:"",tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,totalPage:1,createForm:{name:"",imageSource:"",imageFile:"",imageFormat:"",osArch:"",osSystemType:"",osSystem:"",disk:"",is_protected:"",desc:""},operateOptions:[{value:"选项1",label:this.lang.resource.reboot},{value:"选项2",label:this.lang.resource.backup},{value:"选项3",label:this.lang.resource.migrate},{value:"选项4",label:this.lang.resource.autoAllocation},{value:"选项5",label:this.lang.common.delete}],operateValue:"",deleteDialogVisible:!1,deleteItem:"",detailDialogVisible:!1,poolStatus:"",showTooltip:!1,total:0,poolUser:[],deleteId:"",showConfiguration:!1,currentPoolId:null}},mounted:function(){var t=this;this.getList(),this.Hub.$off("getResource").$on("getResource",function(){t.getList()})},components:{"pana-configuration":o("C7Lr")(d,p,!1,function(t){o("wFgJ")},"data-v-9ecf5232",null).exports,cloudTipDialog:l.a,panaBreadcrumb:i.a},methods:{goTVWall:function(t){this.$router.push({path:"/cloudCenter/resource/guacamole",query:{id:t}})},router_to_dashboard:function(t){this.$router.push({name:"resourceDashboard",params:{id:t}})},permissionManage:function(t){var e=!0;return this.poolUser.filter(function(o){if(o.pool===t)return e=o.is_admin,!0}),e},toggleSelect:function(t){this.titleSelected===t?this.titleSelected="":this.titleSelected=t},statusClass:function(t){var e=t.shutoff_count,o=t.error_count,a=t.suspended_count+t.other_count;return 0===e&&0===o&&0===a?"success":0!==e&&0===o?"warning":0!==o?"error":0===e&&0===o?"info":void 0},deleteConfirm:function(){this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_delete},dialogConfirm:function(){this.dialogVisible=!1;var t=this,e=[],o=JSON.parse(sessionStorage.getItem("panaCurrentPool")),a=!1;this.tile?(e.push(t.titleSelected),t.titleSelected.indexOf(o.id)>-1&&(a=!0)):this.multipleSelection.forEach(function(t){e.push(t.id),null!=o&&t.id===o.id&&(a=!0)});var s=this.common.formatMsg(this.api.cloud.get_pools_detail,{pool_id:e[0]});t.deleteId=e[0],this.checkError(this.$http({url:s,method:"delete"}),function(){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:"正在删除"}),!0===a&&sessionStorage.removeItem("panaCurrentPool");var e=(new Date).getTime(),o=setInterval(function(){(new Date).getTime()-e<12e4?t.getstatus(t.deleteId,o):clearInterval(o)},3e3);t.timer.push(o)})},getstatus:function(t,e){var o=this;this.$http({url:this.common.formatMsg(this.api.cloud.getpoolstatus,{pool_id:t}),method:"get"}).then(function(t){200202===t.data.code&&(clearInterval(e),o.getList(),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.deleteResourceSuccess}))})},getList:function(){var t={page:this.pageNum,size:this.pageSize};this.search&&(t.name=this.search);var e=this;e.loading=!0;var o=this.common.formatGetUrl(t);this.common.is_system_admin()?this.checkError(this.$http({url:this.api.cloud.get_pools+o,method:"get"}),function(t){0==t.data.length&&e.pageNum>Math.ceil(t.total/e.pageSize)&&(e.pageNum=1,e.getList()),e.loading=!1,e.total=t.total,e.tableData=t.data,e.refreshPoolsList()},function(){e.loading=!1}):this.checkError([this.$http({url:e.api.management.pool_user+e.common.formatGetUrl({pool_id:0}),method:"get"}),this.$http({url:this.api.cloud.get_pools+o,method:"get"})],function(t){e.loading=!1,e.total=t.total,e.poolUser=t[0].data,e.tableData=t[1].data,e.refreshPoolsList()})},pageSelect:function(t){this.pageNum=t,this.getList()},handleSelectionChange:function(t){this.multipleSelection=t},handleShowTooltip:function(t){var e=t.target.querySelector(".el-tooltip");this.showTooltip=e.scrollWidth===e.offsetWidth&&e.scrollHeight===e.offsetHeight},refreshPoolsList:function(){this.checkError(this.$http({url:this.api.cloud.get_pools+"?size=1000&is_all=1",method:"get"}),function(t){sessionStorage.setItem("panaPools",s()(t.data)),null==sessionStorage.getItem("panaCurrentPool")&&(t.data.length>0?sessionStorage.setItem("panaCurrentPool",s()(t.data[0])):sessionStorage.setItem("panaCurrentPool","{}"))})},handleConfiguration:function(t){sessionStorage.setItem("panaCurrentPool",s()(t)),this.showConfiguration=!0,this.currentPoolId=t.id,this.getList()},closeConfiguration:function(t){this.showConfiguration=!1,!0===t&&this.getList()}},computed:{buttonDisabled:function(){return this.tile?!this.titleSelected:1!==this.multipleSelection.length},is_system_admin:function(){return this.common.is_system_admin()}},watch:{search:function(){this.pageNum=1,this.getList()}},destroyed:function(){for(var t=0;t<this.timer.length;t++)clearInterval(this.timer[t])}},f={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"mainDiv",attrs:{id:"resource-list"}},[o("pana-breadcrumb"),t._v(" "),o("el-main",[o("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:18}},[t.common.is_system_admin()?o("router-link",{staticClass:"cloud-router-btn",attrs:{to:{name:"createResource"}}},[o("el-button",{attrs:{type:"primary"}},[t._v(t._s(t.lang.common.create))])],1):t._e(),t._v(" "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.multipleSelection.length>1?t.lang.resource.noMultiDelete:t.lang.resource.disabledDelete,placement:"top",disabled:0===t.multipleSelection.length||1===t.multipleSelection.length&&!(4===parseInt(t.multipleSelection[0].status)||5===parseInt(t.multipleSelection[0].status)||6===parseInt(t.multipleSelection[0].status))}},[o("span",[t.common.is_system_admin()?o("el-button",{attrs:{disabled:t.buttonDisabled||4===parseInt(t.multipleSelection[0].status)||5===parseInt(t.multipleSelection[0].status)||6===parseInt(t.multipleSelection[0].status)},on:{click:t.deleteConfirm}},[t._v("\n                            "+t._s(t.lang.common.delete)+"\n                        ")]):t._e()],1)])],1),t._v(" "),o("el-col",{attrs:{span:6}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:22}},[o("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),o("el-col",{attrs:{span:2}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getList}})],1)],1)],1),t._v(" "),o("el-col",{staticClass:"list-btn",staticStyle:{display:"none"},attrs:{span:1}},[o("span",{on:{click:function(e){t.tile=!t.tile}}},[t.tile?t._e():o("i",{staticClass:"el-icon-menu"}),t._v(" "),t.tile?o("i",{staticClass:"fa fa-list",attrs:{"aria-hidden":"true"}}):t._e()])])],1),t._v(" "),t.tile?t._e():o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.tableData},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),t._v(" "),o("el-table-column",{attrs:{prop:"name",label:t.lang.common.name},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",disabled:2===e.row.status||4===e.row.status||6===e.row.status},on:{click:function(o){return t.router_to_dashboard(e.row.id)}}},[t._v("\n                        "+t._s(e.row.name)+"\n                    ")])]}}],null,!1,2745516595)}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.resource.creator},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.creator.real_name)+"\n                ")]}}],null,!1,1204522125)}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[0===parseInt(e.row.status)?o("span",{staticClass:"status normal"},[t._v("正常")]):t._e(),t._v(" "),1===parseInt(e.row.status)?o("span",{staticClass:"status exception"},[t._v("异常")]):t._e(),t._v(" "),2===parseInt(e.row.status)?o("span",{staticClass:"status error"},[t._v("错误")]):t._e(),t._v(" "),3===parseInt(e.row.status)?o("span",{staticClass:"status other"},[t._v("其他")]):t._e(),t._v(" "),4===parseInt(e.row.status)?o("span",{staticClass:"status creating"},[t._v("创建中")]):t._e(),t._v(" "),5===parseInt(e.row.status)?o("span",{staticClass:"status creating"},[t._v("扩容中")]):t._e(),t._v(" "),6===parseInt(e.row.status)?o("span",{staticClass:"status deleteing"},[t._v("删除中")]):t._e()]}}],null,!1,4265396625)}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.createTime},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("utc2beijing")(e.row.create_time))+"\n                ")]}}],null,!1,336217982)}),t._v(" "),o("el-table-column",{attrs:{prop:"description",label:t.lang.common.description}}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.operation},scopedSlots:t._u([{key:"default",fn:function(e){return[t.is_system_admin||t.permissionManage(e.row.id)?o("el-button",{attrs:{type:"text",disabled:2===e.row.status||4===e.row.status||6===e.row.status||5===e.row.status},on:{click:function(o){return t.$router.push({name:"updateResource",params:{id:e.row.id}})}}},[t._v("\n                        "+t._s(t.lang.common.edit)+"\n                    ")]):t._e(),t._v(" "),t.is_system_admin?o("el-button",{attrs:{type:"text",disabled:2===e.row.status||4===e.row.status||6===e.row.status},on:{click:function(o){return t.$router.push({name:"resourceMember",params:{id:e.row.id}})}}},[t._v("\n                        "+t._s(t.lang.resource.member)+"\n                    ")]):t._e(),t._v(" "),t.is_system_admin?o("el-button",{attrs:{type:"text",disabled:2===e.row.status||4===e.row.status||6===e.row.status},on:{click:function(o){return t.handleConfiguration(e.row)}}},[t._v("\n                       "+t._s(t.lang.resource.configuration)+"\n                   ")]):t._e(),t._v(" "),o("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.row.tv_status,expression:"scope.row.tv_status === 1"}],attrs:{type:"text"},on:{click:function(o){return t.goTVWall(e.row.id)}}},[t._v("电视墙")])]}}],null,!1,3112297301)})],1),t._v(" "),t.tile?o("div",{attrs:{id:"tile"}},[o("el-row",{attrs:{gutter:12}},t._l(t.tableData,function(e,a){return o("el-col",{key:a,attrs:{sm:12,md:8,lg:6}},[o("div",{on:{click:function(o){return t.toggleSelect(e.id)}}},[o("el-card",{class:{active:e.id===t.titleSelected},attrs:{shadow:"hover"}},[o("el-row",[o("el-col",{attrs:{xs:5,sm:8,md:9,lg:10,xl:7}},[o("i",{staticClass:"fa fa-server fa-5x",class:t.statusClass(e),attrs:{"aria-hidden":"true"}})]),t._v(" "),o("el-col",{attrs:{xs:19,sm:16,md:15,lg:14,xl:17}},[o("div",{on:{mouseenter:function(e){return t.handleShowTooltip(e)}}},[o("el-tooltip",{attrs:{disabled:t.showTooltip,content:e.name,placement:"top"}},[o("div",{staticClass:"ellipsis name"},[t._v(t._s(e.name))])])],1),t._v(" "),o("p",{staticClass:"desc ellipsis",domProps:{innerHTML:t._s(e.description||t.lang.resource.blank)}})])],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("label",[t._v("lang.resource.poolStatus[0]}}")]),t._v(" "),o("span",{staticClass:"success"},[t._v(t._s(e.active_count))])]),t._v(" "),o("el-col",{attrs:{span:12}},[o("label",[t._v(t._s(t.lang.resource.poolStatus[1]))]),t._v(" "),o("span",{staticClass:"warning"},[t._v(t._s(e.shutoff_count))])])],1),t._v(" "),o("el-row",[o("el-col",{attrs:{span:12}},[o("label",[t._v(t._s(t.lang.resource.poolStatus[2]))]),t._v(" "),o("span",{staticClass:"error"},[t._v(t._s(e.error_count))])]),t._v(" "),o("el-col",{attrs:{span:12}},[o("label",[t._v(t._s(t.lang.resource.poolStatus[3]))]),t._v(" "),o("span",{staticClass:"info"},[t._v(t._s(e.other_count+e.suspended_count))])])],1)],1)],1)])}),1)],1):t._e()],1),t._v(" "),o("cloud-tip-dialog",{attrs:{dialogVisible:t.dialogVisible},on:{cancel:function(e){t.dialogVisible=!1},confirm:t.dialogConfirm}},[t._v("\n        "+t._s(t.tipDialogMsg)+"\n    ")]),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.total>t.pageSize?o("el-pagination",{attrs:{"page-size":t.pageSize,background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.total,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1),t._v(" "),o("pana-configuration",{attrs:{show:t.showConfiguration,poolId:t.currentPoolId},on:{closeModal:t.closeConfiguration}})],1)},staticRenderFns:[]};var g=o("C7Lr")(m,f,!1,function(t){o("Pkz0"),o("McD1")},"data-v-03623990",null);e.default=g.exports},PSm8:function(t,e,o){o("MJJS"),o("at0p"),t.exports=o("eswf")},Pkz0:function(t,e){},eswf:function(t,e,o){var a=o("Nlnz"),s=o("+Tcy")("iterator"),l=o("nVyG");t.exports=o("ZuHZ").isIterable=function(t){var e=Object(t);return void 0!==e[s]||"@@iterator"in e||l.hasOwnProperty(a(e))}},wFgJ:function(t,e){}});