webpackJsonp([17],{"2ykP":function(e,t){},"8kvs":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("/n4h"),l=o("1JPr"),s=o("aA9S"),i=o.n(s),n={props:{show:Boolean},data:function(){return{advancedOptions:!1,free:0,form:{name:"",compression:"off",dedup:"off",casesensitivity:"sensitive",atime:"on",size:"",unit:"G",copies:1,recordsize:"128K",parent:"UD_POOL/UDNAS",type:"filesystem"},rules:{name:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{min:1,max:32,message:this.lang.volume.volumeNameLengthRule},{validator:this.common.validateName4,trigger:"blur"}],size:[{required:!0,type:"integer",min:1,message:"请输入整数，最小值为1",trigger:"blur"},{validator:this.validateSize,trigger:"blur"}]}}},methods:{validateSize:function(e,t,o){var a=this.common.formatCapacity(this.free,"B",2),l=a.value?Math.floor(a.value):a.value,s=a.unit;(""===t||null==t||isNaN(t))&&o(),(t=this.common.switchCapacity(t,this.form.unit+"B",s,0))<=l?o():o(Error(this.common.formatMsg(this.lang.volume.invalidSizeMax,{max:l,unit:s})))},sizeUnitChange:function(){this.$refs.form.validateField("size")},advancedOptionsChange:function(){this.advancedOptions=!this.advancedOptions},confirm:function(){var e=this,t=this;this.$refs.form.validate(function(o){if(!o)return!1;t.advancedOptions||(delete t.form.copies,delete t.form.recordsize);var a=i()({},t.form);t.closeModal(),e.checkError(e.$http({url:e.api.storage.dataset,method:"POST",data:a}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.createVolumeSuccess})})})},closeModal:function(e){i()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){var e=this;this.$refs.form&&this.$refs.form.resetFields(),this.checkError(this.$http({url:this.api.storage.zfs,method:"get"}),function(t){t.data.some(function(t){if("UD_POOL/UDNAS"===t.path)return e.free=t.all_size.free,!0})})}}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.volume.createVolume,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"160px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.lang.volume.volumeName,prop:"name"}},[o("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.compressionLevel}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.compression,callback:function(t){e.$set(e.form,"compression",t)},expression:"form.compression"}},e._l(e.lang.volume.compressionLabel,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.ZFSDeduplication}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.dedup,callback:function(t){e.$set(e.form,"dedup",t)},expression:"form.dedup"}},e._l(e.lang.volume.dedupValue,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.caseSensitive}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.casesensitivity,callback:function(t){e.$set(e.form,"casesensitivity",t)},expression:"form.casesensitivity"}},e._l(e.lang.volume.caseSensitivityValue,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.recordFileDisplayTime}},[o("el-radio",{attrs:{label:"on"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.on))]),e._v(" "),o("el-radio",{attrs:{label:"off"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.off))])],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.spaceQuota,prop:"size"}},[o("el-col",{attrs:{span:14}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:e.lang.common.input,type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.size,callback:function(t){e.$set(e.form,"size",e._n(t))},expression:"form.size"}})],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"14px"},attrs:{span:9}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},on:{change:e.sizeUnitChange},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.lang.volume.unitValue,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),e._v(" "),o("el-form-item",{class:{"cloud-expand-icon":e.advancedOptions}},[o("el-button",{attrs:{type:"text"},on:{click:e.advancedOptionsChange}},[e._v("\n        "+e._s(e.lang.volume.advancedOptions)+"\n        "),o("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}})])],1),e._v(" "),e.advancedOptions?o("div",[o("el-form-item",{attrs:{label:e.lang.volume.copies}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.copies,callback:function(t){e.$set(e.form,"copies",t)},expression:"form.copies"}},e._l(e.lang.volume.copiesValue,function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.recordSize}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.recordsize,callback:function(t){e.$set(e.form,"recordsize",t)},expression:"form.recordsize"}},e._l(e.lang.volume.recordSizeValue,function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e()],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var c=o("C7Lr")(n,r,!1,function(e){o("Rrz6")},"data-v-dcb69820",null).exports,m={props:{show:Boolean,volumeData:Array},data:function(){return{advancedOptions:!1,form:{name:"",compression:"off",dedup:"off",casesensitivity:"sensitive",atime:"on",size:"",unit:"G",copies:1,recordsize:"128K",parent:"UD_POOL/UD_NAS",type:"filesystem"},rules:{size:[{type:"integer",min:1,message:"请输入整数，最小值为1",trigger:"blur"}]}}},methods:{advancedOptionsChange:function(){this.advancedOptions=!this.advancedOptions},confirm:function(){var e=this,t=this;this.$refs.form.validate(function(o){if(!o)return!1;t.advancedOptions||(delete t.form.copies,delete t.form.recordsize);var a=i()({},t.form),l=t.common.formatMsg(e.api.storage.dataset_detail,{zfs_id:t.volumeData.guid});t.closeModal(),e.checkError(e.$http({url:l,method:"put",data:a}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.editVolumeSuccess})})})},closeModal:function(e){i()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){for(var e in this.$refs.form&&this.$refs.form.resetFields(),this.volumeData)e in this.form&&(this.form[e]=this.volumeData[e]);var t=this.volumeData.recordsize/1024;this.form.recordsize=1024===t?t/1024+"M":t+"K"}}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.volume.updateVolume,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"160px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.lang.volume.volumeName}},[o("span",[e._v(e._s(e.form.name))])]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.compressionLevel}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.compression,callback:function(t){e.$set(e.form,"compression",t)},expression:"form.compression"}},e._l(e.lang.volume.compressionLabel,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.ZFSDeduplication}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.dedup,callback:function(t){e.$set(e.form,"dedup",t)},expression:"form.dedup"}},e._l(e.lang.volume.dedupValue,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.caseSensitive}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:"",disabled:!0},model:{value:e.form.casesensitivity,callback:function(t){e.$set(e.form,"casesensitivity",t)},expression:"form.casesensitivity"}},e._l(e.lang.volume.caseSensitivityValue,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.recordFileDisplayTime}},[o("el-radio",{attrs:{label:"on"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.on))]),e._v(" "),o("el-radio",{attrs:{label:"off"},model:{value:e.form.atime,callback:function(t){e.$set(e.form,"atime",t)},expression:"form.atime"}},[e._v(e._s(e.lang.volume.off))])],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.spaceQuota,prop:"size"}},[o("el-col",{attrs:{span:14}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:e.lang.common.input,type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.size,callback:function(t){e.$set(e.form,"size",e._n(t))},expression:"form.size"}})],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"14px"},attrs:{span:9}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.lang.volume.unitValue,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1)],1),e._v(" "),o("div",{attrs:{id:"advancedOptions"},on:{click:e.advancedOptionsChange}},[o("el-form-item",{class:{"cloud-expand-icon":e.advancedOptions},attrs:{label:e.lang.volume.advancedOptions}},[o("i",{staticClass:"fa fa-angle-double-right",attrs:{"aria-hidden":"true"}})])],1),e._v(" "),e.advancedOptions?o("div",[o("el-form-item",{attrs:{label:e.lang.volume.copies}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},model:{value:e.form.copies,callback:function(t){e.$set(e.form,"copies",t)},expression:"form.copies"}},e._l(e.lang.volume.copiesValue,function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.volume.recordSize}},[o("el-select",{staticStyle:{"margin-left":"0"},attrs:{filterable:""},on:{change:e.selectResource},model:{value:e.form.recordsize,callback:function(t){e.$set(e.form,"recordsize",t)},expression:"form.recordsize"}},e._l(e.lang.volume.recordSizeValue,function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e()],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var f=o("C7Lr")(m,u,!1,function(e){o("Jq5B"),o("Cj/H")},"data-v-4338b78c",null).exports,d={props:{show:Boolean,zfs_id:String},data:function(){return{form:{name:""},rules:{name:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{min:1,max:32,message:this.lang.volume.snapshotNameLengthRule},{validator:this.common.validateName5,trigger:"blur"}]}}},methods:{confirm:function(){var e=this,t=this;this.$refs.form.validate(function(o){if(!o)return!1;var a=i()({},t.form),l=t.common.formatMsg(t.api.storage.dataset_detail_snapshot,{zfs_id:t.zfs_id});t.closeModal(),e.checkError(e.$http({url:l,method:"POST",data:a}),function(){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.createSnapshotSuccess})})})},closeModal:function(e){i()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){this.$refs.form&&this.$refs.form.resetFields()}}},p={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.volume.createSnapshot,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.lang.common.name,prop:"name"}},[o("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var v=o("C7Lr")(d,p,!1,function(e){o("Gpj9"),o("Y7P2")},"data-v-4026ae2c",null).exports,g={data:function(){return{loading:!0,showCreateVolume:!1,showUpdateVolume:!1,showCreateSnapshot:!1,dialogVisible:!1,tipDialogMsg:"",tableData:[],volumeData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,operate:""}},mounted:function(){this.getList()},components:{"pana-breadcrumb":l.a,cloudTipDialog:a.a,createVolume:c,updateVolume:f,createSnapshot:v},methods:{sort:function(e){this.tableData=this.common.sort(e,this.tableData,["size","used"])},handleEdit:function(e,t){this.showUpdateVolume=!0,this.volumeData=t},deleteConfirm:function(){this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.confirmDelete,this.operate="delete"},closeCreateVolume:function(){this.showCreateVolume=!1},closeUpdateVolume:function(){this.showUpdateVolume=!1},closeCreateSnapshot:function(){this.showCreateSnapshot=!1},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"delete":this.delete()}},delete:function(){var e=this,t=e.common.formatMsg(e.api.storage.dataset_detail,{zfs_id:e.multipleSelection[0].guid});this.checkError(this.$http({url:t,method:"delete"}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.common.formatMsg(e.lang.volume.deleteVolumeSuccess,{name:e.multipleSelection[0].name})})})},getList:function(){var e=this;this.checkError(this.$http({url:this.api.storage.dataset,method:"get"}),function(t){e.loading=!1,e.tableData=t.data,e.tableData.map(function(e){"gzip"===e.compression&&(e.compression="gzip-6")})})},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e}},computed:{selectNotOne:function(){return 1!==this.multipleSelection.length},filterData:function(){var e=this.search,t=[];return t=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},h={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[o("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),o("el-main",[o("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:18}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreateVolume=!0}}},[e._v("\n                    "+e._s(e.lang.common.found)+"\n                ")]),e._v(" "),o("el-button",{attrs:{disabled:e.selectNotOne},on:{click:e.deleteConfirm}},[e._v("\n                    "+e._s(e.lang.common.delete)+"\n                ")]),e._v(" "),o("el-button",{attrs:{disabled:e.selectNotOne},on:{click:function(t){e.showCreateSnapshot=!0}}},[e._v("\n                    "+e._s(e.lang.volume.createSnapshot)+"\n                ")])],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:22}},[o("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),o("el-col",{attrs:{span:2}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.common.name}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"compressratio",label:e.lang.volume.compressionRatio}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"compression",label:e.lang.volume.compressionLevel},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s("off"===t.row.compression?e.lang.volume.compressionLabel[t.row.compression]:t.row.compression)+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"used",label:e.lang.volume.usedSpace}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"size",label:e.lang.volume.spaceQuota},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.size+e.lang.volume.unitValue[t.row.unit])+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.handleEdit(t.$index,t.row)}}},[e._v(e._s(e.lang.common.update)+"\n                    ")])]}}])})],1),e._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),o("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible},on:{cancel:function(t){e.dialogVisible=!1},confirm:e.dialogConfirm}},[e._v("\n        "+e._s(e.tipDialogMsg)+"\n    ")]),e._v(" "),o("create-volume",{attrs:{show:e.showCreateVolume},on:{closeModal:e.closeCreateVolume,getList:e.getList}}),e._v(" "),o("update-volume",{attrs:{show:e.showUpdateVolume,volumeData:e.volumeData},on:{closeModal:e.closeUpdateVolume,getList:e.getList}}),e._v(" "),o("create-snapshot",{attrs:{show:e.showCreateSnapshot,zfs_id:e.multipleSelection[0]&&e.multipleSelection[0].guid},on:{closeModal:e.closeCreateSnapshot,getList:e.getList}})],1)},staticRenderFns:[]};var b=o("C7Lr")(g,h,!1,function(e){o("2ykP")},"data-v-6958a0be",null);t.default=b.exports},"Cj/H":function(e,t){},Gpj9:function(e,t){},Jq5B:function(e,t){},Rrz6:function(e,t){},Y7P2:function(e,t){}});