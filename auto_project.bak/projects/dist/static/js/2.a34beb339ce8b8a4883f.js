webpackJsonp([2,4],{"+ri7":function(t,e,o){"use strict";var a=o("aA9S"),s=o.n(a),i={props:{server_id:String,show:Boolean},components:{},data:function(){return{loading:!0,floatingIps:[],fixedIps:[],form:{floating_ip:"",port_id:""}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getFloatingIps(),this.getFixedIps()},getFloatingIps:function(){var t=this;this.checkError(this.$http({url:this.api.cloud.cloud_floatingips,method:"get"}),function(e){t.floatingIps=e.data,t.form.floating_ip=t.floatingIps[0]&&t.floatingIps[0].id,t.loading=!1},function(){t.loading=!1})},getFixedIps:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.fixedIps=e.data,t.fixedIps[0]&&(t.form.port_id=t.fixedIps[0].port_id)})},confirm:function(){var t=this,e=this.common.formatMsg(this.api.cloud.post_floatingips_detail_association,{floatingip_id:this.form.floating_ip});delete this.form.floating_ip;var o=this.form;t.closeModal(!1),this.checkError(this.$http({url:e,data:o,method:"post"}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.bindPublicIpSuccess})})},closeModal:function(t){s()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}},computed:{noFloatingIp:function(){return 0===this.floatingIps.length}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.bindPublicIp,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-alert",{attrs:{title:t.lang.resource.bindPublicIpInfo,type:"bg-blue",closable:!1}}),t._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.publicIp,prop:"floating_ip"}},[o("el-select",{attrs:{filterable:"",disabled:t.noFloatingIp},model:{value:t.form.floating_ip,callback:function(e){t.$set(t.form,"floating_ip",e)},expression:"form.floating_ip"}},t._l(t.floatingIps,function(t){return o("el-option",{key:t.id,attrs:{label:t.floating_ip_address,value:t.id}})}),1),t._v(" "),t.noFloatingIp?o("span",{staticClass:"el-form-item__error"},[t._v(t._s(t.lang.resource.noFloatingIp))]):t._e()],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.privateIp,prop:"privateIp"}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.port_id,callback:function(e){t.$set(t.form,"port_id",e)},expression:"form.port_id"}},t._l(t.fixedIps,function(t){return o("el-option",{key:t.port_id,attrs:{label:t.fixed_ips[0].ip_address,value:t.port_id}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.noFloatingIp},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(i,n,!1,function(t){o("YSnw")},"data-v-e9d726f8",null);e.a=r.exports},"09sb":function(t,e,o){"use strict";var a=o("aA9S"),s=o.n(a),i={props:{show:Boolean,serverId:String,componentDetailData:Object},components:{},data:function(){return{form:{id:""},diskInfo:[],loading:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getDiskInfo()},getDiskInfo:function(){this.diskInfo=this.componentDetailData.diskInfo,this.diskInfo=this.diskInfo.filter(function(t){return!t.is_sys_disk}),this.form.id=this.diskInfo[0]&&this.diskInfo[0].id,this.loading=!1},unloadCloudDisk:function(){var t=this,e={server_id:this.serverId},o=this.common.formatMsg(t.api.storage.post_volumes_detail_detachments,{vid:this.form.id});t.wsEventQueue.push(this.form.id),t.closeModal(!1),this.checkError(this.$http({url:o,method:"post",data:e}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.unloadingCloudDiskSuccess})})},closeModal:function(){s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.uninstallCloudDisk,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"130px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.selectDisk}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.id,callback:function(e){t.$set(t.form,"id",e)},expression:"form.id"}},t._l(t.diskInfo,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:!t.form.id},on:{click:t.unloadCloudDisk}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(i,n,!1,function(t){o("c18T"),o("rd24")},"data-v-1410a405",null);e.a=r.exports},"1Mr8":function(t,e){},"3JmR":function(t,e){},"4kHz":function(t,e){},"8nZn":function(t,e){},"8zeT":function(t,e){},E8Uc:function(t,e){},FlL3:function(t,e){},INR5:function(t,e){},Igq9:function(t,e){},JdNb:function(t,e,o){"use strict";var a=o("aA9S"),s=o.n(a),i={props:{server_id:String,show:Boolean},data:function(){return{loading:!0,floatingIps:[],fixedIps:[],form:{port_id:""},disabled:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getFixedIps()},getFixedIps:function(){var t=this,e=this.common.formatMsg(this.api.cloud.server_os_interface_fips,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.fixedIps=e.data,t.fixedIps[0]?(t.disabled=!1,t.form.port_id=t.fixedIps[0].port_id):t.disabled=!0,t.loading=!1})},confirm:function(){var t=this,e=this.get_floatingip_id(),o=this.common.formatMsg(this.api.cloud.post_floatingips_detail_dissociation,{floatingip_id:e}),a=this.form;t.closeModal(!1),this.checkError(this.$http({url:o,data:a,method:"post"}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.unbindPublicIpSuccess})})},closeModal:function(t){s()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)},get_floatingip_id:function(){var t=this,e=this.fixedIps.filter(function(e){return e.port_id===t.form.port_id});return e[0]&&e[0].id}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.releasePublicIp,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.privateIp,prop:"privateIp"}},[o("el-select",{attrs:{filterable:"",disabled:t.disabled},model:{value:t.form.port_id,callback:function(e){t.$set(t.form,"port_id",e)},expression:"form.port_id"}},t._l(t.fixedIps,function(t){return o("el-option",{key:t.port_id,attrs:{label:t.name,value:t.port_id}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.disabled},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(i,n,!1,function(t){o("INR5")},"data-v-7b9e0b3b",null);e.a=r.exports},Kk6J:function(t,e,o){"use strict";var a=o("aA9S"),s=o.n(a),i={props:{show:Boolean,isStorageServer:Boolean,serverId:String},components:{},data:function(){return{form:{id:""},diskList:[],loading:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getDiskList()},getDiskList:function(){var t=this;this.checkError(this.$http({url:this.api.storage.get_canattach_volumes,method:"get"}),function(e){t.diskList=e.data,t.isStorageServer&&(t.diskList=t.diskList.filter(function(t){return!t.multiattach})),t.diskList=t.diskList.filter(function(e){return-1===e.instance_id.indexOf(t.serverId)}),t.form.id=t.diskList[0]&&t.diskList[0].id,t.loading=!1},function(){t.loading=!1})},loadCloudDisk:function(){var t=this,e={server_id:t.serverId},o=this.common.formatMsg(t.api.storage.post_volumes_detail_attachments,{vid:this.form.id});t.wsEventQueue.push(this.form.id),t.closeModal(!1),this.checkError(this.$http({url:o,method:"post",data:e}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.loadingCloudDiskSuccess})})},closeModal:function(){s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.loadCloudDisk,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"130px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.selectDisk}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.id,callback:function(e){t.$set(t.form,"id",e)},expression:"form.id"}},t._l(t.diskList,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:!t.form.id},on:{click:t.loadCloudDisk}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(i,n,!1,function(t){o("sYc6")},"data-v-a5251bb6",null);e.a=r.exports},PP5q:function(t,e){},RlWD:function(t,e){},SI8n:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("ZLEe"),s=o.n(a),i=o("3cXf"),n=o.n(i),r=o("1JPr"),l=o("aA9S"),c=o.n(l),u={props:{show:Boolean,id:String},data:function(){return{data:{},loading:!0}},methods:{initForm:function(){this.getDetail()},getDetail:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t.id});t.loading=!0,this.checkError(this.$http({url:e,method:"get"}),function(e){t.data=e.data,t.loading=!1})},statusClass:function(t){switch(t){case"ACTIVE":return"cloud-color-green";case"ERROR":return"cloud-color-red";case"SUSPENDED":return"cloud-color-blue";case"SHUTOFF":return"cloud-color-gray";default:return"cloud-color-orange"}},closeModal:function(){c()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{componentConfig:function(){var t=this.data.vcpus||0,e=this.data.ram||0;return this.common.formatMsg(this.lang.resource.componentConfig,{cpu:t,memory:e/1024})},cloudDisk:function(){var t="",e=this;return this.data.diskInfo.forEach(function(o){var a=o.is_sys_disk?e.lang.cloudDisk.sysDisk:e.lang.cloudDisk.dataDisk;t=t+e.common.formatMsg(e.lang.resource.detailCloudDisk,{name:o.name,type:o.type,disk:a,size:o.size})+"</br>"}),t},passthroughDevices:function(){return this.data.passthroughDevices.some(function(t){return"USB"===t.device_type})?"USB":this.lang.resource.no}}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.common.detail,visible:t.show,modal:!0,top:"8vh",width:"55%"},on:{open:t.initForm,close:t.closeModal}},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cloud-detail cloud-detail-modal",attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[t.data.hasOwnProperty("name")?o("table",[o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.componentName))]),t._v(" "),o("td",[t._v(t._s(t.data.name))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.image))]),t._v(" "),o("td",[t._v(t._s(t.data.imageName))])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.configuration))]),t._v(" "),o("td",[t._v(t._s(t.componentConfig))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.status))]),t._v(" "),o("td",[o("span",{staticClass:"status",class:t.statusClass(t.data.status)},[t._v(t._s(t.lang.resource.componentStatusArray[t.data.status])+"\n                    ")])])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.outside.privateIp))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.data.fixedIps.join("</br>"))}}),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.cloudDisk))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.cloudDisk)}})]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.outside.publicIp))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.data.floatingIps.join("</br>"))}}),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.create_time))]),t._v(" "),o("td",[t._v(t._s(t._f("utc2beijing")(t.data.createtime)))])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.physicalHost))]),t._v(" "),o("td",[t._v(t._s(t.data.hostName))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.transparentDevice))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.passthroughDevices)}})]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.componentRebootOdd))]),t._v(" "),o("td",[t._v(t._s(t.data.abnormalRestart?t.lang.resource.use:t.lang.resource.notUse))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.safeGroup))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.data.secGroups.join("</br>"))}})])]):t._e()]),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:t.closeModal}},[t._v(t._s(t.lang.common.close))])],1)])},staticRenderFns:[]};var m=o("C7Lr")(u,d,!1,function(t){o("soUv")},"data-v-232be9e6",null).exports,p=o("/n4h"),h=o("Cj+A"),g={name:"nicTips",props:{show:Boolean},data:function(){return{disable:!1}},methods:{init:function(){c()(this.$data,this.$options.data.call(this))},closeModal:function(t){this.disable=!0,this.$emit("closeModal",t)}}},f={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.common.info,visible:t.show,width:"30%","modal-append-to-body":!1,modal:!0},on:{open:t.init,close:t.closeModal}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{staticClass:"tips-content",attrs:{span:18},domProps:{innerHTML:t._s(t.lang.resource.addNicTips)}})],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){return t.closeModal(!1)}}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{disabled:t.disable,type:"primary"},on:{click:function(e){return t.closeModal(!0)}}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var v=o("C7Lr")(g,f,!1,function(t){o("bi95")},"data-v-56b3fd6a",null).exports,_={props:["show","server_id","pool_id"],components:{ipInput:h.a,"pana-nic-tips":v},data:function(){return{loading:!0,safeGroup:[],usedIp:[],networkList:[],allocation_pools:[],setIp:!1,form:{net_id:"",fixed_ip:"",subnetSegment:"",security_group_id:""},ipValidMessage:"",ipRange:"",disabledArr:"",placeholderArr:"",rules:{net_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],security_group_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],subnetSegment:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],fixed_ip:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]},showTips:!1}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getNetwork(),this.getSafeGroup()},openShowTips:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.showTips=!0)})},add:function(t){if(!0===t){var e=this,o={net_id:this.form.net_id,pool_id:this.pool_id},a=this.form.security_group_id;this.setIp&&(o.fixed_ip=this.form.fixed_ip),this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.post_server_os_interface,{server_id:this.server_id}),method:"post",data:o}),function(t){var o=t.data.port_id;e.security_group_set(a,o),e.closeModal(),e.showTips=!1},function(){e.closeModal(),e.showTips=!1})}else this.closeModal(),this.showTips=!1},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)},validateIpFn:function(t){this.$refs.form.validateField(t)},security_group_set:function(t,e){var o=this,a=[];a.push(t),this.checkError(o.$http({url:o.common.formatMsg(o.api.cloud.put_ports,{id:e}),method:"put",data:{security_groups:a}}),function(t){o.$emit("getList"),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.addWorkSuccess})})},getNetwork:function(){var t=this;this.checkError(this.$http({url:this.api.cloud.get_networks,method:"get"}),function(e){t.networkList=e.data,t.form.net_id=t.networkList[0]&&t.networkList[0].id,t.loading=!1,t.netChange()})},getUsedIp:function(){var t=this;this.checkError(this.$http({url:t.common.formatMsg(t.api.cloud.get_networks_detail_used_ips,{network_id:t.form.net_id}),method:"get"}),function(e){var o=[];e.data.map(function(t){o=o.concat(t.ip)}),t.usedIp=o},function(){})},getSafeGroup:function(){var t=this;this.checkError(this.$http({url:this.api.cloud.get_security_groups,method:"get"}),function(e){t.safeGroup=e.data,t.safeGroup.filter(function(e){"default"===e.name&&(t.form.security_group_id=e.id)})})},netChange:function(){this.setAllocationPools(),this.getUsedIp()},subnetChange:function(){var t=this.allocation_pools[this.form.subnetSegment],e=t.start,o=t.end;this.setFixedIp(e,o)},setFixedIp:function(t,e){this.ipValidMessage=this.common.formatMsg(this.lang.resource.ipRangeRule,{start:t,end:e});var o=t.split("."),a=e.split("."),s={},i="",n=[],r=[],l=!0;o.map(function(t,e){t===a[e]?(s[e]=t,i=i+t+".",n.push(e),r.push("")):(s[e]={start:t,end:a[e]},!0===l?(l=!1,r.push(o[e]+"~"+a[e])):r.push("0~255"))}),this.form.fixed_ip=i,this.ipRange=s,this.disabledArr=n,this.placeholderArr=r},validateIp:function(t,e,o){var a=e.split("."),s=!0,i=!0;for(var n in this.ipRange)if(this.ipRange.hasOwnProperty(n)){var r=parseInt(a[parseInt(n)]);if("[object Object]"===this.ipRange[n].toString()){if(!a[parseInt(n)]){i=!1;break}if(!0===s){if(s=!1,r<this.ipRange[n].start||r>this.ipRange[n].end){i=!1;break}}else if(3===parseInt(n)){if(r<0||r>this.ipRange[n].end){i=!1;break}}else if(r<0||r>255){i=!1;break}}}!0===i?o():o(new Error(t.message))},validateIpUsed:function(t,e,o){this.usedIp.join(",").indexOf(e)>-1?o(Error(this.lang.outside.ipUsed)):o()},setAllocationPools:function(){var t=this,e=this.networkList.filter(function(e){return e.id===t.form.net_id});if(e[0]){t.form.subnetSegment=0,t.allocation_pools=[],e[0].subnets.forEach(function(e){e.allocation_pools.forEach(function(o){t.allocation_pools.push({name:e.name,start:o.start,end:o.end})})});var o=t.allocation_pools[this.form.subnetSegment],a=o.start,s=o.end;t.setFixedIp(a,s)}}}},b={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.addNetCard,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-alert",{attrs:{title:t.lang.resource.addNetCardInfo,type:"bg-blue",closable:!1}}),t._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.privateIp,prop:"net_id"}},[o("el-select",{attrs:{filterable:""},on:{change:t.netChange},model:{value:t.form.net_id,callback:function(e){t.$set(t.form,"net_id",e)},expression:"form.net_id "}},t._l(t.networkList,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.setIp,prop:"setIp"}},[o("el-checkbox",{model:{value:t.setIp,callback:function(e){t.setIp=e},expression:"setIp"}})],1),t._v(" "),t.setIp?o("div",[o("el-form-item",{attrs:{label:t.lang.router.subnetSegment,prop:"subnetSegment"}},[o("el-select",{attrs:{filterable:""},on:{change:t.subnetChange},model:{value:t.form.subnetSegment,callback:function(e){t.$set(t.form,"subnetSegment",e)},expression:"form.subnetSegment"}},t._l(t.allocation_pools,function(e,a){return o("el-option",{key:a,attrs:{label:t.common.formatMsg(t.lang.resource.subnetSegmentLabel,{subnet:e.name,start:e.start,end:e.end}),value:a}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.ip,prop:"fixed_ip",rules:[{validator:this.validateIp,message:this.ipValidMessage,trigger:"blur"},{validator:this.validateIpUsed,trigger:"blur"}]}},[o("ip-input",{attrs:{disable:t.disabledArr,placeholder:t.placeholderArr},nativeOn:{"!blur":function(e){return t.validateIpFn("fixed_ip")}},model:{value:t.form.fixed_ip,callback:function(e){t.$set(t.form,"fixed_ip",e)},expression:"form.fixed_ip"}})],1)],1):t._e(),t._v(" "),o("el-form-item",{attrs:{label:t.lang.nav.safeGroup,prop:"security_group_id"}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.security_group_id,callback:function(e){t.$set(t.form,"security_group_id",e)},expression:"form.security_group_id"}},t._l(t.safeGroup,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.openShowTips}},[t._v(t._s(t.lang.common.confirm))])],1),t._v(" "),o("pana-nic-tips",{attrs:{show:t.showTips},on:{closeModal:t.add}})],1)},staticRenderFns:[]};var k=o("C7Lr")(_,b,!1,function(t){o("rhbP")},"data-v-0b549d12",null).exports,w={props:{show:Boolean,server_id:String},data:function(){return{loading:!0,removeBtn:!1,networkList:[],timerObj:{},form:{port_id:""}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.removeBtn=!1,this.getIps()},getIps:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.networkList=e.data,t.form.port_id=t.networkList[0]&&t.networkList[0].port_id,t.loading=!1})},getDetail:function(t,e){var o=this,a=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t});this.checkError(this.$http({url:a,method:"get"}),function(a){a.data.fixedIps.every(function(t){return t!=e})&&(clearInterval(o.timerObj[t]),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.removeNetCardSuccess}),o.$emit("getList"))})},remove:function(){var t=this;t.removeBtn=!0;var e=t.server_id,o=this.common.formatMsg(this.api.cloud.delete_server_os_interface,{server_id:this.server_id}),a=this.common.formatGetUrl({port_id:this.form.port_id});t.closeModal(!1),this.checkError(this.$http({url:o+a,method:"delete"}),function(o){var a="";t.networkList.map(function(e,o){e.port_id==t.form.port_id&&(a=e.fixed_ips[0]&&e.fixed_ips[0].ip_address)});var s="",i=(new Date).getTime();s=setInterval(function(){(new Date).getTime()-i<12e4?t.getDetail(e,a):clearInterval(s)},3e3),t.timerObj[t.server_id]=s,t.timer.push(s)})},closeModal:function(t){t=t||!1,this.$emit("closeModal",t)}}},y={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.removeNetCard,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.privateIp,prop:"privateIp"}},[o("el-tooltip",{attrs:{disabled:1!=t.networkList.length,effect:"dark",content:t.lang.resource.lastNetCart,placement:"top"}},[o("div",[o("el-select",{attrs:{filterable:"",disabled:1==t.networkList.length},model:{value:t.form.port_id,callback:function(e){t.$set(t.form,"port_id",e)},expression:"form.port_id"}},t._l(t.networkList,function(t){return o("el-option",{key:t.port_id,attrs:{label:t.fixed_ips[0]&&t.fixed_ips[0].ip_address,value:t.port_id}})}),1)],1)])],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:1==t.networkList.length||t.removeBtn},on:{click:t.remove}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var S=o("C7Lr")(w,y,!1,function(t){o("jmpZ")},"data-v-38e847b2",null).exports,D={props:{server_id:String,show:Boolean},data:function(){return{loading:!0,ips:[],usedIp:[],network_now:"",networkList:[],form:{port_id:"",ip_address:""},disabledArr:[],placeholderArr:[],ipRange:[],rules:{port_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],ip_address:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]},ipRangeTips:""}},components:{ipInput:h.a},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getIps(),this.getNetworkList()},getNetworkList:function(){var t=this;this.checkError(this.$http({url:this.api.cloud.get_networks,method:"get"}),function(e){t.networkList=e.data,t.privateIpChange(),t.loading=!1})},getAllocationPools:function(){var t=this,e=this.getSubnetId(),o=[];return this.networkList.some(function(a){return a.subnets.some(function(s){if(s.id===e)return o=s.allocation_pools,t.network_now=a.id,t.getUsedIp(),!0})}),o},getUsedIp:function(){var t=this;this.checkError(this.$http({url:t.common.formatMsg(t.api.cloud.get_networks_detail_used_ips,{network_id:t.network_now}),method:"get"}),function(e){var o=[];e.data.map(function(t){o=o.concat(t.ip)}),t.usedIp=o},function(){})},validateIpUsed:function(t,e,o){this.usedIp.join(",").indexOf(e)>-1?o(Error(this.lang.outside.ipUsed)):o()},getSubnetId:function(){var t,e=this,o="";return(t=this.ips.filter(function(t){return t.port_id===e.form.port_id}))[0]&&(o=t[0].fixed_ips[0].subnet_id),o},privateIpChange:function(){var t,e=this,o=this.getAllocationPools(),a=[];this.ipRangeTips=" ",o.map(function(t){e.ipRangeTips=e.ipRangeTips+(t.start+" ~ ")+t.end+"<br/>",a.push(e.setFixedIp(t.start,t.end))}),t=a.sort(function(t,e){return t.disable-e.disable})[0].disable,this.form.ip_address=t>-1?a[0].ip_address.split(".").slice(0,t+1).join("."):"",this.ipRange=[],a.map(function(t){e.ipRange.push(t.ipRange)}),this.disabledArr=t>-1?s()(new Array(3).fill(0)):[],this.placeholderArr=1===a.length?a[0].placeholder:[]},setFixedIp:function(t,e){var o=t.split("."),a=e.split("."),s={},i="",n=-1,r=[],l=!0,c={};return o.map(function(t,e){t===a[e]?(s[e]=t,i=i+t+".",n=e,r.push("")):(s[e]={start:t,end:a[e]},!0===l?(l=!1,r.push(o[e]+"~"+a[e])):r.push("0~255"))}),c.ip_address=i,c.ipRange=s,c.disable=n,c.placeholderArr=r,c},validateIp:function(t,e,o){var a=!1;this.ipRange.map(function(t){var o=e.split("."),s=!0,i=!0;for(var n in t)if(t.hasOwnProperty(n)){var r=parseInt(o[parseInt(n)]);if("[object Object]"===t[n].toString()){if(!o[parseInt(n)]){i=!1;break}if(!0===s){if(s=!1,r<t[n].start||r>t[n].end){i=!1;break}}else if(3===parseInt(n)){if(r<0||r>t[n].end){i=!1;break}}else if(r<0||r>255){i=!1;break}}}a=!0===i||a}),!0===a?o():o(new Error(t.message))},update:function(){var t=!0;if(this.$refs.form.validate(function(e){e||(t=!1)}),!t)return!1;var e=this,o=this.common.formatMsg(this.api.cloud.put_ports,{id:this.form.port_id}),a=[];a.push({ip_address:this.form.ip_address}),e.wsEventQueue.push(e.form.port_id),e.closeModal(!1),this.checkError(this.$http({url:o,data:{fixed_ips:a},method:"put"}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.updatePrivateIpSuccess})})},getIps:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.ips=e.data,t.ips[0]&&(t.form.port_id=t.ips[0].port_id,t.privateIpChange())})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}}},C={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.updatePrivateIp,visible:t.show,modal:!0,top:"8vh",width:"38%"},on:{open:t.initForm,close:t.closeModal}},[o("el-alert",{attrs:{title:t.lang.resource.updatePrivateIpInfo,type:"bg-blue",closable:!1}}),t._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.privateIp,prop:"port_id"}},[o("div",{staticClass:"input-container"},[o("el-select",{attrs:{filterable:""},on:{change:t.privateIpChange},model:{value:t.form.port_id,callback:function(e){t.$set(t.form,"port_id",e)},expression:"form.port_id"}},t._l(t.ips,function(t){return o("el-option",{key:t.port_id,attrs:{label:t.fixed_ips[0].ip_address,value:t.port_id}})}),1),t._v(" "),o("i",{staticClass:"fa fa-question-circle",staticStyle:{color:"transparent"}})],1)]),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.updateTo,prop:"ip_address",rules:[{validator:this.validateIp,message:this.lang.resource.ipValidMessage,trigger:"blur"},{validator:this.validateIpUsed,trigger:"blur"}]}},[o("div",{staticClass:"input-container"},[o("ip-input",{attrs:{disable:t.disabledArr,placeholder:t.placeholderArr},model:{value:t.form.ip_address,callback:function(e){t.$set(t.form,"ip_address",e)},expression:"form.ip_address"}}),t._v(" "),o("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[o("span",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.resource.selectableIpRange+"：<br/>"+t.ipRangeTips)},slot:"content"}),t._v(" "),o("i",{staticClass:"fa fa-question-circle"})])],1)])],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.update}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var I=o("C7Lr")(D,C,!1,function(t){o("FlL3")},"data-v-26151494",null).exports,M=o("+ri7"),x=o("JdNb"),$={props:{show:Boolean,server_id:String},data:function(){return{loading:!0,fixedIps:[],disable:!1,form:{port_id:"",mac_address:""},rules:{mac_address:[{validator:this.common.validateMac,trigger:"blur"}]},floatingIpId:null}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.disable=!1,this.getFixedIps(),this.getFloatingIps()},getFixedIps:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.fixedIps=e.data,t.fixedIps[0]&&(t.form.port_id=t.fixedIps[0].port_id,t.form.mac_address=t.fixedIps[0].mac_addr),t.loading=!1})},getFloatingIps:function(){var t=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.server_os_interface_fips,{server_id:this.server_id}),method:"get"}),function(e){t.floatingIpId=e.data[0].id})},privateIpChange:function(){var t,e=this;t=this.fixedIps.filter(function(t){return t.port_id===e.form.port_id}),e.form.mac_address=t[0]&&t[0].mac_addr},confirm:function(){var t=this,e=this;this.disable=!0,this.$refs.form.validate(function(o){if(o){var a=t.common.formatMsg(t.api.cloud.server_mac,{server_id:t.server_id}),s=t.form;null!=e.floatingIpId&&""!==e.floatingIpId&&(s.floatingIp_id=t.floatingIpId),e.checkError(e.$http({url:a,data:s,method:"put"}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.updateMacSuccess}),e.closeModal(!1)},function(){e.disable=!1})}else e.disable=!1})},closeModal:function(t){t=t||!1,this.$emit("closeModal",t)}}},O={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.updateMac,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-alert",{attrs:{title:t.lang.resource.updateMacInfo,type:"bg-orange",closable:!1}}),t._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.privateIp,prop:"port_id"}},[o("el-select",{attrs:{filterable:""},on:{change:t.privateIpChange},model:{value:t.form.port_id,callback:function(e){t.$set(t.form,"port_id",e)},expression:"form.port_id"}},t._l(t.fixedIps,function(t){return o("el-option",{key:t.port_id,attrs:{label:t.fixed_ips[0].ip_address,value:t.port_id}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.macAddress,prop:"mac_address"}},[o("el-input",{model:{value:t.form.mac_address,callback:function(e){t.$set(t.form,"mac_address",e)},expression:"form.mac_address"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{disabled:t.disable,type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var P=o("C7Lr")($,O,!1,function(t){o("RlWD")},"data-v-ff47fc40",null).exports,E={props:{server_id:String,show:Boolean},data:function(){return{loading:!0,fixedIps:[],safeGroup:[],form:{port_id:"",allowed_address_pairs:[],port_security_enabled:!1,security_group_id:""},rules:{port_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]}}},components:{ipInput:h.a},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getFixedIps()},fixedIpChange:function(){this.get_port_detail()},getFixedIps:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.fixedIps=e.data,t.fixedIps[0]&&(t.form.port_id=t.fixedIps[0].port_id,t.get_port_detail())})},get_port_detail:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_ports_detail,{id:this.form.port_id});this.checkError(this.$http({url:e,method:"get"}),function(e){var o=e.data;t.form.port_security_enabled=o.port_security_enabled,t.safeGroup=o.new_security_groups,o.security_groups[0]?t.form.security_group_id=o.security_groups[0]:t.form.security_group_id=t.safeGroup[0]&&t.safeGroup[0].id,t.form.allowed_address_pairs=o.allowed_address_pairs,t.loading=!1})},addIpPair:function(){this.form.allowed_address_pairs.length<10&&this.form.allowed_address_pairs.push({key:Date.now()})},removeIpPair:function(t){var e=this.form.allowed_address_pairs.indexOf(t);-1!==e&&this.form.allowed_address_pairs.splice(e,1)},confirm:function(){var t=!0;if(this.$refs.form.validate(function(e){e||(t=!1)}),!t)return!1;var e=this,o=this.common.formatMsg(this.api.cloud.put_ports,{id:this.form.port_id});if(delete this.form.port_id,this.form.port_security_enabled){var a=[];a.push(this.form.security_group_id),this.form.security_groups=a,this.form.allowed_address_pairs.forEach(function(t){delete t.key})}else this.form.allowed_address_pairs=[],this.form.security_groups=[];delete this.form.security_group_id;var s=this.form;e.closeModal(!1),this.checkError(this.$http({url:o,data:s,method:"put"}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.nicSecurityConfigSuccess})})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}}},L={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.nicSecurityConfig,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.privateIp,prop:"port_id"}},[o("el-select",{attrs:{filterable:""},on:{change:t.fixedIpChange},model:{value:t.form.port_id,callback:function(e){t.$set(t.form,"port_id",e)},expression:"form.port_id"}},t._l(t.fixedIps,function(t){return o("el-option",{key:t.port_id,attrs:{label:t.fixed_ips[0].ip_address,value:t.port_id}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.nicSecurity}},[o("el-checkbox",{model:{value:t.form.port_security_enabled,callback:function(e){t.$set(t.form,"port_security_enabled",e)},expression:"form.port_security_enabled"}})],1),t._v(" "),t.form.port_security_enabled?o("div",[o("el-form-item",{attrs:{label:t.lang.nav.safeGroup}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.security_group_id,callback:function(e){t.$set(t.form,"security_group_id",e)},expression:"form.security_group_id"}},t._l(t.safeGroup,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:t.addIpPair}},[t._v(t._s(t.lang.resource.addAddressPair))])],1),t._v(" "),t._l(t.form.allowed_address_pairs,function(e,a){return o("el-form-item",{key:e.key,attrs:{label:"IP",prop:"allowed_address_pairs."+a+".ip_address",rules:[{required:!0,message:t.lang.resource.required_item,trigger:"blur"},{validator:t.common.validateIpAddress,message:t.lang.pool.ipFormatRule,trigger:"blur"}]}},[o("el-col",{attrs:{span:20}},[o("ip-input",{model:{value:e.ip_address,callback:function(o){t.$set(e,"ip_address",o)},expression:"item.ip_address"}})],1),t._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:2}},[o("el-form-item",{staticClass:"selectStorageBtn"},[o("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(o){return t.removeIpPair(e)}}},[t._v("\n                            "+t._s(t.lang.common.delete)+"\n                        ")])],1)],1)],1)})],2):t._e()],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var N=o("C7Lr")(E,L,!1,function(t){o("PP5q")},"data-v-70a2e03e",null).exports,R={props:{show:Boolean,componentDetailData:Object},data:function(){return{form:{name:""},volume_id:"",min_disk:"",rules:{name:[{required:!0,message:this.lang.resource.required_item,trigger:"blur"},{validator:this.common.validateName3,trigger:"blur"}]}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields()},confirm:function(){var t=!0;if(this.$refs.form.validate(function(e){e||(t=!1)}),!t)return!1;this.getRootDeviceInfo();var e={createImage:{image_name:this.form.name,volume_id:this.volume_id,min_disk:this.min_disk}},o=this,a=this.componentDetailData.uid,s=this.common.formatMsg(o.api.cloud.post_pool_servers_detail_action,{server_id:a});this.checkError(this.$http({url:s,method:"post",data:e}),function(t){o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.makeImageSuccess})}),this.closeModal(!1)},getRootDeviceInfo:function(){var t=this;"diskInfo"in this.componentDetailData&&this.componentDetailData.diskInfo.some(function(e){if(e.is_sys_disk)return t.volume_id=e.id,t.min_disk=parseInt(e.size),!0})},closeModal:function(t){t=t||!1,this.$emit("closeModal",t)}}},T={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.makeImage,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules}},[o("el-form-item",{attrs:{label:t.lang.resource.imageName,prop:"name"}},[o("el-input",{attrs:{placeholder:t.lang.common.namePlaceholder},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name","string"==typeof e?e.trim():e)},expression:"form.name"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var F=o("C7Lr")(R,T,!1,function(t){o("gaCa")},"data-v-158712e2",null).exports,U={props:{show:Boolean,server_id:String,loaded_image_ids:Array},data:function(){return{imageList:[],form:{imageRef:""},volumeId:"",loading:!1}},mounted:function(){var t=this;this.$ws.setCallback(function(e){if(-1!==t.wsEventQueue.indexOf(e.resource_id)){var o=e.event_type.split(".");"volume"===o[0]&&"end"===o[2]&&t.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getImages()},getImages:function(){var t=this,e="";this.loading=!0,this.loaded_image_ids.length>0&&(e=this.common.formatGetUrl({imageIds:this.loaded_image_ids})),this.checkError(this.$http({url:this.api.cloud.get_images_iso+e,method:"get"}),function(e){t.imageList=e.data,t.form.imageRef=t.imageList[0]&&t.imageList[0].image_id,t.loading=!1},function(){t.loading=!1})},confirm:function(){var t=this;t.closeModal();var e=this.api.cloud.post_iso_make_volume;this.checkError(this.$http({url:e,method:"post",data:this.form}),function(e){t.volumeId=e.data,t.queryVolumeStatus()})},queryVolumeStatus:function(){var t=this.volumeId,e=this,o=this.common.formatMsg(this.api.storage.get_volumes_detail,{vid:t});this.checkError(this.$http({url:o,method:"get"}),function(t){"creating"===t.data.status||"downloading"===t.data.status?setTimeout(e.queryVolumeStatus,5e3):"error"===t.data.status?e.$notify({title:e.lang.common.error,type:"error",message:e.lang.resource.discLoadFail}):e.volumeAttachment()})},volumeAttachment:function(){var t=this,e={volumeAttachment:{volumeId:this.volumeId}};t.wsEventQueue.push(this.volumeId);var o=this.common.formatMsg(this.api.cloud.post_poolServers_os_volume_attachments,{server_id:this.server_id});this.checkError(this.$http({url:o,method:"post",data:e}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.discLoading})})},closeModal:function(t){t=t||!1,this.$emit("closeModal",t)}}},V={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{"append-to-body":"",title:t.lang.resource.load,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.deviceDescription,prop:"imageRef"}},t._l(t.imageList,function(e,a){return o("div",{key:a},[o("el-radio",{attrs:{label:e.image_id},model:{value:t.form.imageRef,callback:function(e){t.$set(t.form,"imageRef",e)},expression:"form.imageRef"}},[o("span",{domProps:{innerHTML:t._s(t.common.formatMsg(t.lang.resource.deviceImage,{name:e.image_name,min_disk:e.size}))}})])],1)}),0)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:!t.form.imageRef},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var B=o("C7Lr")(U,V,!1,function(t){o("xrNV")},null,null).exports,A={props:{show:Boolean,server_id:String},data:function(){return{unloadDialogVisible:!1,multipleSelection:[],showLoad:!1,tableData:[],pageNum:1,pageSize:10,search:"",loading:!0}},components:{discLoad:B},mounted:function(){var t=this;this.$ws.setCallback(function(e){if(-1!==t.wsEventQueue.indexOf(e.resource_id)){var o=e.event_type.split(".");"volume"===o[0]&&"end"===o[2]&&t.getList()}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getList()},unload:function(){var t=this;this.unloadDialogVisible=!1;var e=[];this.multipleSelection.forEach(function(o){e.push(o.volumeId),t.wsEventQueue.push(o.volumeId)});var o=this.common.formatGetUrl({volumeId:e}),a=this.common.formatMsg(this.api.cloud.poolServers_os_volume_attachments,{server_id:this.server_id});this.checkError(this.$http({url:a+o,method:"delete"}),function(e){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.discUnloading})})},handleSelectionChange:function(t){this.multipleSelection=t},closeLoad:function(t){!0===t&&this.getList(),this.showLoad=!1},pageSelect:function(t){this.pageNum=t},statusClass:function(t){switch(t){case"in-use":return"cloud-success";case"attaching":return"bg-blue";case"detaching":return"cloud-warning"}},getList:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_poolServers_os_volume_attachments,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.loading=!1,t.tableData=e.data})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}},computed:{getImageIds:function(){var t=[];return this.tableData.forEach(function(e){t.push(e.imageId)}),t},pagedData:function(){var t=this.tableData;return t.length<=this.pageSize?t:this.common.pagination(t,this.pageSize,this.pageNum)}}},q={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{id:"load",title:t.lang.resource.discManagement,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-row",{staticClass:"pana-btn-group"},[o("el-col",{attrs:{span:18}},[o("el-button",{attrs:{type:"primary",disabled:t.loading},on:{click:function(e){t.showLoad=!0}}},[t._v(t._s(t.lang.resource.load))]),t._v(" "),o("el-button",{attrs:{disabled:t.multipleSelection.length<=0},on:{click:function(e){t.unloadDialogVisible=!0}}},[t._v(t._s(t.lang.resource.unload))])],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedData},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),t._v(" "),o("el-table-column",{attrs:{prop:"name",label:t.lang.resource.discName}}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"status",class:t.statusClass(e.row.status)},[t._v(t._s(t.lang.resource.volumeAttachStatusArray[e.row.status])+"\n                ")])]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"size",label:t.lang.resource.capacityGb}})],1),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.tableData.length>t.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.tableData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1),t._v(" "),o("disc-load",{attrs:{loaded_image_ids:t.getImageIds,server_id:t.server_id,show:t.showLoad},on:{getList:t.getList,closeModal:t.closeLoad}}),t._v(" "),o("el-dialog",{staticClass:"cloud-tipDialog",attrs:{"append-to-body":"",title:t.lang.imageManage.tip,visible:t.unloadDialogVisible,width:"35%"},on:{"update:visible":function(e){t.unloadDialogVisible=e}}},[t._v("\n        "+t._s(t.lang.resource.unloadDiscConfirm)+"\n        "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.unloadDialogVisible=!1}}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.unload}},[t._v(t._s(t.lang.common.confirm))])],1)]),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))])],1)],1)},staticRenderFns:[]};var G=o("C7Lr")(A,q,!1,function(t){o("laRw")},"data-v-29180093",null).exports,H={props:{show:Boolean,selectdComponent:Object},data:function(){return{timerLocal:"",flavorRef:"",loadingFlavor:!0,flavors:[],tableData:[],pageNumFlavor:1,pageSize:10,searchFlavor:"",label:"",loading:!0}},mounted:function(){var t=this;this.$ws.setCallback(function(e){if(-1!==t.wsEventQueue.indexOf(e.resource_id)){var o=e.event_type.split(".");"compute"===o[0]&&"finish_resize"===o[2]&&"end"===o[3]&&t.$emit("getList"),"compute"!==o[0]||"resize"!==o[2]||"end"!==o[4]&&"error"!==o[4]||t.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getList()},pageSelect:function(t){this.pageNumFlavor=t},resize:function(){var t=this,e={resize:{flavorRef:this.flavorRef}},o=this.selectdComponent.uid,a=this.common.formatMsg(t.api.cloud.post_pool_servers_detail_action,{server_id:o});this.closeModal(),t.wsEventQueue.push(o),this.checkError(this.$http({url:a,method:"post",data:e}),function(t){},function(e){t.wsEventQueue.splice(o,1)})},getStatus:function(t){var e=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t});this.$http({url:o,method:"get"}).then(function(t){200303!==t.data.code&&"SHUTOFF"!==t.data.data.status&&"ERROR"!==t.data.data.status||(e.$emit("getList"),clearInterval(e.timerLocal))})},getList:function(){var t=this,e=this.selectdComponent;this.checkError(this.$http({url:this.api.management.get_flavors,method:"get"}),function(o){t.loadingFlavor=!1,t.flavors=o.data,t.flavors=t.flavors.filter(function(t){return!(t.ram===e.ram&&t.vcpus===e.vcpus)})})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}},computed:{filterFlavors:function(){var t=this.searchFlavor,e=this.flavors;return""===t?e:this.common.cloudFilter(e,t)},pagedFlavors:function(){var t=[];return t=this.filterFlavors.length<=this.pageSize?this.filterFlavors:this.common.pagination(this.filterFlavors,this.pageSize,this.pageNumFlavor),this.flavorRef=t[0]&&t[0].id,t}},watch:{searchFlavor:function(){this.pageNumFlavor=1}}},z={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.adjustConfiguration,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:12}}),t._v(" "),o("el-col",{attrs:{span:12}},[o("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.searchFlavor,callback:function(e){t.searchFlavor=e},expression:"searchFlavor"}})],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingFlavor,expression:"loadingFlavor"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedFlavors,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-radio",{attrs:{label:e.row.id},model:{value:t.flavorRef,callback:function(e){t.flavorRef=e},expression:"flavorRef"}},[t._v(t._s(t.label)+"\n                ")])]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"name",label:t.lang.common.name}}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.cpu},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.vcpus+t.lang.resource.core)+"\n            ")]}}])}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.memory},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.ram/1024+t.lang.common.gb)+"\n            ")]}}])})],1),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.filterFlavors.length>t.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.filterFlavors.length,"current-page":t.pageNumFlavor},on:{"current-change":t.pageSelect}}):t._e()],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:!t.flavorRef||t.pagedFlavors.length<=0},on:{click:t.resize}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var j=o("C7Lr")(H,z,!1,function(t){o("oEl3")},"data-v-acf36046",null).exports,Q={props:{show:Boolean,server_id:String,server_name:String},data:function(){return{usbList:[],form:{deviceType:"USB",usbBus:"0",description:""},noUsbDevice:!1,enterpriseUid:"66666666666666666666666666666666",loading:!1}},methods:{initForm:function(){this.getAvailableUsb()},getAvailableUsb:function(){var t=this,e=this.common.formatMsg(this.api.cloud.poolserver_usb_dev_available,{server_id:this.server_id});this.loading=!0,this.checkError(this.$http({url:e,method:"get"}),function(e){t.usbList=e.data,t.usbList[0]?(t.noUsbDevice=!1,t.form.description=t.usbList[0].description):t.noUsbDevice=!0,t.loading=!1},function(){t.loading=!1})},confirm:function(){var t=this,e={},o=t.usbList.filter(function(e){return e.description===t.form.description});o[0]&&(e={addressBus:o[0].address_bus,addressDevice:o[0].address_device,description:o[0].description,deviceType:t.form.deviceType,enterpriseUid:t.enterpriseUid,hostName:o[0].host,serverId:t.server_id,serverName:t.server_name,usbBus:t.form.usbBus});var a=this.common.formatMsg(this.api.cloud.poolserver_load_usb_device,{server_id:this.server_id});t.closeModal(),this.checkError(this.$http({url:a,method:"post",data:{load:e}}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.transparentEquipmentLoadSuccess})})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}}},Z={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{"append-to-body":"",title:t.lang.resource.load,visible:t.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.deviceType,prop:"privateIp"}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.deviceType,callback:function(e){t.$set(t.form,"deviceType",e)},expression:"form.deviceType"}},t._l(t.lang.resource.transparentDeviceType,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.deviceDescription,prop:"imageRef"}},[t._l(t.usbList,function(e,a){return e.loading?t._e():o("div",{key:a},[o("el-radio",{attrs:{label:e.description},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}},[t._v("\n                    "+t._s(e.description)+"\n                ")])],1)}),t._v(" "),t.noUsbDevice?o("div",{staticClass:"error"},[t._v("\n                "+t._s(t.lang.resource.noDeviceToLoad)+"\n            ")]):t._e()],2),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.USBcompatibility,prop:"privateIp"}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.usbBus,callback:function(e){t.$set(t.form,"usbBus",e)},expression:"form.usbBus"}},t._l(t.lang.resource.USBcompatibilityArray,function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var W=o("C7Lr")(Q,Z,!1,function(t){o("4kHz")},"data-v-6a02487c",null).exports,J={props:{show:Boolean,server_id:String,server_name:String},data:function(){return{unloadDialogVisible:!1,multipleSelection:[],showLoad:!1,tableData:[],pageNum:1,pageSize:10,search:"",loading:!0}},components:{transparentEquipmentLoad:W},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getList()},selectNotOne:function(){return 1!==this.multipleSelection.length},unload:function(){var t=this;this.unloadDialogVisible=!1;var e={addressBus:this.multipleSelection[0].addressBus,addressDevice:this.multipleSelection[0].addressDevice,usbBus:this.multipleSelection[0].usbBus,usbPort:this.multipleSelection[0].usbPort},o=this.common.formatMsg(this.api.cloud.poolserver_unload_usb_device,{server_id:this.server_id});this.checkError(this.$http({url:o,method:"POST",data:{unload:e}}),function(e){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.transparentEquipmentUnloadSuccess})})},handleSelectionChange:function(t){this.multipleSelection=t},closeLoad:function(t){!0===t&&this.getList(),this.showLoad=!1},pageSelect:function(t){this.pageNum=t},statusClass:function(t){switch(t){case!0:case!1:return"cloud-success"}},getList:function(){var t=this,e=this.common.formatMsg(this.api.cloud.poolserver_attached,{server_id:this.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.loading=!1,t.tableData=e.data},function(){t.loading=!1})},closeModal:function(t){t=t||!0,this.$emit("closeModal",t)}},computed:{pagedData:function(){var t=this.tableData;return t.length<=this.pageSize?t:this.common.pagination(t,this.pageSize,this.pageNum)}}},K={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{id:"load",title:t.lang.resource.transparentEquipment,visible:t.show,modal:!0,top:"8vh",width:"50%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-row",{staticClass:"pana-btn-group"},[o("el-col",{attrs:{span:18}},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.showLoad=!0}}},[t._v(t._s(t.lang.resource.load))]),t._v(" "),o("el-button",{attrs:{disabled:t.selectNotOne()},on:{click:function(e){t.unloadDialogVisible=!0}}},[t._v(t._s(t.lang.resource.unload))])],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedData},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),t._v(" "),o("el-table-column",{attrs:{prop:"deviceType",label:t.lang.resource.deviceType}}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"status",class:t.statusClass(e.row.status)},[t._v(t._s(t.lang.resource.transparentEquipmentStatusArray[e.row.status])+"\n                ")])]}}])}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.resource.compatibility},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s("0"===e.row.usbBus?"USB2.0":"USB3.0")+"\n            ")]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"description",label:t.lang.resource.deviceDescription}})],1),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.tableData.length>t.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.tableData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1),t._v(" "),o("transparent-equipment-load",{attrs:{server_id:t.server_id,show:t.showLoad},on:{getList:t.getList,closeModal:t.closeLoad}}),t._v(" "),o("el-dialog",{staticClass:"cloud-tipDialog",attrs:{"append-to-body":"",title:t.lang.imageManage.tip,visible:t.unloadDialogVisible,width:"35%"},on:{"update:visible":function(e){t.unloadDialogVisible=e}}},[t._v("\n        "+t._s(t.lang.resource.unloadTransparentDevice)+"\n        "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.unloadDialogVisible=!1}}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.unload}},[t._v(t._s(t.lang.common.confirm))])],1)])],1)},staticRenderFns:[]};var Y=o("C7Lr")(J,K,!1,function(t){o("Igq9")},"data-v-97656cf8",null).exports,X={props:{show:Boolean,components:Array,gpuInfo:Object},data:function(){return{data:[],hasError:!1,gpuNumOrigin:{},gpuNum:{},migratedNode:{}}},methods:{initForm:function(){var t=this.gpuInfo,e=this;for(var o in this.$refs.form&&this.$refs.form.resetFields(),t){if(t.hasOwnProperty(o))t[o].length>0?this.gpuNumOrigin[o]=t[o].length:delete t[o]}this.components.forEach(function(t){var o=t.hostName;e.gpuNumOrigin.hasOwnProperty(o)&&e.gpuNumOrigin[o]>0?(t.noGpu=!1,e.gpuNumOrigin[o]--):t.noGpu=!0}),c()(this.gpuNum,this.gpuNumOrigin),this.data=this.components},migratedNodeChange:function(){for(var t in c()(this.gpuNum,this.gpuNumOrigin),this.migratedNode)if(this.migratedNode.hasOwnProperty(t)){var e=this.migratedNode[t];this.gpuNum.hasOwnProperty(e)&&this.gpuNum[e]>0&&this.gpuNum[e]--}},confirm:function(){var t=this,e=[],o="",a={},s=[];if(t.hasError=!1,t.data.some(function(e){if(e.noGpu&&!t.migratedNode.hasOwnProperty(e.name))return t.hasError=!0,!0}),t.hasError)return!1;t.data.forEach(function(i){o=i.noGpu?t.migratedNode[i.name]:i.hostName,(s=t.gpuInfo[o]).length>0&&(a=s[0],s.shift()),a.host=o+".node.consul",a.serverId=i.uid,a.serverName=i.name,a.migrate=i.noGpu,e.push(a)}),t.closeModal(),this.checkError(this.$http({url:this.api.cloud.gpu_load,method:"POST",data:{meta:e}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.gpuManage.loadingGpu}),t.wsEventQueue.push(a.gpuId+a.serverId),t.$emit("getList")},function(){t.$emit("getList")})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}}},tt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{id:"mount-gpu",title:t.lang.resource.mountGpu,visible:t.show,modal:!0,top:"8vh",width:"40%"},on:{open:t.initForm,close:t.closeModal}},[o("el-form",{ref:"form",attrs:{"label-width":"85px"}},[o("el-form-item",{attrs:{label:t.lang.resource.availGpu+":"}},t._l(t.gpuInfo,function(e,a){return e.length>0?o("span",{key:a,staticClass:"gpu-node"},[t._v("\n                "+t._s(a)+": "),o("span",{staticClass:"gpu-number cloud-color-blue"},[t._v(t._s(e.length))]),t._v("个\n            ")]):t._e()}),0),t._v(" "),o("el-table",{staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:t.data,"highlight-current-row":""}},[o("el-table-column",{attrs:{prop:"name",label:t.lang.resource.componentName},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{class:{"cloud-color-red":e.row.noGpu}},[t._v(t._s(e.row.name))])]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"hostName",label:t.lang.resource.physicalHost},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{class:{"cloud-color-red":e.row.noGpu}},[t._v(t._s(e.row.hostName))]),t._v(" "),e.row.noGpu?o("el-select",{key:e.row.uid,staticClass:"migrated-node",attrs:{filterable:"",placeholder:t.lang.resource.migrateNode},on:{change:t.migratedNodeChange},model:{value:t.migratedNode[e.row.name],callback:function(o){t.$set(t.migratedNode,e.row.name,o)},expression:"migratedNode[scope.row.name]"}},t._l(t.gpuInfo,function(e,a){return t.gpuNum[a]>0?o("el-option",{key:a,attrs:{label:a,value:a}}):t._e()}),1):t._e(),t._v(" "),t.hasError&&e.row.noGpu&&!t.migratedNode.hasOwnProperty(e.row.name)?o("span",{staticClass:"migrated-node-error"},[t._v(t._s(t.lang.common.required_item))]):t._e()]}}])})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.resource.confirmMount))])],1)],1)},staticRenderFns:[]};var et=o("C7Lr")(X,tt,!1,function(t){o("W4IG"),o("jTl5")},"data-v-6b964b0f",null).exports,ot={props:{show:Boolean,server_id:String,abnormalRestart:Boolean},data:function(){return{form:{start:!1}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.form.start=this.abnormalRestart},confirm:function(){var t=this;t.closeModal(!0);var e=this.common.formatGetUrl({action:this.form.start}),o=this.common.formatMsg(this.api.cloud.poolserver_abnormalrestart,{server_id:this.server_id});this.checkError(this.$http({url:o+e,method:"post"}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.virtualExceptionSuccess})},function(e){t.$emit("setLoading")})},closeModal:function(t){t=t||!1,this.$emit("closeModal",t)}}},at={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.componentExceptionManage,visible:t.show,modal:!0,top:"8vh",width:"25%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"120px"}},[o("el-form-item",{attrs:{label:t.lang.resource.componentExceptionReboot}},[o("el-switch",{model:{value:t.form.start,callback:function(e){t.$set(t.form,"start",e)},expression:"form.start"}})],1),t._v(" "),o("p",{staticClass:"description"},[t._v("\n            "+t._s(t.lang.resource.componentExceptionDesc1)+"\n        ")]),t._v(" "),o("p",{staticClass:"description"},[t._v("\n            "+t._s(t.lang.resource.componentExceptionDesc2)+"\n        ")])],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.form.start===t.abnormalRestart},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var st=o("C7Lr")(ot,at,!1,function(t){o("t/+v")},"data-v-4c25474e",null).exports,it={props:{show:Boolean,server_id:String,server_name:String},data:function(){return{bootMenus:[],selectedBoot:!1,loading:!1}},methods:{initForm:function(){this.selectedBoot=!1,this.getBootMenu()},getBootMenu:function(){var t=this,e=this.common.formatMsg(this.api.cloud.poolserver_boot_menu,{server_id:this.server_id});this.loading=!0,this.checkError(this.$http({url:e,method:"get"}),function(e){var o=e.data.bootMenus;t.bootMenus=o.filter(function(t){return"fd"!==t.dev}),t.loading=!1},function(){t.loading=!1})},confirm:function(){var t=this,e=[];this.bootMenus.forEach(function(t){e.push(t.dev)}),e.push("fd");var o=this.common.formatGetUrl({bootMenu:e});o=o+"&serverName="+this.server_name;var a=this.common.formatMsg(this.api.cloud.poolserver_boot_menu,{server_id:this.server_id});this.closeModal(),this.checkError(this.$http({url:a+o,method:"put"}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.bootSequenceSuccess})})},moveUp:function(){if(this.selectedBoot){var t=this,e=0;if(this.bootMenus.some(function(o,a){return e=a,o.dev===t.selectedBoot}),e>0){var o=this.bootMenus[e-1],a=this.bootMenus[e];this.bootMenus.splice(e-1,1,a),this.bootMenus[e]=o}}},moveDown:function(){if(this.selectedBoot){var t=this,e=0;if(this.bootMenus.some(function(o,a){return e=a,o.dev===t.selectedBoot}),e<this.bootMenus.length-1){var o=this.bootMenus[e+1],a=this.bootMenus[e];this.bootMenus.splice(e+1,1,a),this.bootMenus[e]=o}}},moveTop:function(){if(this.selectedBoot){var t=this,e=0;if(this.bootMenus.some(function(o,a){return e=a,o.dev===t.selectedBoot}),e>0){var o=this.bootMenus[e];this.bootMenus.splice(e,1),this.bootMenus.unshift(o)}}},moveEnd:function(){if(this.selectedBoot){var t=this,e=0;if(this.bootMenus.some(function(o,a){return e=a,o.dev===t.selectedBoot}),e<this.bootMenus.length-1){var o=this.bootMenus[e];this.bootMenus.splice(e,1),this.bootMenus.push(o)}}},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}}},nt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.bootSequenceManagement,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"120px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("div",{staticClass:"button-div"},[o("el-button",{attrs:{plain:"",icon:"el-icon-arrow-up"},on:{click:t.moveUp}},[t._v(t._s(t.lang.resource.moveUp))]),t._v(" "),o("el-button",{attrs:{plain:"",icon:"el-icon-arrow-down"},on:{click:t.moveDown}},[t._v(t._s(t.lang.resource.moveDown))]),t._v(" "),o("el-button",{attrs:{plain:"",icon:"el-icon-upload2"},on:{click:t.moveTop}},[t._v(t._s(t.lang.resource.moveTop))]),t._v(" "),o("el-button",{attrs:{plain:"",icon:"el-icon-download"},on:{click:t.moveEnd}},[t._v(t._s(t.lang.resource.moveEnd))])],1),t._v(" "),o("div",{staticClass:"boot-div"},t._l(t.bootMenus,function(e,a){return o("div",{key:a},[o("el-radio",{attrs:{label:e.dev},model:{value:t.selectedBoot,callback:function(e){t.selectedBoot=e},expression:"selectedBoot"}},[t._v("\n                    "+t._s(t.lang.resource.bootArray[e.dev])+"\n                ")])],1)}),0)]),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var rt=o("C7Lr")(it,nt,!1,function(t){o("daod")},"data-v-63ebe013",null).exports,lt={props:{timerLocal:"",show:Boolean,server_id:String,currentUsageData:Object},data:function(){return{current_memory:"",form:{vcpu_max:"",ram_max:""}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields()},confirm:function(){var t=!0;if(this.$refs.form.validate(function(e){e||(t=!1)}),!t)return!1;this.closeModal();var e=this.common.formatMsg(this.api.cloud.post_pool_servers_detail_action,{server_id:this.server_id});this.form.ram_max=1024*this.form.ram_max,this.wsEventQueue.push(this.server_id),this.checkError(this.$http({url:e,method:"post",data:{liveResize:this.form}}),function(t){})},getStatus:function(t){var e=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t});this.checkError(this.$http({url:o,method:"get"}),function(t){"ACTIVE"===t.data.status&&(e.$emit("getList"),clearInterval(e.timerLocal))})},closeModal:function(t){t=t||!1,this.$emit("closeModal",t)}},computed:{currentConfigurationData:function(){var t=this.currentUsageData.current_cpus;return this.current_memory=this.common.switchCapacity(this.currentUsageData.current_mem_mb,"MB","GB",1),this.common.formatMsg(this.lang.resource.currentConfigurationData,{cpu:t,memory:this.current_memory})},maximum_mem_gb:function(){return this.common.switchCapacity(this.currentUsageData.maximum_mem_mb,"MB","GB",1)},equalCurrentConf:function(){return this.form.ram_max===this.current_memory&&this.form.vcpu_max===this.currentUsageData.current_cpus}}},ct={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.hotUpgrade,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"120px"}},[o("el-form-item",{attrs:{label:t.lang.resource.currentConfiguration}},[o("span",[t._v(t._s(t.currentConfigurationData))])]),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.cpu,prop:"vcpu_max",rules:[{type:"integer",min:this.currentUsageData.current_cpus,max:this.currentUsageData.maximum_cpus,message:this.common.formatMsg(this.lang.resource.validHotGradeCpu,{min:this.currentUsageData.current_cpus,max:this.currentUsageData.maximum_cpus}),trigger:"change"}]}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number"},nativeOn:{mousewheel:function(t){t.preventDefault()}},model:{value:t.form.vcpu_max,callback:function(e){t.$set(t.form,"vcpu_max",t._n(e))},expression:"form.vcpu_max"}})],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.memory,prop:"ram_max",rules:[{type:"integer",min:this.current_memory,max:this.maximum_mem_gb,message:this.common.formatMsg(this.lang.resource.validHotGradeRam,{min:this.current_memory,max:this.maximum_mem_gb}),trigger:"change"}]}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number"},nativeOn:{mousewheel:function(t){t.preventDefault()}},model:{value:t.form.ram_max,callback:function(e){t.$set(t.form,"ram_max",t._n(e))},expression:"form.ram_max"}}),t._v(" "),t.equalCurrentConf?o("span",{staticClass:"el-form-item__error"},[t._v(t._s(t.lang.resource.moreThanCurrentConf))]):t._e()],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{disabled:t.equalCurrentConf,type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var ut=o("C7Lr")(lt,ct,!1,function(t){o("3JmR")},"data-v-08e4498d",null).exports,dt={props:{show:Boolean},methods:{closeModal:function(t){t=t||!1,this.$emit("closeModal",t)}}},mt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.common.info,visible:t.show,width:"30%",modal:!0},on:{close:t.closeModal}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{staticStyle:{"text-align":"center"}},[t._v(t._s(t.lang.resource.notRebuildInfo))])],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.close))])],1)],1)},staticRenderFns:[]},pt=o("C7Lr")(dt,mt,!1,null,null,null).exports,ht={props:{server_id:String,availabilityZone:String,hostName:String,show:Boolean},data:function(){return{timerLocal:"",loading:!1,availabilityZoneData:[],hosts:[],form:{host:""},rules:{host:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]}}},mounted:function(){var t=this;this.$ws.setCallback(function(e){if(-1!==t.wsEventQueue.indexOf(e.resource_id)){var o=e.event_type.split(".");"compute"===o[0]&&"end"===o[4]&&t.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getAvailabilityZone()},getAvailabilityZone:function(){var t=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_os_availability_zone,method:"get"}),function(e){t.availabilityZoneData=e.data,t.getHosts(),t.loading=!1},function(){t.loading=!1})},getHosts:function(){var t,e=this;(t=this.availabilityZoneData.filter(function(t){return t.zoneName===e.availabilityZone})).length>0&&(e.hosts=s()(t[0].hosts).filter(function(t){return t!==e.hostName}),e.hosts.length>0&&(e.form.host=e.hosts[0]))},getStatus:function(t){var e=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t});this.$http({url:o,method:"get"}).then(function(t){200303!==t.data.code&&"ACTIVE"!==t.data.data.status&&"ERROR"!==t.data.data.status||(e.$emit("getList"),clearInterval(e.timerLocal))})},confirm:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;var o=t,a=o.common.formatMsg(o.api.cloud.post_pool_servers_detail_action,{server_id:o.server_id}),s={"os-migrateLive":{block_migration:!1,disk_over_commit:!1,host:o.form.host}},i=o.server_id;o.form.host;o.closeModal(),o.wsEventQueue.push(i),t.checkError(t.$http({url:a,data:s,method:"post"}),function(t){})})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}}},gt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.hotMigrate,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.targetNode,prop:"host"}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.host,callback:function(e){t.$set(t.form,"host",e)},expression:"form.host"}},t._l(t.hosts,function(t,e){return o("el-option",{key:e,attrs:{label:t,value:t}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var ft=o("C7Lr")(ht,gt,!1,function(t){o("UIiB")},"data-v-40ff3c72",null).exports,vt={props:{server_id:String,server:Object,show:Boolean},data:function(){return{label:"",loading:!1,timerLocal:"",form:{migrateMode:"",node:""},hypervisors:[],pageNum:1,pageSize:10,rules:{migrateMode:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]}}},mounted:function(){var t=this;this.$ws.setCallback(function(e){if(-1!==t.wsEventQueue.indexOf(e.resource_id)){var o=e.event_type.split(".");"compute"===o[0]&&"finish_resize"===o[2]&&"end"===o[3]&&t.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getHypervisors()},getHypervisors:function(){var t=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_os_hypervisors,method:"get"}),function(e){t.hypervisors=e.data,t.loading=!1},function(){t.loading=!1})},migrateModeChange:function(){1===this.form.migrateMode&&this.hostsData.length>0&&(this.form.node=this.hostsData[0].name)},pageSelect:function(t){this.pageNum=t},getStatus:function(t){var e=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t});this.$http({url:o,method:"get"}).then(function(t){200303!==t.data.code&&"SHUTOFF"!==t.data.data.status&&"ERROR"!==t.data.data.status||(e.$emit("getList"),clearInterval(e.timerLocal))})},confirm:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;var o=t,a=o.server_id,s=o.common.formatMsg(o.api.cloud.post_pool_servers_detail_action,{server_id:o.server_id}),i={};i=0===o.form.migrateMode?{migrate:null}:{migrate:{host:o.form.node}},o.closeModal(),o.wsEventQueue.push(a),t.checkError(t.$http({url:s,data:i,method:"post"}),function(t){})})},closeModal:function(t){c()(this.$data,this.$options.data.call(this)),t=t||!1,this.$emit("closeModal",t)}},computed:{hostsData:function(){var t=this.server;return this.hypervisors.map(function(t){t.name=t.hypervisor_hostname.split(".")[0],t.freeCpu=4*t.vcpus-t.vcpus_used,t.freeRam=parseInt(t.free_ram_mb/1024)}),this.hypervisors.filter(function(e){return e.name!=t.hostName&&t.vcpus<e.freeCpu&&t.ram/1024<e.freeRam&&"up"==e.state&&"enabled"==e.status})},pagedData:function(){return this.hostsData.length<=this.pageSize?this.hostsData:this.common.pagination(this.hostsData,this.pageSize,this.pageNum)}}},_t={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.coldMigrate,visible:t.show,modal:!0,top:"8vh",width:"25%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"100px",rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.migrateMode,prop:"migrateMode"}},[o("el-select",{attrs:{filterable:""},on:{change:t.migrateModeChange},model:{value:t.form.migrateMode,callback:function(e){t.$set(t.form,"migrateMode",e)},expression:"form.migrateMode"}},t._l(t.lang.resource.migrateModeValue,function(t,e){return o("el-option",{key:e,attrs:{label:t,value:e}})}),1)],1),t._v(" "),1===t.form.migrateMode?o("el-table",{ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:t.pagedData,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-radio",{attrs:{label:e.row.name},model:{value:t.form.node,callback:function(e){t.$set(t.form,"node",e)},expression:"form.node"}},[t._v(t._s(t.label))])]}}],null,!1,2196103380)}),t._v(" "),o("el-table-column",{attrs:{prop:"name",label:t.lang.common.name}}),t._v(" "),o("el-table-column",{attrs:{prop:"freeCpu",label:t.lang.resource.freeCpu}}),t._v(" "),o("el-table-column",{attrs:{prop:"freeRam",label:t.lang.resource.freeMemoryGB}})],1):t._e(),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.hostsData.length>t.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.hostsData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:1===t.form.migrateMode&&""===t.form.node},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var bt=o("C7Lr")(vt,_t,!1,function(t){o("ZP0S")},"data-v-04bce6df",null).exports,kt={name:"resetPassword",props:{show:Boolean,serverId:String},data:function(){return{form:{password:"",confirmPassword:""},rules:{password:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validatePassword,trigger:"blur"}]}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields()},closeModal:function(){c()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")},updatePassword:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.checkError(t.$http({url:t.common.formatMsg(t.api.cloud.post_pool_servers_detail_action,{server_id:t.serverId}),method:"post",data:{changePassword:{adminPass:t.form.password}}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.updatePasswordSuccess}),t.closeModal()})})},validateConfirmPass:function(t,e,o){e!==this.form.password?o(new Error(self.lang.resource.passwordNotConsistent)):o()}}},wt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{id:"updatePassword",title:t.lang.resource.updatePassword,visible:t.show,top:"8vh",width:"35%"},on:{open:t.initForm,close:t.closeModal}},[o("el-form",{ref:"form",staticClass:"fixPassWordValWid",attrs:{model:t.form,"label-width":"150px",rules:t.rules}},[o("el-form-item",{attrs:{label:t.lang.common.password,prop:"password"}},[o("el-input",{attrs:{type:"password",placeholder:t.lang.imageManage.passwordPlaceholder},model:{value:t.form.password,callback:function(e){t.$set(t.form,"password",e)},expression:"form.password"}})],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.common.confirmPassword,prop:"confirmPassword",rules:[{required:!0,message:t.lang.common.required_item,trigger:"blur"},{validator:t.validateConfirmPass,trigger:"blur"}]}},[o("el-input",{attrs:{type:"password",placeholder:t.lang.imageManage.confirmPasswordPlaceholder},model:{value:t.form.confirmPassword,callback:function(e){t.$set(t.form,"confirmPassword",e)},expression:"form.confirmPassword"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.updatePasswordDialogVisible=!1}}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updatePassword("form")}}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var yt=o("C7Lr")(kt,wt,!1,function(t){o("1Mr8")},"data-v-3c58182b",null).exports,St={name:"setName",props:{show:Boolean,vmName:String,serverId:String},data:function(){return{form:{name:""},rules:{name:[{required:!0,message:"请输入组件名称",trigger:"blur"},{min:1,max:64,message:"长度为1-64个字符",trigger:"blur"},{validator:this.common.validateName2,trigger:"blur"}]}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.form.name=this.vmName},closeModal:function(t){t=t||!1,c()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",t)},updateName:function(){var t=this,e=this;this.$refs.form.validate(function(o){if(!o)return!1;t.checkError(t.$http({url:t.common.formatMsg(e.api.cloud.put_pool_servers,{server_id:e.serverId}),method:"put",data:{name:e.form.name}}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.editComponentNameSuccess}),e.closeModal(!0)})})}}},Dt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.updateComponentName,visible:t.show,top:"8vh",width:"35%"},on:{open:t.initForm,close:t.closeModal}},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"150px",rules:t.rules}},[o("el-form-item",{attrs:{label:t.lang.resource.cloudComponentName,prop:"name"}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.updateName("form")}}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var Ct=o("C7Lr")(St,Dt,!1,function(t){o("iPXr")},"data-v-cf987e22",null).exports,It=o("Kk6J"),Mt=o("09sb"),xt=o("oIPs"),$t=o("zLDf"),Ot={props:["poolId","currentPool"],components:{panaBreadcrumb:r.a,detail:m,cloudTipDialog:p.a,cloudAddNetwork:k,cloudRemoveNetwork:S,cloudUpdatePrivateIp:I,cloudBindPublicIp:M.a,cloudUnbindPublicIp:x.a,cloudUpdateMac:P,cloudNicSecurityConfig:N,cloudMakeImage:F,cloudDiscManagement:G,cloudAjustConfiguration:j,cloudTransparentEquipment:Y,cloudMountGpu:et,cloudComponentException:st,cloudHotMigrate:ft,cloudColdMigrate:bt,cloudBootSequence:rt,cloudHotUpgrade:ut,cloudNotRebuild:pt,cloudResetPassword:yt,cloudUpdateName:Ct,loadCloudDisk:It.a,unloadCloudDisk:Mt.a,cloudSnapshot:xt.a,cloudSnapshotRollback:$t.a},data:function(){return{sortOrder:0,sortProp:"",gpuListLoading:!1,gpuQuota:"",showNotRebuild:!1,timerArray:[],gpuInfo:{},showLoadCloudDisk:!1,showUnloadCloudDisk:!1,showSnapshot:!1,showSnapshotRollback:!1,showDeleteSystemConfirm:!1,deleteSystemDisk:!0,operation_only_sysytem_admin:["hotMigrate"],confirm_warning:!1,confirm_text_left:!1,showAddNetwork:!1,showRemoveNetwork:!1,showUpdatePrivateIp:!1,showBindPublicIp:!1,showUnbindPublicIp:!1,showUpdateMac:!1,showReleasePublicIp:!1,showNicSecurityConfig:!1,showTooltip:!1,showMakeImage:!1,showDiscManagement:!1,showTransparentEquipment:!1,showMountGpu:!1,showComponentException:!1,showBootSequence:!1,showHotUpgrade:!1,showHotMigrate:!1,showColdMigrate:!1,loading:!0,tipDialogMsg:"",dialogVisible:!1,actionData:{},updatePasswordDialogVisible:!1,resizeDialogVisible:!1,id:"",detailDialogVisible:!1,diskOperateValue:"",diskOperation:[{value:"loadCloudDisk",label:this.lang.resource.loadCloudDisk},{value:"unloadCloudDisk",label:this.lang.resource.uninstallCloudDisk},{value:"snapshot",label:this.lang.resource.snapshot},{value:"snapshotRollback",label:this.lang.resource.snapshotRollback}],networkOperateValue:"",networkOperateOptions:[{value:"addPort",label:this.lang.resource.addNetCard},{value:"removePort",label:this.lang.resource.removeNetCard},{value:"updatePrivateIp",label:this.lang.resource.updatePrivateIp},{value:"bindPublicIp",label:this.lang.resource.bindPublicIp},{value:"unbindPublicIp",label:this.lang.resource.releasePublicIp},{value:"updateMac",label:this.lang.resource.updateMac},{value:"nicSecurityConfig",label:this.lang.resource.nicSecurityConfig}],moreOperateValue:"",operate:"",moreOperation1:[{value:"reboot",label:this.lang.resource.reboot},{value:"delete",label:this.lang.common.delete},{value:"updateName",label:this.lang.resource.updateComponentName},{value:"makeImage",label:this.lang.resource.makeImage},{value:"suspend",label:this.lang.resource.hang},{value:"resume",label:this.lang.resource.restoreHang},{value:"pause",label:this.lang.resource.pause},{value:"unpause",label:this.lang.resource.restorePause},{value:"reset",label:this.lang.resource.reset},{value:"oneClickRecovery",label:this.lang.resource.oneClickRecovery},{value:"forceShutdown",label:this.lang.resource.forceShutdown}],moreOperation2:[{value:"hotMigrate",label:this.lang.resource.hotMigrate},{value:"coldMigrate",label:this.lang.resource.coldMigrate},{value:"hotUpgrade",label:this.lang.resource.hotUpgrade},{value:"updatePassword",label:this.lang.resource.updatePassword},{value:"resize",label:this.lang.resource.adjustConfiguration},{value:"discManagement",label:this.lang.resource.discManagement},{value:"mountGpu",label:this.lang.resource.mountGpu},{value:"unmountGpu",label:this.lang.resource.unmountGpu},{value:"transparentEquipment",label:this.lang.resource.transparentEquipment},{value:"bootSequence",label:this.lang.resource.bootSequenceManagement},{value:"componentException",label:this.lang.resource.componentExceptionManage}],tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,updateNameDialogVisible:!1,poolPage:1,componentDetailData:{},currentUsageData:{},gpuList:[],storageServerId:null}},mounted:function(){var t=this;this.loading=!0,this.tableData=[],JSON.parse(sessionStorage.getItem("panaPools")).map(function(e){parseInt(e.id)===parseInt(t.poolId)&&(t.storageServerId=e.stor_server_id)}),this.Hub.$off("getComponentList").$on("getComponentList",function(){t.getList()}),this.$ws.setCallback(function(e){if(-1!==t.wsEventQueue.indexOf(e.resource_id)){var o=e.event_type.split(".");"floatingip"===o[0]&&"end"===o[2]&&(t.tableData.map(function(t){null===e.payload.floatingip.fixed_ip_address?-1!==t.floatingIps.indexOf(e.payload.floatingip.floating_ip_address)&&(t.floatingIps=[]):-1!==t.fixedIps.indexOf(e.payload.floatingip.fixed_ip_address)&&(t.floatingIps=[],t.floatingIps.push(e.payload.floatingip.floating_ip_address))}),t.$refs.multipleTable.clearSelection()),"compute"!==o[0]||"instance"!==o[1]||"end"!==o[3]&&"error"!==o[3]||t.getList(),"compute"!==o[0]||"instance"!==o[1]||"end"!==o[4]&&"error"!==o[4]||t.getList(),"instance"===o[0].split("_")[1]&&t.getList(),"volume"===o[0]&&"end"===o[2]&&t.getList(),"udsafe"===o[0]&&"gpu"===o[2]&&"end"===o[4]&&t.getList(),"port"===o[0]&&"delete"===o[1]&&"end"===o[2]&&t.getList()}}),t.getList(),this.setCurrentPool(),this.common.is_system_admin()||this.common.permissionManage(t,t.poolId,function(){t.moreOperation2=t.moreOperation2.filter(function(t){return"hotMigrate"!==t.value&&"coldMigrate"!==t.value&&"transparentEquipment"!==t.value}),t.moreOperation1=t.moreOperation1.filter(function(t){return"reset"!==t.value})})},methods:{sort:function(t){var e=null==t.order?0:"ascending"===t.order?1:-1;this.sortProp=t.prop,this.sortOrder=e,this.tableData=this.tableData.sort(function(e,o){return e[t.prop]=null==e[t.prop]?"":e[t.prop],o[t.prop]=null==o[t.prop]?"":o[t.prop],e[t.prop]==o[t.prop]?o.createtime-e.createtime:(e[t.prop]>o[t.prop]?1:-1)*self.sortOrder})},setCurrentPool:function(){var t=this;JSON.parse(sessionStorage.getItem("panaPools")).filter(function(e){if(e.id===t.poolId)return sessionStorage.setItem("panaCurrentPool",n()(e)),!0})},moreOperateTooltip:function(t){return this.moreOperateDisabled(t)&&this.lang.resource.componentMoreOperateTooltip.hasOwnProperty(t)},netOperateTooltip:function(t){return this.netOperateDisabled(t)&&t in this.lang.resource.componentNetOperateTooltip},diskOperateTooltip:function(t){return this.diskOperateDisabled(t)&&t in this.lang.resource.diskOperateTooltip},selectedServerId:function(){if(this.multipleSelection[0])return this.multipleSelection[0].uid},closeAddNetwork:function(t){!0===t&&this.getList(),this.showAddNetwork=!1},closeRemoveNetwork:function(t){!0===t&&this.getList(),this.showRemoveNetwork=!1},closeUpdatePrivateIp:function(t){!0===t&&this.getList(),this.showUpdatePrivateIp=!1},closeUpdateMac:function(t){!0===t&&this.getList(),this.showUpdateMac=!1},closeNicSecurityConfig:function(t){!0===t&&this.getList(),this.showNicSecurityConfig=!1},closeMakeImage:function(t){!0===t&&this.getList(),this.showMakeImage=!1},closeTransparentEquipment:function(t){t&&this.getList(),this.showTransparentEquipment=!1},closeMountGpu:function(t){t&&this.getList(),this.showMountGpu=!1},closeComponentException:function(t){!0===t&&(this.loading=!0,this.multipleSelection=[]),this.showComponentException=!1},closeBootSequence:function(t){!0===t&&this.getList(),this.showBootSequence=!1},closeHotUpgrade:function(t){!0===t&&this.getList(),this.showHotUpgrade=!1},closeHotMigrate:function(t){!0===t&&this.getList(),this.showHotMigrate=!1},closeColdMigrate:function(t){!0===t&&this.getList(),this.showColdMigrate=!1},diskOperateDisabled:function(t){if(this.selectNotOne||this.rebuildStatus||this.errorStatus||this.isPoweringOff||this.isPoweringOn||this.isCreating)return!0;switch(t){case"loadCloudDisk":return this.multipleSelection.some(function(t){return"ACTIVE"!==t.status&&"SHUTOFF"!==t.status});case"unloadCloudDisk":if(!this.componentDetailData.hasOwnProperty("diskInfo"))return!0;if(1===this.componentDetailData.diskInfo.length)return!0;break;case"snapshotRollback":if("SHUTOFF"!==this.multipleSelection[0].status)return this.lang.resource.diskOperateTooltip.snapshotRollback=this.lang.resource.snapshotRollbackInfo[0],!0;if(!this.componentDetailData.hasOwnProperty("diskId"))return this.lang.resource.diskOperateTooltip.snapshotRollback=this.lang.resource.snapshotRollbackInfo[1],!0}},netOperateDisabled:function(t){if(this.selectNotOne||this.rebuildStatus||this.errorStatus||this.isPoweringOff||this.isPoweringOn||this.isCreating)return!0;switch(t){case"addPort":return this.multipleSelection.some(function(t){return t.fixedIps.length>=8});case"removePort":return this.multipleSelection.some(function(t){return t.fixedIps.length<=1});case"updateMac":return this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status});case"nicSecurityConfig":return this.multipleSelection.some(function(t){return"ACTIVE"!==t.status});case"bindPublicIp":return this.multipleSelection.some(function(t){return t.floatingIps.length>0});case"unbindPublicIp":return this.multipleSelection.some(function(t){return 0===t.floatingIps.length})}},moreOperateDisabled:function(t){var e=this;if(this.isCreating||"delete"!==t&&(this.isPoweringOff||this.isPoweringOn))return!0;switch(t){case"reboot":return!!this.notSelect||this.someNotActive;case"delete":if(this.notSelect)return!0;break;case"updateName":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"ACTIVE"!==t.status&&"SHUTOFF"!==t.status&&"PAUSED"!==t.status&&"SUSPENDED"!==t.status});case"suspend":case"pause":return!!this.notSelect||this.someNotActive;case"resume":return!!this.notSelect||this.multipleSelection.some(function(t){return"SUSPENDED"!==t.status});case"unpause":return!!this.notSelect||this.multipleSelection.some(function(t){return"PAUSED"!==t.status});case"resize":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status||t.passthroughDevices.length>0});case"updatePassword":return!!this.selectNotOne||this.someNotActive;case"discManagement":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status});case"transparentEquipment":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"ACTIVE"!==t.status&&"SHUTOFF"!==t.status});case"mountGpu":return this.mountGpu();case"unmountGpu":return delete this.lang.resource.componentMoreOperateTooltip.unmountGpu,!!this.selectNotOne||this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status?(e.lang.resource.componentMoreOperateTooltip.unmountGpu=e.lang.resource.unmountGpuInfo.wrongStatus,!0):"load"!==t.gpu_status});case"componentException":case"bootSequence":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status});case"hotMigrate":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"ACTIVE"!==t.status||t.passthroughDevices.length>0});case"coldMigrate":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status||t.passthroughDevices.length>0});case"hotUpgrade":return!(!this.selectNotOne&&!this.rebuildStatus)||(!("qga_support"in this.currentUsageData)||!this.currentUsageData.qga_support);case"revertResize":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"VERIFY_RESIZE"!==t.status});case"reset":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"ERROR"!==t.status});case"oneClickRecovery":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"ACTIVE"!==t.status&&"SHUTOFF"!==t.status});case"forceShutdown":return!!this.selectNotOne||this.multipleSelection.some(function(t){return"ERROR"!==t.status||(!t.hostName||void 0)});case"makeImage":if(this.selectNotOne||this.rebuildStatus||this.errorStatus)return!0}},open_vnc:function(){var t=this.multipleSelection[0].uid,e=this.common.formatMsg(this.api.cloud.post_pool_servers_detail_remote_console,{server_id:t}),o="",a=window.open("",t,"toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1200 height=900 left=200 top=50");this.checkError(this.$http({url:e,method:"post"}),function(t){o=t.data.console.url,a.location=o})},start:function(){this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_start,this.operate="os-start"},shutoff:function(){this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_shutoff,this.operate="os-stop"},netOperationChange:function(){switch(this.networkOperateValue){case"addPort":this.showAddNetwork=!0,this.networkOperateValue="";break;case"removePort":this.showRemoveNetwork=!0,this.networkOperateValue="";break;case"updatePrivateIp":this.showUpdatePrivateIp=!0,this.networkOperateValue="";break;case"bindPublicIp":this.showBindPublicIp=!0,this.networkOperateValue="";break;case"unbindPublicIp":this.showUnbindPublicIp=!0,this.networkOperateValue="";break;case"updateMac":this.showUpdateMac=!0,this.networkOperateValue="";break;case"releasePublicIp":this.showReleasePublicIp=!0,this.networkOperateValue="";break;case"nicSecurityConfig":this.showNicSecurityConfig=!0,this.networkOperateValue=""}},moreOperationChange:function(){switch(this.confirm_warning=!1,this.confirm_text_left=!1,this.moreOperateValue){case"updatePassword":this.updatePasswordDialogVisible=!0,this.moreOperateValue="";break;case"updateName":this.updateNameDialogVisible=!0,this.moreOperateValue="";break;case"makeImage":this.showMakeImage=!0,this.moreOperateValue="";break;case"discManagement":this.showDiscManagement=!0,this.moreOperateValue="";break;case"transparentEquipment":this.showTransparentEquipment=!0,this.moreOperateValue="";break;case"mountGpu":this.showMountGpu=!0,this.moreOperateValue="";break;case"unmountGpu":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirmUnmountGpu,this.gpuListLoading=0===this.gpuList.length;break;case"componentException":this.showComponentException=!0,this.moreOperateValue="";break;case"bootSequence":this.showBootSequence=!0,this.moreOperateValue="";break;case"hotMigrate":this.showHotMigrate=!0,this.moreOperateValue="";break;case"coldMigrate":this.showColdMigrate=!0,this.moreOperateValue="";break;case"hotUpgrade":this.showHotUpgrade=!0,this.moreOperateValue="";break;case"reset":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_reset;break;case"oneClickRecovery":this.confirm_warning=!0,this.confirm_text_left=!0,this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_one_click_recovery;break;case"forceShutdown":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_force_shutdown;break;case"resize":this.resizeDialogVisible=!0,this.moreOperateValue="";break;case"addSecurityGroup":break;case"pause":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_pause;break;case"unpause":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_unpause;break;case"reboot":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_reboot;break;case"delete":this.dialogVisible=!0,this.showDeleteSystemConfirm=!0,this.deleteSystemDisk=!0,this.tipDialogMsg=this.lang.resource.confirm_delete;break;case"resume":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_resume;break;case"suspend":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_suspend;break;case"revertResize":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_revertResize}},getGpuList:function(){var t=this;this.checkError(this.$http({url:this.api.cloud.gpu_device_list,method:"get"}),function(e){t.gpuList=e.data,t.gpuListLoading=!1})},diskOperationChange:function(){switch(this.diskOperateValue){case"loadCloudDisk":this.showLoadCloudDisk=!0,this.diskOperateValue="";break;case"unloadCloudDisk":this.showUnloadCloudDisk=!0,this.diskOperateValue="";break;case"snapshot":this.showSnapshot=!0,this.diskOperateValue="";break;case"snapshotRollback":this.showSnapshotRollback=!0,this.diskOperateValue=""}},closeUpdateName:function(t){!0===t&&this.getList(),this.updateNameDialogVisible=!1},dialogCancel:function(){this.dialogVisible=!1,this.showDeleteSystemConfirm=!1,this.moreOperateValue="",this.gpuListLoading=!1},getSystemDiskSnapshots:function(){var t=this,e=[];t.componentDetailData.diskInfo.filter(function(t){if(t.is_sys_disk)return e.push(t.id),!0}),this.checkError(this.$http({url:this.api.storage.snapshotDetail,method:"POST",data:{volume_id:e}}),function(e){null===e.data?t.oneClickRecovery():t.showNotRebuild=!0})},oneClickRecovery:function(){var t=this;this.checkError(this.$http({url:t.common.formatMsg(t.api.cloud.get_pool_servers_detail,{server_id:t.selectedServerId()}),method:"get"}),function(e){var o=e.data.imageId;t.actionData={rebuild:{imageRef:o}},t.actionSubmit()})},dialogConfirm:function(){switch(this.moreOperateValue&&(this.operate=this.moreOperateValue),this.operate){case"pause":this.actionData={pause:null};break;case"reset":this.actionData={"os-resetState":{state:"active"}};break;case"oneClickRecovery":this.getSystemDiskSnapshots();break;case"forceShutdown":this.actionData={"os-forceStop":null};break;case"unpause":this.actionData={unpause:null};break;case"reboot":this.actionData={reboot:{type:-1===this.lang.resource.HARD_REBOOT.indexOf(this.multipleSelection[0].status)?"SOFT":"HARD"}};break;case"delete":this.deleteComponent();break;case"unmountGpu":this.unmountGpu();break;case"resume":this.actionData={resume:null};break;case"suspend":this.actionData={suspend:null};break;case"revertResize":this.actionData={revertResize:null};break;case"os-start":this.actionData={"os-start":null};break;case"os-stop":this.actionData={"os-stop":null}}this.dialogVisible=!1,"delete"!==this.moreOperateValue&&"oneClickRecovery"!==this.moreOperateValue&&"unmountGpu"!==this.moreOperateValue&&this.actionSubmit()},unmountGpu:function(){if(this.multipleSelection.length>0){var t=this.multipleSelection[0].uid,e=this,o={};this.gpuList.some(function(e){if(e.server_id===t)return o={bus:e.bus,function:e.function,gpuId:e.gpuId,server_id:e.server_id,slot:e.slot},!0}),this.checkError(this.$http({url:this.api.cloud.gpu_unload,method:"post",data:o}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.gpuManage.unloadGpuSuccess}),e.getList()})}},getList:function(){var t=this;t.loading=!0;var e=this.common.formatMsg(this.api.cloud.get_pools_detail_servers,{pool_id:t.poolId});this.checkError(this.$http({url:e,method:"get"}),function(e){t.loading=!1;var o=[];o=e.data.filter(function(e){return"fixedImageInstanceName"!==e.name&&e.uid!==t.storageServerId}),t.tableData=o.sort(function(t,e){return e.createtime-t.createtime})},function(){t.loading=!1,t.tableData=[]})},actionSubmit:function(){var t=this,e="",o=this.moreOperateValue||this.operate,a=[],s=["os-start","suspend","resume","os-stop","reboot","delete","unpause","pause","oneClickRecovery"],i="",n=t.multipleSelection.length;this.moreOperateValue="",t.multipleSelection.forEach(function(r,l){e=r.uid,a.push(e),i=t.common.formatMsg(t.api.cloud.post_pool_servers_detail_action,{server_id:e}),-1!==s.indexOf(o)&&t.wsEventQueue.push(e),t.checkError(t.$http({url:i,method:"post",data:t.actionData}),function(){l===n-1&&t.getList(),-1===s.indexOf(o)&&t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.operateSuccess})})}),-1!==["reboot","unpause","os-stop","pause","delete"].indexOf(o)&&t.setTimer(a,o)},setTimer:function(t,e){var o=this,a="",s={},i=(new Date).getTime();t.forEach(function(t){a=setInterval(function(){(new Date).getTime()-i<12e4?o.getStatus(t):clearInterval(a)},3e3),s[t]=a,s.operate=e,o.timerArray.push(s),o.timer.push(a)})},statusClass:function(t){switch(t){case"ACTIVE":return"cloud-success";case"ERROR":return"cloud-error";case"SUSPENDED":return"cloud-fault";case"SHUTOFF":return"cloud-info";case"PAUSED":case"RESIZE":case"REVERT_RESIZE":case"UNKNOWN":return"cloud-warning";default:return"cloud-default"}},showDetail:function(t){this.id=t,this.detailDialogVisible=!0},pageSelect:function(t){this.pageNum=t},handleSelectionChange:function(t){if(this.multipleSelection=t,0===this.multipleSelection.length?(this.gpuInfo={},this.gpuList=[]):(0===s()(this.gpuInfo).length&&this.getGpuAvail(),this.getGpuQuota()),1===this.multipleSelection.length){var e=this.multipleSelection[0].uid;this.getComponentDetail(e),this.current_usage(e),this.getGpuList()}else this.componentDetailData={},this.currentUsageData={}},getGpuQuota:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_gpu_pool_detail_check,{id:this.poolId});this.checkError(this.$http({url:e,method:"get"}),function(e){t.gpuQuota=e.data})},getComponentDetail:function(t){var e=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t});this.checkError(this.$http({url:o,method:"get"}),function(t){e.componentDetailData=t.data})},getStatus:function(t){var e=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t}),a=[],s={},i="";e.timerArray.filter(function(e){if(e.hasOwnProperty(t))return i=e.operate,s=e,!0}),this.$http({url:o,method:"get"}).then(function(o){switch(i){case"reboot":case"unpause":a=["ACTIVE","ERROR"];break;case"os-stop":a=["SHUTOFF","ERROR"];break;case"pause":a=["PAUSED","ERROR"];break;case"delete":a=["SOFT_DELETED","ERROR"]}200303!==parseInt(o.data.code)&&-1===a.indexOf(o.data.data.status)||(e.getList(),clearInterval(s[t]))})},current_usage:function(t){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.poolserver_current_usage,{server_id:t}),method:"get"}),function(t){e.currentUsageData=t.data})},getGpuAvail:function(){var t=this;this.checkError(this.$http({url:this.api.cloud.gpu_available_list,method:"get"}),function(e){t.gpuInfo=e.data.avalibal})},handleShowTooltip:function(t){var e=t.target.querySelector(".tooltip-div .ellipsis");this.showTooltip=!(e.scrollWidth===e.offsetWidth&&e.scrollHeight===e.offsetHeight)},createCompont:function(){this.$router.push({name:"createComponent",params:{poolId:this.poolId}})},mountGpu:function(){var t=this.gpuInfo,e=this.multipleSelection.some(function(t){return"preload"===t.gpu_status}),o=this.gpuQuota||0,a=0;if(!0===e)return this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.preloadStatus,!0;if(0===s()(t).length)return this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.noData,!0;for(var i in t)t.hasOwnProperty(i)&&(a+=t[i].length);return 0===a?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.noGpu,!0):this.multipleSelection.length>a?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.noEnoughGpu,!0):(e=this.multipleSelection.some(function(t){return null!=t.gpu_status&&"load"===t.gpu_status}))?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.loadStatus,!0):this.multipleSelection.length>o?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.notEnoughGpuQuota,!0):(e=this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status}))?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.wrongStatus,!0):void 0},deleteComponent:function(){var t=this,e=[];this.multipleSelection.forEach(function(o){t.wsEventQueue.push(o.uid),e.push(o.uid)}),this.checkError(this.$http({url:t.api.cloud.post_pool_servers_patch_delete,data:{ids:e,pool_id:this.poolId,flag:this.deleteSystemDisk},method:"post"}),function(t){})}},watch:{search:function(){this.pageNum=1}},computed:{notSelect:function(){return this.multipleSelection.length<=0},selectNotOne:function(){return 1!==this.multipleSelection.length},someNotActive:function(){return this.multipleSelection.some(function(t){return"ACTIVE"!==t.status})},rebuildStatus:function(){return this.multipleSelection.some(function(t){return"REBUILD"===t.status})},isPoweringOff:function(){return this.multipleSelection.some(function(t){return"powering-off"===t.task_state})},isPoweringOn:function(){return this.multipleSelection.some(function(t){return"powering-on"===t.task_state})},isCreating:function(){return this.multipleSelection.some(function(t){return"BUILD"===t.status})},errorStatus:function(){return this.multipleSelection.some(function(t){return"ERROR"===t.status})},startDisabled:function(){return!!(this.notSelect||this.isPoweringOff||this.isPoweringOn)||this.multipleSelection.some(function(t){return"SHUTOFF"!==t.status})},shutoffDisabled:function(){return!!(this.notSelect||this.isPoweringOff||this.isPoweringOn)||this.someNotActive},vncDisabled:function(){return!!(this.selectNotOne||this.isPoweringOff||this.isPoweringOn)||this.someNotActive},filterData:function(){var t=this,e=this.search,o=[];return o=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),o.sort(function(e,o){return e[t.sortProp]=null==e[t.sortProp]?"":e[t.sortProp],o[t.sortProp]=null==o[t.sortProp]?"":o[t.sortProp],e[t.sortProp]==o[t.sortProp]?o.createtime-e.createtime:(e[t.sortProp]>o[t.sortProp]?1:-1)*t.sortOrder})},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},destroyed:function(){this.common.clearTimer(this)}},Pt={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"component-list"}},[o("el-row",{staticClass:"cloud-btn-row",staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:20}},[o("el-tooltip",{attrs:{disabled:null!=t.currentPool.private_subnet_id&&""!==t.currentPool.private_subnet_id&&null!=t.currentPool.private_network_id&&""!==t.currentPool.private_network_id,content:t.lang.resource.noPoolSubnetInfo,placement:"top"}},[o("span",{staticStyle:{"margin-right":"10px"}},[o("el-button",{attrs:{disabled:null==t.currentPool.private_subnet_id||""===t.currentPool.private_subnet_id||null==t.currentPool.private_network_id||""===t.currentPool.private_network_id,type:"primary"},on:{click:function(e){return t.createCompont()}}},[t._v(t._s(t.lang.common.create))])],1)]),t._v(" "),o("el-button",{attrs:{disabled:t.startDisabled},on:{click:t.start}},[t._v(t._s(t.lang.resource.start))]),t._v(" "),o("el-button",{attrs:{disabled:t.shutoffDisabled},on:{click:t.shutoff}},[t._v(t._s(t.lang.resource.shutdown))]),t._v(" "),o("el-button",{attrs:{disabled:t.vncDisabled},on:{click:t.open_vnc}},[t._v(t._s(t.lang.common.console))]),t._v(" "),o("el-select",{staticClass:"more-operation",attrs:{disabled:t.notSelect,placeholder:t.lang.resource.netOperation,value:""},on:{change:t.netOperationChange},model:{value:t.networkOperateValue,callback:function(e){t.networkOperateValue=e},expression:"networkOperateValue"}},t._l(t.networkOperateOptions,function(e){return o("el-option",{key:e.value,attrs:{disabled:t.netOperateDisabled(e.value),value:e.value}},[t.netOperateTooltip(e.value)?o("div",[o("el-tooltip",{attrs:{content:t.lang.resource.componentNetOperateTooltip[e.value],placement:"left"}},[o("div",[t._v(t._s(e.label))])])],1):o("div",[o("div",[t._v(t._s(e.label))])])])}),1),t._v(" "),o("el-select",{staticClass:"more-operation",attrs:{disabled:t.notSelect,placeholder:t.lang.resource.diskOperation,value:""},on:{change:t.diskOperationChange},model:{value:t.diskOperateValue,callback:function(e){t.diskOperateValue=e},expression:"diskOperateValue"}},t._l(t.diskOperation,function(e){return o("el-option",{key:e.value,attrs:{disabled:t.diskOperateDisabled(e.value),value:e.value}},[t.diskOperateTooltip(e.value)?o("div",[o("el-tooltip",{attrs:{content:t.lang.resource.diskOperateTooltip[e.value],placement:"left"}},[o("div",[t._v(t._s(e.label))])])],1):o("div",[o("div",[t._v(t._s(e.label))])])])}),1),t._v(" "),o("el-select",{staticClass:"more-operation",attrs:{disabled:t.notSelect,placeholder:t.lang.common.moreOperation},on:{change:t.moreOperationChange},model:{value:t.moreOperateValue,callback:function(e){t.moreOperateValue=e},expression:"moreOperateValue"}},[o("el-row",[o("el-col",{attrs:{span:12}},t._l(t.moreOperation1,function(e){return o("el-option",{key:e.value,attrs:{disabled:t.moreOperateDisabled(e.value),value:e.value}},[t.moreOperateTooltip(e.value)?o("div",[o("el-tooltip",{attrs:{content:t.lang.resource.componentMoreOperateTooltip[e.value],placement:"left"}},[o("div",[t._v(t._s(e.label))])])],1):o("div",[o("div",[t._v(t._s(e.label))])])])}),1),t._v(" "),o("el-col",{attrs:{span:12}},t._l(t.moreOperation2,function(e){return o("el-option",{key:e.value,attrs:{disabled:t.moreOperateDisabled(e.value),value:e.value}},[t.moreOperateTooltip(e.value)?o("div",[o("el-tooltip",{attrs:{content:t.lang.resource.componentMoreOperateTooltip[e.value],placement:"left"}},[o("div",[t._v(t._s(e.label))])])],1):o("div",[o("div",[t._v(t._s(e.label))])])])}),1)],1)],1)],1),t._v(" "),o("el-col",{attrs:{span:4}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:20}},[o("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),o("el-col",{attrs:{span:4}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getList}})],1)],1)],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedData},on:{"sort-change":t.sort,"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",label:t.lang.common.name,prop:"name"}}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"status",label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"status",class:t.lang.resource.componentTaskState.hasOwnProperty(e.row.task_state)?"bg-blue":t.statusClass(e.row.status)},[t._v("\n                        "+t._s(t.lang.resource.componentTaskState.hasOwnProperty(e.row.task_state)?t.lang.resource.componentTaskState[e.row.task_state]:t.lang.resource.componentStatusArray[e.row.status])+"\n                        "),t.lang.resource.componentTaskState.hasOwnProperty(e.row.task_state)?o("i",{staticClass:"el-icon-loading"}):t._e()])]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"gpu_status",label:t.lang.resource.gpuStatus},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"status",class:{"cloud-btn-green":"load"===e.row.gpu_status,"cloud-btn-gray":"unload"===e.row.gpu_status,"cloud-btn-purple":"preload"===e.row.gpu_status,"cloud-btn-blue":"loading"===e.row.gpu_status}},[t._v(t._s(t.lang.resource.gpuStatusValue[e.row.gpu_status]))])]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"imageName",label:t.lang.resource.imageName}}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"fixedIps",label:t.lang.outside.privateIp},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{domProps:{innerHTML:t._s(e.row.fixedIps.join("</br>"))}})]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"floatingIps",label:t.lang.outside.publicIp},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{domProps:{innerHTML:t._s(e.row.floatingIps.join("</br>"))}})]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"createtime",label:t.lang.common.create_time},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("utc2beijing")(e.row.createtime))+"\n            ")]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"hostName",label:t.lang.resource.hostName}}),t._v(" "),o("el-table-column",{attrs:{label:t.lang.common.operation,width:200},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return t.showDetail(e.row.uid)}}},[t._v("\n                    "+t._s(t.lang.common.showDetail)+"\n                ")])]}}])})],1),t._v(" "),o("detail",{attrs:{show:t.detailDialogVisible,id:t.id},on:{closeModal:function(e){t.detailDialogVisible=!1}}}),t._v(" "),o("cloud-reset-password",{attrs:{show:t.updatePasswordDialogVisible,serverId:t.multipleSelection[0]&&t.multipleSelection[0].uid},on:{closeModal:function(e){t.updatePasswordDialogVisible=!1}}}),t._v(" "),o("cloud-update-name",{attrs:{show:t.updateNameDialogVisible,serverId:t.multipleSelection[0]&&t.multipleSelection[0].uid,vmName:t.multipleSelection[0]&&t.multipleSelection[0].name},on:{closeModal:t.closeUpdateName}}),t._v(" "),o("load-cloud-disk",{attrs:{serverId:t.selectedServerId(),show:t.showLoadCloudDisk},on:{getList:t.getList,closeModal:function(e){t.showLoadCloudDisk=!1}}}),t._v(" "),o("unload-cloud-disk",{attrs:{serverId:t.selectedServerId(),show:t.showUnloadCloudDisk,componentDetailData:t.componentDetailData},on:{getList:t.getList,closeModal:function(e){t.showUnloadCloudDisk=!1}}}),t._v(" "),o("cloud-snapshot",{attrs:{serverId:t.selectedServerId(),show:t.showSnapshot},on:{getList:t.getList,closeModal:function(e){t.showSnapshot=!1}}}),t._v(" "),o("cloud-snapshot-rollback",{attrs:{componentDetailData:t.componentDetailData,show:t.showSnapshotRollback},on:{getList:t.getList,closeModal:function(e){t.showSnapshotRollback=!1}}}),t._v(" "),o("cloud-tip-dialog",{attrs:{dialogVisible:t.dialogVisible,confirmDisabled:t.gpuListLoading,loading:t.gpuListLoading},on:{cancel:t.dialogCancel,confirm:t.dialogConfirm}},[o("p",{class:{"confirm-warning":t.confirm_warning,"confirm-text-left":t.confirm_text_left},staticStyle:{"margin-bottom":"5px"}},[t._v(t._s(t.tipDialogMsg))]),t._v(" "),t.showDeleteSystemConfirm?o("div",[o("el-checkbox",{staticClass:"pana-checkoutbox",model:{value:t.deleteSystemDisk,callback:function(e){t.deleteSystemDisk=e},expression:"deleteSystemDisk"}}),t._v(" "),o("span",{staticStyle:{"margin-left":"5px"}},[t._v(t._s(t.lang.resource.deleteSystemDiskConfirm))])],1):t._e()]),t._v(" "),o("cloud-add-network",{attrs:{server_id:t.selectedServerId(),pool_id:t.poolId,show:t.showAddNetwork},on:{getList:t.getList,closeModal:t.closeAddNetwork}}),t._v(" "),o("cloud-remove-network",{attrs:{server_id:t.selectedServerId(),show:t.showRemoveNetwork},on:{closeModal:t.closeRemoveNetwork,getList:t.getList}}),t._v(" "),o("cloud-update-private-ip",{attrs:{server_id:t.selectedServerId(),show:t.showUpdatePrivateIp},on:{closeModal:t.closeUpdatePrivateIp,getList:t.getList}}),t._v(" "),o("cloud-bind-public-ip",{attrs:{server_id:t.selectedServerId(),show:t.showBindPublicIp},on:{closeModal:function(e){t.showBindPublicIp=!1}}}),t._v(" "),o("cloud-unbind-public-ip",{attrs:{server_id:t.selectedServerId(),show:t.showUnbindPublicIp},on:{closeModal:function(e){t.showUnbindPublicIp=!1}}}),t._v(" "),o("cloud-update-mac",{attrs:{server_id:t.selectedServerId(),show:t.showUpdateMac},on:{closeModal:t.closeUpdateMac}}),t._v(" "),o("cloud-nic-security-config",{attrs:{server_id:t.selectedServerId(),show:t.showNicSecurityConfig},on:{closeModal:t.closeNicSecurityConfig,getList:t.getList}}),t._v(" "),o("cloud-make-image",{attrs:{show:t.showMakeImage,componentDetailData:t.componentDetailData},on:{closeModal:t.closeMakeImage}}),t._v(" "),o("cloud-ajust-configuration",{attrs:{selectdComponent:t.componentDetailData,show:t.resizeDialogVisible},on:{getList:t.getList,closeModal:function(e){t.resizeDialogVisible=!1}}}),t._v(" "),o("cloud-disc-management",{attrs:{server_id:t.multipleSelection[0]&&t.multipleSelection[0].uid,show:t.showDiscManagement},on:{closeModal:function(e){t.showDiscManagement=!1}}}),t._v(" "),o("cloud-transparent-equipment",{attrs:{server_id:t.multipleSelection[0]&&t.multipleSelection[0].uid,server_name:t.multipleSelection[0]&&t.multipleSelection[0].name,show:t.showTransparentEquipment},on:{closeModal:t.closeTransparentEquipment}}),t._v(" "),o("cloud-mount-gpu",{attrs:{components:t.multipleSelection,gpuInfo:t.gpuInfo,show:t.showMountGpu},on:{getList:t.getList,closeModal:t.closeMountGpu}}),t._v(" "),o("cloud-component-exception",{attrs:{server_id:t.multipleSelection[0]&&t.multipleSelection[0].uid,abnormalRestart:t.multipleSelection[0]&&t.multipleSelection[0].abnormalRestart,show:t.showComponentException},on:{closeModal:t.closeComponentException,getList:t.getList,setLoading:function(e){t.loading=!1}}}),t._v(" "),o("cloud-boot-sequence",{attrs:{server_id:t.multipleSelection[0]&&t.multipleSelection[0].uid,server_name:t.multipleSelection[0]&&t.multipleSelection[0].name,show:t.showBootSequence},on:{closeModal:t.closeBootSequence}}),t._v(" "),o("cloud-hot-migrate",{attrs:{server_id:t.multipleSelection[0]&&t.multipleSelection[0].uid,availabilityZone:t.multipleSelection[0]&&t.multipleSelection[0].availabilityZone,hostName:t.multipleSelection[0]&&t.multipleSelection[0].hostName,show:t.showHotMigrate},on:{closeModal:t.closeHotMigrate,getList:t.getList}}),t._v(" "),o("cloud-cold-migrate",{attrs:{server_id:t.multipleSelection[0]&&t.multipleSelection[0].uid,server:t.componentDetailData,show:t.showColdMigrate},on:{closeModal:t.closeColdMigrate,getList:t.getList}}),t._v(" "),o("cloud-hot-upgrade",{attrs:{server_id:t.multipleSelection[0]&&t.multipleSelection[0].uid,currentUsageData:t.currentUsageData,show:t.showHotUpgrade},on:{closeModal:t.closeHotUpgrade,getList:t.getList}}),t._v(" "),o("cloud-not-rebuild",{attrs:{show:t.showNotRebuild},on:{closeModal:function(e){t.showNotRebuild=!1}}}),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.filterData.length>t.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.filterData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1)],1)},staticRenderFns:[]};var Et=o("C7Lr")(Ot,Pt,!1,function(t){o("c3+p")},null,null);e.default=Et.exports},T6oK:function(t,e){},TRBe:function(t,e){},UIiB:function(t,e){},Vz65:function(t,e){},W4IG:function(t,e){},YSnw:function(t,e){},ZP0S:function(t,e){},bK4G:function(t,e){},bi95:function(t,e){},c18T:function(t,e){},"c3+p":function(t,e){},d7qa:function(t,e){},daod:function(t,e){},gaCa:function(t,e){},iPXr:function(t,e){},jTl5:function(t,e){},"jYw+":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("1JPr"),s=o("ZLEe"),i=o.n(s),n=o("aA9S"),r=o.n(n),l={props:{show:Boolean,server_id:String,server_name:String},data:function(){return{acquisitionCycle:300,time:15e5,date:"",currentData:{},cpuData:{},memoryData:{},diskRate:{},diskThroughput:{},nicPacket:{},nicBandwidth:{},disks:[],disk:"",nics:[],nic:""}},methods:{closeModal:function(t){var e=this;["cpu-chart","memory-chart","disk-rate","disk-throughput","nic-packet","nic-bandwidth"].forEach(function(t){e.$refs[t]&&e.$echarts.init(e.$refs[t]).dispose()}),t=t||!1,r()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",t)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),window.addEventListener("resize",this.init,20),this.onSubmit()},query:function(){var t=this,e=this.api.monitor.get_current_query,o={sql:"select * from mem where time > now() - 1m AND code = 'FFFFF' AND host_type = 'virtual' AND vm_id = "+t.server_id};this.checkError(this.$http({url:e,method:"POST",data:o}),function(e){t.currentData=e.data})},onSubmit:function(){this.getCpuRate(),this.getMemoryRate(),this.disk?(this.getDiskRate(this.disk),this.getDiskThroughput(this.disk)):this.get_disks(),this.nic?(this.getNicPacket(this.nic),this.getNicBandwidth(this.nic)):this.get_nics()},setChartParam:function(t){var e=Date.parse(new Date),o="",a={chart:t,hostId:this.server_id,region:"FFFFF",precision:this.acquisitionCycle};return""===this.time?(e=Date.parse(this.date[1])+864e5,o=Date.parse(this.date[0])):o=e-this.time,a.endTimeMillis=e,a.startTimeMillis=o,a},getCpuRate:function(){var t=this,e=t.setChartParam("cpu");e=this.common.formatGetUrl(e),this.checkError(this.$http({url:this.api.monitor.get_cpu_rate+e,method:"get"}),function(e){t.cpuData=e.data,setTimeout(function(){t.chartInit({elementId:"cpu-chart",title:t.lang.common.cpu,legend:t.lang.componentMonitor.cpuLegend,yAxisLabel:"%",data:t.cpuData})},0)})},getMemoryRate:function(){var t=this,e=t.setChartParam("memory");e=this.common.formatGetUrl(e),this.checkError(this.$http({url:this.api.monitor.get_memory_rate+e,method:"get"}),function(e){t.memoryData=e.data,setTimeout(function(){t.chartInit({elementId:"memory-chart",title:t.lang.common.memory,legend:t.lang.componentMonitor.memoryLegend,yAxisLabel:"%",data:t.memoryData})},0)})},get_disks:function(){var t=this,e=this.common.formatMsg(this.api.monitor.get_disks,{id:t.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.disks=e.data,t.disks.length>0&&(setTimeout(function(){t.disk=t.disks[0].name},0),t.getDiskRate(t.disks[0].name),t.getDiskThroughput(t.disks[0].name))})},get_nics:function(){var t=this,e=this.common.formatMsg(this.api.monitor.get_nics,{id:t.server_id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.nics=e.data,t.nics.length>0&&(setTimeout(function(){t.nic=t.nics[0].name},0),t.getNicPacket(t.nics[0].name),t.getNicBandwidth(t.nics[0].name))})},diskChange:function(){this.getDiskRate(this.disk),this.getDiskThroughput(this.disk)},nicChange:function(){},getDiskRate:function(t){var e=this,o=e.setChartParam("disk.rate");o.disk=t,o.startTimeMillis=o.startTimeMillis-3e5,o=this.common.formatGetUrl(o),this.checkError(this.$http({url:this.api.monitor.get_disk_rw+o,method:"get"}),function(t){e.diskRate=t.data,setTimeout(function(){e.chartInit({elementId:"disk-rate",legend:e.lang.componentMonitor.diskRateLegend,yAxisLabel:e.lang.componentMonitor.timesPerSecond,data:e.diskRate})},0)})},getNicPacket:function(t){var e=this,o=e.setChartParam("net.packet.rate");o.interface=t,o.startTimeMillis=o.startTimeMillis-3e5,o=this.common.formatGetUrl(o),this.checkError(this.$http({url:this.api.monitor.get_nic_rate+o,method:"get"}),function(t){e.nicPacket=t.data,setTimeout(function(){e.chartInit({elementId:"nic-packet",legend:e.lang.componentMonitor.nicPacketLegend,yAxisLabel:e.lang.componentMonitor.nicPacketLabel,data:e.nicPacket})},0)})},getNicBandwidth:function(t){var e=this,o=e.setChartParam("net.bandwidth.rate");o.interface=t,o.startTimeMillis=o.startTimeMillis-3e5,o=this.common.formatGetUrl(o),this.checkError(this.$http({url:this.api.monitor.get_nic_rate+o,method:"get"}),function(t){e.nicBandwidth=t.data,setTimeout(function(){e.chartInit({elementId:"nic-bandwidth",legend:e.lang.componentMonitor.nicBandwidthLegend,yAxisLabel:"bps",data:e.nicBandwidth})},0)})},getDiskThroughput:function(t){var e=this,o=e.setChartParam("disk.throughput");o.disk=t,o.startTimeMillis=o.startTimeMillis-3e5,o=this.common.formatGetUrl(o),this.checkError(this.$http({url:this.api.monitor.get_disk_rw+o,method:"get"}),function(t){e.diskThroughput=t.data,setTimeout(function(){e.chartInit({elementId:"disk-throughput",legend:e.lang.componentMonitor.diskThroughputLegend,yAxisLabel:"Bps",data:e.diskThroughput})},0)})},chartInit:function(t){var e=this,o=this.$echarts.init(document.getElementById(t.elementId)),a=t.data,s=[],i="",n=[],r={},l=[];for(var c in o.clear(),a.values.forEach(function(t){i=15e5===e.time?e.moment(t[0]).format("HH:mm"):e.moment(t[0]).format("MM-DD HH:mm"),s.push(i),a.columns.forEach(function(e,o){o>0&&(r.hasOwnProperty(e)||(r[e]=[]),r[e].push(t[o].toFixed(2)))})}),r)l.push({name:t.legend[c],type:"line",data:r[c]}),n.push(t.legend[c]);var u={title:{text:t.title,textStyle:{fontSize:14,fontWeight:"normal"},left:"10%"},tooltip:{trigger:"axis"},color:["#42BC9C","#49ACFF","#4E6584"],legend:{data:n},grid:{left:"15%"},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value",axisLabel:{formatter:"{value} "+t.yAxisLabel}},series:l};o.setOption(u)},init:function(){var t=this;["cpu-chart","memory-chart","disk-rate","disk-throughput","nic-packet","nic-bandwidth"].forEach(function(e){t.$echarts.init(t.$refs[e]).resize()})}},destroyed:function(){window.removeEventListener("resize",this.init,20)}},c={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{id:"componentMonitor",title:t.server_name,width:"75%",visible:t.show,modal:!0},on:{open:t.initForm,close:t.closeModal}},[o("el-form",{ref:"form",attrs:{"label-width":"80px",inline:!0}},[o("el-form-item",{attrs:{label:t.lang.componentMonitor.acquisitionCycle,"label-width":"100px"}},[o("el-select",{attrs:{filterable:""},model:{value:t.acquisitionCycle,callback:function(e){t.acquisitionCycle=e},expression:"acquisitionCycle"}},t._l(t.lang.componentMonitor.acquisitionCycleOptions,function(t){return o("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:""}},[o("el-radio-group",{on:{change:function(e){t.date=""}},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}},t._l(t.lang.componentMonitor.timeOptions,function(e){return o("el-radio-button",{key:e.value,attrs:{label:e.value}},[t._v("\n                    "+t._s(e.text)+"\n                ")])}),1),t._v(" "),o("el-date-picker",{class:{active:!t.time&&t.date},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{input:function(e){t.time=""}},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),t._v(" "),o("el-form-item",{attrs:{label:""}},[o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.lang.componentMonitor.inquire))])],1),t._v(" "),o("el-form-item",{attrs:{label:""}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.componentMonitor.info)},slot:"content"}),t._v(" "),o("i",{staticClass:"el-icon-info"})])],1),t._v(" "),o("el-row",[o("span",{staticClass:"row-title"},[t._v(t._s(t.lang.componentMonitor.compute))])]),t._v(" "),o("el-row",{staticClass:"chart-row"},[o("el-col",{staticClass:"chart-col",attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.cpuData.hasOwnProperty("values")&&0!==t.cpuData.values.length,expression:"cpuData.hasOwnProperty('values') && cpuData.values.length!==0"}],ref:"cpu-chart",staticClass:"chart",attrs:{id:"cpu-chart"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.cpuData.hasOwnProperty("values")&&0===t.cpuData.values.length,expression:"cpuData.hasOwnProperty('values') && cpuData.values.length===0"}],staticClass:"no-data"},[t._v(t._s(t.lang.componentMonitor.noData))])]),t._v(" "),o("el-col",{attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.memoryData.hasOwnProperty("values")&&0!==t.memoryData.values.length,expression:"memoryData.hasOwnProperty('values') && memoryData.values.length!==0"}],ref:"memory-chart",staticClass:"chart",attrs:{id:"memory-chart"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.memoryData.hasOwnProperty("values")&&0===t.memoryData.values.length,expression:"memoryData.hasOwnProperty('values') && memoryData.values.length===0"}],staticClass:"no-data"},[t._v("\n                    "+t._s(t.lang.componentMonitor.noData)+"\n                ")])])],1),t._v(" "),o("el-row",[o("span",{staticClass:"el-form-item__label row-title"},[t._v(t._s(t.lang.componentMonitor.disk))]),t._v(" "),o("el-form-item",{attrs:{label:t.lang.componentMonitor.diskPerformance}},[o("el-select",{attrs:{filterable:""},on:{change:t.diskChange},model:{value:t.disk,callback:function(e){t.disk=e},expression:"disk"}},t._l(t.disks,function(t){return o("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}),1)],1)],1),t._v(" "),o("el-row",{staticClass:"chart-row"},[o("el-col",{staticClass:"chart-col",attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.diskRate.hasOwnProperty("values")&&0!==t.diskRate.values.length,expression:"diskRate.hasOwnProperty('values') && diskRate.values.length!==0"}],ref:"disk-rate",staticClass:"chart",attrs:{id:"disk-rate"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.diskRate.hasOwnProperty("values")&&0===t.diskRate.values.length,expression:"diskRate.hasOwnProperty('values') && diskRate.values.length===0"}],staticClass:"no-data"},[t._v("\n                    "+t._s(t.lang.componentMonitor.noData)+"\n                ")])]),t._v(" "),o("el-col",{attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.diskThroughput.hasOwnProperty("values")&&0!==t.diskThroughput.values.length,expression:"diskThroughput.hasOwnProperty('values') && diskThroughput.values.length!==0"}],ref:"disk-throughput",staticClass:"chart",attrs:{id:"disk-throughput"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.diskThroughput.hasOwnProperty("values")&&0===t.diskThroughput.values.length,expression:"diskThroughput.hasOwnProperty('values') && diskThroughput.values.length===0"}],staticClass:"no-data"},[t._v("\n                    "+t._s(t.lang.componentMonitor.noData)+"\n                ")])])],1),t._v(" "),o("el-row",[o("span",{staticClass:"el-form-item__label row-title"},[t._v(t._s(t.lang.componentMonitor.nic))]),t._v(" "),o("el-form-item",{attrs:{label:""}},[o("el-select",{attrs:{filterable:""},on:{change:t.nicChange},model:{value:t.nic,callback:function(e){t.nic=e},expression:"nic"}},t._l(t.nics,function(t){return o("el-option",{key:t.name,attrs:{label:t.name,value:t.name}})}),1)],1)],1),t._v(" "),o("el-row",{staticClass:"chart-row"},[o("el-col",{staticClass:"chart-col",attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.nicPacket.hasOwnProperty("values")&&0!==t.nicPacket.values.length,expression:"nicPacket.hasOwnProperty('values') && nicPacket.values.length!==0"}],ref:"nic-packet",staticClass:"chart",attrs:{id:"nic-packet"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.nicPacket.hasOwnProperty("values")&&0===t.nicPacket.values.length,expression:"nicPacket.hasOwnProperty('values') && nicPacket.values.length===0"}],staticClass:"no-data"},[t._v("\n                    "+t._s(t.lang.componentMonitor.noData)+"\n                ")])]),t._v(" "),o("el-col",{attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.nicBandwidth.hasOwnProperty("values")&&0!==t.nicBandwidth.values.length,expression:"nicBandwidth.hasOwnProperty('values') && nicBandwidth.values.length!==0"}],ref:"nic-bandwidth",staticClass:"chart",attrs:{id:"nic-bandwidth"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.nicBandwidth.hasOwnProperty("values")&&0===t.nicBandwidth.values.length,expression:"nicBandwidth.hasOwnProperty('values') && nicBandwidth.values.length===0"}],staticClass:"no-data"},[t._v("\n                    "+t._s(t.lang.componentMonitor.noData)+"\n                ")])])],1)],1)],1)},staticRenderFns:[]};var u={name:"monitor",props:["poolId"],data:function(){return{firstrowSpan:8,gpuTotal:0,acquisitionCycle:300,time:15e5,date:"",cpuData:{},memoryData:{},loading:!0,componentData:[],total:0,componentStatusColor:["#D7E1E3"],componentDistributeColor:["#9084ff","#3399ff","#30c9ae","#f06292","#6435ea","#60abfc","#35c5ea"],componentStatusData:[{value:0,name:"其它"}],componentDistributeData:[],gpuQuotaData:[],server_id:"",server_name:"",showComponentMonitorVisible:!1,pageNum:1,pageSize:10}},components:{componentMonitor:o("C7Lr")(l,c,!1,function(t){o("T6oK"),o("d7qa")},"data-v-403ecdc0",null).exports},mounted:function(){this.getComponents(),this.getGpuQuota(),this.onSubmit(),window.addEventListener("resize",this.init,20)},methods:{onSubmit:function(){this.getCpuRate(),this.getMemoryRate()},getCpuRate:function(){var t=this,e=t.setChartParam("cpu");e=this.common.formatGetUrl(e),this.checkError(this.$http({url:this.api.cloud.pool_cpu_monitor+e,method:"get"}),function(e){t.cpuData=e.data,setTimeout(function(){t.chartInit({elementId:"pool-cpu-chart",title:t.lang.common.cpu,legend:t.lang.componentMonitor.cpuLegend,yAxisLabel:"%",data:t.cpuData})},0)})},setChartParam:function(t){var e=Date.parse(new Date),o="",a={chart:t,precision:this.acquisitionCycle};return""===this.time?(e=Date.parse(this.date[1])+864e5,o=Date.parse(this.date[0])):o=e-this.time,a.endTimeMillis=e,a.startTimeMillis=o-3e5,a},chartInit:function(t){var e=this,o=this.$echarts.init(document.getElementById(t.elementId)),a=t.data,s=[],i="",n=[],r={},l=[];for(var c in o.clear(),a.values.forEach(function(t){i=15e5===e.time?e.moment(t[0]).format("HH:mm"):e.moment(t[0]).format("MM-DD HH:mm"),s.push(i),a.columns.forEach(function(e,o){o>0&&(r.hasOwnProperty(e)||(r[e]=[]),r[e].push(t[o].toFixed(2)))})}),r)l.push({name:t.legend[c],type:"line",data:r[c]}),n.push(t.legend[c]);var u={title:{text:t.title,textStyle:{fontSize:14,fontWeight:"normal"},left:"10%"},tooltip:{trigger:"axis"},color:["#42BC9C","#49ACFF","#4E6584"],legend:{data:n},grid:{left:"15%"},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value",axisLabel:{formatter:"{value} "+t.yAxisLabel}},series:l};o.setOption(u)},getMemoryRate:function(){var t=this,e=t.setChartParam("memory");e=this.common.formatGetUrl(e),this.checkError(this.$http({url:this.api.cloud.pool_memory_monitor+e,method:"get"}),function(e){t.memoryData=e.data,setTimeout(function(){t.chartInit({elementId:"pool-memory-chart",title:t.lang.common.memory,legend:t.lang.componentMonitor.memoryLegend,yAxisLabel:"%",data:t.memoryData})},0)})},sort:function(t){this.componentData=this.common.sort(t,this.componentData)},getComponents:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_pools_detail_servers,{pool_id:t.poolId});this.checkError(this.$http({url:e,method:"get"}),function(e){t.loading=!1,t.componentData=e.data,t.getComponentStatus(),t.getComponentDistribute()})},getGpuQuota:function(){var t=this;this.checkError(t.$http({url:this.api.cloud.pool_gpu_monitor,method:"get"}),function(e){var o=e.data.used,a=e.data.total-o;t.gpuTotal=e.data.total,t.gpuQuotaData.push({name:"已使用",value:o},{name:"剩余",value:a}),t.pieChartInit({elementId:"gpu-quota",title:t.lang.resource.gpuQuota,centerText:t.gpuTotal,centerSubtext:t.lang.resource.gpuQuota,color:["#35c5ea","#e5e5e5"],data:t.gpuQuotaData})})},getComponentStatus:function(){var t=this,e=0,o="",a={};t.componentData.forEach(function(s){e++,"ACTIVE"===(o=s.status)||"ERROR"===o||"SHUTOFF"===o||"SUSPENDED"===o?a.hasOwnProperty(o)?a[o]++:a[o]=1:t.componentStatusData[0].value++}),i()(a).forEach(function(e){switch(e){case"ACTIVE":t.componentStatusColor.unshift("#30C9AD");break;case"SHUTOFF":t.componentStatusColor.unshift("#EABE27");break;case"SUSPENDED":t.componentStatusColor.unshift("#4a6583");break;case"ERROR":t.componentStatusColor.unshift("#EF807E")}t.componentStatusData.unshift({value:a[e],name:t.lang.resource.componentStatusArray[e]})}),t.total=e,0===t.total&&(t.componentStatusColor=["#e5e5e5"]),t.pieChartInit({elementId:"component-status-chart",title:this.lang.resource.componentStatusDistribute,centerText:t.total,centerSubtext:t.lang.resource.componentTotal,color:t.componentStatusColor,data:this.componentStatusData})},getComponentDistribute:function(){var t=this,e="",o={};t.componentData.forEach(function(t){(e=t.hostName)&&(o.hasOwnProperty(e)?o[e]++:o[e]=1)}),i()(o).forEach(function(e){t.componentDistributeData.unshift({value:o[e],name:e})}),0===t.total&&(t.componentDistributeColor=["#e5e5e5"],t.componentDistributeData=[{value:0}]),t.pieChartInit({elementId:"component-chart",title:this.lang.resource.componentDistribute,centerText:t.total,centerSubtext:t.lang.resource.componentTotal,color:t.componentDistributeColor,data:t.componentDistributeData})},pieChartInit:function(t){var e=this.$echarts.init(document.getElementById(t.elementId)),o={a:{color:"#7C91AC",fontSize:"13"}};t.color.map(function(t,e){o["style"+e]={fontWeight:"510",fontSize:"25",padding:[0,0,0,20],color:t}});var a={title:[{text:t.title,textStyle:{color:"#A2ACBA",fontWeight:"normal",fontSize:"14"}},{text:t.centerText,subtext:t.centerSubtext,textStyle:{fontSize:16,fontWeight:"bold",color:"#A2ACBA"},subtextStyle:{fontSize:16,fontWeight:"bold",color:"#A2ACBA"},textAlign:"center",x:"24%",y:"35%"}],tooltip:{show:0!==t.centerText,trigger:"item",formatter:"{b} : {c} ({d}%)"},color:t.color,legend:{orient:"auto",left:"45%",top:"middle",selectedMode:!1,textStyle:{padding:[0,0,0,10],rich:o},formatter:function(e){for(var o=t.data,a=0,s=o.length;a<s;a++)if(o[a].name===e)return"{a|"+e+" :}{style"+a+"|"+o[a].value+"}"},icon:"circle"},series:[{type:"pie",center:["25%","50%"],radius:["50%","66%"],avoidLabelOverlap:!1,label:{normal:{show:!1},emphasis:{show:!1}},labelLine:{normal:{show:!1}},data:t.data}]};e.setOption(a,!0)},init:function(){var t=this;["component-status-chart","component-chart","gpu-quota","pool-cpu-chart","pool-memory-chart"].forEach(function(e){t.$echarts.init(t.$refs[e]).resize()})},statusClass:function(t){switch(t){case"ACTIVE":return"cloud-success";case"ERROR":return"cloud-error";case"SUSPENDED":return"cloud-fault";case"SHUTOFF":return"cloud-info";case"PAUSED":case"RESIZE":case"REVERT_RESIZE":case"UNKNOWN":return"cloud-warning";default:return"cloud-default"}},showComponentMonitor:function(t,e){this.showComponentMonitorVisible=!0,this.server_id=t,this.server_name=e},closeComponentMonitor:function(){this.showComponentMonitorVisible=!1},pageSelect:function(t){this.pageNum=t}},computed:{pagedData:function(){return this.componentData.length<=this.pageSize?this.componentData:this.common.pagination(this.componentData,this.pageSize,this.pageNum)}},destroyed:function(){window.removeEventListener("resize",this.init,20)}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"mainDiv",attrs:{id:"component-monitor"}},[o("el-row",{staticClass:"first-row",attrs:{gutter:20}},[o("el-col",{attrs:{span:t.firstrowSpan}},[o("div",{ref:"component-status-chart",staticClass:"echartlist",attrs:{id:"component-status-chart"}})]),t._v(" "),o("el-col",{attrs:{span:t.firstrowSpan}},[o("div",{ref:"component-chart",staticClass:"echartlist",attrs:{id:"component-chart"}})]),t._v(" "),o("el-col",{attrs:{span:t.firstrowSpan}},[o("div",{ref:"gpu-quota",staticClass:"echartlist",attrs:{id:"gpu-quota"}})])],1),t._v(" "),o("el-form",{ref:"form",attrs:{"label-width":"80px",inline:!0}},[o("div",{staticClass:"form-row-inline"},[o("el-form-item",{attrs:{label:t.lang.componentMonitor.acquisitionCycle,"label-width":"100px"}},[o("el-select",{attrs:{filterable:""},model:{value:t.acquisitionCycle,callback:function(e){t.acquisitionCycle=e},expression:"acquisitionCycle"}},t._l(t.lang.componentMonitor.acquisitionCycleOptions,function(t){return o("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})}),1)],1),t._v(" "),o("el-form-item",{attrs:{label:""}},[o("el-radio-group",{on:{change:function(e){t.date=""}},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}},t._l(t.lang.componentMonitor.timeOptions,function(e){return o("el-radio-button",{key:e.value,attrs:{label:e.value}},[t._v("\n                        "+t._s(e.text)+"\n                    ")])}),1),t._v(" "),o("el-date-picker",{class:{active:!t.time&&t.date},attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},on:{input:function(e){t.time=""}},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}})],1),t._v(" "),o("el-form-item",{attrs:{label:""}},[o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v(t._s(t.lang.componentMonitor.inquire))])],1),t._v(" "),o("el-form-item",{attrs:{label:""}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.componentMonitor.info)},slot:"content"}),t._v(" "),o("i",{staticClass:"el-icon-info"})])],1)],1),t._v(" "),o("el-row",{staticClass:"chart-row",attrs:{gutter:20}},[o("el-col",{staticClass:"chart-col",attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.cpuData.hasOwnProperty("values")&&0!==t.cpuData.values.length,expression:"cpuData.hasOwnProperty('values') && cpuData.values.length!==0"}],ref:"pool-cpu-chart",staticClass:"chart",attrs:{id:"pool-cpu-chart"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.cpuData.hasOwnProperty("values")&&0===t.cpuData.values.length,expression:"cpuData.hasOwnProperty('values') && cpuData.values.length===0"}],staticClass:"no-data"},[t._v(t._s(t.lang.componentMonitor.noData))])]),t._v(" "),o("el-col",{attrs:{span:12}},[o("div",{directives:[{name:"show",rawName:"v-show",value:t.memoryData.hasOwnProperty("values")&&0!==t.memoryData.values.length,expression:"memoryData.hasOwnProperty('values') && memoryData.values.length!==0"}],ref:"pool-memory-chart",staticClass:"chart",attrs:{id:"pool-memory-chart"}}),t._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.memoryData.hasOwnProperty("values")&&0===t.memoryData.values.length,expression:"memoryData.hasOwnProperty('values') && memoryData.values.length===0"}],staticClass:"no-data"},[t._v("\n                    "+t._s(t.lang.componentMonitor.noData)+"\n                ")])])],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedData},on:{"sort-change":t.sort}},[o("el-table-column",{attrs:{sortable:"custom",prop:"name",label:t.lang.resource.cloudComponentName},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return t.showComponentMonitor(e.row.uid,e.row.name)}}},[t._v(t._s(e.row.name)+"\n                ")])]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"hostName",label:t.lang.resource.hostName}}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"status",label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"status",class:t.statusClass(e.row.status)},[t._v(t._s(t.lang.resource.componentStatusArray[e.row.status])+"\n                    "),"BUILD"==e.row.status?o("i",{staticClass:"el-icon-loading"}):t._e()])]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"createtime",label:t.lang.common.create_time},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("utc2beijing")(e.row.createtime))+"\n            ")]}}])})],1),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.componentData.length>t.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.componentData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1),t._v(" "),o("component-monitor",{attrs:{server_id:t.server_id,server_name:t.server_name,show:t.showComponentMonitorVisible},on:{closeModal:t.closeComponentMonitor}})],1)},staticRenderFns:[]};var m=o("C7Lr")(u,d,!1,function(t){o("8nZn"),o("bK4G")},"data-v-110be1b7",null).exports,p=o("SI8n"),h=o("/n4h"),g=o("+ri7"),f=o("JdNb"),v=o("Kk6J"),_=o("09sb"),b=o("oIPs"),k=o("zLDf"),w={props:["poolId"],data:function(){return{data:{},version:"",isStorageServer:!0,loading:!0,showBindPublicIp:!1,showUnbindPublicIp:!1,showLoadCloudDisk:!1,showUnloadCloudDisk:!1,showSnapshot:!1,showSnapshotRollback:!1,loadingCloudDisk:!1,dialogVisible:!1,tipDialogMsg:"",operateValue:"",operateOptions:[{value:"os-start",label:this.lang.resource.start},{value:"bindPublicIp",label:this.lang.resource.bindPublicIp},{value:"unbindPublicIp",label:this.lang.resource.releasePublicIp},{value:"loadCloudDisk",label:this.lang.resource.loadCloudDisk},{value:"unloadCloudDisk",label:this.lang.resource.uninstallCloudDisk},{value:"snapshot",label:this.lang.resource.snapshot},{value:"snapshotRollback",label:this.lang.resource.snapshotRollback}],isPoolAdmin:JSON.parse(sessionStorage.getItem("panaUser")).is_admin,storageServerId:null}},created:function(){var t=this;if(JSON.parse(sessionStorage.getItem("panaPools")).map(function(e){parseInt(e.id)===parseInt(t.poolId)&&(t.storageServerId=e.stor_server_id)}),this.storageServerId){var e=this;this.getDetail(),this.getStorageSysinfo(),this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");if("floatingip"===o[0]&&"end"===o[2]&&e.data.hasOwnProperty("uid")){var a=e.data;null===t.payload.floatingip.fixed_ip_address?-1!==a.floatingIps.indexOf(t.payload.floatingip.floating_ip_address)&&(a.floatingIps=[]):-1!==a.fixedIps.indexOf(t.payload.floatingip.fixed_ip_address)&&(a.floatingIps=[],a.floatingIps.push(t.payload.floatingip.floating_ip_address))}"compute"===o[0]&&"instance"===o[1]&&"end"===o[3]&&e.getDetail(),"instance"===o[0].split("_")[1]&&e.getDetail(),"volume"===o[0]&&"end"===o[2]&&e.getDetail()}})}},components:{cloudTipDialog:h.a,cloudBindPublicIp:g.a,cloudUnbindPublicIp:f.a,loadCloudDisk:v.a,unloadCloudDisk:_.a,cloudSnapshot:b.a,cloudSnapshotRollback:k.a},methods:{operateDisabled:function(t){var e=this.data;if(!e.hasOwnProperty("uid"))return!0;if(this.rebuildStatus||this.errorStatus||this.isPoweringOff||this.isPoweringOn)return!0;switch(t){case"os-start":return"SHUTOFF"!==e.status;case"bindPublicIp":return e.floatingIps.length>0;case"unbindPublicIp":return 0===e.floatingIps.length;case"loadCloudDisk":return"ACTIVE"!==e.status&&"SHUTOFF"!==e.status;case"unloadCloudDisk":if(!e.hasOwnProperty("diskInfo"))return!0;if(1===e.diskInfo.length)return!0;break;case"snapshotRollback":if("SHUTOFF"!==e.status)return this.lang.resource.operateTooltip.snapshotRollback=this.lang.resource.snapshotRollbackInfo[0],!0;if(!e.hasOwnProperty("diskId"))return this.lang.resource.operateTooltip.snapshotRollback=this.lang.resource.snapshotRollbackInfo[1],!0}},operationChange:function(){switch(this.operateValue){case"start":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_start,this.operateValue="os-start";break;case"bindPublicIp":this.showBindPublicIp=!0,this.operateValue="";break;case"unbindPublicIp":this.showUnbindPublicIp=!0,this.operateValue="";break;case"loadCloudDisk":this.showLoadCloudDisk=!0,this.operateValue="";break;case"unloadCloudDisk":this.showUnloadCloudDisk=!0,this.operateValue="";break;case"snapshot":this.showSnapshot=!0,this.operateValue="";break;case"snapshotRollback":this.showSnapshotRollback=!0,this.operateValue=""}},dialogCancel:function(){this.dialogVisible=!1,this.operateValue=""},dialogConfirm:function(){switch(this.operateValue){case"os-start":this.actionData={"os-start":null}}this.dialogVisible=!1,this.actionSubmit()},actionSubmit:function(){var t=this.storageServerId,e=this.common.formatMsg(this.api.cloud.post_pool_servers_detail_action,{server_id:t});this.operateValue="",this.checkError(this.$http({url:e,method:"post",data:this.actionData}))},closeBindPublicIp:function(t){!0===t&&(this.loading=!0),this.showBindPublicIp=!1},closeUnbindPublicIp:function(t){!0===t&&(this.loading=!0),this.showUnbindPublicIp=!1},closeLoadCloudDisk:function(){this.showLoadCloudDisk=!1},closeUnloadCloudDisk:function(){this.showUnloadCloudDisk=!1},closeSnapshot:function(){this.showSnapshot=!1},closeSnapshotRollback:function(){this.showSnapshotRollback=!1},setLoading:function(t){this.loading=t},getDetail:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:t.storageServerId});this.checkError(this.$http({url:e,method:"get"}),function(e){t.data=e.data,t.loading=!1})},getStorageSysinfo:function(){var t=this,e=this.api.storage.sysinfo;this.checkError(this.$http({url:e,method:"get"}),function(e){t.version=e.data.version})},statusClass:function(t){switch(t){case"ACTIVE":return"cloud-color-green";case"ERROR":return"cloud-color-red";case"SUSPENDED":return"cloud-color-blue";case"SHUTOFF":return"cloud-color-gray";default:return"cloud-color-orange"}}},computed:{componentConfig:function(){var t=this.data.vcpus||0,e=this.data.ram||0;return this.common.formatMsg(this.lang.resource.componentConfig,{cpu:t,memory:e/1024})},cloudDisk:function(){var t="",e=this;return this.data.diskInfo.forEach(function(o){var a=o.is_sys_disk?e.lang.cloudDisk.sysDisk:e.lang.cloudDisk.dataDisk;t=t+e.common.formatMsg(e.lang.resource.detailCloudDisk,{name:o.name,type:o.type,disk:a,size:o.size})+"</br>"}),t},rebuildStatus:function(){return"REBUILD"===this.data.status},isPoweringOff:function(){return"powering-off"===this.data.status},isPoweringOn:function(){return"powering-on"===this.data.task_state}}},y={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"storage-component"}},[t.storageServerId?o("div",[o("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:20}},[o("el-select",{attrs:{placeholder:t.lang.resource.operation,disabled:!t.isPoolAdmin},on:{change:t.operationChange},model:{value:t.operateValue,callback:function(e){t.operateValue=e},expression:"operateValue"}},t._l(t.operateOptions,function(e){return o("el-option",{key:e.value,attrs:{disabled:t.operateDisabled(e.value),value:e.value}},[t._v("\n                                "+t._s(e.label)+"\n                        ")])}),1),t._v(" "),o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getDetail}})],1)],1),t._v(" "),o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cloud-detail cloud-detail-modal",attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[t.data.hasOwnProperty("name")?o("table",[o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.configuration))]),t._v(" "),o("td",[t._v(t._s(t.componentConfig))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.status))]),t._v(" "),o("td",[o("span",{staticClass:"status",class:t.statusClass(t.data.status)},[t._v(t._s(t.lang.resource.componentStatusArray[t.data.status])+"\n                        ")])])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.outside.privateIp))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.data.fixedIps.join("</br>"))}}),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.cloudDisk))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.cloudDisk)}})]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.outside.publicIp))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.data.floatingIps.join("</br>"))}}),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.create_time))]),t._v(" "),o("td",[t._v(t._s(t._f("utc2beijing")(t.data.createtime)))])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.physicalHost))]),t._v(" "),o("td",[t._v(t._s(t.data.hostName))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.safeGroup))]),t._v(" "),o("td",{domProps:{innerHTML:t._s(t.data.secGroups.join("</br>"))}})])]):t._e()])],1):o("div",[t._v("\n            "+t._s(t.lang.resource.notStorageComponent)+"\n        ")]),t._v(" "),o("cloud-tip-dialog",{attrs:{dialogVisible:t.dialogVisible},on:{cancel:t.dialogCancel,confirm:t.dialogConfirm}},[o("p",{staticStyle:{"margin-bottom":"5px"}},[t._v(t._s(t.tipDialogMsg))])]),t._v(" "),o("cloud-bind-public-ip",{attrs:{server_id:t.storageServerId,show:t.showBindPublicIp},on:{setLoading:t.setLoading,closeModal:t.closeBindPublicIp}}),t._v(" "),o("cloud-unbind-public-ip",{attrs:{server_id:t.storageServerId,show:t.showUnbindPublicIp},on:{setLoading:t.setLoading,closeModal:t.closeUnbindPublicIp}}),t._v(" "),o("load-cloud-disk",{attrs:{serverId:t.storageServerId,isStorageServer:t.isStorageServer,show:t.showLoadCloudDisk},on:{getList:t.getDetail,closeModal:t.closeLoadCloudDisk}}),t._v(" "),o("unload-cloud-disk",{attrs:{serverId:t.storageServerId,show:t.showUnloadCloudDisk,componentDetailData:t.data},on:{getList:t.getDetail,closeModal:t.closeUnloadCloudDisk}}),t._v(" "),o("cloud-snapshot",{attrs:{serverId:t.storageServerId,isStorageServer:t.isStorageServer,show:t.showSnapshot},on:{getList:t.getDetail,closeModal:t.closeSnapshot}}),t._v(" "),o("cloud-snapshot-rollback",{attrs:{componentDetailData:t.data,show:t.showSnapshotRollback},on:{getList:t.getDetail,closeModal:t.closeSnapshotRollback}})],1)},staticRenderFns:[]};var S=o("C7Lr")(w,y,!1,function(t){o("Vz65"),o("TRBe")},"data-v-4e9ac1df",null).exports,D={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",justify:"end"}},[o("el-col",{attrs:{span:6}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:22}},[o("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),o("el-col",{attrs:{span:2}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getList}})],1)],1)],1)],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedData},on:{"sort-change":t.sort}},[o("el-table-column",{attrs:{sortable:"custom",label:t.lang.common.name,prop:"name"}}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"status",label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{staticClass:"status",class:t.lang.resource.componentTaskState.hasOwnProperty(e.row.task_state)?"bg-blue":t.statusClass(e.row.status)},[t._v("\n                    "+t._s(t.lang.resource.componentTaskState.hasOwnProperty(e.row.task_state)?t.lang.resource.componentTaskState[e.row.task_state]:t.lang.resource.componentStatusArray[e.row.status])+"\n                    "),t.lang.resource.componentTaskState.hasOwnProperty(e.row.task_state)?o("i",{staticClass:"el-icon-loading"}):t._e()])]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"imageName",label:t.lang.resource.imageName}}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"fixedIps",label:t.lang.outside.privateIp},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{domProps:{innerHTML:t._s(e.row.fixedIps.join("</br>"))}})]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"floatingIps",label:t.lang.outside.publicIp},scopedSlots:t._u([{key:"default",fn:function(e){return[o("span",{domProps:{innerHTML:t._s(e.row.floatingIps.join("</br>"))}})]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"createtime",label:t.lang.common.create_time},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(t._f("utc2beijing")(e.row.createtime))+"\n            ")]}}])}),t._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"hostName",label:t.lang.resource.hostName}})],1),t._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.filterData.length>t.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.filterData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1)],1)},staticRenderFns:[]},C=o("C7Lr")({props:["poolId"],data:function(){return{loading:!0,tableData:[],search:"",pageNum:1,pageSize:10}},created:function(){this.getList()},components:{},methods:{statusClass:function(t){switch(t){case"ACTIVE":return"cloud-success";case"ERROR":return"cloud-error";case"SUSPENDED":return"cloud-fault";case"SHUTOFF":return"cloud-info";case"PAUSED":case"RESIZE":case"REVERT_RESIZE":case"UNKNOWN":return"cloud-warning";default:return"cloud-default"}},sort:function(t){this.tableData=this.common.sort(t,this.tableData)},getList:function(){var t=this;t.loading=!0;var e=this.common.formatMsg(this.api.cloud.get_pools_detail_servers,{pool_id:t.poolId});this.checkError(this.$http({url:e,method:"get"}),function(e){t.loading=!1,t.tableData=e.data.filter(function(t){return"fixedImageInstanceName"===t.name})},function(e){t.loading=!1})},pageSelect:function(t){this.pageNum=t}},computed:{filterData:function(){var t=this.search,e=[];return e=""===t?this.tableData:this.common.cloudFilter(this.tableData,t),e},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},D,!1,null,null,null).exports,I={components:{Monitor:m,panaBreadcrumb:a.a,businessComponent:p.default,storageComponent:S,imageComponent:C},data:function(){return{id:"",storageServerId:"",data:{},activeName:"businessComponent",loading:!0}},mounted:function(){this.id=this.$route.params.id,self.loading=!0,this.getStorageServerId(),this.getDetail()},methods:{getStorageServerId:function(){var t=this;JSON.parse(sessionStorage.getItem("panaPools")).map(function(e){e.id===t.id&&(t.storageServerId=e.stor_server_id)})},getDetail:function(){var t=this,e=this.common.formatMsg(this.api.cloud.get_pools_detail,{pool_id:t.id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.loading=!1,t.data=e.data,t.data.memory_limit=t.common.switchCapacity(t.data.memory_limit,"MB","GB",0)})}}},M={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{class:{"monitor-active":"monitor"===t.activeName},attrs:{id:"resourceDashboard"}},[o("pana-breadcrumb",{attrs:{back:!0}}),t._v(" "),o("el-main",[o("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:t.lang.resource.businessComponent,name:"businessComponent"}},[""!=t.id&&"businessComponent"===t.activeName?o("business-component",{attrs:{poolId:t.id,currentPool:t.data}}):t._e()],1),t._v(" "),o("el-tab-pane",{attrs:{label:t.lang.resource.storageComponent,name:"storageComponent"}},["storageComponent"===t.activeName?o("storage-component",{attrs:{poolId:t.id}}):t._e()],1),t._v(" "),o("el-tab-pane",{attrs:{label:t.lang.resource.imageComponent,name:"imageComponent"}},["imageComponent"===t.activeName?o("image-component",{attrs:{poolId:t.id}}):t._e()],1),t._v(" "),o("el-tab-pane",{attrs:{label:t.lang.common.detail,name:"detail"}},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cloud-detail"},[t.data.hasOwnProperty("name")?o("table",[o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.name))]),t._v(" "),o("td",[t._v(t._s(t.data.name))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.description))]),t._v(" "),o("td",[t._v(t._s(t.data.description))])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.cpu))]),t._v(" "),o("td",[t._v(t._s(t.data.cpu_limit+t.lang.resource.core))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.common.memory))]),t._v(" "),o("td",[t._v(t._s(t.data.memory_limit+t.lang.common.GB))])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.GPUQuota))]),t._v(" "),o("td",[t._v(t._s(t.data.gpu_quota))]),t._v(" "),o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.poolQuota))]),t._v(" "),o("td",[t._v(t._s(t.data.stor_limit+t.lang.common.GB))])]),t._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.resource.componentNum))]),t._v(" "),o("td",[t._v(t._s(t.data.servers_num))]),t._v(" "),o("td",{staticClass:"cloud-label"}),t._v(" "),o("td")])]):t._e()])]),t._v(" "),o("el-tab-pane",{attrs:{label:t.lang.resource.monitor,name:"monitor"}},["monitor"===t.activeName?o("monitor",{attrs:{poolId:t.id}}):t._e()],1)],1)],1)],1)},staticRenderFns:[]};var x=o("C7Lr")(I,M,!1,function(t){o("sSFg"),o("m9/R")},"data-v-38d4c811",null);e.default=x.exports},jmpZ:function(t,e){},laRw:function(t,e){},"m9/R":function(t,e){},oEl3:function(t,e){},oIPs:function(t,e,o){"use strict";var a=o("aA9S"),s=o.n(a),i={props:{show:Boolean,isStorageServer:Boolean,serverId:String},components:{},data:function(){return{noSelectVolume:!1,timedSnapshot:!1,diskIds:{},systemOptions:[],dataDiskOptions:[],form:{systemDisk:[],dataDisk:[],holdNumber:1,frequency:"",unit:"",startTime:""},pickerOptions:{shortcuts:[{text:"今天",onClick:function(t){t.$emit("pick",new Date)}}],disabledDate:function(t){return t.getTime()<Date.now()-864e5}},confirmDisabled:!1,rules:{startTime:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validateCurrentTime,message:this.lang.planTask.timeInvalid,trigger:"blur"}]},loading:!1}},methods:{validateTimeInterval:function(t){var e=this;t&&""!==e.form.frequency?setTimeout(function(){e.$refs.form.validateField("frequency",function(t){if(t)return!1})},0):e.$refs.form.clearValidate()},initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getDiskInfo()},getDiskInfo:function(){var t=this,e=t.common.formatMsg(t.api.cloud.server_snapshot_volumes,{server_id:t.serverId});this.loading=!0,this.checkError(this.$http({url:e,method:"get"}),function(e){var o=e.data.diskInfo;t.diskIds=e.data.diskId,(o=(o=(o=(o=o.filter(function(t){return"iso"!=t.diskFormat&&("in-use"==t.status||"available"==t.status)})).filter(function(t){return!t.magrationing})).filter(function(t){return t.storageLimit&&t.storageLimit.snapshots})).filter(function(t){return!(t.storageLimit&&!t.storageLimit.share_volumes_snapshots&&t.attachments.length>1)})).forEach(function(e){"true"===e.bootable&&e.device.endsWith("da")?t.systemOptions.push(e):t.dataDiskOptions.push(e)}),t.loading=!1},function(){t.loading=!1})},confirm:function(){var t=this,e=this,o={},a="",s=[],i="",n=e.form.systemDisk.concat(e.form.dataDisk);this.$refs.form.validate(function(r){if(r){if(0===n.length)return e.noSelectVolume=!0,!1;t.confirmDisabled=!0,e.timedSnapshot?(a=e.api.operation.post_jobs_add,o.volumeIds=n,o.serverId=e.serverId,o.startTime=e.moment(e.form.startTime).format("YYYY-MM-DD HH:mm"),o.unit=e.form.unit||"once",e.form.unit&&(o.holdNumber=e.form.holdNumber,o.frequency=e.form.frequency),i=e.lang.resource.operationSuccess):(a=e.api.storage.getSnapshot,n.forEach(function(t){s.push(e.diskIds[t])}),o.name=s,o.volume_id=n,i=e.lang.resource.snapshotCreateSuccess),e.closeModal(!1),e.checkError(e.$http({url:a,data:o,method:"POST"}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:i})})}})},closeModal:function(){s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{maxTimeInterval:function(){switch(this.form.unit){case"hour":return 168;case"day":return 31;case"week":case"month":return 99}}}},n={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{id:"component-snapshot",title:t.lang.resource.snapshot,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[t.timedSnapshot?o("el-alert",{attrs:{title:t.lang.resource.snapshotInfo,type:"bg-blue",closable:!1}}):t._e(),t._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"120px",rules:t.rules,"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.componentSystemDisk}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.resource.snapshotDiskInfo)},slot:"content"}),t._v(" "),o("i",{staticClass:"el-icon-info"})])],1),t._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:"",multiple:"",disabled:0===t.systemOptions.length,placeholder:0===t.systemOptions.length?t.lang.resource.componentSystemDiskPlaceholder[1]:t.lang.resource.componentSystemDiskPlaceholder[0]},model:{value:t.form.systemDisk,callback:function(e){t.$set(t.form,"systemDisk",e)},expression:"form.systemDisk"}},t._l(t.systemOptions,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.componentDataDisk}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.resource.snapshotDiskInfo)},slot:"content"}),t._v(" "),o("i",{staticClass:"el-icon-info"})])],1),t._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:"",multiple:"",disabled:t.isStorageServer||0===t.dataDiskOptions.length,placeholder:0===t.dataDiskOptions.length?t.lang.resource.dataDiskPlaceholder[1]:t.lang.resource.dataDiskPlaceholder[0]},model:{value:t.form.dataDisk,callback:function(e){t.$set(t.form,"dataDisk",e)},expression:"form.dataDisk"}},t._l(t.dataDiskOptions,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),t.noSelectVolume&&0===t.form.systemDisk.length&&0===t.form.dataDisk.length?o("span",{staticClass:"el-form-item__error"},[t._v(t._s(t.lang.resource.noSelectSnapVolume))]):t._e()],1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.timedSnapshot}},[o("el-col",{attrs:{span:1}},[t._v("\n                 \n            ")]),t._v(" "),o("el-col",{attrs:{span:23}},[o("el-switch",{model:{value:t.timedSnapshot,callback:function(e){t.timedSnapshot=e},expression:"timedSnapshot"}})],1)],1),t._v(" "),t.timedSnapshot?o("div",[o("el-form-item",{attrs:{label:t.lang.resource.executionFrequency}},[o("el-col",{attrs:{span:1}},[t._v("\n                     \n                ")]),t._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:""},on:{change:t.validateTimeInterval},model:{value:t.form.unit,callback:function(e){t.$set(t.form,"unit",e)},expression:"form.unit"}},t._l(t.lang.resource.executionFrequencyValue,function(t){return o("el-option",{key:t.unit,attrs:{label:t.name,value:t.unit}})}),1)],1)],1),t._v(" "),t.form.unit?o("el-form-item",{attrs:{label:t.lang.resource.timeInterval,prop:"frequency",rules:[{required:!0,message:t.lang.common.required_item,trigger:"blur"},{type:"integer",min:1,max:t.maxTimeInterval,message:t.common.formatMsg(t.lang.resource.invalidTimeInterval,{max:t.maxTimeInterval}),trigger:"blur"}]}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.resource.timeIntervalInfo)},slot:"content"}),t._v(" "),o("i",{staticClass:"el-icon-info"})])],1),t._v(" "),o("el-col",{attrs:{span:12}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:t.lang.resource.timeIntervalPlaceholder,type:"number"},nativeOn:{mousewheel:function(t){t.preventDefault()}},model:{value:t.form.frequency,callback:function(e){t.$set(t.form,"frequency",t._n(e))},expression:"form.frequency"}})],1),t._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:4}},[t._v("\n                    "+t._s(t.lang.resource.timeUnit[t.form.unit])+"\n                ")])],1):t._e(),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.executionFirstTime,prop:"startTime"}},[o("el-col",{attrs:{span:1}},[t._v("\n                     \n                ")]),t._v(" "),o("el-col",{attrs:{span:12}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:t.lang.resource.datePlaceholder,align:"right","picker-options":t.pickerOptions},model:{value:t.form.startTime,callback:function(e){t.$set(t.form,"startTime",e)},expression:"form.startTime"}})],1)],1),t._v(" "),t.form.unit?o("el-form-item",{attrs:{label:t.lang.resource.snapshotsReservations}},[o("el-col",{attrs:{span:1}},[t._v("\n                     \n                ")]),t._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:""},model:{value:t.form.holdNumber,callback:function(e){t.$set(t.form,"holdNumber",e)},expression:"form.holdNumber"}},t._l(t.lang.resource.snapshotsReservationsValue,function(t){return o("el-option",{key:t,attrs:{label:t,value:t}})}),1)],1)],1):t._e()],1):t._e()],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.confirmDisabled},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(i,n,!1,function(t){o("8zeT"),o("rCO8")},"data-v-045a79f6",null);e.a=r.exports},rCO8:function(t,e){},rd24:function(t,e){},rhbP:function(t,e){},sSFg:function(t,e){},sYc6:function(t,e){},soUv:function(t,e){},"t/+v":function(t,e){},xrNV:function(t,e){},zLDf:function(t,e,o){"use strict";var a=o("aA9S"),s=o.n(a),i=o("ZLEe"),n=o.n(i),r={props:{show:Boolean,componentDetailData:Object},components:{},data:function(){return{noSelectSnap:!1,systemSnapshots:[],snapshots:[],systemSnapshotOptions:[],dataDiskSnapshots:[],dataDiskSnapshotOptions:[],form:{systemDisk:[],dataDisk:[]},confirmDisabled:!1,loading:!1}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getSnapshots()},systemSnapshotChange:function(t){t.length>0?this.systemSnapshotOptions=[]:this.systemSnapshotOptions=this.systemSnapshots,this.$refs.systemDisk.blur()},dataDiskSnapshotChange:function(t){var e=this,o="",a=e.dataDiskSnapshots;t.forEach(function(t){e.dataDiskSnapshots.filter(function(e){if(e.id===t)return o=e.volume_id,!0}),a=a.filter(function(t){return t.volume_id!==o})}),e.dataDiskSnapshotOptions=a,0===e.dataDiskSnapshotOptions.length&&this.$refs.dataDisk.blur()},getSnapshots:function(){var t=this,e=n()(this.componentDetailData.diskId);this.loading=!0,this.checkError(this.$http({url:this.api.storage.snapshotDetail,method:"POST",data:{volume_id:e}}),function(e){var o=e.data,a="";t.snapshots=o,t.componentDetailData.diskInfo.filter(function(t){t.is_sys_disk&&(a=t.id)}),o.forEach(function(e){e.volume_id===a?t.systemSnapshots.push(e):t.dataDiskSnapshots.push(e)}),t.systemSnapshotOptions=t.systemSnapshots,t.dataDiskSnapshotOptions=t.dataDiskSnapshots,t.loading=!1},function(){t.loading=!1})},confirm:function(){var t,e=!0,o=this,a=o.form.dataDisk.concat(o.form.systemDisk),s=[];return this.$refs.form.validate(function(t){t||(e=!1)}),!!e&&(0===a.length?(o.noSelectSnap=!0,!1):(this.confirmDisabled=!0,t=this.api.storage.snapshotRollback,o.snapshots.forEach(function(t){a.includes(t.id)&&s.push({volumeId:t.volume_id,snapshotId:t.id})}),o.closeModal(!1),void this.checkError(this.$http({url:t,data:{volume_snapshots:s},method:"POST"}),function(t){o.$emit("getList"),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.volume.snapshotRollbackSuccess})})))},closeModal:function(){s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}}},l={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{attrs:{title:t.lang.resource.snapshotRollback,visible:t.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"form",attrs:{model:t.form,"label-width":"120px","element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:t.lang.resource.systemSnapshot}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.resource.snapshotRollbackHelp)},slot:"content"}),t._v(" "),o("i",{staticClass:"el-icon-info"})])],1),t._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{ref:"systemDisk",attrs:{filterable:"",multiple:"",disabled:0===t.systemSnapshotOptions.length&&0===t.form.systemDisk.length,placeholder:0===t.systemSnapshotOptions.length?t.lang.resource.SystemDiskSnapshotPlaceholder[1]:t.lang.resource.SystemDiskSnapshotPlaceholder[0]},on:{change:t.systemSnapshotChange},model:{value:t.form.systemDisk,callback:function(e){t.$set(t.form,"systemDisk",e)},expression:"form.systemDisk"}},t._l(t.systemSnapshotOptions,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1)],1)],1),t._v(" "),o("el-form-item",{attrs:{label:t.lang.resource.dataDiskSnapshot}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.lang.resource.snapshotRollbackHelp)},slot:"content"}),t._v(" "),o("i",{staticClass:"el-icon-info"})])],1),t._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{ref:"dataDisk",attrs:{filterable:"",multiple:"",disabled:0===t.dataDiskSnapshotOptions.length&&0===t.form.dataDisk.length,placeholder:0===t.dataDiskSnapshotOptions.length?t.lang.resource.dataDiskSnapshotPlaceholder[1]:t.lang.resource.dataDiskSnapshotPlaceholder[0]},on:{change:t.dataDiskSnapshotChange},model:{value:t.form.dataDisk,callback:function(e){t.$set(t.form,"dataDisk",e)},expression:"form.dataDisk"}},t._l(t.dataDiskSnapshotOptions,function(t){return o("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}),1),t._v(" "),t.noSelectSnap&&0===t.form.systemDisk.length&&0===t.form.dataDisk.length?o("span",{staticClass:"el-form-item__error"},[t._v(t._s(t.lang.resource.noSelectSnap))]):t._e()],1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))]),t._v(" "),o("el-button",{attrs:{type:"primary",disabled:t.confirmDisabled},on:{click:t.confirm}},[t._v(t._s(t.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var c=o("C7Lr")(r,l,!1,function(t){o("E8Uc")},"data-v-30c9e158",null);e.a=c.exports}});