webpackJsonp([23],{Dd1Q:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("1JPr"),l=o("aA9S"),i=o.n(l),a={name:"pana-create-role",props:{show:Boolean},methods:{closeModal:function(e){var t={refresh:e=e||!1,permission:this.isAddPermission};!0===this.isAddPermission&&(t.createdId=this.createdId),i()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",t)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.roleLoading=!1},createRole:function(){var e=this,t=this.form,o=!0;if(this.$refs.form.validate(function(e){e||(o=!1)}),!o)return!1;t=this.common.dropEmptyParameter(t),this.checkError(this.$http({url:this.api.management.post_roles,method:"post",data:t}),function(t){e.createdId=t.data.id,e.$notify({title:e.lang.common.success,type:"success",message:e.lang.roleManage.createRoleSuccess}),e.closeModal(!0)})},addPermission:function(){this.isAddPermission=!0,this.createRole()}},data:function(){return{labelWidth:"100px",form:{role_name:"",description:""},isAddPermission:!1,createdId:null,rules:{role_name:[{required:!0,message:this.lang.roleManage.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.roleManage.nameLengthRule,trigger:"blur"},{validator:this.common.validateDefaultName,message:this.lang.roleManage.nameFormatRule,trigger:"blur"}],description:[{min:1,max:100,message:this.lang.roleManage.descriptionLengthRule,trigger:"blur"}]},roleLoading:!0}}},r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.roleLoading,expression:"roleLoading"}],attrs:{title:e.lang.roleManage.createRole,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.common.name,"label-width":e.labelWidth,prop:"role_name"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{placeholder:e.lang.roleManage.roleNamePlaceholder},model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name",t)},expression:"form.role_name"}})],1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.common.description,"label-width":e.labelWidth,prop:"description"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.roleManage.descriptionPlaceholder},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.addPermission}},[e._v(e._s(e.lang.roleManage.addPermission))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.createRole}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var s=o("C7Lr")(a,r,!1,function(e){o("eHlJ")},"data-v-36de13e5",null).exports,c={name:"pana-delete-role",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteRole:function(){this.closeModal(!0)}}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.roleManage.deleteRoleInfo))])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.deleteRole}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},m=o("C7Lr")(c,d,!1,null,null,null).exports,h={name:"pana-create-role",props:{show:Boolean,roleObj:Object},methods:{closeModal:function(e){e=e||!1,i()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.roleLoading=!1,this.form.role_name=this.roleObj.role_name,this.form.description=this.roleObj.description},editRole:function(){var e=this,t=this.form,o=!0;if(this.$refs.form.validate(function(e){e||(o=!1)}),!o)return!1;t=this.common.dropEmptyParameter(t),this.checkError(this.$http({url:this.common.formatMsg(this.api.management.put_roles_detail,{id:this.roleObj.id}),method:"put",data:t}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.roleManage.editRoleSuccess}),e.closeModal(!0)})}},data:function(){return{labelWidth:"100px",form:{role_name:"",description:""},rules:{role_name:[{required:!0,message:this.lang.roleManage.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.roleManage.nameLengthRule,trigger:"blur"},{validator:this.common.validateDefaultName,message:this.lang.roleManage.nameFormatRule,trigger:"blur"}],description:[{min:1,max:80,message:this.lang.roleManage.descriptionLengthRule,trigger:"blur"}]},roleLoading:!0}}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.roleLoading,expression:"roleLoading"}],attrs:{title:e.lang.roleManage.editRole,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.common.name,"label-width":e.labelWidth,prop:"role_name"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{placeholder:e.lang.roleManage.roleNamePlaceholder},model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name",t)},expression:"form.role_name"}})],1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.common.description,"label-width":e.labelWidth,prop:"description"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{type:"textarea",rows:3,placeholder:e.lang.roleManage.descriptionPlaceholder},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.editRole}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var f=o("C7Lr")(h,u,!1,function(e){o("Pkx0")},"data-v-6211bf7f",null).exports,p=o("3cXf"),g=o.n(p),_={name:"pana-set-permission",props:{show:Boolean,roleId:String},computed:{children:function(){var e=JSON.parse(g()(this.menuOrigin)),t={};if(e.length>0)for(var o=0;o<e.length;o++)null==e[o].parent_id&&(e[o].parent_id=0),e[o].menu_name=this.lang.nav[e[o].menu_name],!0===this.common.isArray(t[e[o].parent_id])?t[e[o].parent_id].push(e[o]):t[e[o].parent_id]=[e[o]];return t},menu:function(){return this.menuOrigin.length>0?this.formatMenu(this.children,0):[]}},watch:{"form.menu_id":function(e){this.$refs.tree.setCheckedKeys(e)},childrenCount:function(){this.isIndeterminate=this.childrenCount>0&&this.menuChildren.length>this.childrenCount,this.checkedAll=this.menuChildren.length===this.childrenCount&&0!==this.childrenCount},menuChildren:function(){this.$refs.tree.setCheckedKeys(this.form.menu_id),this.isIndeterminate=this.childrenCount>0&&this.menuChildren.length>this.childrenCount,this.checkedAll=this.menuChildren.length===this.childrenCount&&0!==this.menuChildren.length}},methods:{closeModal:function(e){e=e||!1,i()(this.$data,this.$options.data.call(this));var t={refresh:e,permission:this.isAddPermission};!0===this.isAddPermission&&(t.createdId=this.createdId),this.$emit("closeModal",t)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getAllMenu(),this.getSelectList(),this.permissionLoading=!1},addPermission:function(){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.management.put_roles_detail_permission,{id:this.roleId}),method:"put",data:this.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.roleManage.setPermissionSuccess}),e.closeModal(!0)})},getAllMenu:function(){var e=this;this.checkError(this.$http({url:this.api.management.get_menus,method:"get"}),function(t){e.menuOrigin=t.data})},formatMenu:function(e,t){for(var o=e[t],n=0;n<o.length;n++)null!=e[o[n].id]&&o[n].level<2?(o[n].children=this.formatMenu(e,o[n].id),o[n].isLeaf=!1):o[n].isLeaf=!0;return o},clickNode:function(e){var t=this;this.childrenCount=0,2===e.level?(this.menuChildren=this.children[e.id],this.menuChildren.map(function(e){t.form.menu_id.indexOf(e.id)>=0&&t.childrenCount++})):this.menuChildren=[]},getSelectList:function(){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.management.get_roles_detail_permission,{id:this.roleId}),method:"get"}),function(t){t.data.map(function(t){e.form.menu_id.push(t.id)})})},childChange:function(e,t){!0===e?(this.childrenCount++,this.addParent(parseInt(t.target.value))):this.childrenCount--},checkTree:function(e,t){!0===t?this.addParent(e.id):this.removeChildren(e.id)},addParent:function(e){this.form.menu_id.indexOf(e)<0&&this.form.menu_id.push(e);var t=null;this.menuOrigin.map(function(o){if(o.id===e)return t=o,!0}),null!=t.parent_id&&this.addParent(t.parent_id)},removeChildren:function(e){var t=this.form.menu_id.indexOf(e);if(t>=0&&this.form.menu_id.splice(t,1),this.children.hasOwnProperty(e)){var o=this;this.children[e].map(function(e){o.removeChildren(e.id)})}},checkAllAction:function(){var e=this,t=null;this.menuChildren.map(function(o){var n=e.form.menu_id.indexOf(o.id);n<0&&!0===e.checkedAll?(e.form.menu_id.push(o.id),e.childrenCount++,t=o.parent_id):n>=0&&!1===e.checkedAll&&(e.form.menu_id.splice(n,1),e.childrenCount--)}),null!=t&&this.addParent(t)}},data:function(){return{permissionLoading:!0,menuOrigin:[],menuChildren:[],checkedAll:!1,childrenCount:0,isIndeterminate:!1,form:{menu_id:[]},defaultProps:{children:"children",label:"menu_name"}}}},v={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.permissionLoading,expression:"permissionLoading"}],staticClass:"permission",attrs:{title:e.lang.roleManage.permissionSet,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{"label-position":"right"}},[o("el-container",[o("el-aside",[o("el-tree",{ref:"tree",staticClass:"navigation-left",attrs:{data:e.menu,"show-checkbox":"",props:e.defaultProps,"node-key":"id","highlight-current":"","check-strictly":""},on:{"check-change":e.checkTree,"node-click":e.clickNode}})],1),e._v(" "),o("el-main",[o("el-row",[o("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.checkAllAction},model:{value:e.checkedAll,callback:function(t){e.checkedAll=t},expression:"checkedAll"}},[e._v("\n                        "+e._s(e.lang.roleManage.selectAll)+"\n                    ")])],1),e._v(" "),o("hr"),e._v(" "),o("el-row",[o("el-checkbox-group",{model:{value:e.form.menu_id,callback:function(t){e.$set(e.form,"menu_id",t)},expression:"form.menu_id"}},e._l(e.menuChildren,function(t,n){return o("el-checkbox",{key:n,attrs:{label:t.id},on:{change:e.childChange}},[e._v("\n                            "+e._s(t.menu_name)+"\n                        ")])}),1)],1)],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.addPermission}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var b=o("C7Lr")(_,v,!1,function(e){o("IABi"),o("ZdFi")},"data-v-990a7f4c",null).exports,w={name:"role-manage",components:{"pana-breadcrumb":n.a,"pana-create-role":s,"pana-delete-role":m,"pana-edit-role":f,"pana-set-permission":b},data:function(){return{pageSize:10,roleSearch:"",roleTable:[],roleSelectionIds:[],rolePage:1,showCreateRole:!1,showDeleteRole:!1,showEditRole:!1,showPermission:!1,roleTotal:0,roleObj:null,permissionId:null,loading:!1}},methods:{switchRolePage:function(e){this.rolePage=e,this.getRoleList()},closeCreateRole:function(e){!0===e.refresh&&(this.getRoleList(),!0===e.permission&&this.setPermission(e.createdId)),this.showCreateRole=!1},closeDeleteRole:function(e){var t=this;if(this.showDeleteRole=!1,!0===e){var o=this.api.management.delete_roles+this.common.formatGetUrl({rid:this.roleSelectionIds});this.checkError(this.$http.delete(o),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.roleManage.deleteRoleSuccess}),t.getRoleList()}),t.roleSelectionIds=[]}},getRoleList:function(){var e=this,t={search:this.roleSearch,page:this.rolePage};t=this.common.dropEmptyParameter(t),this.loading=!0,this.checkError(this.$http({url:this.api.management.get_roles+this.common.formatGetUrl(t),method:"get"}),function(t){e.loading=!1,e.roleTable=t.data,e.roleTotal=t.total},function(){e.loading=!1})},selectRoleIds:function(e){var t=[];e.forEach(function(e){t.push(e.id)}),this.roleSelectionIds=t},setPermission:function(e){this.permissionId=e,this.showPermission=!0},editRole:function(e){this.roleObj=e,this.showEditRole=!0},closeEditRole:function(e){this.showEditRole=!1,!0===e&&this.getRoleList()},searchRole:function(){this.rolePage=1,this.getRoleList()}},mounted:function(){this.getRoleList()}},R={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",{attrs:{type:"flex",direction:"vertical"}},[o("pana-breadcrumb"),e._v(" "),o("el-main",[o("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:6}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreateRole=!0}}},[e._v("\n                    "+e._s(e.lang.roleManage.createRole)+"\n                ")]),e._v(" "),o("el-button",{attrs:{disabled:0===e.roleSelectionIds.length},on:{click:function(t){e.showDeleteRole=!0}}},[e._v("\n                    "+e._s(e.lang.common.delete)+"\n                ")])],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-input",{attrs:{placeholder:e.lang.roleManage.roleSearchPlaceholder,"suffix-icon":"el-icon-search"}})],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:22}},[o("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},on:{change:e.searchRole},model:{value:e.roleSearch,callback:function(t){e.roleSearch=t},expression:"roleSearch"}})],1),e._v(" "),o("el-col",{attrs:{span:2}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getRoleList}})],1)],1)],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.roleTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectRoleIds}},[o("el-table-column",{attrs:{type:"selection"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.name,prop:"role_name"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.description,prop:"description"}}),e._v(" "),o("el-table-column",{attrs:{prop:"create_time",label:e.lang.common.createTime},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e._f("utc2beijing")(t.row.create_time))+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.editRole(t.row)}}},[e._v("\n                        "+e._s(e.lang.common.edit)+"\n                    ")]),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.setPermission(t.row.id)}}},[e._v("\n                        "+e._s(e.lang.roleManage.permission)+"\n                    ")])]}}])})],1),e._v(" "),o("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.roleTotal>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.roleTotal,"page-count":e.roleTotal/e.pageSize%e.pageSize==0?e.roleTotal/e.pageSize:e.roleTotal/e.pageSize+1},on:{"current-change":e.switchRolePage}}):e._e()],1),e._v(" "),o("pana-create-role",{attrs:{show:e.showCreateRole},on:{closeModal:e.closeCreateRole}}),e._v(" "),o("pana-delete-role",{attrs:{show:e.showDeleteRole},on:{closeModal:e.closeDeleteRole}}),e._v(" "),o("pana-edit-role",{attrs:{show:e.showEditRole,roleObj:e.roleObj},on:{closeModal:e.closeEditRole}}),e._v(" "),o("pana-set-permission",{attrs:{show:e.showPermission,roleId:e.permissionId},on:{closeModal:function(t){e.showPermission=!1}}})],1)],1)},staticRenderFns:[]};var k=o("C7Lr")(w,R,!1,function(e){o("L1Hn")},"data-v-c9b49134",null);t.default=k.exports},IABi:function(e,t){},L1Hn:function(e,t){},Pkx0:function(e,t){},ZdFi:function(e,t){},eHlJ:function(e,t){}});