webpackJsonp([27],{"0kdu":function(e,t){},cBcb:function(e,t){},ctwa:function(e,t){},fn5u:function(e,t){},ozqk:function(e,t,o){"use strict";var a=o("aA9S"),l=o.n(a),n={name:"pana-edit-router",props:{show:Boolean,network:Object,netIndex:String},methods:{closeModal:function(e){l()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.form.name=this.network.name},editNetwork:function(){this.disable=!0;var e=this;this.$refs.form.validate(function(t){t?e.checkError(e.$http({url:e.common.formatMsg(e.api.cloud.put_networks_detail,{network_id:e.network.id}),method:"put",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:"pool"===e.netIndex?e.lang.pool.editPoolSuccess:e.lang.outside.editNetworkSuccess}),e.closeModal(!0)},function(){e.disable=!1}):e.disable=!1})}},computed:{titleFlag:function(){return"outside"==this.netIndex}},data:function(){return{labelWidth:"120px",form:{name:null},rules:{name:[{required:!0,message:this.lang.router.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.router.nameLengthRule,trigger:"blur"},{validator:this.common.validateNetworkName,message:this.lang.outside.nameFormatRule,trigger:"blur"}]},disable:!1}}},s={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.titleFlag?e.lang.outside.editOutNetwork:e.lang.pool.outsideEditNetwork,width:"45%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.outside.networkName,"label-width":e.labelWidth,prop:"name"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{placeholder:e.lang.outside.networkNamePlaceholder,required:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.editNetwork}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(n,s,!1,function(e){o("ctwa")},"data-v-0c1f03c5",null);t.a=r.exports},sMBl:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("3cXf"),l=o.n(a),n=o("1JPr"),s=o("yRx0"),r={name:"pana-delete-group",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deletePool:function(){this.closeModal(!0)}}},i={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.pool.deletePoolInfo))])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.deletePool}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},c=o("C7Lr")(r,i,!1,null,null,null).exports,p=o("aA9S"),u=o.n(p),d={name:"pana-create-pool",components:{"pana-ip-input":o("Cj+A").a},props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,u()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.checkPoolAdmin(),this.getPhysicsNetwork(),this.getExistVlanIds(),this.getNetworkTypes()},getPhysicsNetwork:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_networks_availablePrivateNetwork,method:"get"}),function(t){e.loading=!1,e.originPhysics=t.data,e.physics=e.originPhysics.filter(function(t){return t.networkType.toLowerCase()===e.currentNetworkType}).map(function(e){var t=e.networkName.split(":");return e.name=t[0]+":"+t[1]+"-"+t[2],e}),e.physics.length>0&&(e.physicNetwork=0,e.checkPhysicNetwork())},function(){e.loading=!1})},newAddress:function(){this.form.subnet.allocation_pools.push({start:"",end:""})},deleteAddress:function(e){this.form.subnet.allocation_pools.splice(e,1)},validateGatewayIp:function(e,t,o){var a=this.common.getRangeInCidr(this.form.subnetIp+"/"+this.common.switchToNumberCount(this.form.subnetMask)).start;null==t||""===t?o():this.enableGateway&&this.form.subnet.gateway_ip==t?o(new Error(this.lang.outside.gatewayIpUsed)):a==t?o(new Error(this.lang.outside.gatewayIpUsed)):o()},validateGatewayIpArr:function(e,t,o){var a=this,l=this.form.subnet.allocation_pools;null==t||""===t?o():l.map(function(e,l){e.start&&e.end&&(a.common.getLargerIp(e.start,t)===t&&a.common.getLargerIp(t,e.end)===e.end?o(new Error(a.lang.outside.gatewayOccupancy)):o())})},createPool:function(){this.disable=!0;var e=this;this.$refs.form.validate(function(t){t?(e.form.subnet.cidr=e.form.subnetIp+"/"+e.common.switchToNumberCount(e.form.subnetMask),""!==e.form.dnsNameservers&&null!=e.form.dnsNameservers&&(e.form.subnet.dns_nameservers=e.form.dnsNameservers.split(/\n/g)),""!==e.form.hostRoutes&&null!=e.form.hostRoutes&&(e.form.subnet.host_routes=e.formatRouters(e.form.hostRoutes)),e.form.subnet.allocation_pools=e.availableAddress?e.validateAllocation(e.form.subnet.allocation_pools):[],delete e.form.subnetIp,delete e.form.subnetMask,delete e.form.hostRoutes,delete e.form.dnsNameservers,e.form=e.common.dropEmptyParameter(e.form),!1===e.enableGateway&&(e.form.subnet.gateway_ip=null),e.checkError(e.$http({url:e.api.cloud.post_networks,method:"post",data:e.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.pool.createPoolSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},formatRouters:function(e){for(var t=e.split(/\n/g),o=[],a=0;a<t.length;a++){var l={},n=t[a].split(",");l.destination=n[0].replace(/(^\s*)|(\s*$)/g,""),l.nexthop=n[1].replace(/(^\s*)|(\s*$)/g,""),o.push(l)}return o},validateAllocation:function(e){for(var t=[],o=0;o<e.length;o++)null!=e[o].start&&null!=e[o].end&&t.push(e[o]);return t.length>0?t:null},validateMaskFn:function(){this.$refs.form.validateField("subnetMask")},validateIpFn:function(){this.$refs.form.validateField("subnetIp")},checkPhysicNetwork:function(){var e=this.physics[this.physicNetwork];this.form.network.physical_network=e.networkName.split(":")[0];var t=e.networkName.split(":");this.min=t[1],this.max=t[2]},checkStep:function(e){var t=this;e>0?this.$refs.form.validate(function(o){o&&(t.stepIndex+=e)}):(t.stepIndex+=e,null!=this.$refs.form&&this.$refs.form.clearValidate())},validateIpCross:function(e,t,o){var a=this,l=!0;this.form.subnet.allocation_pools.forEach(function(n,s){e.key!==s&&(n.start===t||n.end===t||a.common.getLargerIp(n.start,t)===t&&a.common.getLargerIp(n.end,t)===n.end)&&(o(Error(e.message)),l=!1)}),l&&o()},validateIpCIDRRange:function(e,t,o){var a=this.form.subnetIp+"/"+this.common.switchToNumberCount(this.form.subnetMask),l=this.common.getRangeInCidr(a),n=l.start.replace(/\./g,"")-1,s=l.end.replace(/\./g,"")-0+1;t!==l.start&&t!==l.end?t.replace(/\./g,"")==n?o(Error(this.lang.pool.noNetworkWrite)):t.replace(/\./g,"")==s?o(Error(this.lang.pool.noTelWrite)):this.common.getLargerIp(t,l.end)===t||this.common.getLargerIp(t,l.start)===l.start?o(Error(this.lang.pool.noCIDR)):o():o()},validateIpEndRange:function(e,t,o){null!=e.start&&""!==e.start&&null!=t&&""!==t||o(),this.common.getLargerIp(e.start,t)===e.start?o(Error(e.message)):o()},validateNetmaskRange:function(e,t,o){var a=null==e.min?"255.128.0.0":e.min,l=null==e.max?"255.255.255.248":e.max;this.common.getLargerIp(a,t)===t&&this.common.getLargerIp(t,l)===l?o():o(new Error(e.message))},getExistVlanIds:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_networks_vlanids_inuse,method:"get"}),function(t){e.existVlanIds=t.data.segment_vlan_availabilities})},validateUnused:function(e,t,o){null==t||""===t||-1===this.currentVlanIds.indexOf(t)?o():o(new Error(e.message))},validateGatewayRange:function(e,t,o){null==t||""===t||this.common.getLargerIp(t,e.range.start)===t&&this.common.getLargerIp(t,e.range.end)===e.range.end?o():o(new Error(e.message))},setGatewayRange:function(){var e=/^(?=(\b|\D))(((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))\.){3}((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))(?=(\b|\D))$/;return e.test(this.form.subnetIp)&&e.test(this.form.subnetMask)?(this.enableIpRange=!0,this.common.getRangeInCidr(this.form.subnetIp+"/"+this.common.switchToNumberCount(this.form.subnetMask))):(this.enableIpRange=!1,this.availableAddress=!1,{start:null,end:null})},getNetworkTypes:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_private_networktype,method:"get"}),function(t){e.networkType=[t.data],e.currentNetworkType=t.data.type})},validateDuplicate:function(e,t,o){if(null==t||""===t)o();else{var a=t.split("\n");this.common.hasDuplicate(a)?"dns"===e.type?o(new Error(this.lang.pool.validateDnsDuplicateRule)):o(new Error(this.lang.pool.validateRoutesDuplicateRule)):"dns"===e.type?(e.message=this.lang.pool.dnsFormatRule,this.common.validateDnsServers(e,t,o)):(e.message=this.lang.pool.hostRoutesFormatRule,this.common.validateHostRoutes(e,t,o))}},checkPoolAdmin:function(){var e=this;this.isPoolAdmin=!0,this.common.is_system_admin()||this.common.permissionManage(this,JSON.parse(sessionStorage.getItem("panaCurrentPool")).id,function(){e.isPoolAdmin=!1})}},watch:{currentNetworkType:function(){var e=this;this.physicNetwork=null,this.physics=this.originPhysics.filter(function(t){return t.networkType.toLowerCase()===e.currentNetworkType})},physicNetwork:function(){null==this.physicNetwork?this.currentVlanIds=[]:this.currentVlanIds=this.existVlanIds[0].vlan_id_used},"form.subnetIp":function(){this.gatewayRange=this.setGatewayRange(),this.$refs.form.validateField("subnet.gateway_ip")},"form.subnetMask":function(){this.gatewayRange=this.setGatewayRange(),this.$refs.form.validateField("subnet.gateway_ip")}},data:function(){return{labelWidth:"120px",loading:!1,form:{is_external:!1,network:{name:null,network_type:"vlan",physical_network:null,segmentation_id:null,shared:!1},subnet:{name:null,cidr:"",ip_version:4,gateway_ip:"",enable_dhcp:!0,dns_nameservers:[],host_routes:[],allocation_pools:[{start:null,end:null}]},subnetIp:null,subnetMask:null,dnsNameservers:"",hostRoutes:""},rules:{"network.name":[{required:!0,message:this.lang.pool.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.pool.nameLengthRule,trigger:"blur"},{validator:this.common.validateNetworkName,message:this.lang.pool.nameFormatRule,trigger:"blur"}],"network.network_type":[{required:!0,message:this.lang.pool.typeRequiredRule,trigger:"blur"}],"network.physical_network":[{required:!0,message:this.lang.pool.typeRequiredRule,trigger:"blur"}],"subnet.name":[{required:!0,message:this.lang.pool.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.pool.nameLengthRule,trigger:"blur"},{validator:this.common.validateNetworkName,message:this.lang.pool.nameFormatRule,trigger:"blur"}],subnetIp:[{required:!0,message:this.lang.pool.subnetRequiredRule,trigger:"blur"},{validator:this.common.validateIpAddress,message:this.lang.pool.ipFormatRule,trigger:"blur"}],subnetMask:[{required:!0,message:this.lang.pool.netmaskRequiredRule,trigger:"blur"},{validator:this.common.validateNetMask,message:this.lang.pool.netmaskFormatRule,trigger:"blur"},{validator:this.validateNetmaskRange,message:this.lang.pool.netmaskRangeRule,trigger:"blur"}],dnsNameservers:[{validator:this.validateDuplicate,type:"dns",trigger:"blur"}],hostRoutes:[{validator:this.validateDuplicate,type:"routes",trigger:"blur"}]},originPhysics:[],physics:[],stepIndex:0,currentNetworkType:"vlan",networkType:[],langStepConfig:[this.lang.pool.stepNetwork,this.lang.pool.stepSubnet,this.lang.pool.stepSubnetDetail],availableAddress:!1,enableGateway:!0,physicNetwork:null,disable:!1,existVlanIds:[],currentVlanIds:[],gatewayRange:{start:null,end:null},enableIpRange:!1,isPoolAdmin:!1,min:0,max:65535}}},m={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.pool.newPoolNetwork,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-steps",{attrs:{active:e.stepIndex,"align-center":!0}},e._l(e.langStepConfig,function(t,a){return o("el-step",{key:a,attrs:{title:t},on:{click:function(t){return e.nextStep(a)}}})}),1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:0===e.stepIndex,expression:"stepIndex === 0"}],staticClass:"step-padding-top"},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.networkName,"label-width":e.labelWidth,prop:"network.name"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{placeholder:e.lang.pool.networkNamePlaceholder,required:""},model:{value:e.form.network.name,callback:function(t){e.$set(e.form.network,"name",t)},expression:"form.network.name"}})],1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.networkType,"label-width":e.labelWidth,prop:"network.network_type"}},[o("el-select",{attrs:{filterable:"",placeholder:e.lang.router.attachPlaceholder,width:"100%"},on:{change:function(t){e.currentNetworkType=e.form.network.network_type}},model:{value:e.form.network.network_type,callback:function(t){e.$set(e.form.network,"network_type",t)},expression:"form.network.network_type"}},e._l(e.networkType,function(e,t){return o("el-option",{key:t,attrs:{label:e.type,value:e.type}})}),1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.physicalNetwork,"label-width":e.labelWidth,prop:"network.physical_network"}},[o("el-select",{attrs:{filterable:"",placeholder:e.lang.router.attachPlaceholder,width:"100%"},on:{change:e.checkPhysicNetwork},model:{value:e.physicNetwork,callback:function(t){e.physicNetwork=t},expression:"physicNetwork"}},e._l(e.physics,function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:t}})}),1)],1)],1)],1),e._v(" "),"vlan"===e.currentNetworkType?o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.vlanId,"label-width":e.labelWidth,prop:"network.segmentation_id",rules:[{validator:this.common.validateNumberType,trueValue:this.form.network.segmentation_id,message:this.lang.pool.segmentationNumberRule,trigger:"blur"},{validator:this.common.validateNumberRange,min:this.min,max:this.max,message:this.common.formatMsg(this.lang.pool.vlanIdRangeRule,{min:this.min,max:this.max}),trigger:"blur"},{validator:this.validateUnused,message:this.lang.pool.usedVlanIdRule}]}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{placeholder:e.lang.pool.vlanIdPlaceholder,type:"text"},model:{value:e.form.network.segmentation_id,callback:function(t){e.$set(e.form.network,"segmentation_id",t)},expression:"form.network.segmentation_id"}})],1)],1)],1)],1):e._e(),e._v(" "),!0===e.isPoolAdmin?o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.share,"label-width":e.labelWidth}},[o("el-col",{attrs:{span:16}},[o("el-checkbox",{model:{value:e.form.network.shared,callback:function(t){e.$set(e.form.network,"shared",t)},expression:"form.network.shared"}})],1)],1)],1)],1):e._e()],1),e._v(" "),1===e.stepIndex?o("div",{staticClass:"step-padding-top"},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.subnetName,"label-width":e.labelWidth,prop:"subnet.name"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{placeholder:e.lang.pool.subnetPlaceholder,required:""},model:{value:e.form.subnet.name,callback:function(t){e.$set(e.form.subnet,"name",t)},expression:"form.subnet.name"}})],1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.subnet,"label-width":e.labelWidth,prop:"subnetIp"}},[o("el-col",{attrs:{span:16}},[o("pana-ip-input",{on:{blur:e.validateIpFn},model:{value:e.form.subnetIp,callback:function(t){e.$set(e.form,"subnetIp",t)},expression:"form.subnetIp"}})],1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.common.netmask,"label-width":e.labelWidth,prop:"subnetMask"}},[o("el-col",{attrs:{span:16}},[o("pana-ip-input",{on:{blur:e.validateMaskFn},model:{value:e.form.subnetMask,callback:function(t){e.$set(e.form,"subnetMask",t)},expression:"form.subnetMask"}})],1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.availableAddress,"label-width":e.labelWidth}},[o("el-col",{attrs:{span:16}},[o("el-checkbox",{attrs:{disabled:!e.enableIpRange},model:{value:e.availableAddress,callback:function(t){e.availableAddress=t},expression:"availableAddress"}})],1)],1)],1)],1),e._v(" "),e.availableAddress?o("div",[e._l(e.form.subnet.allocation_pools,function(t,a){return o("el-row",{key:a,attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,"label-width":"50px",prop:"subnet.allocation_pools."+a+".start",rules:[{required:!0,message:e.lang.pool.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpCIDRRange,trigger:"blur"},{validator:e.validateGatewayIp,trigger:"blur"},{validator:e.validateIpCross,message:"不能与已有范围交叉",key:a,trigger:"blur"}]}},[o("el-input",{staticClass:"address",model:{value:t.start,callback:function(o){e.$set(t,"start",o)},expression:"item.start"}})],1),e._v(" "),o("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,"label-width":"50px",prop:"subnet.allocation_pools."+a+".end",rules:[{required:!0,message:e.lang.pool.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.pool.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"},{validator:e.validateIpCIDRRange,trigger:"blur"},{validator:e.validateGatewayIp,trigger:"blur"},{validator:e.validateIpCross,message:"不能与已有范围交叉",key:a,trigger:"blur"}]}},[o("el-input",{staticClass:"address",model:{value:t.end,callback:function(o){e.$set(t,"end",o)},expression:"item.end"}})],1),e._v(" "),o("el-form-item",{staticClass:"address-range-button",attrs:{label:""}},[o("el-button",{attrs:{type:"danger",disabled:1===e.form.subnet.allocation_pools.length},on:{click:function(t){return e.deleteAddress(a)}}},[e._v("\n                                "+e._s(e.lang.common.delete)+"\n                            ")])],1)],1)],1)}),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.availableAddress,"label-width":e.labelWidth}},[o("el-col",{attrs:{span:16}},[o("el-button",{attrs:{type:"primary"},on:{click:e.newAddress}},[e._v("\n                                    "+e._s(e.lang.common.new)+"\n                                ")])],1)],1)],1)],1)],2):e._e(),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.enableGateway,"label-width":e.labelWidth}},[o("el-col",{attrs:{span:16}},[o("el-checkbox",{model:{value:e.enableGateway,callback:function(t){e.enableGateway=t},expression:"enableGateway"}})],1)],1)],1)],1),e._v(" "),e.enableGateway?o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.gatewayIp,"label-width":e.labelWidth,prop:"subnet.gateway_ip",rules:[{validator:this.common.validateIpAddress,message:this.lang.pool.ipFormatRule,trigger:"blur"},{validator:this.validateGatewayRange,range:this.gatewayRange,message:this.common.formatMsg(this.lang.pool.gatewayRangeRule,this.gatewayRange),trigger:"blur"},{validator:e.validateGatewayIpArr,trigger:"blur"}]}},[o("el-tooltip",{attrs:{effect:"dark",content:e.lang.pool.gatewayPlaceholder,placement:"top"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{placeholder:e.lang.pool.gatewayPlaceholder},model:{value:e.form.subnet.gateway_ip,callback:function(t){e.$set(e.form.subnet,"gateway_ip",t)},expression:"form.subnet.gateway_ip"}})],1)],1)],1)],1)],1):e._e(),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.enableDhcp,"label-width":e.labelWidth}},[o("el-col",{attrs:{span:16}},[o("el-checkbox",{model:{value:e.form.subnet.enable_dhcp,callback:function(t){e.$set(e.form.subnet,"enable_dhcp",t)},expression:"form.subnet.enable_dhcp"}})],1)],1)],1)],1)],1):e._e(),e._v(" "),2===e.stepIndex?o("div",{staticClass:"step-padding-top"},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.dnsServer,"label-width":e.labelWidth,prop:"dnsNameservers"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{type:"textarea",rows:4,placeholder:e.lang.pool.dnsServerPlaceholder},model:{value:e.form.dnsNameservers,callback:function(t){e.$set(e.form,"dnsNameservers",t)},expression:"form.dnsNameservers"}})],1)],1)],1)],1),e._v(" "),!0===e.form.subnet.enable_dhcp?o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.pool.addRouter,"label-width":e.labelWidth,prop:"hostRoutes"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{type:"textarea",rows:4,placeholder:e.lang.pool.addRouterPlaceholder},model:{value:e.form.hostRoutes,callback:function(t){e.$set(e.form,"hostRoutes",t)},expression:"form.hostRoutes"}})],1)],1)],1)],1):e._e()],1):e._e()],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),e.stepIndex>0?o("el-button",{on:{click:function(t){return e.checkStep(-1)}}},[e._v(e._s(e.lang.common.prevStep))]):e._e(),e._v(" "),e.stepIndex<2?o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.checkStep(1)}}},[e._v(e._s(e.lang.common.nextStep))]):o("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createPool}},[e._v(e._s(e.lang.common.complete))])],1)],1)},staticRenderFns:[]};var g=o("C7Lr")(d,m,!1,function(e){o("cBcb")},"data-v-bf557d9c",null).exports,h=o("ozqk"),f={name:"cloudDisk",components:{"pana-breadcrumb":n.a,"cloud-info":s.a,"pana-delete-pool":c,"pana-create-pool":g,"pana-edit-pool":h.a},watch:{poolSearch:function(){this.poolPage=1}},computed:{poolFilter:function(){var e=this;return this.poolOrigin.filter(function(t){return""===e.poolSearch||-1!==l()(t).search(e.poolSearch)}).sort(function(t,o){return t[e.sortProp]=null==t[e.sortProp]?"":t[e.sortProp],o[e.sortProp]=null==o[e.sortProp]?"":o[e.sortProp],t[e.sortProp]==o[e.sortProp]?o.created_at-t.created_at:(t[e.sortProp]>o[e.sortProp]?1:-1)*e.sortOrder})},poolTable:function(){return this.poolFilter.length>this.pageSize?this.poolFilter.slice((this.poolPage-1)*this.pageSize,this.poolPage*this.pageSize):this.poolFilter}},data:function(){return{sortOrder:0,sortProp:"",pageSize:10,poolOrigin:[],poolSearch:"",poolPage:1,poolSelectionIds:[],createPool:!1,showCreatePool:!1,showDeletePool:!1,showEditPool:!1,showSetDefault:!0,config:{active:{style:"cloud-success",title:this.lang.common.running},down:{style:"cloud-warning",title:this.lang.common.stop},build:{style:"cloud-fault",title:this.lang.common.buildStatus},error:{style:"cloud-error",title:this.lang.common.errorStatus}},editObj:null,networkType:{flat:this.lang.outside.flat,vlan:this.lang.outside.vlan,xvlan:this.lang.outside.xvlan,gre:this.lang.outside.gre},loading:!1}},methods:{handleEdit:function(e,t){this.editObj=e,this.showEditPool=!0},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.sortProp=e.prop,this.sortOrder=t,this.poolOrigin=this.poolOrigin.sort(function(o,a){switch(e.prop){case"provider:segmentation_id":case"available_ip":return o[e.prop]==a[e.prop]?a.created_at-o.created_at:(o[e.prop]-a[e.prop])*t;default:return o[e.prop]=null==o[e.prop]?"":o[e.prop],a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]==a[e.prop]?a.created_at-o.created_at:(o[e.prop]>a[e.prop]?1:-1)*t}})},switchPoolPage:function(e){this.poolPage=e},selectPool:function(e){var t=[];e.forEach(function(e){t.push(e.id)}),this.poolSelectionIds=t},getPoolData:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_private_networks+"?detail=true",method:"get"}),function(t){e.loading=!1,e.poolOrigin=t.data,e.showSetDefault=!0,t.data.map(function(t){!0===t.is_default&&(e.showSetDefault=!1)})},function(){e.loading=!1})},closeDeletePool:function(e){var t=this;if(this.showDeletePool=!1,!0===e){var o=this.api.cloud.post_networks_patch_delete;this.checkError(this.$http({url:o,method:"post",data:{network_ids:this.poolSelectionIds}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.pool.deletePoolSuccess}),t.getPoolData()}),t.poollSelectionIds=[]}},closeCreatePool:function(e){this.showCreatePool=!1,!0===e&&this.getPoolData()},closeEditPool:function(e){this.showEditPool=!1,!0===e&&this.getPoolData()},setDefaultNet:function(e){var t=this;this.checkError(this.$http({url:this.api.cloud.post_networks_default_network,method:"post",data:{network_id:e}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.pool.setDefaultNetSuccess}),t.getPoolData()})}},mounted:function(){this.getPoolData()}},b={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",{attrs:{type:"flex",direction:"vertical"}},[o("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getPoolData}}),e._v(" "),o("el-main",[o("el-row",[o("cloud-info",{attrs:{content:e.lang.pool.poolInfo}})],1),e._v(" "),o("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:6}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreatePool=!0}}},[e._v("\n                    "+e._s(e.lang.common.create)+"\n                ")]),e._v(" "),o("el-button",{attrs:{disabled:0===e.poolSelectionIds.length},on:{click:function(t){e.showDeletePool=!0}}},[e._v("\n                    "+e._s(e.lang.common.delete)+"\n                ")])],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:22}},[o("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.poolSearch,callback:function(t){e.poolSearch=t},expression:"poolSearch"}})],1),e._v(" "),o("el-col",{attrs:{span:2}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getPoolData}})],1)],1)],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.poolTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectPool,"sort-change":e.sortChange}},[o("el-table-column",{attrs:{type:"selection"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.pool.networkName,sortable:"custom",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.name)+" "),!0===t.row.is_default?o("sup",{staticStyle:{color:"#1ABC9C"}},[e._v(e._s(e.lang.pool.default))]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.pool.bondSubnet},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.subnets,function(t,a){return o("div",{key:a},[e._v("\n                        "+e._s(t.name)+"\n                    ")])})}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.status,sortable:"custom",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!=e.config[t.row.status.toLowerCase()]?o("span",{class:["status",e.config[t.row.status.toLowerCase()].style]},[e._v("\n                        "+e._s(e.config[t.row.status.toLowerCase()].title)+"\n                    ")]):o("span",{staticClass:"status cloud-error"},[e._v("\n                        "+e._s(e.config.error.title)+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.outside.isShare,sortable:"custom",prop:"shared"},scopedSlots:e._u([{key:"default",fn:function(t){return[!0===e.common.forceBoolean(t.row.shared)?o("span",[e._v("\n                        "+e._s(e.lang.common.yes)+"\n                    ")]):o("span",[e._v("\n                        "+e._s(e.lang.common.no)+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.pool.networkType,sortable:"custom",prop:"provider:segmentation_id"},scopedSlots:e._u([{key:"default",fn:function(t){return[null==t.row["provider:segmentation_id"]?o("span",[e._v("\n                        "+e._s(e.networkType[t.row["provider:network_type"]])+"\n                    ")]):o("span",[e._v("\n                        "+e._s(e.networkType[t.row["provider:network_type"]]+" : "+t.row["provider:segmentation_id"])+"\n                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.pool.ipCount,sortable:"custom",prop:"available_ip"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.pool.physicalNetwork,sortable:"custom",prop:"provider:physical_network"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.handleEdit(t.row,1)}}},[e._v("\n                        "+e._s(e.lang.common.update)+"\n                    ")]),e._v(" "),o("router-link",{attrs:{to:"/cloudCenter/pool/detail/"+t.row.is_default+"/"+t.row.id+"/"}},[o("el-button",{attrs:{type:"text"}},[e._v("\n                            "+e._s(e.lang.pool.checkMore)+"\n                        ")])],1),e._v(" "),!0===e.showSetDefault?o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.setDefaultNet(t.row.id)}}},[e._v("\n                        "+e._s(e.lang.pool.setDefault)+"\n                    ")]):e._e()]}}])})],1),e._v(" "),o("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.poolFilter.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.poolFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchPoolPage}},[e._t("default",[o("span",{staticClass:"pagination-slot"},[e._v("\n                        "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.poolPage,total:this.poolFilter.length}))+"\n                    ")])])],2):e._e()],1),e._v(" "),o("pana-delete-pool",{attrs:{show:e.showDeletePool},on:{closeModal:e.closeDeletePool}}),e._v(" "),o("pana-create-pool",{attrs:{show:e.showCreatePool},on:{closeModal:e.closeCreatePool}}),e._v(" "),o("pana-edit-pool",{attrs:{show:e.showEditPool,network:e.editObj,netIndex:"pool"},on:{closeModal:e.closeEditPool}})],1)],1)},staticRenderFns:[]};var v=o("C7Lr")(f,b,!1,function(e){o("fn5u"),o("0kdu")},"data-v-76e3f795",null);t.default=v.exports}});