webpackJsonp([30],{"1WpH":function(e,t){},"2zeP":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("3cXf"),s=a.n(n),o=a("rVsN"),i=a.n(o),l=a("aA9S"),r=a.n(l),c=a("ZLEe"),d=a.n(c),u={props:{show:Boolean,pool_id:[Number,String]},data:function(){return{enterpriseInfo:{},showTooltip:!1,defaultProps:{children:"children",label:"name"},filterText:"",filterSelected:"",data:[],labelWidth:"100px",form:{department_name:"",description:"",parent_id:""},rules:{department_name:[{required:!0,message:this.lang.router.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.departmentManage.nameRangeRule,trigger:"blur"},{validator:this.common.validateDefaultName,message:this.lang.departmentManage.nameFormatRule,trigger:"blur"}],description:[{min:1,max:100,message:this.lang.departmentManage.descriptionRangeRule,trigger:"blur"}]},users:[],departments:[],allUsers:[],selectedUsers:[],poolUsers:[],loading:!1}},computed:{departmentMenu:function(){var e=JSON.parse(s()(this.allUsers)),t={},a=[],n="";if(e.length>0){for(var o=0;o<e.length;o++){if("parent_id"in e[o])null===e[o].parent_id&&(e[o].parent_id="0"),n=e[o].parent_id,e[o].name=e[o].department_name;else{if(null===e[o].department)continue;n=e[o].department.id,e[o].name=e[o].username}""!==n&&(!0===this.common.isArray(t[n])?t[n].push(e[o]):t[n]=[e[o]])}0!==d()(t).length&&(a=this.formatMenu(t,0))}return[{name:this.enterpriseInfo.abbreviation,id:0,children:a}]},total:function(){return this.users.filter(function(e){return null!==e.department}).length},selectedNum:function(){return this.selectedUsers.length},filterSelectedUser:function(){var e=this;return e.filterSelected?this.selectedUsers.filter(function(t){return-1!==t.name.indexOf(e.filterSelected)}):this.selectedUsers}},watch:{filterText:function(e){this.$refs.user.filter(e)}},methods:{handleShowTooltip:function(e){var t=e.target;this.showTooltip=t.scrollWidth>t.offsetWidth},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)},checkChange:function(){var e=this,t=this.$refs.user.getCheckedNodes(!0);e.selectedUsers=[],t.forEach(function(t){t.hasOwnProperty("department")&&e.selectedUsers.push({user:t.id,name:t.username,is_admin:!1})})},closeModal:function(e){e=e||!1,r()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){var e=this;this.loading=!0,null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getEnterpriseInfo();var t=this.getPoolUserList(),a=this.getUserList(),n=this.getDepartment();i.a.all([t,a,n]).then(function(){e.poolUsers.forEach(function(t){e.users=e.users.filter(function(e){return t.user!==e.id})}),e.allUsers=e.departments.concat(e.users),e.loading=!1}).catch(function(){e.loading=!1})},getEnterpriseInfo:function(){var e=this;this.checkError(this.$http({url:this.api.management.enterprise,method:"get"}),function(t){e.enterpriseInfo=t.data})},confirm:function(){var e=this,t=JSON.parse(s()(this.selectedUsers));e.closeModal(),t.forEach(function(e){delete e.name}),this.checkError(this.$http({url:this.api.management.pool_user,method:"post",data:{pool:parseInt(this.pool_id),obj:t}}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.addMemberSuccess})})},formatMenu:function(e,t){for(var a=e[t],n=0;n<a.length;n++)a[n].hasOwnProperty("department")||(null!=e[a[n].id]?a[n].children=this.formatMenu(e,a[n].id):a[n].disabled=!0);return a},getPoolUserList:function(){var e=this,t=this.common.formatGetUrl({pool_id:this.pool_id});return new i.a(function(a,n){var s=e;e.checkError(e.$http({url:e.api.management.pool_user+t,method:"get"}),function(e){s.poolUsers=e.data,a(e.data)},function(){n()})})},getUserList:function(){var e=this,t=this.common.formatGetUrl({state:"yes",size:0});return new i.a(function(a,n){var s=e;e.checkError(e.$http({url:e.api.management.get_users+t,method:"get"}),function(e){s.users=e.data,a(e.data)},function(){n()})})},getDepartment:function(){var e=this,t=this.common.formatGetUrl({size:0});return new i.a(function(a,n){var s=e;e.checkError(e.$http({url:e.api.management.get_departments+t,method:"get"}),function(e){s.departments=e.data,a(e.data)},function(){n()})})}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{id:"add-member",title:e.lang.departmentManage.addStaff,visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"text-align":"center"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("div",{staticClass:"el-transfer",staticStyle:{"text-align":"left",display:"inline-block"}},[a("div",{staticClass:"el-transfer-panel"},[a("p",{staticClass:"el-transfer-panel__header"},[a("label",{staticClass:"el-checkbox"},[a("span",{staticClass:"el-checkbox__label"},[e._v("\n                            "+e._s(e.lang.resource.availableMember)+"\n                            "),a("span",[e._v(e._s(e.selectedNum+"/"+e.total))])])])]),e._v(" "),a("div",{staticClass:"el-transfer-panel__body"},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("div",{staticClass:"el-checkbox-group el-transfer-panel__list is-filterable",attrs:{role:"group","aria-label":"checkbox-group"}},[a("el-tree",{ref:"user",staticClass:"filter-tree",attrs:{data:e.departmentMenu,"show-checkbox":"","node-key":"id",props:e.defaultProps,"filter-node-method":e.filterNode},on:{check:e.checkChange},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return t.data,a("span",{},[a("el-tooltip",{attrs:{effect:"dark",content:n.label,placement:"top",disabled:!e.showTooltip}},[a("span",{staticClass:"span-ellipsis",on:{mouseenter:function(t){return e.handleShowTooltip(t)}}},[e._v(e._s(n.label))])])],1)}}])})],1)],1)]),e._v(" "),a("div",{staticClass:"el-transfer__buttons"},[a("span",[a("i",{staticClass:"el-icon-d-arrow-right"})])]),e._v(" "),a("div",{staticClass:"el-transfer-panel"},[a("p",{staticClass:"el-transfer-panel__header"},[a("label",{staticClass:"el-checkbox",attrs:{role:"checkbox"}},[a("span",{staticClass:"el-checkbox__label"},[e._v("\n                            "+e._s(e.lang.resource.selectedMember)+"\n                            "),a("span",[e._v(e._s(e.selectedNum))])])])]),e._v(" "),a("div",{staticClass:"el-transfer-panel__body right"},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.filterSelected,callback:function(t){e.filterSelected=t},expression:"filterSelected"}}),e._v(" "),a("ul",e._l(e.filterSelectedUser,function(t,n){return a("li",{key:n},[e._v("\n                            "+e._s(t.name)+"\n                        ")])}),0)],1)])])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary",disabled:e.selectedUsers.length<=0},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)])},staticRenderFns:[]};var p=a("C7Lr")(u,m,!1,function(e){a("1WpH"),a("f0fS")},"data-v-dcff5c84",null).exports,h=a("/n4h"),g={props:{show:Boolean,server_id:String},data:function(){return{pool_id:"",pool_name:"",poolData:"",multipleSelection:[],showAdd:!1,tableData:[],pageNum:1,pageSize:10,search:"",operate:"",dialogVisible:!1,tipDialogMsg:"",role:"",visibleEdit:!1,editElement:"",editUser:"",total:null,loading:!0}},components:{addMember:p,cloudTipDialog:h.a},mounted:function(){this.pool_id=this.$route.params.id,this.getList(),this.getPoolDetail(),this.setCurrentPool()},methods:{editClick:function(e){this.editElement=e.target},roleChange:function(e){this.editElement.click(),this.editUser=e,this.edit()},edit:function(){var e=this.editUser,t=this,a=this.common.formatMsg(this.api.management.pool_user_detail,{id:e.id}),n={user:e.user,pool:e.pool,is_admin:this.role};this.checkError(this.$http({url:a,method:"put",data:n}),function(){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.editRoleSuccess})})},handleSelectionChange:function(e){this.multipleSelection=e},closeAdd:function(e){!0===e&&this.getList(),this.showAdd=!1},pageSelect:function(e){this.pageNum=e,this.getList()},getList:function(){var e=this,t={pool_id:this.pool_id,page:this.pageNum,size:this.pageSize};this.search&&(t.search=this.search);var a=this.common.formatGetUrl(t);this.checkError(this.$http({url:this.api.management.pool_user+a,method:"get"}),function(t){e.loading=!1,e.total=t.total,e.tableData=t.data},function(){e.loading=!1})},deleteConfirm:function(){this.operate="delete",this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_remove_member},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"delete":this.deleteMember()}},getPoolDetail:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_pools_detail,{pool_id:e.pool_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.poolData=t.data,e.pool_name=e.poolData.name})},deleteMember:function(){var e=[],t=this;this.multipleSelection.forEach(function(a){e.push({user:a.user,pool:t.pool_id})}),this.checkError(this.$http({url:this.api.management.pool_user,method:"delete",data:{obj:e,pool:t.pool_id}}),function(){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.removeMemberSuccess})})},setCurrentPool:function(){var e=this;JSON.parse(sessionStorage.getItem("panaPools")).filter(function(t){if(t.id===e.pool_id)return sessionStorage.setItem("panaCurrentPool",s()(t)),!0})}},computed:{deleteDisabled:function(){return this.multipleSelection.length<=0},pagedData:function(){var e=this.tableData;return e.length<=this.pageSize?e:this.common.pagination(e,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1,this.getList()}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-main",[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-col",{attrs:{span:18}},[a("el-breadcrumb-item",{attrs:{to:{name:"resourceList"}}},[e._v(e._s(e.lang.resource.resourceManage))]),e._v(" "),a("el-breadcrumb-item",[e._v("\n                "+e._s(e.lang.resource.memberManage)+"\n                "),a("span",{staticStyle:{"margin-left":"20px"}},[a("img",{staticStyle:{"margin-right":"5px","margin-bottom":"2px"},attrs:{src:"static/image/pool_icon.png",alt:""}}),e._v("\n                    "+e._s(e.pool_name)+"\n                ")])])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-breadcrumb-item",{attrs:{to:{name:"resourceList"}}},[a("span",{staticClass:"cloud-back"},[e._v(e._s(e.lang.common.back))])])],1)],1)],1),e._v(" "),a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showAdd=!0}}},[e._v(e._s(e.lang.resource.addMember))]),e._v(" "),a("el-button",{attrs:{disabled:e.deleteDisabled},on:{click:e.deleteConfirm}},[e._v(e._s(e.lang.resource.deleteMember))])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:e.lang.userManage.username}}),e._v(" "),a("el-table-column",{attrs:{prop:"realname",label:e.lang.userManage.realname}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.resource.role},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n               "+e._s(e.lang.resource.roleValue[t.row.is_admin])+"\n            ")]}}])}),e._v(" "),e.common.is_system_admin()?a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{"popper-class":"pool-edit-role",placement:"right",title:e.lang.resource.editRole,width:"200",trigger:"click"},on:{show:function(a){e.role=t.row.is_admin}}},[a("el-radio-group",{on:{change:function(a){return e.roleChange(t.row)}},model:{value:e.role,callback:function(t){e.role=t},expression:"role"}},[a("div",[a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.lang.resource.roleValue.true))])],1),e._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.lang.resource.roleValue.false))])],1)]),e._v(" "),a("el-button",{attrs:{slot:"reference",type:"text"},on:{click:e.editClick},slot:"reference"},[e._v("\n                        "+e._s(e.lang.common.update)+"\n                    ")])],1)]}}],null,!1,1703722562)}):e._e()],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.total>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.total,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1),e._v(" "),a("add-member",{attrs:{show:e.showAdd,pool_id:e.pool_id},on:{getList:e.getList,closeModal:e.closeAdd}}),e._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible},on:{cancel:function(t){e.dialogVisible=!1},confirm:e.dialogConfirm}},[e._v("\n        "+e._s(e.tipDialogMsg)+"\n    ")])],1)},staticRenderFns:[]};var _=a("C7Lr")(g,f,!1,function(e){a("P/6/"),a("ToDu")},"data-v-690789ec",null);t.default=_.exports},"P/6/":function(e,t){},ToDu:function(e,t){},f0fS:function(e,t){}});