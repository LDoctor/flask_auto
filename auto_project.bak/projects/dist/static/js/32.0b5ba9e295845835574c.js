webpackJsonp([32],{Lky4:function(e,t){},U9Jj:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),s=a.n(r),n=a("1JPr"),l={name:"departmentTree",props:{data:Array,name:String,index:[String,Number]},methods:{handleNodeClick:function(e){e.id!==this.currentId&&(this.currentId=e.id,this.$emit("switchItem",e.id))},handleShowTooltip:function(e){var t=e.target;this.showTooltip=t.scrollWidth>t.offsetWidth}},data:function(){return{showTooltip:!1,defaultProps:{children:"children",label:this.name,currentId:"0"}}},watch:{index:function(e,t){this.$refs.tree.setCurrentKey(e)}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tree",{ref:"tree",staticClass:"navigation-left",attrs:{data:e.data,props:e.defaultProps,"node-key":"id","expand-on-click-node":!1,"highlight-current":""},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node;return t.data,a("span",{},[a("el-tooltip",{attrs:{effect:"dark",content:r.label,placement:"top",disabled:!e.showTooltip}},[a("span",{staticClass:"span-ellipsis",on:{mouseenter:function(t){return e.handleShowTooltip(t)}}},[e._v(e._s(r.label))])])],1)}}])})},staticRenderFns:[]};var i=a("C7Lr")(l,o,!1,function(e){a("kvSX")},"data-v-33ef6909",null).exports,c=a("aA9S"),u=a.n(c),d={name:"createUser",data:function(){return{labelWidth:"120px",form:{username:"",realname:"",password:"",department_id:[],email:"",phone:""},rules:{username:[{required:!0,message:this.lang.userManage.usernameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.userManage.usernameRangeRule,trigger:"blur"},{validator:this.validateUserName,message:this.lang.userManage.usernameFormatRule,trigger:"blur"}],realname:[{required:!0,message:this.lang.userManage.realnameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.userManage.realnameRangeRule,trigger:"blur"},{validator:this.validateRealName,message:this.lang.userManage.realnameFormatRule,trigger:"blur"}],password:[{required:!0,message:this.lang.userManage.passwordRequiredRule,trigger:"blur"},{min:6,max:16,message:this.lang.userManage.passwordRangeRule,trigger:"blur"}],email:[{validator:this.common.validateEmail,message:this.lang.userManage.emailFormatRule,trigger:"blur"}],phone:[{min:11,max:11,message:this.lang.userManage.phoneRangeRule,trigger:"blur"},{validator:this.common.validatePhone,message:this.lang.userManage.phoneFormatRule,trigger:"blur"}]},departments:["0"],disable:!1}},computed:{depts:function(){var e=this.common.deepCopyByJson(this.deptOptions[0].children);return e.unshift({id:"0",department_name:this.lang.userManage.selectDepPlaceholder}),e}},props:{deptOptions:Array,show:Boolean},methods:{closeModal:function(e){u()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate()},formatDept:function(e){for(var t=[],a=0;a<e.length;a++){t.push(e[a]);var r=[];!1===e[a].isLeaf&&(r=this.formatDept(e[a].children),t=t.concat(r))}return t},createUser:function(){var e=this;this.disable=!0,this.departments.length>0&&(this.form.department_id=this.departments[this.departments.length-1]),delete this.form.confirmPassword,this.$refs.form.validate(function(t){t?(e.form=e.common.dropEmptyParameter(e.form),"0"===e.form.department_id&&delete e.form.department_id,e.checkError(e.$http({url:e.api.management.post_users,method:"post",data:e.form}),function(){e.disable=!1,e.$notify({title:e.lang.common.success,type:"success",message:e.lang.userManage.createUserSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})},confirmPassword:function(e,t,a){t===e.password?a():a(Error(e.message))},validateRealName:function(e,t,a){""===t||null==t||/^[A-Za-z\u4E00-\u9FA5].*$/.test(t)?a():a(new Error(e.message))},validateUserName:function(e,t,a){""===t||null==t||/^[A-Za-z][A-Za-z0-9_-]*$/.test(t)?a():a(new Error(e.message))}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.userManage.createUser,visible:e.show,width:"40%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{ref:"form",attrs:{"label-width":"80px",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.realname,"label-width":e.labelWidth,prop:"realname"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.userManage.realnamePlaceholder},model:{value:e.form.realname,callback:function(t){e.$set(e.form,"realname",t)},expression:"form.realname"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.username,"label-width":e.labelWidth,prop:"username"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.userManage.usernamePlaceholder},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.password,"label-width":e.labelWidth,prop:"password"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.userManage.passwordPlaceholder,type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.confirmPassword,"label-width":e.labelWidth,prop:"confirmPassword",rules:[{validator:this.confirmPassword,message:this.lang.userManage.cfmPasswordNotSameRule,password:this.form.password,trigger:"blur"},{required:!0,message:this.lang.userManage.passwordRequiredRule,trigger:"blur"}]}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.userManage.confirmPasswordPlaceholder,type:"password"},model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.email,"label-width":e.labelWidth,prop:"email"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.userManage.emailPlaceholder},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.phone,"label-width":e.labelWidth,prop:"phone"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:e.lang.userManage.phonePlaceholder},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.selectDepartment,"label-width":e.labelWidth}},[a("el-cascader",{attrs:{placeholder:e.lang.userManage.selectDepPlaceholder,"change-on-select":"",options:e.depts,"expand-trigger":"hover",props:{label:"department_name",value:"id"}},model:{value:e.departments,callback:function(t){e.departments=t},expression:"departments"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{disabled:e.disable,type:"primary"},on:{click:e.createUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var p=a("C7Lr")(d,m,!1,function(e){a("Lky4")},"data-v-676543d2",null).exports,h=a("pqwD"),g={name:"pana-delete-user",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},deleteUser:function(){this.closeModal(!0)}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:18}},[e._v(e._s(e.lang.userManage.deleteUserInfo))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteUser}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},v=a("C7Lr")(g,f,!1,null,null,null).exports,w=a("X5xq"),_={name:"setRole",data:function(){return{labelWidth:"120px",roles:[],form:{roles_id:[]}}},props:{userId:String,show:Boolean},methods:{closeModal:function(e){u()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},initForm:function(){this.getRoleList(),this.getCurrentUserRoles()},setRole:function(){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.management.post_users_detail_roles,{id:this.userId}),method:"put",data:this.form}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.roleManage.setRoleSuccess}),e.closeModal(!0)})},getRoleList:function(){var e=this;this.checkError(this.$http({url:this.api.management.get_roles+"?size=0",method:"get"}),function(t){e.roles=t.data})},getCurrentUserRoles:function(){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.management.get_users_detail_roles,{id:this.userId}),method:"get"}),function(t){var a=[];t.data.map(function(e){a.push(e.id)}),e.form.roles_id=a})}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.userManage.setRole,visible:e.show,width:"30%"},on:{close:e.closeModal,open:e.initForm}},[a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.userManage.role,"label-width":e.labelWidth}},[a("el-select",{attrs:{filterable:"",multiple:"",placeholder:e.lang.userManage.selectRolePlaceholder,width:"100%"},model:{value:e.form.roles_id,callback:function(t){e.$set(e.form,"roles_id",t)},expression:"form.roles_id"}},e._l(e.roles,function(e,t){return a("el-option",{key:t,attrs:{label:e.role_name,value:e.id}})}),1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.setRole}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var M=a("C7Lr")(_,b,!1,function(e){a("WuJs")},"data-v-df8b924c",null).exports,y={name:"userManage",components:{"pana-breadcrumb":n.a,department:i,"pana-create-user":p,"pana-reset-password":h.a,"pana-delete-user":v,"pana-edit-user":w.a,"pana-set-role":M},data:function(){return{active:"yes",pageSize:10,departmentOrigin:[],currentData:[],currentDepartmentId:"0",currentSearch:"",currentPage:"",userSelectionIds:[],currentTotal:0,showCreateUser:!1,showResetPassword:!1,showDeleteUser:!1,showEditUser:!1,editObj:null,setRoleId:null,showSetRole:!1,stateConf:[{style:"cloud-fault",title:this.lang.userManage.locked},{style:"cloud-success",title:this.lang.userManage.active},{},{style:"cloud-warning",title:this.lang.userManage.unapproval},{style:"cloud-error",title:this.lang.userManage.refused}],auth:["super","admin"],role:"normal",loading:!1,enterpriseInfo:{}}},computed:{departmentMenu:function(){var e=JSON.parse(s()(this.departmentOrigin)),t={},a=[];if(e.length>0){for(var r=0;r<e.length;r++)null==e[r].parent_id&&(e[r].parent_id="0"),!0===this.common.isArray(t[e[r].parent_id])?t[e[r].parent_id].push(e[r]):t[e[r].parent_id]=[e[r]];a=this.formatMenu(t,"0")}return[{department_name:this.enterpriseInfo.abbreviation,department_id:"0",children:a}]}},methods:{pageSelect:function(e){this.currentPage=e,this.getUserList()},getEnterpriseInfo:function(){var e=this;this.checkError(this.$http({url:this.api.management.enterprise,method:"get"}),function(t){e.enterpriseInfo=t.data})},getUserList:function(){var e=this,t={page:this.currentPage,search:this.currentSearch};null!=this.currentDepartmentId&&"0"!==this.currentDepartmentId&&(t.department_id=this.currentDepartmentId);var a=this.common.formatGetUrl(this.common.dropEmptyParameter(t));this.checkError(this.$http({url:this.api.management.get_users+a,method:"get"}),function(t){e.currentData=t.data,e.currentTotal=t.total})},clickTree:function(e){this.currentDepartmentId=e,this.currentPage=1,this.getUserList()},getDepartmentList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.management.get_departments+"?size=0",method:"get"}),function(t){e.loading=!1,e.departmentOrigin=t.data},function(){e.loading=!1})},formatMenu:function(e,t){for(var a=e[t],r=0;r<a.length;r++)null!=e[a[r].id]?(a[r].children=this.formatMenu(e,a[r].id),a[r].isLeaf=!1):a[r].isLeaf=!0;return a},userSelection:function(e){var t=[];e.forEach(function(e){t.push(e.id)}),this.userSelectionIds=t},closeCreateUser:function(e){!0===e&&this.getUserList(),this.showCreateUser=!1},closeEditUser:function(e){!0===e&&this.getUserList(),this.showEditUser=!1},closeDeleteUser:function(e){var t=this;if(this.showDeleteUser=!1,!0===e){var a=this.api.management.delete_users+this.common.formatGetUrl({id:this.userSelectionIds});this.checkError(this.$http({url:a,method:"delete"}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.userManage.deleteUserSuccess}),t.getUserList()})}},searchUser:function(){this.currentPage="",this.getUserList()},editUser:function(e){this.editObj=e,this.showEditUser=!0},setRole:function(e){this.setRoleId=e,this.showSetRole=!0},setUserState:function(e,t){var a=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.management.put_users_detail_state,{id:t.id}),method:"put",data:{state:e}}),function(){var t=0===e?a.lang.userManage.unlockUserSuccess:a.lang.userManage.lockUserSuccess;a.$notify({title:a.lang.common.success,type:"success",message:t}),a.getUserList()})}},mounted:function(){this.getEnterpriseInfo(),this.role=JSON.parse(sessionStorage.getItem("panaUser")).role,this.getDepartmentList(),this.getUserList()},watch:{currentSearch:function(){this.pageNum=1}}},k={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb"),e._v(" "),a("el-main",[a("el-row",{attrs:{type:"flex",justify:"space-between",gutter:10}},[a("el-col",{staticClass:"pana-tree",attrs:{span:3}},[a("department",{attrs:{data:e.departmentMenu,name:"department_name",index:e.currentDepartmentId},on:{switchItem:e.clickTree}})],1),e._v(" "),a("el-col",{attrs:{span:21}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:16}},[e.auth.indexOf(e.role)>-1?a("div",["yes"===e.active?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreateUser=!0}}},[e._v("\n                                "+e._s(e.lang.userManage.createUser)+"\n                            ")]):e._e(),e._v(" "),"yes"===e.active?a("el-button",{attrs:{disabled:1!==e.userSelectionIds.length},on:{click:function(t){e.showResetPassword=!0}}},[e._v("\n                                "+e._s(e.lang.userManage.resetPassword)+"\n                            ")]):e._e(),e._v(" "),a("el-button",{attrs:{disabled:e.userSelectionIds.length<1},on:{click:function(t){e.showDeleteUser=!0}}},[e._v("\n                                "+e._s(e.lang.userManage.deleteUser)+"\n                            ")])],1):e._e()]),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},on:{change:e.searchUser},model:{value:e.currentSearch,callback:function(t){e.currentSearch=t},expression:"currentSearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getUserList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.currentData,"tooltip-effect":"dark"},on:{"selection-change":e.userSelection}},[a("el-table-column",{attrs:{type:"selection"}}),e._v(" "),a("el-table-column",{attrs:{prop:"username",label:e.lang.userManage.username}}),e._v(" "),a("el-table-column",{attrs:{prop:"realname",label:e.lang.userManage.realname,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"department.department_name",label:e.lang.userManage.departmentName,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"email",label:e.lang.userManage.mailbox,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:e.lang.userManage.phone,"show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.status,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:["status",e.stateConf[t.row.state].style]},[e._v("\n                            "+e._s(e.stateConf[t.row.state].title)+"\n                        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:e.lang.common.createTime},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e._f("utc2beijing")(t.row.create_time))+"\n                        ")]}}])}),e._v(" "),"yes"===e.active&&e.auth.indexOf(e.role)>-1?a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editUser(t.row)}}},[e._v("\n                                "+e._s(e.lang.common.edit)+"\n                            ")]),e._v(" "),1===parseInt(t.row.state)?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.setUserState(t.row.state,t.row)}}},[e._v("\n                                "+e._s(e.lang.userManage.lock)+"\n                            ")]):e._e(),e._v(" "),0===parseInt(t.row.state)?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.setUserState(t.row.state,t.row)}}},[e._v("\n                                "+e._s(e.lang.userManage.unlock)+"\n                            ")]):e._e()]}}],null,!1,1665613630)}):e._e()],1)],1)],1),e._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.currentTotal>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.currentTotal},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("pana-create-user",{attrs:{show:e.showCreateUser,deptOptions:e.departmentMenu},on:{closeModal:e.closeCreateUser}}),e._v(" "),a("pana-reset-password",{attrs:{id:e.userSelectionIds[0],show:e.showResetPassword},on:{closeModal:function(t){e.showResetPassword=!1}}}),e._v(" "),a("pana-delete-user",{attrs:{show:e.showDeleteUser},on:{closeModal:e.closeDeleteUser}}),e._v(" "),a("pana-edit-user",{attrs:{show:e.showEditUser,editObj:e.editObj,deptOptions:e.departmentMenu,deptArr:e.departmentOrigin},on:{closeModal:e.closeEditUser}}),e._v(" "),a("pana-set-role",{attrs:{show:e.showSetRole,userId:e.setRoleId},on:{closeModal:function(t){e.showSetRole=!1}}})],1)},staticRenderFns:[]};var x=a("C7Lr")(y,k,!1,function(e){a("iTN1")},"data-v-354c2df4",null);t.default=x.exports},WuJs:function(e,t){},iTN1:function(e,t){},kvSX:function(e,t){}});