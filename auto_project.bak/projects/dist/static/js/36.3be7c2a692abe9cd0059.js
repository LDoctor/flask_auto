webpackJsonp([36],{"26lc":function(e,t){},MNB7:function(e,t){},Msp8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=a("1JPr"),s={props:{show:Boolean},data:function(){return{labelWidth:"100px",form:{name:"",labels:[],temperature:""},enable:!0,resourceTypeoption:[{value:"physical",label:"物理主机"},{value:"virtual",label:"云组件"},{value:"computeha",label:"高可用"},{value:"planwork",label:"计划任务"},{value:"hardware",label:"硬件故障"},{value:"ceph",label:"ceph"},{value:"ceph_check",label:"ceph健康检查"}],resourcetype:"physical",hostName:[],alarmtemplateOption:[],templates:[],contactOption:[],contactLists:[],falutList:[],checkList:[],monitoringTasks:[],rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:32,message:"长度为1-32个字符",trigger:"blur"},{validator:this.common.validateName6,trigger:"blur"}],labels:[{required:!0,message:"必填项",trigger:"blur"}],temperature:[{required:!0,message:"必填项",trigger:"blur"},{min:50,max:200,type:"integer",message:"请输入50-200的值",trigger:"blur"}]},firstchekbox:!1,loading:!1}},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},gethostList:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.gethostName,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)a.push({value:t.data[l].nodeUid,label:t.data[l].hostName});e.hostName=a})},getalarmTemplate:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getalarmTemplate,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)"physical"==e.resourcetype?"physical"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name}):"virtual"==e.resourcetype?"virtual"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name}):"ceph"==e.resourcetype&&"ceph"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name});e.alarmtemplateOption=a})},getcontact:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getcontactGroup,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)a.push({value:t.data[l].id,label:t.data[l].name});e.contactOption=a})},getcloudFormation:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getvirtual,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)"ACTIVE"===t.data[l].status&&a.push({value:t.data[l].uid,label:t.data[l].name});e.hostName=a})},getfalutList:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getfaultList,method:"get"}),function(t){e.falutList=t.data})},changeResource:function(){this.templates=[],this.form.labels=[],this.getalarmTemplate(),"hardware"==this.resourcetype?this.getfalutList():"physical"==this.resourcetype?this.gethostList():"virtual"==this.resourcetype&&this.getcloudFormation()},cerateSetting:function(){for(var e=this,t=this,a=[],l=0;l<this.checkList.length;l++)for(var s=0;s<this.hostName.length;s++)"20"==this.checkList[l]?a.push({alarmRuleOperatorId:"2",monitoringItemId:this.checkList[l],threshold:this.form.temperature,monitoringTargetId:this.hostName[s].value}):a.push({alarmRuleOperatorId:"3",monitoringItemId:this.checkList[l],threshold:1,monitoringTargetId:this.hostName[s].value});var o=void 0;o="physical"==this.resourcetype||"virtual"==this.resourcetype?{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:this.form.labels.join(","),name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(",")}:"hardware"==this.resourcetype?{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:"defaultcephid",name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(","),monitoringTasks:a}:{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:"defaultcephid",name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(",")},this.$refs.form.validate(function(a){a&&(e.loading=!0,e.checkError(e.$http({url:t.api.alarmManage.getalarmSettinglist,method:"post",data:o}),function(e){t.loading=!1,t.$notify({title:t.lang.common.success,type:"success",message:"创建成功"}),t.closeModal(!0)},function(e){t.loading=!1}))})},changecheckbox:function(){-1===this.checkList.indexOf(20)?this.firstchekbox=!1:this.firstchekbox=!0},initForm:function(){null!=this.$refs.form&&this.$refs.form.resetFields(),this.loading=!1,this.enable=!0,this.form.labels=[],this.templates=[],this.contactLists=[],this.resourcetype="physical",this.gethostList(),this.getalarmTemplate(),this.getcontact()}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.alarmManage.createalarmSeting,width:"45%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)"}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.alarmName,"label-width":e.labelWidth,prop:"name"}},[a("el-input",{attrs:{placeholder:e.lang.alarmManage.placeentername},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectresoureType,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:""},on:{change:e.changeResource},model:{value:e.resourcetype,callback:function(t){e.resourcetype=t},expression:"resourcetype"}},e._l(e.resourceTypeoption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),"physical"==e.resourcetype||"virtual"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectResource,"label-width":e.labelWidth,prop:"labels"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:e.lang.alarmManage.selectResourcemitle},model:{value:e.form.labels,callback:function(t){e.$set(e.form,"labels",t)},expression:"form.labels"}},e._l(e.hostName,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1):e._e(),e._v(" "),"physical"==e.resourcetype||"virtual"==e.resourcetype||"ceph"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectTemplate,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:e.lang.alarmManage.selecttemMitle},model:{value:e.templates,callback:function(t){e.templates=t},expression:"templates"}},e._l(e.alarmtemplateOption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1):e._e(),e._v(" "),"hardware"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.monitoringitem,"label-width":e.labelWidth}},[a("el-checkbox-group",{on:{change:e.changecheckbox},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.falutList,function(t,l){return a("div",{key:l,staticStyle:{width:"150px"}},[a("el-checkbox",{attrs:{label:t.id}},[e._v(e._s(t.name))])],1)}),0)],1)],1),e._v(" "),e.firstchekbox?a("el-col",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.yuvalue,"label-width":e.labelWidth,prop:"temperature"}},[a("el-input",{model:{value:e.form.temperature,callback:function(t){e.$set(e.form,"temperature",e._n(t))},expression:"form.temperature"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"10px","line-height":"38px"},attrs:{span:8}},[a("span",[e._v("超过阈值后触发告警")])])],1):e._e()],1):e._e(),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectContact,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:e.lang.alarmManage.selectcontactMitle},model:{value:e.contactLists,callback:function(t){e.contactLists=t},expression:"contactLists"}},e._l(e.contactOption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.common.enable,"label-width":e.labelWidth}},[a("el-checkbox",{model:{value:e.enable,callback:function(t){e.enable=t},expression:"enable"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",staticStyle:{display:"block","text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.cerateSetting}},[e._v(e._s(e.lang.common.confirm))])],1)],1)])},staticRenderFns:[]};var r=a("C7Lr")(s,o,!1,function(e){a("O4WD")},"data-v-1e372fd3",null).exports,i={props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},disableAlarm:function(){this.closeModal(!0)}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.alarmManage.disableAlarm))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.disableAlarm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},c=a("C7Lr")(i,n,!1,null,null,null).exports,h={props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},enableAlarm:function(){this.closeModal(!0)}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.alarmManage.enableAlarm))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.enableAlarm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},m=a("C7Lr")(h,u,!1,null,null,null).exports,p={props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},disableAlarm:function(){this.closeModal(!0)}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.alarmManage.ensuredeleteSetting))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.disableAlarm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},f=a("C7Lr")(p,d,!1,null,null,null).exports,g={props:{show:Boolean,setInfo:Object},data:function(){return{labelWidth:"100px",form:{name:"",labels:[],temperature:""},enable:"",resourceTypeoption:[{value:"physical",label:"物理主机"},{value:"virtual",label:"云组件"},{value:"computeha",label:"高可用"},{value:"planwork",label:"计划任务"},{value:"hardware",label:"硬件故障"},{value:"ceph",label:"ceph"},{value:"ceph_check",label:"ceph健康检查"}],resourcetype:"physical",hostName:[],alarmtemplateOption:[],templates:[],contactOption:[],contactLists:[],falutList:[],checkList:[],monitoringTasks:[],rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:32,message:"长度为1-32个字符",trigger:"blur"},{validator:this.common.validateName6,trigger:"blur"}],labels:[{required:!0,message:"必填项",trigger:"blur"}],temperature:[{required:!0,message:"必填项",trigger:"blur"},{min:50,max:200,type:"number",message:"请输入50-200的值",trigger:"blur"}]},firstchekbox:!1,tempIdEx:[],resourceIdEx:[],resourceIdNow:[],isDefault:!1}},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},gethostList:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.gethostName,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)a.push({value:t.data[l].nodeUid,label:t.data[l].hostName});e.hostName=a})},getalarmTemplate:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getalarmTemplate,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)"physical"==e.resourcetype?"physical"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name}):"virtual"==e.resourcetype?"virtual"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name}):"ceph"==e.resourcetype&&"ceph"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name});e.alarmtemplateOption=a})},getcontact:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getcontactGroup,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)a.push({value:t.data[l].id,label:t.data[l].name});e.contactOption=a})},getfalutList:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getfaultList,method:"get"}),function(t){e.falutList=t.data})},getcloudFormation:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getvirtual,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)"ACTIVE"===t.data[l].status&&a.push({value:t.data[l].uid,label:t.data[l].name});e.hostName=a})},changeResource:function(){"hardware"==this.resourcetype?this.getfalutList():"physical"==this.resourcetype?this.gethostList():"virtual"==this.resourcetype&&this.getcloudFormation()},updateSetting:function(){for(var e=this,t=this,a=[],l=0;l<this.checkList.length;l++)for(var s=0;s<this.hostName.length;s++)"20"==this.checkList[l]?a.push({alarmRuleOperatorId:"2",monitoringItemId:this.checkList[l],threshold:this.form.temperature,monitoringTargetId:this.hostName[s].value}):a.push({alarmRuleOperatorId:"3",monitoringItemId:this.checkList[l],threshold:1,monitoringTargetId:this.hostName[s].value});var o=void 0;o="hardware"==this.resourcetype?{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:this.form.labels.join(","),name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(","),monitoringTasks:a,resourceIdNow:this.form.labels,resourceIdEx:this.resourceIdEx,tempIdNow:this.templates,tempIdEx:this.tempIdEx}:{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:this.form.labels.join(","),name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(","),resourceIdNow:this.form.labels,resourceIdEx:this.resourceIdEx,tempIdNow:this.templates,tempIdEx:this.tempIdEx},this.$refs.form.validate(function(a){a&&e.checkError(e.$http({url:e.common.formatMsg(e.api.alarmManage.getsettingDetail,{id:t.setInfo.id}),method:"put",data:o}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:"修改成功"}),t.closeModal(!0)})})},changecheckbox:function(){-1==this.checkList.indexOf(20)?this.firstchekbox=!1:this.firstchekbox=!0},initForm:function(){null!=this.$refs.form&&this.$refs.form.resetFields(),this.getalarmTemplate(),this.getcontact(),this.getfalutList(),this.form.name=this.setInfo.name;var e=[],t=[],a=[];this.enable=this.setInfo.enabled,this.isDefault=this.setInfo.isDefault,this.tempIdEx=[];for(var l=0;l<this.setInfo.labelList.length;l++)"virtual"===this.setInfo.resourceType?(e.push(this.setInfo.labelList[l].uid),this.resourceIdEx.push(this.setInfo.labelList[l].uid),this.getcloudFormation()):(e.push(this.setInfo.labelList[l].nodeUid),this.resourceIdEx.push(this.setInfo.labelList[l].nodeUid),this.gethostList()),this.resourceIdEx.push(this.setInfo.labelList[l].nodeUid);this.form.labels=e;for(var s=0;s<this.setInfo.alarmtemps.length;s++)t.push(this.setInfo.alarmtemps[s].id),this.tempIdEx.push(this.setInfo.alarmtemps[s].id);this.templates=t;for(var o=0;o<this.setInfo.contactlists.length;o++)a.push(this.setInfo.contactlists[o].id);this.contactLists=a,this.resourcetype=this.setInfo.resourceType;var r=[];if(this.setInfo.monitoringTasks&&this.setInfo.monitoringTasks.length>0){for(var i=0;i<this.setInfo.monitoringTasks.length;i++)20==this.setInfo.monitoringTasks[i].monitoringItemId&&(this.firstchekbox=!0,this.form.temperature=this.setInfo.monitoringTasks[i].threshold),-1==r.indexOf(this.setInfo.monitoringTasks[i].monitoringItemId)&&r.push(this.setInfo.monitoringTasks[i].monitoringItemId);this.checkList=r}}}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.alarmManage.editalarmSeting,width:"45%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.alarmName,"label-width":e.labelWidth,prop:"name"}},[a("el-input",{attrs:{disabled:!("virtual"==e.resourcetype||"ceph_check"==e.resourcetype||"planwork"==e.resourcetype)&&1==e.isDefault,placeholder:e.lang.alarmManage.placeentername},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectresoureType,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",disabled:""},on:{change:e.changeResource},model:{value:e.resourcetype,callback:function(t){e.resourcetype=t},expression:"resourcetype"}},e._l(e.resourceTypeoption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),"physical"==e.resourcetype||"virtual"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectResource,"label-width":e.labelWidth,prop:"labels"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:"请选择"},model:{value:e.form.labels,callback:function(t){e.$set(e.form,"labels",t)},expression:"form.labels"}},e._l(e.hostName,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1):e._e(),e._v(" "),"physical"==e.resourcetype||"virtual"==e.resourcetype||"ceph"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectTemplate,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:e.lang.alarmManage.selecttemMitle,disabled:("physical"==e.resourcetype||"ceph"==e.resourcetype)&&1==e.isDefault},model:{value:e.templates,callback:function(t){e.templates=t},expression:"templates"}},e._l(e.alarmtemplateOption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1):e._e(),e._v(" "),"hardware"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.monitoringitem,"label-width":e.labelWidth}},[a("el-checkbox-group",{on:{change:e.changecheckbox},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.falutList,function(t,l){return a("div",{key:l,staticStyle:{width:"150px"}},[a("el-checkbox",{attrs:{label:t.id}},[e._v(e._s(t.name))])],1)}),0)],1)],1),e._v(" "),e.firstchekbox?a("el-col",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.yuvalue,"label-width":e.labelWidth,prop:"temperature"}},[a("el-input",{model:{value:e.form.temperature,callback:function(t){e.$set(e.form,"temperature",e._n(t))},expression:"form.temperature"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"10px","line-height":"38px"},attrs:{span:8}},[a("span",[e._v("超过阈值后触发告警")])])],1):e._e()],1):e._e(),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectContact,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:e.lang.alarmManage.selectcontactMitle},model:{value:e.contactLists,callback:function(t){e.contactLists=t},expression:"contactLists"}},e._l(e.contactOption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.common.enable,"label-width":e.labelWidth}},[a("el-checkbox",{model:{value:e.enable,callback:function(t){e.enable=t},expression:"enable"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.updateSetting}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var v=a("C7Lr")(g,b,!1,function(e){a("T72z")},"data-v-51d81b3d",null).exports,y={props:{show:Boolean,setInfo:Object},data:function(){return{labelWidth:"100px",form:{name:"",labels:[],temperature:""},enable:"",resourceTypeoption:[{value:"physical",label:"物理主机"},{value:"virtual",label:"云组件"},{value:"computeha",label:"高可用"},{value:"planwork",label:"计划任务"},{value:"hardware",label:"硬件故障"},{value:"ceph",label:"ceph"},{value:"ceph_check",label:"ceph健康检查"}],resourcetype:"physical",hostName:[],alarmtemplateOption:[],templates:[],contactOption:[],contactLists:[],falutList:[],checkList:[],monitoringTasks:[],rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:32,message:"长度为1-32个字符",trigger:"blur"},{validator:this.common.validateName6,trigger:"blur"}],labels:[{required:!0,message:"必填项",trigger:"blur"}],temperature:[{required:!0,message:"必填项",trigger:"blur"},{min:50,max:200,type:"number",message:"请输入50-200的值",trigger:"blur"}]},firstchekbox:!1,tempIdEx:[]}},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},gethostList:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.gethostName,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)a.push({value:t.data[l].nodeUid,label:t.data[l].hostName});e.hostName=a})},getalarmTemplate:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getalarmTemplate,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)"physical"==e.resourcetype?"physical"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name}):"virtual"==e.resourcetype?"virtual"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name}):"ceph"==e.resourcetype&&"ceph"==t.data[l].resourceType&&a.push({value:t.data[l].id,label:t.data[l].name});e.alarmtemplateOption=a})},getcontact:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getcontactGroup,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)a.push({value:t.data[l].id,label:t.data[l].name});e.contactOption=a})},getfalutList:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getfaultList,method:"get"}),function(t){e.falutList=t.data})},getcloudFormation:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getvirtual,method:"get"}),function(t){for(var a=[],l=0;l<t.data.length;l++)"ACTIVE"===t.data[l].status&&a.push({value:t.data[l].uid,label:t.data[l].name});e.hostName=a})},changeResource:function(){"hardware"==this.resourcetype?this.getfalutList():"physical"==this.resourcetype?this.gethostList():"virtual"==this.resourcetype&&this.getcloudFormation()},updateSetting:function(){for(var e=this,t=this,a=[],l=0;l<this.checkList.length;l++)for(var s=0;s<this.hostName.length;s++)"20"==this.checkList[l]?a.push({alarmRuleOperatorId:"2",monitoringItemId:this.checkList[l],threshold:this.form.temperature,monitoringTargetId:this.hostName[s].value}):a.push({alarmRuleOperatorId:"3",monitoringItemId:this.checkList[l],threshold:1,monitoringTargetId:this.hostName[s].value});var o=void 0;o="physical"==this.resourcetype||"virtual"==this.resourcetype?{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:this.form.labels.join(","),name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(",")}:"hardware"==this.resourcetype?{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:"defaultcephid",name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(","),monitoringTasks:a}:{alarmAction:"email",contactLists:this.contactLists.join(","),enabled:this.enable,labels:"defaultcephid",name:this.form.name,resourceType:this.resourcetype,templates:this.templates.join(",")},this.$refs.form.validate(function(a){a&&e.checkError(e.$http({url:t.api.alarmManage.getalarmSettinglist,method:"post",data:o}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:"复制告警成功"}),t.closeModal(!0)})})},changecheckbox:function(){-1==this.checkList.indexOf(20)?this.firstchekbox=!1:this.firstchekbox=!0},initForm:function(){null!=this.$refs.form&&this.$refs.form.resetFields(),this.gethostList(),this.getcloudFormation(),this.getalarmTemplate(),this.getcontact(),this.getfalutList();for(var e=[],t=[],a=[],l=0;l<this.setInfo.labelList.length;l++)"virtual"===this.setInfo.resourceType?e.push(this.setInfo.labelList[l].uid):e.push(this.setInfo.labelList[l].nodeUid);this.form.labels=e;for(var s=0;s<this.setInfo.alarmtemps.length;s++)t.push(this.setInfo.alarmtemps[s].id);this.templates=t;for(var o=0;o<this.setInfo.contactlists.length;o++)a.push(this.setInfo.contactlists[o].id);this.contactLists=a,this.enable=this.setInfo.enabled,this.resourcetype=this.setInfo.resourceType;var r=[];if(this.setInfo.monitoringTasks.length>0){for(var i=0;i<this.setInfo.monitoringTasks.length;i++)20==this.setInfo.monitoringTasks[i].monitoringItemId&&(this.firstchekbox=!0,this.form.temperature=this.setInfo.monitoringTasks[i].threshold),-1==r.indexOf(this.setInfo.monitoringTasks[i].monitoringItemId)&&r.push(this.setInfo.monitoringTasks[i].monitoringItemId);this.checkList=r}}}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.alarmManage.copyalarmSeting,width:"45%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.alarmName,"label-width":e.labelWidth,prop:"name"}},[a("el-input",{attrs:{placeholder:e.lang.alarmManage.placeentername},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectresoureType,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",disabled:""},on:{change:e.changeResource},model:{value:e.resourcetype,callback:function(t){e.resourcetype=t},expression:"resourcetype"}},e._l(e.resourceTypeoption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),"physical"==e.resourcetype||"virtual"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectResource,"label-width":e.labelWidth,prop:"labels"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:"请选择"},model:{value:e.form.labels,callback:function(t){e.$set(e.form,"labels",t)},expression:"form.labels"}},e._l(e.hostName,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1):e._e(),e._v(" "),"physical"==e.resourcetype||"virtual"==e.resourcetype||"ceph"==e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectTemplate,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:e.lang.alarmManage.selecttemMitle},model:{value:e.templates,callback:function(t){e.templates=t},expression:"templates"}},e._l(e.alarmtemplateOption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1):e._e(),e._v(" "),"hardware"===e.resourcetype?a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.monitoringitem,"label-width":e.labelWidth}},[a("el-checkbox-group",{on:{change:e.changecheckbox},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.falutList,function(t,l){return a("div",{key:l,staticStyle:{width:"150px"}},[a("el-checkbox",{attrs:{label:t.id}},[e._v(e._s(t.name))])],1)}),0)],1)],1),e._v(" "),e.firstchekbox?a("el-col",[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.yuvalue,"label-width":e.labelWidth,prop:"temperature"}},[a("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.temperature,callback:function(t){e.$set(e.form,"temperature",e._n(t))},expression:"form.temperature"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"10px","line-height":"38px"},attrs:{span:8}},[a("span",[e._v("超过阈值后触发告警")])])],1):e._e()],1):e._e(),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.selectContact,"label-width":e.labelWidth}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",multiple:"",placeholder:e.lang.alarmManage.selectcontactMitle},model:{value:e.contactLists,callback:function(t){e.contactLists=t},expression:"contactLists"}},e._l(e.contactOption,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:15}},[a("el-form-item",{attrs:{label:e.lang.common.enable,"label-width":e.labelWidth}},[a("el-checkbox",{model:{value:e.enable,callback:function(t){e.enable=t},expression:"enable"}})],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.updateSetting}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var k=a("C7Lr")(y,_,!1,function(e){a("26lc")},"data-v-1c34d7de",null).exports,w={components:{"pana-breadcrumb":l.a,"pana-createsetting":r,"pana-disablesetting":c,"pana-enablesetting":m,"pana-deletesetting":f,"pana-editsetting":v,"pana-copysetting":k},data:function(){return{tableData:[],pageNum:1,pageSize:10,showCreate:!1,showDisable:!1,showEnable:!1,showDelete:!1,showEdit:!1,showCopy:!1,search:"",resourceTypes:{physical:"物理主机",ceph:"ceph",computeha:"高可用",hardware:"硬件故障",ceph_check:"ceph健康检查",planwork:"计划任务",virtual:"云组件"},disableIds:[],enableIds:[],selectedIds:[],isdeleteIds:[],nodeleteIds:[],setingInfo:null,copyInfo:null,loading:!0}},methods:{getsettingsList:function(){var e=this;this.checkError(this.$http({url:this.api.alarmManage.getalarmSettinglist,method:"get"}),function(t){e.loading=!1,e.tableData=t.data},function(t){e.loading=!1})},pageSelect:function(e){this.pageNum=e},selectids:function(e){var t=[],a=[],l=[],s=[],o=[];e.forEach(function(e){1==e.enabled?t.push(e.id):a.push(e.id),0==e.isDefault?s.push(e.id):o.push(e.id),l.push(e.id)}),this.selectedIds=l,this.disableIds=t,this.enableIds=a,this.isdeleteIds=s,this.nodeleteIds=o},closeCreate:function(e){1==e&&this.getsettingsList(),this.showCreate=!1},closeEdit:function(e){1==e&&this.getsettingsList(),this.showEdit=!1},closeCopy:function(e){1==e&&this.getsettingsList(),this.showCopy=!1},closeDisable:function(e){var t=this,a=[];this.showDisable=!1,!0===e&&(a=this.disableIds,this.checkError(this.$http({url:this.api.alarmManage.disableAlarm+this.common.formatGetUrl({ids:a,status:"disabled"}),method:"put"}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:"禁用成功"}),t.getsettingsList()}))},closeEnable:function(e){var t=this,a=[];this.showEnable=!1,!0===e&&(a=this.enableIds,this.checkError(this.$http({url:this.api.alarmManage.disableAlarm+this.common.formatGetUrl({ids:a,status:"enabled"}),method:"put"}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:"启用成功"}),t.getsettingsList()}))},closeDelete:function(e){var t=this,a=[];this.showDelete=!1,!0===e&&(a=this.isdeleteIds,this.checkError(this.$http({url:this.api.alarmManage.getalarmSettinglist+this.common.formatGetUrl({ids:a}),method:"delete"}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:"删除成功"}),t.getsettingsList()}))},editSetting:function(e){this.showEdit=!0,this.setingInfo=e},copySetting:function(e){this.showCopy=!0,this.copyInfo=e},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.tableData=this.tableData.sort(function(a,l){return(a[e.prop]>l[e.prop]?1:-1)*t})}},computed:{filterData:function(){var e=this.search,t=[];return t=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),t},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}},mounted:function(){this.getsettingsList()}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getsettingsList}}),e._v(" "),a("el-main",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:19}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreate=!0}}},[e._v(e._s(e.lang.common.create))]),e._v(" "),a("el-button",{attrs:{disabled:0==e.disableIds.length||e.disableIds.length>0&&e.enableIds.length>0},on:{click:function(t){e.showDisable=!0}}},[e._v(e._s(e.lang.common.disable))]),e._v(" "),a("el-button",{attrs:{disabled:0==e.enableIds.length||e.disableIds.length>0&&e.enableIds.length>0},on:{click:function(t){e.showEnable=!0}}},[e._v(e._s(e.lang.common.enable))]),e._v(" "),a("el-button",{attrs:{disabled:0==e.isdeleteIds.length||e.isdeleteIds.length>0&&e.nodeleteIds.length>0},on:{click:function(t){e.showDelete=!0}}},[e._v(e._s(e.lang.common.delete))])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getsettingsList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"selection-change":e.selectids,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection",width:"45",sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:e.lang.alarmManage.alarmName,sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.sourceType,prop:"resourceType",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.resourceTypes[t.row.resourceType]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.alarmTemplate},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.alarmtemps,function(l,s){return a("span",{key:s},[e._v("\n                        "+e._s(l.name)+"\n                        "),a("i",{directives:[{name:"show",rawName:"v-show",value:s<t.row.alarmtemps.length-1,expression:"index<scope.row.alarmtemps.length-1"}]},[e._v(",")])])})}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.source},scopedSlots:e._u([{key:"default",fn:function(t){return[e._l(t.row.labelList,function(l,s){return"virtual"!==t.row.resourceType?a("span",{key:s},[e._v("\n                        "+e._s(l.hostName)+"\n                        "),a("span",{directives:[{name:"show",rawName:"v-show",value:s<t.row.labelList.length-1,expression:"index<scope.row.labelList.length-1"}]},[e._v(",")])]):e._e()}),e._v(" "),e._l(t.row.labelList,function(l,s){return"virtual"===t.row.resourceType?a("span",{key:s},[e._v("\n                        "+e._s(l.name)+"\n                        "),a("i",{directives:[{name:"show",rawName:"v-show",value:s<t.row.labelList.length-1,expression:"index<scope.row.labelList.length-1"}]},[e._v(",")])]):e._e()})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:e.lang.alarmManage.contactPerson},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.contactlists,function(l,s){return a("span",{key:s},[e._v("\n                        "+e._s(l.name)+"\n                        "),a("i",{directives:[{name:"show",rawName:"v-show",value:s<t.row.contactlists.length-1,expression:"index<scope.row.contactlists.length-1"}]},[e._v(",")])])})}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.isup,prop:"enabled",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.enabled?a("div",[e._v("是")]):e._e(),e._v(" "),0==t.row.enabled?a("div",[e._v("否")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.operate},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.editSetting(t.row)}}},[e._v("\n                        "+e._s(e.lang.common.edit)+"\n                    ")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.copySetting(t.row)}}},[e._v("\n                        "+e._s(e.lang.common.copy)+"\n                    ")])]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("pana-createsetting",{attrs:{show:e.showCreate},on:{closeModal:e.closeCreate}}),e._v(" "),a("pana-disablesetting",{attrs:{show:e.showDisable},on:{closeModal:e.closeDisable}}),e._v(" "),a("pana-enablesetting",{attrs:{show:e.showEnable},on:{closeModal:e.closeEnable}}),e._v(" "),a("pana-deletesetting",{attrs:{show:e.showDelete},on:{closeModal:e.closeDelete}}),e._v(" "),a("pana-editsetting",{attrs:{show:e.showEdit,setInfo:e.setingInfo},on:{closeModal:e.closeEdit}}),e._v(" "),a("pana-copysetting",{attrs:{show:e.showCopy,setInfo:e.copyInfo},on:{closeModal:e.closeCopy}})],1)},staticRenderFns:[]};var I=a("C7Lr")(w,x,!1,function(e){a("MNB7")},"data-v-5ddeaf42",null);t.default=I.exports},O4WD:function(e,t){},T72z:function(e,t){}});