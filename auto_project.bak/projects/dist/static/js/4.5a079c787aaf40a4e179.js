webpackJsonp([4],{"+ri7":function(e,t,o){"use strict";var s=o("aA9S"),i=o.n(s),a={props:{server_id:String,show:Boolean},components:{},data:function(){return{loading:!0,floatingIps:[],fixedIps:[],form:{floating_ip:"",port_id:""}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getFloatingIps(),this.getFixedIps()},getFloatingIps:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.cloud_floatingips,method:"get"}),function(t){e.floatingIps=t.data,e.form.floating_ip=e.floatingIps[0]&&e.floatingIps[0].id,e.loading=!1},function(){e.loading=!1})},getFixedIps:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.fixedIps=t.data,e.fixedIps[0]&&(e.form.port_id=e.fixedIps[0].port_id)})},confirm:function(){var e=this,t=this.common.formatMsg(this.api.cloud.post_floatingips_detail_association,{floatingip_id:this.form.floating_ip});delete this.form.floating_ip;var o=this.form;e.closeModal(!1),this.checkError(this.$http({url:t,data:o,method:"post"}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.bindPublicIpSuccess})})},closeModal:function(e){i()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}},computed:{noFloatingIp:function(){return 0===this.floatingIps.length}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.bindPublicIp,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-alert",{attrs:{title:e.lang.resource.bindPublicIpInfo,type:"bg-blue",closable:!1}}),e._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.publicIp,prop:"floating_ip"}},[o("el-select",{attrs:{filterable:"",disabled:e.noFloatingIp},model:{value:e.form.floating_ip,callback:function(t){e.$set(e.form,"floating_ip",t)},expression:"form.floating_ip"}},e._l(e.floatingIps,function(e){return o("el-option",{key:e.id,attrs:{label:e.floating_ip_address,value:e.id}})}),1),e._v(" "),e.noFloatingIp?o("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.noFloatingIp))]):e._e()],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.privateIp,prop:"privateIp"}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.port_id,callback:function(t){e.$set(e.form,"port_id",t)},expression:"form.port_id"}},e._l(e.fixedIps,function(e){return o("el-option",{key:e.port_id,attrs:{label:e.fixed_ips[0].ip_address,value:e.port_id}})}),1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:e.noFloatingIp},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(a,n,!1,function(e){o("YSnw")},"data-v-e9d726f8",null);t.a=r.exports},"09sb":function(e,t,o){"use strict";var s=o("aA9S"),i=o.n(s),a={props:{show:Boolean,serverId:String,componentDetailData:Object},components:{},data:function(){return{form:{id:""},diskInfo:[],loading:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getDiskInfo()},getDiskInfo:function(){this.diskInfo=this.componentDetailData.diskInfo,this.diskInfo=this.diskInfo.filter(function(e){return!e.is_sys_disk}),this.form.id=this.diskInfo[0]&&this.diskInfo[0].id,this.loading=!1},unloadCloudDisk:function(){var e=this,t={server_id:this.serverId},o=this.common.formatMsg(e.api.storage.post_volumes_detail_detachments,{vid:this.form.id});e.wsEventQueue.push(this.form.id),e.closeModal(!1),this.checkError(this.$http({url:o,method:"post",data:t}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.unloadingCloudDiskSuccess})})},closeModal:function(){i()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.uninstallCloudDisk,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"130px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.selectDisk}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}},e._l(e.diskInfo,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:!e.form.id},on:{click:e.unloadCloudDisk}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(a,n,!1,function(e){o("c18T"),o("rd24")},"data-v-1410a405",null);t.a=r.exports},"1Mr8":function(e,t){},"3JmR":function(e,t){},"4kHz":function(e,t){},"8zeT":function(e,t){},E8Uc:function(e,t){},FlL3:function(e,t){},INR5:function(e,t){},Igq9:function(e,t){},JdNb:function(e,t,o){"use strict";var s=o("aA9S"),i=o.n(s),a={props:{server_id:String,show:Boolean},data:function(){return{loading:!0,floatingIps:[],fixedIps:[],form:{port_id:""},disabled:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getFixedIps()},getFixedIps:function(){var e=this,t=this.common.formatMsg(this.api.cloud.server_os_interface_fips,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.fixedIps=t.data,e.fixedIps[0]?(e.disabled=!1,e.form.port_id=e.fixedIps[0].port_id):e.disabled=!0,e.loading=!1})},confirm:function(){var e=this,t=this.get_floatingip_id(),o=this.common.formatMsg(this.api.cloud.post_floatingips_detail_dissociation,{floatingip_id:t}),s=this.form;e.closeModal(!1),this.checkError(this.$http({url:o,data:s,method:"post"}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.unbindPublicIpSuccess})})},closeModal:function(e){i()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},get_floatingip_id:function(){var e=this,t=this.fixedIps.filter(function(t){return t.port_id===e.form.port_id});return t[0]&&t[0].id}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.releasePublicIp,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.privateIp,prop:"privateIp"}},[o("el-select",{attrs:{filterable:"",disabled:e.disabled},model:{value:e.form.port_id,callback:function(t){e.$set(e.form,"port_id",t)},expression:"form.port_id"}},e._l(e.fixedIps,function(e){return o("el-option",{key:e.port_id,attrs:{label:e.name,value:e.port_id}})}),1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:e.disabled},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(a,n,!1,function(e){o("INR5")},"data-v-7b9e0b3b",null);t.a=r.exports},Kk6J:function(e,t,o){"use strict";var s=o("aA9S"),i=o.n(s),a={props:{show:Boolean,isStorageServer:Boolean,serverId:String},components:{},data:function(){return{form:{id:""},diskList:[],loading:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getDiskList()},getDiskList:function(){var e=this;this.checkError(this.$http({url:this.api.storage.get_canattach_volumes,method:"get"}),function(t){e.diskList=t.data,e.isStorageServer&&(e.diskList=e.diskList.filter(function(e){return!e.multiattach})),e.diskList=e.diskList.filter(function(t){return-1===t.instance_id.indexOf(e.serverId)}),e.form.id=e.diskList[0]&&e.diskList[0].id,e.loading=!1},function(){e.loading=!1})},loadCloudDisk:function(){var e=this,t={server_id:e.serverId},o=this.common.formatMsg(e.api.storage.post_volumes_detail_attachments,{vid:this.form.id});e.wsEventQueue.push(this.form.id),e.closeModal(!1),this.checkError(this.$http({url:o,method:"post",data:t}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.loadingCloudDiskSuccess})})},closeModal:function(){i()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.loadCloudDisk,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"130px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.selectDisk}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}},e._l(e.diskList,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:!e.form.id},on:{click:e.loadCloudDisk}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(a,n,!1,function(e){o("sYc6")},"data-v-a5251bb6",null);t.a=r.exports},PP5q:function(e,t){},RlWD:function(e,t){},SI8n:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("ZLEe"),i=o.n(s),a=o("3cXf"),n=o.n(a),r=o("1JPr"),l=o("aA9S"),c=o.n(l),u={props:{show:Boolean,id:String},data:function(){return{data:{},loading:!0}},methods:{initForm:function(){this.getDetail()},getDetail:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e.id});e.loading=!0,this.checkError(this.$http({url:t,method:"get"}),function(t){e.data=t.data,e.loading=!1})},statusClass:function(e){switch(e){case"ACTIVE":return"cloud-color-green";case"ERROR":return"cloud-color-red";case"SUSPENDED":return"cloud-color-blue";case"SHUTOFF":return"cloud-color-gray";default:return"cloud-color-orange"}},closeModal:function(){c()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{componentConfig:function(){var e=this.data.vcpus||0,t=this.data.ram||0;return this.common.formatMsg(this.lang.resource.componentConfig,{cpu:e,memory:t/1024})},cloudDisk:function(){var e="",t=this;return this.data.diskInfo.forEach(function(o){var s=o.is_sys_disk?t.lang.cloudDisk.sysDisk:t.lang.cloudDisk.dataDisk;e=e+t.common.formatMsg(t.lang.resource.detailCloudDisk,{name:o.name,type:o.type,disk:s,size:o.size})+"</br>"}),e},passthroughDevices:function(){return this.data.passthroughDevices.some(function(e){return"USB"===e.device_type})?"USB":this.lang.resource.no}}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.common.detail,visible:e.show,modal:!0,top:"8vh",width:"55%"},on:{open:e.initForm,close:e.closeModal}},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"cloud-detail cloud-detail-modal",attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[e.data.hasOwnProperty("name")?o("table",[o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.componentName))]),e._v(" "),o("td",[e._v(e._s(e.data.name))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.image))]),e._v(" "),o("td",[e._v(e._s(e.data.imageName))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.common.configuration))]),e._v(" "),o("td",[e._v(e._s(e.componentConfig))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.common.status))]),e._v(" "),o("td",[o("span",{staticClass:"status",class:e.statusClass(e.data.status)},[e._v(e._s(e.lang.resource.componentStatusArray[e.data.status])+"\n                    ")])])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.outside.privateIp))]),e._v(" "),o("td",{domProps:{innerHTML:e._s(e.data.fixedIps.join("</br>"))}}),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.common.cloudDisk))]),e._v(" "),o("td",{domProps:{innerHTML:e._s(e.cloudDisk)}})]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.outside.publicIp))]),e._v(" "),o("td",{domProps:{innerHTML:e._s(e.data.floatingIps.join("</br>"))}}),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.common.create_time))]),e._v(" "),o("td",[e._v(e._s(e._f("utc2beijing")(e.data.createtime)))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.physicalHost))]),e._v(" "),o("td",[e._v(e._s(e.data.hostName))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.transparentDevice))]),e._v(" "),o("td",{domProps:{innerHTML:e._s(e.passthroughDevices)}})]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.componentRebootOdd))]),e._v(" "),o("td",[e._v(e._s(e.data.abnormalRestart?e.lang.resource.use:e.lang.resource.notUse))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.safeGroup))]),e._v(" "),o("td",{domProps:{innerHTML:e._s(e.data.secGroups.join("</br>"))}})])]):e._e()]),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:e.closeModal}},[e._v(e._s(e.lang.common.close))])],1)])},staticRenderFns:[]};var m=o("C7Lr")(u,d,!1,function(e){o("soUv")},"data-v-232be9e6",null).exports,p=o("/n4h"),h=o("Cj+A"),f={name:"nicTips",props:{show:Boolean},data:function(){return{disable:!1}},methods:{init:function(){c()(this.$data,this.$options.data.call(this))},closeModal:function(e){this.disable=!0,this.$emit("closeModal",e)}}},g={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%","modal-append-to-body":!1,modal:!0},on:{open:e.init,close:e.closeModal}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{staticClass:"tips-content",attrs:{span:18},domProps:{innerHTML:e._s(e.lang.resource.addNicTips)}})],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){return e.closeModal(!1)}}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{disabled:e.disable,type:"primary"},on:{click:function(t){return e.closeModal(!0)}}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var v=o("C7Lr")(f,g,!1,function(e){o("bi95")},"data-v-56b3fd6a",null).exports,_={props:["show","server_id","pool_id"],components:{ipInput:h.a,"pana-nic-tips":v},data:function(){return{loading:!0,safeGroup:[],usedIp:[],networkList:[],allocation_pools:[],setIp:!1,form:{net_id:"",fixed_ip:"",subnetSegment:"",security_group_id:""},ipValidMessage:"",ipRange:"",disabledArr:"",placeholderArr:"",rules:{net_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],security_group_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],subnetSegment:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],fixed_ip:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]},showTips:!1}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getNetwork(),this.getSafeGroup()},openShowTips:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.showTips=!0)})},add:function(e){if(!0===e){var t=this,o={net_id:this.form.net_id,pool_id:this.pool_id},s=this.form.security_group_id;this.setIp&&(o.fixed_ip=this.form.fixed_ip),this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.post_server_os_interface,{server_id:this.server_id}),method:"post",data:o}),function(e){var o=e.data.port_id;t.security_group_set(s,o),t.closeModal(),t.showTips=!1},function(){t.closeModal(),t.showTips=!1})}else this.closeModal(),this.showTips=!1},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)},validateIpFn:function(e){this.$refs.form.validateField(e)},security_group_set:function(e,t){var o=this,s=[];s.push(e),this.checkError(o.$http({url:o.common.formatMsg(o.api.cloud.put_ports,{id:t}),method:"put",data:{security_groups:s}}),function(e){o.$emit("getList"),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.addWorkSuccess})})},getNetwork:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_networks,method:"get"}),function(t){e.networkList=t.data,e.form.net_id=e.networkList[0]&&e.networkList[0].id,e.loading=!1,e.netChange()})},getUsedIp:function(){var e=this;this.checkError(this.$http({url:e.common.formatMsg(e.api.cloud.get_networks_detail_used_ips,{network_id:e.form.net_id}),method:"get"}),function(t){var o=[];t.data.map(function(e){o=o.concat(e.ip)}),e.usedIp=o},function(){})},getSafeGroup:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_security_groups,method:"get"}),function(t){e.safeGroup=t.data,e.safeGroup.filter(function(t){"default"===t.name&&(e.form.security_group_id=t.id)})})},netChange:function(){this.setAllocationPools(),this.getUsedIp()},subnetChange:function(){var e=this.allocation_pools[this.form.subnetSegment],t=e.start,o=e.end;this.setFixedIp(t,o)},setFixedIp:function(e,t){this.ipValidMessage=this.common.formatMsg(this.lang.resource.ipRangeRule,{start:e,end:t});var o=e.split("."),s=t.split("."),i={},a="",n=[],r=[],l=!0;o.map(function(e,t){e===s[t]?(i[t]=e,a=a+e+".",n.push(t),r.push("")):(i[t]={start:e,end:s[t]},!0===l?(l=!1,r.push(o[t]+"~"+s[t])):r.push("0~255"))}),this.form.fixed_ip=a,this.ipRange=i,this.disabledArr=n,this.placeholderArr=r},validateIp:function(e,t,o){var s=t.split("."),i=!0,a=!0;for(var n in this.ipRange)if(this.ipRange.hasOwnProperty(n)){var r=parseInt(s[parseInt(n)]);if("[object Object]"===this.ipRange[n].toString()){if(!s[parseInt(n)]){a=!1;break}if(!0===i){if(i=!1,r<this.ipRange[n].start||r>this.ipRange[n].end){a=!1;break}}else if(3===parseInt(n)){if(r<0||r>this.ipRange[n].end){a=!1;break}}else if(r<0||r>255){a=!1;break}}}!0===a?o():o(new Error(e.message))},validateIpUsed:function(e,t,o){this.usedIp.join(",").indexOf(t)>-1?o(Error(this.lang.outside.ipUsed)):o()},setAllocationPools:function(){var e=this,t=this.networkList.filter(function(t){return t.id===e.form.net_id});if(t[0]){e.form.subnetSegment=0,e.allocation_pools=[],t[0].subnets.forEach(function(t){t.allocation_pools.forEach(function(o){e.allocation_pools.push({name:t.name,start:o.start,end:o.end})})});var o=e.allocation_pools[this.form.subnetSegment],s=o.start,i=o.end;e.setFixedIp(s,i)}}}},b={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.addNetCard,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-alert",{attrs:{title:e.lang.resource.addNetCardInfo,type:"bg-blue",closable:!1}}),e._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.privateIp,prop:"net_id"}},[o("el-select",{attrs:{filterable:""},on:{change:e.netChange},model:{value:e.form.net_id,callback:function(t){e.$set(e.form,"net_id",t)},expression:"form.net_id "}},e._l(e.networkList,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.setIp,prop:"setIp"}},[o("el-checkbox",{model:{value:e.setIp,callback:function(t){e.setIp=t},expression:"setIp"}})],1),e._v(" "),e.setIp?o("div",[o("el-form-item",{attrs:{label:e.lang.router.subnetSegment,prop:"subnetSegment"}},[o("el-select",{attrs:{filterable:""},on:{change:e.subnetChange},model:{value:e.form.subnetSegment,callback:function(t){e.$set(e.form,"subnetSegment",t)},expression:"form.subnetSegment"}},e._l(e.allocation_pools,function(t,s){return o("el-option",{key:s,attrs:{label:e.common.formatMsg(e.lang.resource.subnetSegmentLabel,{subnet:t.name,start:t.start,end:t.end}),value:s}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.ip,prop:"fixed_ip",rules:[{validator:this.validateIp,message:this.ipValidMessage,trigger:"blur"},{validator:this.validateIpUsed,trigger:"blur"}]}},[o("ip-input",{attrs:{disable:e.disabledArr,placeholder:e.placeholderArr},nativeOn:{"!blur":function(t){return e.validateIpFn("fixed_ip")}},model:{value:e.form.fixed_ip,callback:function(t){e.$set(e.form,"fixed_ip",t)},expression:"form.fixed_ip"}})],1)],1):e._e(),e._v(" "),o("el-form-item",{attrs:{label:e.lang.nav.safeGroup,prop:"security_group_id"}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.security_group_id,callback:function(t){e.$set(e.form,"security_group_id",t)},expression:"form.security_group_id"}},e._l(e.safeGroup,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.openShowTips}},[e._v(e._s(e.lang.common.confirm))])],1),e._v(" "),o("pana-nic-tips",{attrs:{show:e.showTips},on:{closeModal:e.add}})],1)},staticRenderFns:[]};var k=o("C7Lr")(_,b,!1,function(e){o("rhbP")},"data-v-0b549d12",null).exports,w={props:{show:Boolean,server_id:String},data:function(){return{loading:!0,removeBtn:!1,networkList:[],timerObj:{},form:{port_id:""}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.removeBtn=!1,this.getIps()},getIps:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.networkList=t.data,e.form.port_id=e.networkList[0]&&e.networkList[0].port_id,e.loading=!1})},getDetail:function(e,t){var o=this,s=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.checkError(this.$http({url:s,method:"get"}),function(s){s.data.fixedIps.every(function(e){return e!=t})&&(clearInterval(o.timerObj[e]),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.removeNetCardSuccess}),o.$emit("getList"))})},remove:function(){var e=this;e.removeBtn=!0;var t=e.server_id,o=this.common.formatMsg(this.api.cloud.delete_server_os_interface,{server_id:this.server_id}),s=this.common.formatGetUrl({port_id:this.form.port_id});e.closeModal(!1),this.checkError(this.$http({url:o+s,method:"delete"}),function(o){var s="";e.networkList.map(function(t,o){t.port_id==e.form.port_id&&(s=t.fixed_ips[0]&&t.fixed_ips[0].ip_address)});var i="",a=(new Date).getTime();i=setInterval(function(){(new Date).getTime()-a<12e4?e.getDetail(t,s):clearInterval(i)},3e3),e.timerObj[e.server_id]=i,e.timer.push(i)})},closeModal:function(e){e=e||!1,this.$emit("closeModal",e)}}},S={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.removeNetCard,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.privateIp,prop:"privateIp"}},[o("el-tooltip",{attrs:{disabled:1!=e.networkList.length,effect:"dark",content:e.lang.resource.lastNetCart,placement:"top"}},[o("div",[o("el-select",{attrs:{filterable:"",disabled:1==e.networkList.length},model:{value:e.form.port_id,callback:function(t){e.$set(e.form,"port_id",t)},expression:"form.port_id"}},e._l(e.networkList,function(e){return o("el-option",{key:e.port_id,attrs:{label:e.fixed_ips[0]&&e.fixed_ips[0].ip_address,value:e.port_id}})}),1)],1)])],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:1==e.networkList.length||e.removeBtn},on:{click:e.remove}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var y=o("C7Lr")(w,S,!1,function(e){o("jmpZ")},"data-v-38e847b2",null).exports,M={props:{server_id:String,show:Boolean},data:function(){return{loading:!0,ips:[],usedIp:[],network_now:"",networkList:[],form:{port_id:"",ip_address:""},disabledArr:[],placeholderArr:[],ipRange:[],rules:{port_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],ip_address:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]},ipRangeTips:""}},components:{ipInput:h.a},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getIps(),this.getNetworkList()},getNetworkList:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_networks,method:"get"}),function(t){e.networkList=t.data,e.privateIpChange(),e.loading=!1})},getAllocationPools:function(){var e=this,t=this.getSubnetId(),o=[];return this.networkList.some(function(s){return s.subnets.some(function(i){if(i.id===t)return o=i.allocation_pools,e.network_now=s.id,e.getUsedIp(),!0})}),o},getUsedIp:function(){var e=this;this.checkError(this.$http({url:e.common.formatMsg(e.api.cloud.get_networks_detail_used_ips,{network_id:e.network_now}),method:"get"}),function(t){var o=[];t.data.map(function(e){o=o.concat(e.ip)}),e.usedIp=o},function(){})},validateIpUsed:function(e,t,o){this.usedIp.join(",").indexOf(t)>-1?o(Error(this.lang.outside.ipUsed)):o()},getSubnetId:function(){var e,t=this,o="";return(e=this.ips.filter(function(e){return e.port_id===t.form.port_id}))[0]&&(o=e[0].fixed_ips[0].subnet_id),o},privateIpChange:function(){var e,t=this,o=this.getAllocationPools(),s=[];this.ipRangeTips=" ",o.map(function(e){t.ipRangeTips=t.ipRangeTips+(e.start+" ~ ")+e.end+"<br/>",s.push(t.setFixedIp(e.start,e.end))}),e=s.sort(function(e,t){return e.disable-t.disable})[0].disable,this.form.ip_address=e>-1?s[0].ip_address.split(".").slice(0,e+1).join("."):"",this.ipRange=[],s.map(function(e){t.ipRange.push(e.ipRange)}),this.disabledArr=e>-1?i()(new Array(3).fill(0)):[],this.placeholderArr=1===s.length?s[0].placeholder:[]},setFixedIp:function(e,t){var o=e.split("."),s=t.split("."),i={},a="",n=-1,r=[],l=!0,c={};return o.map(function(e,t){e===s[t]?(i[t]=e,a=a+e+".",n=t,r.push("")):(i[t]={start:e,end:s[t]},!0===l?(l=!1,r.push(o[t]+"~"+s[t])):r.push("0~255"))}),c.ip_address=a,c.ipRange=i,c.disable=n,c.placeholderArr=r,c},validateIp:function(e,t,o){var s=!1;this.ipRange.map(function(e){var o=t.split("."),i=!0,a=!0;for(var n in e)if(e.hasOwnProperty(n)){var r=parseInt(o[parseInt(n)]);if("[object Object]"===e[n].toString()){if(!o[parseInt(n)]){a=!1;break}if(!0===i){if(i=!1,r<e[n].start||r>e[n].end){a=!1;break}}else if(3===parseInt(n)){if(r<0||r>e[n].end){a=!1;break}}else if(r<0||r>255){a=!1;break}}}s=!0===a||s}),!0===s?o():o(new Error(e.message))},update:function(){var e=!0;if(this.$refs.form.validate(function(t){t||(e=!1)}),!e)return!1;var t=this,o=this.common.formatMsg(this.api.cloud.put_ports,{id:this.form.port_id}),s=[];s.push({ip_address:this.form.ip_address}),t.wsEventQueue.push(t.form.port_id),t.closeModal(!1),this.checkError(this.$http({url:o,data:{fixed_ips:s},method:"put"}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.updatePrivateIpSuccess})})},getIps:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.ips=t.data,e.ips[0]&&(e.form.port_id=e.ips[0].port_id,e.privateIpChange())})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}}},I={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.updatePrivateIp,visible:e.show,modal:!0,top:"8vh",width:"38%"},on:{open:e.initForm,close:e.closeModal}},[o("el-alert",{attrs:{title:e.lang.resource.updatePrivateIpInfo,type:"bg-blue",closable:!1}}),e._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.privateIp,prop:"port_id"}},[o("div",{staticClass:"input-container"},[o("el-select",{attrs:{filterable:""},on:{change:e.privateIpChange},model:{value:e.form.port_id,callback:function(t){e.$set(e.form,"port_id",t)},expression:"form.port_id"}},e._l(e.ips,function(e){return o("el-option",{key:e.port_id,attrs:{label:e.fixed_ips[0].ip_address,value:e.port_id}})}),1),e._v(" "),o("i",{staticClass:"fa fa-question-circle",staticStyle:{color:"transparent"}})],1)]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.updateTo,prop:"ip_address",rules:[{validator:this.validateIp,message:this.lang.resource.ipValidMessage,trigger:"blur"},{validator:this.validateIpUsed,trigger:"blur"}]}},[o("div",{staticClass:"input-container"},[o("ip-input",{attrs:{disable:e.disabledArr,placeholder:e.placeholderArr},model:{value:e.form.ip_address,callback:function(t){e.$set(e.form,"ip_address",t)},expression:"form.ip_address"}}),e._v(" "),o("el-tooltip",{attrs:{effect:"dark",placement:"top"}},[o("span",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.selectableIpRange+"：<br/>"+e.ipRangeTips)},slot:"content"}),e._v(" "),o("i",{staticClass:"fa fa-question-circle"})])],1)])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.update}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var D=o("C7Lr")(M,I,!1,function(e){o("FlL3")},"data-v-26151494",null).exports,x=o("+ri7"),C=o("JdNb"),$={props:{show:Boolean,server_id:String},data:function(){return{loading:!0,fixedIps:[],disable:!1,form:{port_id:"",mac_address:""},rules:{mac_address:[{validator:this.common.validateMac,trigger:"blur"}]},floatingIpId:null}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.disable=!1,this.getFixedIps(),this.getFloatingIps()},getFixedIps:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.fixedIps=t.data,e.fixedIps[0]&&(e.form.port_id=e.fixedIps[0].port_id,e.form.mac_address=e.fixedIps[0].mac_addr),e.loading=!1})},getFloatingIps:function(){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.server_os_interface_fips,{server_id:this.server_id}),method:"get"}),function(t){e.floatingIpId=t.data[0].id})},privateIpChange:function(){var e,t=this;e=this.fixedIps.filter(function(e){return e.port_id===t.form.port_id}),t.form.mac_address=e[0]&&e[0].mac_addr},confirm:function(){var e=this,t=this;this.disable=!0,this.$refs.form.validate(function(o){if(o){var s=e.common.formatMsg(e.api.cloud.server_mac,{server_id:e.server_id}),i=e.form;null!=t.floatingIpId&&""!==t.floatingIpId&&(i.floatingIp_id=e.floatingIpId),t.checkError(t.$http({url:s,data:i,method:"put"}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.updateMacSuccess}),t.closeModal(!1)},function(){t.disable=!1})}else t.disable=!1})},closeModal:function(e){e=e||!1,this.$emit("closeModal",e)}}},O={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.updateMac,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-alert",{attrs:{title:e.lang.resource.updateMacInfo,type:"bg-orange",closable:!1}}),e._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.privateIp,prop:"port_id"}},[o("el-select",{attrs:{filterable:""},on:{change:e.privateIpChange},model:{value:e.form.port_id,callback:function(t){e.$set(e.form,"port_id",t)},expression:"form.port_id"}},e._l(e.fixedIps,function(e){return o("el-option",{key:e.port_id,attrs:{label:e.fixed_ips[0].ip_address,value:e.port_id}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.macAddress,prop:"mac_address"}},[o("el-input",{model:{value:e.form.mac_address,callback:function(t){e.$set(e.form,"mac_address",t)},expression:"form.mac_address"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{disabled:e.disable,type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var L=o("C7Lr")($,O,!1,function(e){o("RlWD")},"data-v-ff47fc40",null).exports,E={props:{server_id:String,show:Boolean},data:function(){return{loading:!0,fixedIps:[],safeGroup:[],form:{port_id:"",allowed_address_pairs:[],port_security_enabled:!1,security_group_id:""},rules:{port_id:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]}}},components:{ipInput:h.a},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getFixedIps()},fixedIpChange:function(){this.get_port_detail()},getFixedIps:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_server_os_interface,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.fixedIps=t.data,e.fixedIps[0]&&(e.form.port_id=e.fixedIps[0].port_id,e.get_port_detail())})},get_port_detail:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_ports_detail,{id:this.form.port_id});this.checkError(this.$http({url:t,method:"get"}),function(t){var o=t.data;e.form.port_security_enabled=o.port_security_enabled,e.safeGroup=o.new_security_groups,o.security_groups[0]?e.form.security_group_id=o.security_groups[0]:e.form.security_group_id=e.safeGroup[0]&&e.safeGroup[0].id,e.form.allowed_address_pairs=o.allowed_address_pairs,e.loading=!1})},addIpPair:function(){this.form.allowed_address_pairs.length<10&&this.form.allowed_address_pairs.push({key:Date.now()})},removeIpPair:function(e){var t=this.form.allowed_address_pairs.indexOf(e);-1!==t&&this.form.allowed_address_pairs.splice(t,1)},confirm:function(){var e=!0;if(this.$refs.form.validate(function(t){t||(e=!1)}),!e)return!1;var t=this,o=this.common.formatMsg(this.api.cloud.put_ports,{id:this.form.port_id});if(delete this.form.port_id,this.form.port_security_enabled){var s=[];s.push(this.form.security_group_id),this.form.security_groups=s,this.form.allowed_address_pairs.forEach(function(e){delete e.key})}else this.form.allowed_address_pairs=[],this.form.security_groups=[];delete this.form.security_group_id;var i=this.form;t.closeModal(!1),this.checkError(this.$http({url:o,data:i,method:"put"}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.nicSecurityConfigSuccess})})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}}},P={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.nicSecurityConfig,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.privateIp,prop:"port_id"}},[o("el-select",{attrs:{filterable:""},on:{change:e.fixedIpChange},model:{value:e.form.port_id,callback:function(t){e.$set(e.form,"port_id",t)},expression:"form.port_id"}},e._l(e.fixedIps,function(e){return o("el-option",{key:e.port_id,attrs:{label:e.fixed_ips[0].ip_address,value:e.port_id}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.nicSecurity}},[o("el-checkbox",{model:{value:e.form.port_security_enabled,callback:function(t){e.$set(e.form,"port_security_enabled",t)},expression:"form.port_security_enabled"}})],1),e._v(" "),e.form.port_security_enabled?o("div",[o("el-form-item",{attrs:{label:e.lang.nav.safeGroup}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.security_group_id,callback:function(t){e.$set(e.form,"security_group_id",t)},expression:"form.security_group_id"}},e._l(e.safeGroup,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:e.addIpPair}},[e._v(e._s(e.lang.resource.addAddressPair))])],1),e._v(" "),e._l(e.form.allowed_address_pairs,function(t,s){return o("el-form-item",{key:t.key,attrs:{label:"IP",prop:"allowed_address_pairs."+s+".ip_address",rules:[{required:!0,message:e.lang.resource.required_item,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.pool.ipFormatRule,trigger:"blur"}]}},[o("el-col",{attrs:{span:20}},[o("ip-input",{model:{value:t.ip_address,callback:function(o){e.$set(t,"ip_address",o)},expression:"item.ip_address"}})],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:2}},[o("el-form-item",{staticClass:"selectStorageBtn"},[o("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(o){return e.removeIpPair(t)}}},[e._v("\n                            "+e._s(e.lang.common.delete)+"\n                        ")])],1)],1)],1)})],2):e._e()],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var N=o("C7Lr")(E,P,!1,function(e){o("PP5q")},"data-v-70a2e03e",null).exports,F={props:{show:Boolean,componentDetailData:Object},data:function(){return{form:{name:""},volume_id:"",min_disk:"",rules:{name:[{required:!0,message:this.lang.resource.required_item,trigger:"blur"},{validator:this.common.validateName3,trigger:"blur"}]}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields()},confirm:function(){var e=!0;if(this.$refs.form.validate(function(t){t||(e=!1)}),!e)return!1;this.getRootDeviceInfo();var t={createImage:{image_name:this.form.name,volume_id:this.volume_id,min_disk:this.min_disk}},o=this,s=this.componentDetailData.uid,i=this.common.formatMsg(o.api.cloud.post_pool_servers_detail_action,{server_id:s});this.checkError(this.$http({url:i,method:"post",data:t}),function(e){o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.makeImageSuccess})}),this.closeModal(!1)},getRootDeviceInfo:function(){var e=this;"diskInfo"in this.componentDetailData&&this.componentDetailData.diskInfo.some(function(t){if(t.is_sys_disk)return e.volume_id=t.id,e.min_disk=parseInt(t.size),!0})},closeModal:function(e){e=e||!1,this.$emit("closeModal",e)}}},R={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.makeImage,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.lang.resource.imageName,prop:"name"}},[o("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var T=o("C7Lr")(F,R,!1,function(e){o("gaCa")},"data-v-158712e2",null).exports,U={props:{show:Boolean,server_id:String,loaded_image_ids:Array},data:function(){return{imageList:[],form:{imageRef:""},volumeId:"",loading:!1}},mounted:function(){var e=this;this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");"volume"===o[0]&&"end"===o[2]&&e.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getImages()},getImages:function(){var e=this,t="";this.loading=!0,this.loaded_image_ids.length>0&&(t=this.common.formatGetUrl({imageIds:this.loaded_image_ids})),this.checkError(this.$http({url:this.api.cloud.get_images_iso+t,method:"get"}),function(t){e.imageList=t.data,e.form.imageRef=e.imageList[0]&&e.imageList[0].image_id,e.loading=!1},function(){e.loading=!1})},confirm:function(){var e=this;e.closeModal();var t=this.api.cloud.post_iso_make_volume;this.checkError(this.$http({url:t,method:"post",data:this.form}),function(t){e.volumeId=t.data,e.queryVolumeStatus()})},queryVolumeStatus:function(){var e=this.volumeId,t=this,o=this.common.formatMsg(this.api.storage.get_volumes_detail,{vid:e});this.checkError(this.$http({url:o,method:"get"}),function(e){"creating"===e.data.status||"downloading"===e.data.status?setTimeout(t.queryVolumeStatus,5e3):"error"===e.data.status?t.$notify({title:t.lang.common.error,type:"error",message:t.lang.resource.discLoadFail}):t.volumeAttachment()})},volumeAttachment:function(){var e=this,t={volumeAttachment:{volumeId:this.volumeId}};e.wsEventQueue.push(this.volumeId);var o=this.common.formatMsg(this.api.cloud.post_poolServers_os_volume_attachments,{server_id:this.server_id});this.checkError(this.$http({url:o,method:"post",data:t}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.discLoading})})},closeModal:function(e){e=e||!1,this.$emit("closeModal",e)}}},V={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{"append-to-body":"",title:e.lang.resource.load,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.deviceDescription,prop:"imageRef"}},e._l(e.imageList,function(t,s){return o("div",{key:s},[o("el-radio",{attrs:{label:t.image_id},model:{value:e.form.imageRef,callback:function(t){e.$set(e.form,"imageRef",t)},expression:"form.imageRef"}},[o("span",{domProps:{innerHTML:e._s(e.common.formatMsg(e.lang.resource.deviceImage,{name:t.image_name,min_disk:t.size}))}})])],1)}),0)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:!e.form.imageRef},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var B=o("C7Lr")(U,V,!1,function(e){o("xrNV")},null,null).exports,q={props:{show:Boolean,server_id:String},data:function(){return{unloadDialogVisible:!1,multipleSelection:[],showLoad:!1,tableData:[],pageNum:1,pageSize:10,search:"",loading:!0}},components:{discLoad:B},mounted:function(){var e=this;this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");"volume"===o[0]&&"end"===o[2]&&e.getList()}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getList()},unload:function(){var e=this;this.unloadDialogVisible=!1;var t=[];this.multipleSelection.forEach(function(o){t.push(o.volumeId),e.wsEventQueue.push(o.volumeId)});var o=this.common.formatGetUrl({volumeId:t}),s=this.common.formatMsg(this.api.cloud.poolServers_os_volume_attachments,{server_id:this.server_id});this.checkError(this.$http({url:s+o,method:"delete"}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.discUnloading})})},handleSelectionChange:function(e){this.multipleSelection=e},closeLoad:function(e){!0===e&&this.getList(),this.showLoad=!1},pageSelect:function(e){this.pageNum=e},statusClass:function(e){switch(e){case"in-use":return"cloud-success";case"attaching":return"bg-blue";case"detaching":return"cloud-warning"}},getList:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_poolServers_os_volume_attachments,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.loading=!1,e.tableData=t.data})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}},computed:{getImageIds:function(){var e=[];return this.tableData.forEach(function(t){e.push(t.imageId)}),e},pagedData:function(){var e=this.tableData;return e.length<=this.pageSize?e:this.common.pagination(e,this.pageSize,this.pageNum)}}},G={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{id:"load",title:e.lang.resource.discManagement,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-row",{staticClass:"pana-btn-group"},[o("el-col",{attrs:{span:18}},[o("el-button",{attrs:{type:"primary",disabled:e.loading},on:{click:function(t){e.showLoad=!0}}},[e._v(e._s(e.lang.resource.load))]),e._v(" "),o("el-button",{attrs:{disabled:e.multipleSelection.length<=0},on:{click:function(t){e.unloadDialogVisible=!0}}},[e._v(e._s(e.lang.resource.unload))])],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:e.lang.resource.discName}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"status",class:e.statusClass(t.row.status)},[e._v(e._s(e.lang.resource.volumeAttachStatusArray[t.row.status])+"\n                ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"size",label:e.lang.resource.capacityGb}})],1),e._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.tableData.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.tableData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1),e._v(" "),o("disc-load",{attrs:{loaded_image_ids:e.getImageIds,server_id:e.server_id,show:e.showLoad},on:{getList:e.getList,closeModal:e.closeLoad}}),e._v(" "),o("el-dialog",{staticClass:"cloud-tipDialog",attrs:{"append-to-body":"",title:e.lang.imageManage.tip,visible:e.unloadDialogVisible,width:"35%"},on:{"update:visible":function(t){e.unloadDialogVisible=t}}},[e._v("\n        "+e._s(e.lang.resource.unloadDiscConfirm)+"\n        "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.unloadDialogVisible=!1}}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.unload}},[e._v(e._s(e.lang.common.confirm))])],1)]),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))])],1)],1)},staticRenderFns:[]};var A=o("C7Lr")(q,G,!1,function(e){o("laRw")},"data-v-29180093",null).exports,H={props:{show:Boolean,selectdComponent:Object},data:function(){return{timerLocal:"",flavorRef:"",loadingFlavor:!0,flavors:[],tableData:[],pageNumFlavor:1,pageSize:10,searchFlavor:"",label:"",loading:!0}},mounted:function(){var e=this;this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");"compute"===o[0]&&"finish_resize"===o[2]&&"end"===o[3]&&e.$emit("getList"),"compute"!==o[0]||"resize"!==o[2]||"end"!==o[4]&&"error"!==o[4]||e.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getList()},pageSelect:function(e){this.pageNumFlavor=e},resize:function(){var e=this,t={resize:{flavorRef:this.flavorRef}},o=this.selectdComponent.uid,s=this.common.formatMsg(e.api.cloud.post_pool_servers_detail_action,{server_id:o});this.closeModal(),e.wsEventQueue.push(o),this.checkError(this.$http({url:s,method:"post",data:t}),function(e){},function(t){e.wsEventQueue.splice(o,1)})},getStatus:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.$http({url:o,method:"get"}).then(function(e){200303!==e.data.code&&"SHUTOFF"!==e.data.data.status&&"ERROR"!==e.data.data.status||(t.$emit("getList"),clearInterval(t.timerLocal))})},getList:function(){var e=this,t=this.selectdComponent;this.checkError(this.$http({url:this.api.management.get_flavors,method:"get"}),function(o){e.loadingFlavor=!1,e.flavors=o.data,e.flavors=e.flavors.filter(function(e){return!(e.ram===t.ram&&e.vcpus===t.vcpus)})})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}},computed:{filterFlavors:function(){var e=this.searchFlavor,t=this.flavors;return""===e?t:this.common.cloudFilter(t,e)},pagedFlavors:function(){var e=[];return e=this.filterFlavors.length<=this.pageSize?this.filterFlavors:this.common.pagination(this.filterFlavors,this.pageSize,this.pageNumFlavor),this.flavorRef=e[0]&&e[0].id,e}},watch:{searchFlavor:function(){this.pageNumFlavor=1}}},z={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.adjustConfiguration,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:12}}),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.searchFlavor,callback:function(t){e.searchFlavor=t},expression:"searchFlavor"}})],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingFlavor,expression:"loadingFlavor"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedFlavors,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-radio",{attrs:{label:t.row.id},model:{value:e.flavorRef,callback:function(t){e.flavorRef=t},expression:"flavorRef"}},[e._v(e._s(e.label)+"\n                ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:e.lang.common.name}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.cpu},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.vcpus+e.lang.resource.core)+"\n            ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.memory},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.ram/1024+e.lang.common.gb)+"\n            ")]}}])})],1),e._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterFlavors.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterFlavors.length,"current-page":e.pageNumFlavor},on:{"current-change":e.pageSelect}}):e._e()],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:!e.flavorRef||e.pagedFlavors.length<=0},on:{click:e.resize}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var j=o("C7Lr")(H,z,!1,function(e){o("oEl3")},"data-v-acf36046",null).exports,Q={props:{show:Boolean,server_id:String,server_name:String},data:function(){return{usbList:[],form:{deviceType:"USB",usbBus:"0",description:""},noUsbDevice:!1,enterpriseUid:"66666666666666666666666666666666",loading:!1}},methods:{initForm:function(){this.getAvailableUsb()},getAvailableUsb:function(){var e=this,t=this.common.formatMsg(this.api.cloud.poolserver_usb_dev_available,{server_id:this.server_id});this.loading=!0,this.checkError(this.$http({url:t,method:"get"}),function(t){e.usbList=t.data,e.usbList[0]?(e.noUsbDevice=!1,e.form.description=e.usbList[0].description):e.noUsbDevice=!0,e.loading=!1},function(){e.loading=!1})},confirm:function(){var e=this,t={},o=e.usbList.filter(function(t){return t.description===e.form.description});o[0]&&(t={addressBus:o[0].address_bus,addressDevice:o[0].address_device,description:o[0].description,deviceType:e.form.deviceType,enterpriseUid:e.enterpriseUid,hostName:o[0].host,serverId:e.server_id,serverName:e.server_name,usbBus:e.form.usbBus});var s=this.common.formatMsg(this.api.cloud.poolserver_load_usb_device,{server_id:this.server_id});e.closeModal(),this.checkError(this.$http({url:s,method:"post",data:{load:t}}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.transparentEquipmentLoadSuccess})})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}}},Z={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{"append-to-body":"",title:e.lang.resource.load,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.deviceType,prop:"privateIp"}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.deviceType,callback:function(t){e.$set(e.form,"deviceType",t)},expression:"form.deviceType"}},e._l(e.lang.resource.transparentDeviceType,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.deviceDescription,prop:"imageRef"}},[e._l(e.usbList,function(t,s){return t.loading?e._e():o("div",{key:s},[o("el-radio",{attrs:{label:t.description},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}},[e._v("\n                    "+e._s(t.description)+"\n                ")])],1)}),e._v(" "),e.noUsbDevice?o("div",{staticClass:"error"},[e._v("\n                "+e._s(e.lang.resource.noDeviceToLoad)+"\n            ")]):e._e()],2),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.USBcompatibility,prop:"privateIp"}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.usbBus,callback:function(t){e.$set(e.form,"usbBus",t)},expression:"form.usbBus"}},e._l(e.lang.resource.USBcompatibilityArray,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var W=o("C7Lr")(Q,Z,!1,function(e){o("4kHz")},"data-v-6a02487c",null).exports,J={props:{show:Boolean,server_id:String,server_name:String},data:function(){return{unloadDialogVisible:!1,multipleSelection:[],showLoad:!1,tableData:[],pageNum:1,pageSize:10,search:"",loading:!0}},components:{transparentEquipmentLoad:W},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getList()},selectNotOne:function(){return 1!==this.multipleSelection.length},unload:function(){var e=this;this.unloadDialogVisible=!1;var t={addressBus:this.multipleSelection[0].addressBus,addressDevice:this.multipleSelection[0].addressDevice,usbBus:this.multipleSelection[0].usbBus,usbPort:this.multipleSelection[0].usbPort},o=this.common.formatMsg(this.api.cloud.poolserver_unload_usb_device,{server_id:this.server_id});this.checkError(this.$http({url:o,method:"POST",data:{unload:t}}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.transparentEquipmentUnloadSuccess})})},handleSelectionChange:function(e){this.multipleSelection=e},closeLoad:function(e){!0===e&&this.getList(),this.showLoad=!1},pageSelect:function(e){this.pageNum=e},statusClass:function(e){switch(e){case!0:case!1:return"cloud-success"}},getList:function(){var e=this,t=this.common.formatMsg(this.api.cloud.poolserver_attached,{server_id:this.server_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.loading=!1,e.tableData=t.data},function(){e.loading=!1})},closeModal:function(e){e=e||!0,this.$emit("closeModal",e)}},computed:{pagedData:function(){var e=this.tableData;return e.length<=this.pageSize?e:this.common.pagination(e,this.pageSize,this.pageNum)}}},Y={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{id:"load",title:e.lang.resource.transparentEquipment,visible:e.show,modal:!0,top:"8vh",width:"50%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-row",{staticClass:"pana-btn-group"},[o("el-col",{attrs:{span:18}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showLoad=!0}}},[e._v(e._s(e.lang.resource.load))]),e._v(" "),o("el-button",{attrs:{disabled:e.selectNotOne()},on:{click:function(t){e.unloadDialogVisible=!0}}},[e._v(e._s(e.lang.resource.unload))])],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),o("el-table-column",{attrs:{prop:"deviceType",label:e.lang.resource.deviceType}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"status",class:e.statusClass(t.row.status)},[e._v(e._s(e.lang.resource.transparentEquipmentStatusArray[t.row.status])+"\n                ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.resource.compatibility},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s("0"===t.row.usbBus?"USB2.0":"USB3.0")+"\n            ")]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"description",label:e.lang.resource.deviceDescription}})],1),e._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.tableData.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.tableData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1),e._v(" "),o("transparent-equipment-load",{attrs:{server_id:e.server_id,show:e.showLoad},on:{getList:e.getList,closeModal:e.closeLoad}}),e._v(" "),o("el-dialog",{staticClass:"cloud-tipDialog",attrs:{"append-to-body":"",title:e.lang.imageManage.tip,visible:e.unloadDialogVisible,width:"35%"},on:{"update:visible":function(t){e.unloadDialogVisible=t}}},[e._v("\n        "+e._s(e.lang.resource.unloadTransparentDevice)+"\n        "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.unloadDialogVisible=!1}}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.unload}},[e._v(e._s(e.lang.common.confirm))])],1)])],1)},staticRenderFns:[]};var K=o("C7Lr")(J,Y,!1,function(e){o("Igq9")},"data-v-97656cf8",null).exports,X={props:{show:Boolean,components:Array,gpuInfo:Object},data:function(){return{data:[],hasError:!1,gpuNumOrigin:{},gpuNum:{},migratedNode:{}}},methods:{initForm:function(){var e=this.gpuInfo,t=this;for(var o in this.$refs.form&&this.$refs.form.resetFields(),e){if(e.hasOwnProperty(o))e[o].length>0?this.gpuNumOrigin[o]=e[o].length:delete e[o]}this.components.forEach(function(e){var o=e.hostName;t.gpuNumOrigin.hasOwnProperty(o)&&t.gpuNumOrigin[o]>0?(e.noGpu=!1,t.gpuNumOrigin[o]--):e.noGpu=!0}),c()(this.gpuNum,this.gpuNumOrigin),this.data=this.components},migratedNodeChange:function(){for(var e in c()(this.gpuNum,this.gpuNumOrigin),this.migratedNode)if(this.migratedNode.hasOwnProperty(e)){var t=this.migratedNode[e];this.gpuNum.hasOwnProperty(t)&&this.gpuNum[t]>0&&this.gpuNum[t]--}},confirm:function(){var e=this,t=[],o="",s={},i=[];if(e.hasError=!1,e.data.some(function(t){if(t.noGpu&&!e.migratedNode.hasOwnProperty(t.name))return e.hasError=!0,!0}),e.hasError)return!1;e.data.forEach(function(a){o=a.noGpu?e.migratedNode[a.name]:a.hostName,(i=e.gpuInfo[o]).length>0&&(s=i[0],i.shift()),s.host=o+".node.consul",s.serverId=a.uid,s.serverName=a.name,s.migrate=a.noGpu,t.push(s)}),e.closeModal(),this.checkError(this.$http({url:this.api.cloud.gpu_load,method:"POST",data:{meta:t}}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.gpuManage.loadingGpu}),e.wsEventQueue.push(s.gpuId+s.serverId),e.$emit("getList")},function(){e.$emit("getList")})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}}},ee={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{id:"mount-gpu",title:e.lang.resource.mountGpu,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{"label-width":"85px"}},[o("el-form-item",{attrs:{label:e.lang.resource.availGpu+":"}},e._l(e.gpuInfo,function(t,s){return t.length>0?o("span",{key:s,staticClass:"gpu-node"},[e._v("\n                "+e._s(s)+": "),o("span",{staticClass:"gpu-number cloud-color-blue"},[e._v(e._s(t.length))]),e._v("个\n            ")]):e._e()}),0),e._v(" "),o("el-table",{staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.data,"highlight-current-row":""}},[o("el-table-column",{attrs:{prop:"name",label:e.lang.resource.componentName},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{class:{"cloud-color-red":t.row.noGpu}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"hostName",label:e.lang.resource.physicalHost},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{class:{"cloud-color-red":t.row.noGpu}},[e._v(e._s(t.row.hostName))]),e._v(" "),t.row.noGpu?o("el-select",{key:t.row.uid,staticClass:"migrated-node",attrs:{filterable:"",placeholder:e.lang.resource.migrateNode},on:{change:e.migratedNodeChange},model:{value:e.migratedNode[t.row.name],callback:function(o){e.$set(e.migratedNode,t.row.name,o)},expression:"migratedNode[scope.row.name]"}},e._l(e.gpuInfo,function(t,s){return e.gpuNum[s]>0?o("el-option",{key:s,attrs:{label:s,value:s}}):e._e()}),1):e._e(),e._v(" "),e.hasError&&t.row.noGpu&&!e.migratedNode.hasOwnProperty(t.row.name)?o("span",{staticClass:"migrated-node-error"},[e._v(e._s(e.lang.common.required_item))]):e._e()]}}])})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.resource.confirmMount))])],1)],1)},staticRenderFns:[]};var te=o("C7Lr")(X,ee,!1,function(e){o("W4IG"),o("jTl5")},"data-v-6b964b0f",null).exports,oe={props:{show:Boolean,server_id:String,abnormalRestart:Boolean},data:function(){return{form:{start:!1}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.form.start=this.abnormalRestart},confirm:function(){var e=this;e.closeModal(!0);var t=this.common.formatGetUrl({action:this.form.start}),o=this.common.formatMsg(this.api.cloud.poolserver_abnormalrestart,{server_id:this.server_id});this.checkError(this.$http({url:o+t,method:"post"}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.virtualExceptionSuccess})},function(t){e.$emit("setLoading")})},closeModal:function(e){e=e||!1,this.$emit("closeModal",e)}}},se={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.componentExceptionManage,visible:e.show,modal:!0,top:"8vh",width:"25%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[o("el-form-item",{attrs:{label:e.lang.resource.componentExceptionReboot}},[o("el-switch",{model:{value:e.form.start,callback:function(t){e.$set(e.form,"start",t)},expression:"form.start"}})],1),e._v(" "),o("p",{staticClass:"description"},[e._v("\n            "+e._s(e.lang.resource.componentExceptionDesc1)+"\n        ")]),e._v(" "),o("p",{staticClass:"description"},[e._v("\n            "+e._s(e.lang.resource.componentExceptionDesc2)+"\n        ")])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:e.form.start===e.abnormalRestart},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var ie=o("C7Lr")(oe,se,!1,function(e){o("t/+v")},"data-v-4c25474e",null).exports,ae={props:{show:Boolean,server_id:String,server_name:String},data:function(){return{bootMenus:[],selectedBoot:!1,loading:!1}},methods:{initForm:function(){this.selectedBoot=!1,this.getBootMenu()},getBootMenu:function(){var e=this,t=this.common.formatMsg(this.api.cloud.poolserver_boot_menu,{server_id:this.server_id});this.loading=!0,this.checkError(this.$http({url:t,method:"get"}),function(t){var o=t.data.bootMenus;e.bootMenus=o.filter(function(e){return"fd"!==e.dev}),e.loading=!1},function(){e.loading=!1})},confirm:function(){var e=this,t=[];this.bootMenus.forEach(function(e){t.push(e.dev)}),t.push("fd");var o=this.common.formatGetUrl({bootMenu:t});o=o+"&serverName="+this.server_name;var s=this.common.formatMsg(this.api.cloud.poolserver_boot_menu,{server_id:this.server_id});this.closeModal(),this.checkError(this.$http({url:s+o,method:"put"}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.bootSequenceSuccess})})},moveUp:function(){if(this.selectedBoot){var e=this,t=0;if(this.bootMenus.some(function(o,s){return t=s,o.dev===e.selectedBoot}),t>0){var o=this.bootMenus[t-1],s=this.bootMenus[t];this.bootMenus.splice(t-1,1,s),this.bootMenus[t]=o}}},moveDown:function(){if(this.selectedBoot){var e=this,t=0;if(this.bootMenus.some(function(o,s){return t=s,o.dev===e.selectedBoot}),t<this.bootMenus.length-1){var o=this.bootMenus[t+1],s=this.bootMenus[t];this.bootMenus.splice(t+1,1,s),this.bootMenus[t]=o}}},moveTop:function(){if(this.selectedBoot){var e=this,t=0;if(this.bootMenus.some(function(o,s){return t=s,o.dev===e.selectedBoot}),t>0){var o=this.bootMenus[t];this.bootMenus.splice(t,1),this.bootMenus.unshift(o)}}},moveEnd:function(){if(this.selectedBoot){var e=this,t=0;if(this.bootMenus.some(function(o,s){return t=s,o.dev===e.selectedBoot}),t<this.bootMenus.length-1){var o=this.bootMenus[t];this.bootMenus.splice(t,1),this.bootMenus.push(o)}}},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}}},ne={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.bootSequenceManagement,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-width":"120px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("div",{staticClass:"button-div"},[o("el-button",{attrs:{plain:"",icon:"el-icon-arrow-up"},on:{click:e.moveUp}},[e._v(e._s(e.lang.resource.moveUp))]),e._v(" "),o("el-button",{attrs:{plain:"",icon:"el-icon-arrow-down"},on:{click:e.moveDown}},[e._v(e._s(e.lang.resource.moveDown))]),e._v(" "),o("el-button",{attrs:{plain:"",icon:"el-icon-upload2"},on:{click:e.moveTop}},[e._v(e._s(e.lang.resource.moveTop))]),e._v(" "),o("el-button",{attrs:{plain:"",icon:"el-icon-download"},on:{click:e.moveEnd}},[e._v(e._s(e.lang.resource.moveEnd))])],1),e._v(" "),o("div",{staticClass:"boot-div"},e._l(e.bootMenus,function(t,s){return o("div",{key:s},[o("el-radio",{attrs:{label:t.dev},model:{value:e.selectedBoot,callback:function(t){e.selectedBoot=t},expression:"selectedBoot"}},[e._v("\n                    "+e._s(e.lang.resource.bootArray[t.dev])+"\n                ")])],1)}),0)]),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var re=o("C7Lr")(ae,ne,!1,function(e){o("daod")},"data-v-63ebe013",null).exports,le={props:{timerLocal:"",show:Boolean,server_id:String,currentUsageData:Object},data:function(){return{current_memory:"",form:{vcpu_max:"",ram_max:""}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields()},confirm:function(){var e=!0;if(this.$refs.form.validate(function(t){t||(e=!1)}),!e)return!1;this.closeModal();var t=this.common.formatMsg(this.api.cloud.post_pool_servers_detail_action,{server_id:this.server_id});this.form.ram_max=1024*this.form.ram_max,this.wsEventQueue.push(this.server_id),this.checkError(this.$http({url:t,method:"post",data:{liveResize:this.form}}),function(e){})},getStatus:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.checkError(this.$http({url:o,method:"get"}),function(e){"ACTIVE"===e.data.status&&(t.$emit("getList"),clearInterval(t.timerLocal))})},closeModal:function(e){e=e||!1,this.$emit("closeModal",e)}},computed:{currentConfigurationData:function(){var e=this.currentUsageData.current_cpus;return this.current_memory=this.common.switchCapacity(this.currentUsageData.current_mem_mb,"MB","GB",1),this.common.formatMsg(this.lang.resource.currentConfigurationData,{cpu:e,memory:this.current_memory})},maximum_mem_gb:function(){return this.common.switchCapacity(this.currentUsageData.maximum_mem_mb,"MB","GB",1)},equalCurrentConf:function(){return this.form.ram_max===this.current_memory&&this.form.vcpu_max===this.currentUsageData.current_cpus}}},ce={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.hotUpgrade,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[o("el-form-item",{attrs:{label:e.lang.resource.currentConfiguration}},[o("span",[e._v(e._s(e.currentConfigurationData))])]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.cpu,prop:"vcpu_max",rules:[{type:"integer",min:this.currentUsageData.current_cpus,max:this.currentUsageData.maximum_cpus,message:this.common.formatMsg(this.lang.resource.validHotGradeCpu,{min:this.currentUsageData.current_cpus,max:this.currentUsageData.maximum_cpus}),trigger:"change"}]}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.vcpu_max,callback:function(t){e.$set(e.form,"vcpu_max",e._n(t))},expression:"form.vcpu_max"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.memory,prop:"ram_max",rules:[{type:"integer",min:this.current_memory,max:this.maximum_mem_gb,message:this.common.formatMsg(this.lang.resource.validHotGradeRam,{min:this.current_memory,max:this.maximum_mem_gb}),trigger:"change"}]}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.ram_max,callback:function(t){e.$set(e.form,"ram_max",e._n(t))},expression:"form.ram_max"}}),e._v(" "),e.equalCurrentConf?o("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.moreThanCurrentConf))]):e._e()],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{disabled:e.equalCurrentConf,type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var ue=o("C7Lr")(le,ce,!1,function(e){o("3JmR")},"data-v-08e4498d",null).exports,de={props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)}}},me={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.lang.resource.notRebuildInfo))])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.close))])],1)],1)},staticRenderFns:[]},pe=o("C7Lr")(de,me,!1,null,null,null).exports,he={props:{server_id:String,availabilityZone:String,hostName:String,show:Boolean},data:function(){return{timerLocal:"",loading:!1,availabilityZoneData:[],hosts:[],form:{host:""},rules:{host:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]}}},mounted:function(){var e=this;this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");"compute"===o[0]&&"end"===o[4]&&e.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getAvailabilityZone()},getAvailabilityZone:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_os_availability_zone,method:"get"}),function(t){e.availabilityZoneData=t.data,e.getHosts(),e.loading=!1},function(){e.loading=!1})},getHosts:function(){var e,t=this;(e=this.availabilityZoneData.filter(function(e){return e.zoneName===t.availabilityZone})).length>0&&(t.hosts=i()(e[0].hosts).filter(function(e){return e!==t.hostName}),t.hosts.length>0&&(t.form.host=t.hosts[0]))},getStatus:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.$http({url:o,method:"get"}).then(function(e){200303!==e.data.code&&"ACTIVE"!==e.data.data.status&&"ERROR"!==e.data.data.status||(t.$emit("getList"),clearInterval(t.timerLocal))})},confirm:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var o=e,s=o.common.formatMsg(o.api.cloud.post_pool_servers_detail_action,{server_id:o.server_id}),i={"os-migrateLive":{block_migration:!1,disk_over_commit:!1,host:o.form.host}},a=o.server_id;o.form.host;o.closeModal(),o.wsEventQueue.push(a),e.checkError(e.$http({url:s,data:i,method:"post"}),function(e){})})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}}},fe={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.hotMigrate,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.targetNode,prop:"host"}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.host,callback:function(t){e.$set(e.form,"host",t)},expression:"form.host"}},e._l(e.hosts,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var ge=o("C7Lr")(he,fe,!1,function(e){o("UIiB")},"data-v-40ff3c72",null).exports,ve={props:{server_id:String,server:Object,show:Boolean},data:function(){return{label:"",loading:!1,timerLocal:"",form:{migrateMode:"",node:""},hypervisors:[],pageNum:1,pageSize:10,rules:{migrateMode:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]}}},mounted:function(){var e=this;this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");"compute"===o[0]&&"finish_resize"===o[2]&&"end"===o[3]&&e.$emit("getList")}})},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getHypervisors()},getHypervisors:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_os_hypervisors,method:"get"}),function(t){e.hypervisors=t.data,e.loading=!1},function(){e.loading=!1})},migrateModeChange:function(){1===this.form.migrateMode&&this.hostsData.length>0&&(this.form.node=this.hostsData[0].name)},pageSelect:function(e){this.pageNum=e},getStatus:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.$http({url:o,method:"get"}).then(function(e){200303!==e.data.code&&"SHUTOFF"!==e.data.data.status&&"ERROR"!==e.data.data.status||(t.$emit("getList"),clearInterval(t.timerLocal))})},confirm:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var o=e,s=o.server_id,i=o.common.formatMsg(o.api.cloud.post_pool_servers_detail_action,{server_id:o.server_id}),a={};a=0===o.form.migrateMode?{migrate:null}:{migrate:{host:o.form.node}},o.closeModal(),o.wsEventQueue.push(s),e.checkError(e.$http({url:i,data:a,method:"post"}),function(e){})})},closeModal:function(e){c()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}},computed:{hostsData:function(){var e=this.server;return this.hypervisors.map(function(e){e.name=e.hypervisor_hostname.split(".")[0],e.freeCpu=4*e.vcpus-e.vcpus_used,e.freeRam=parseInt(e.free_ram_mb/1024)}),this.hypervisors.filter(function(t){return t.name!=e.hostName&&e.vcpus<t.freeCpu&&e.ram/1024<t.freeRam&&"up"==t.state&&"enabled"==t.status})},pagedData:function(){return this.hostsData.length<=this.pageSize?this.hostsData:this.common.pagination(this.hostsData,this.pageSize,this.pageNum)}}},_e={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.coldMigrate,visible:e.show,modal:!0,top:"8vh",width:"25%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.migrateMode,prop:"migrateMode"}},[o("el-select",{attrs:{filterable:""},on:{change:e.migrateModeChange},model:{value:e.form.migrateMode,callback:function(t){e.$set(e.form,"migrateMode",t)},expression:"form.migrateMode"}},e._l(e.lang.resource.migrateModeValue,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),1===e.form.migrateMode?o("el-table",{ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.pagedData,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-radio",{attrs:{label:t.row.name},model:{value:e.form.node,callback:function(t){e.$set(e.form,"node",t)},expression:"form.node"}},[e._v(e._s(e.label))])]}}],null,!1,2196103380)}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:e.lang.common.name}}),e._v(" "),o("el-table-column",{attrs:{prop:"freeCpu",label:e.lang.resource.freeCpu}}),e._v(" "),o("el-table-column",{attrs:{prop:"freeRam",label:e.lang.resource.freeMemoryGB}})],1):e._e(),e._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.hostsData.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.hostsData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:1===e.form.migrateMode&&""===e.form.node},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var be=o("C7Lr")(ve,_e,!1,function(e){o("ZP0S")},"data-v-04bce6df",null).exports,ke={name:"resetPassword",props:{show:Boolean,serverId:String},data:function(){return{form:{password:"",confirmPassword:""},rules:{password:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validatePassword,trigger:"blur"}]}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields()},closeModal:function(){c()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")},updatePassword:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.checkError(e.$http({url:e.common.formatMsg(e.api.cloud.post_pool_servers_detail_action,{server_id:e.serverId}),method:"post",data:{changePassword:{adminPass:e.form.password}}}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.updatePasswordSuccess}),e.closeModal()})})},validateConfirmPass:function(e,t,o){t!==this.form.password?o(new Error(self.lang.resource.passwordNotConsistent)):o()}}},we={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{id:"updatePassword",title:e.lang.resource.updatePassword,visible:e.show,top:"8vh",width:"35%"},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",staticClass:"fixPassWordValWid",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.lang.common.password,prop:"password"}},[o("el-input",{attrs:{type:"password",placeholder:e.lang.imageManage.passwordPlaceholder},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.common.confirmPassword,prop:"confirmPassword",rules:[{required:!0,message:e.lang.common.required_item,trigger:"blur"},{validator:e.validateConfirmPass,trigger:"blur"}]}},[o("el-input",{attrs:{type:"password",placeholder:e.lang.imageManage.confirmPasswordPlaceholder},model:{value:e.form.confirmPassword,callback:function(t){e.$set(e.form,"confirmPassword",t)},expression:"form.confirmPassword"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.updatePasswordDialogVisible=!1}}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatePassword("form")}}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var Se=o("C7Lr")(ke,we,!1,function(e){o("1Mr8")},"data-v-3c58182b",null).exports,ye={name:"setName",props:{show:Boolean,vmName:String,serverId:String},data:function(){return{form:{name:""},rules:{name:[{required:!0,message:"请输入组件名称",trigger:"blur"},{min:1,max:64,message:"长度为1-64个字符",trigger:"blur"},{validator:this.common.validateName2,trigger:"blur"}]}}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.form.name=this.vmName},closeModal:function(e){e=e||!1,c()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},updateName:function(){var e=this,t=this;this.$refs.form.validate(function(o){if(!o)return!1;e.checkError(e.$http({url:e.common.formatMsg(t.api.cloud.put_pool_servers,{server_id:t.serverId}),method:"put",data:{name:t.form.name}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.editComponentNameSuccess}),t.closeModal(!0)})})}}},Me={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.updateComponentName,visible:e.show,top:"8vh",width:"35%"},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"150px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.lang.resource.cloudComponentName,prop:"name"}},[o("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateName("form")}}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var Ie=o("C7Lr")(ye,Me,!1,function(e){o("iPXr")},"data-v-cf987e22",null).exports,De=o("Kk6J"),xe=o("09sb"),Ce=o("oIPs"),$e=o("zLDf"),Oe={props:["poolId","currentPool"],components:{panaBreadcrumb:r.a,detail:m,cloudTipDialog:p.a,cloudAddNetwork:k,cloudRemoveNetwork:y,cloudUpdatePrivateIp:D,cloudBindPublicIp:x.a,cloudUnbindPublicIp:C.a,cloudUpdateMac:L,cloudNicSecurityConfig:N,cloudMakeImage:T,cloudDiscManagement:A,cloudAjustConfiguration:j,cloudTransparentEquipment:K,cloudMountGpu:te,cloudComponentException:ie,cloudHotMigrate:ge,cloudColdMigrate:be,cloudBootSequence:re,cloudHotUpgrade:ue,cloudNotRebuild:pe,cloudResetPassword:Se,cloudUpdateName:Ie,loadCloudDisk:De.a,unloadCloudDisk:xe.a,cloudSnapshot:Ce.a,cloudSnapshotRollback:$e.a},data:function(){return{sortOrder:0,sortProp:"",gpuListLoading:!1,gpuQuota:"",showNotRebuild:!1,timerArray:[],gpuInfo:{},showLoadCloudDisk:!1,showUnloadCloudDisk:!1,showSnapshot:!1,showSnapshotRollback:!1,showDeleteSystemConfirm:!1,deleteSystemDisk:!0,operation_only_sysytem_admin:["hotMigrate"],confirm_warning:!1,confirm_text_left:!1,showAddNetwork:!1,showRemoveNetwork:!1,showUpdatePrivateIp:!1,showBindPublicIp:!1,showUnbindPublicIp:!1,showUpdateMac:!1,showReleasePublicIp:!1,showNicSecurityConfig:!1,showTooltip:!1,showMakeImage:!1,showDiscManagement:!1,showTransparentEquipment:!1,showMountGpu:!1,showComponentException:!1,showBootSequence:!1,showHotUpgrade:!1,showHotMigrate:!1,showColdMigrate:!1,loading:!0,tipDialogMsg:"",dialogVisible:!1,actionData:{},updatePasswordDialogVisible:!1,resizeDialogVisible:!1,id:"",detailDialogVisible:!1,diskOperateValue:"",diskOperation:[{value:"loadCloudDisk",label:this.lang.resource.loadCloudDisk},{value:"unloadCloudDisk",label:this.lang.resource.uninstallCloudDisk},{value:"snapshot",label:this.lang.resource.snapshot},{value:"snapshotRollback",label:this.lang.resource.snapshotRollback}],networkOperateValue:"",networkOperateOptions:[{value:"addPort",label:this.lang.resource.addNetCard},{value:"removePort",label:this.lang.resource.removeNetCard},{value:"updatePrivateIp",label:this.lang.resource.updatePrivateIp},{value:"bindPublicIp",label:this.lang.resource.bindPublicIp},{value:"unbindPublicIp",label:this.lang.resource.releasePublicIp},{value:"updateMac",label:this.lang.resource.updateMac},{value:"nicSecurityConfig",label:this.lang.resource.nicSecurityConfig}],moreOperateValue:"",operate:"",moreOperation1:[{value:"reboot",label:this.lang.resource.reboot},{value:"delete",label:this.lang.common.delete},{value:"updateName",label:this.lang.resource.updateComponentName},{value:"makeImage",label:this.lang.resource.makeImage},{value:"suspend",label:this.lang.resource.hang},{value:"resume",label:this.lang.resource.restoreHang},{value:"pause",label:this.lang.resource.pause},{value:"unpause",label:this.lang.resource.restorePause},{value:"reset",label:this.lang.resource.reset},{value:"oneClickRecovery",label:this.lang.resource.oneClickRecovery},{value:"forceShutdown",label:this.lang.resource.forceShutdown}],moreOperation2:[{value:"hotMigrate",label:this.lang.resource.hotMigrate},{value:"coldMigrate",label:this.lang.resource.coldMigrate},{value:"hotUpgrade",label:this.lang.resource.hotUpgrade},{value:"updatePassword",label:this.lang.resource.updatePassword},{value:"resize",label:this.lang.resource.adjustConfiguration},{value:"discManagement",label:this.lang.resource.discManagement},{value:"mountGpu",label:this.lang.resource.mountGpu},{value:"unmountGpu",label:this.lang.resource.unmountGpu},{value:"transparentEquipment",label:this.lang.resource.transparentEquipment},{value:"bootSequence",label:this.lang.resource.bootSequenceManagement},{value:"componentException",label:this.lang.resource.componentExceptionManage}],tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,updateNameDialogVisible:!1,poolPage:1,componentDetailData:{},currentUsageData:{},gpuList:[],storageServerId:null}},mounted:function(){var e=this;this.loading=!0,this.tableData=[],JSON.parse(sessionStorage.getItem("panaPools")).map(function(t){parseInt(t.id)===parseInt(e.poolId)&&(e.storageServerId=t.stor_server_id)}),this.Hub.$off("getComponentList").$on("getComponentList",function(){e.getList()}),this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");"floatingip"===o[0]&&"end"===o[2]&&(e.tableData.map(function(e){null===t.payload.floatingip.fixed_ip_address?-1!==e.floatingIps.indexOf(t.payload.floatingip.floating_ip_address)&&(e.floatingIps=[]):-1!==e.fixedIps.indexOf(t.payload.floatingip.fixed_ip_address)&&(e.floatingIps=[],e.floatingIps.push(t.payload.floatingip.floating_ip_address))}),e.$refs.multipleTable.clearSelection()),"compute"!==o[0]||"instance"!==o[1]||"end"!==o[3]&&"error"!==o[3]||e.getList(),"compute"!==o[0]||"instance"!==o[1]||"end"!==o[4]&&"error"!==o[4]||e.getList(),"instance"===o[0].split("_")[1]&&e.getList(),"volume"===o[0]&&"end"===o[2]&&e.getList(),"udsafe"===o[0]&&"gpu"===o[2]&&"end"===o[4]&&e.getList(),"port"===o[0]&&"delete"===o[1]&&"end"===o[2]&&e.getList()}}),e.getList(),this.setCurrentPool(),this.common.is_system_admin()||this.common.permissionManage(e,e.poolId,function(){e.moreOperation2=e.moreOperation2.filter(function(e){return"hotMigrate"!==e.value&&"coldMigrate"!==e.value&&"transparentEquipment"!==e.value}),e.moreOperation1=e.moreOperation1.filter(function(e){return"reset"!==e.value})})},methods:{sort:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.sortProp=e.prop,this.sortOrder=t,this.tableData=this.tableData.sort(function(t,o){return t[e.prop]=null==t[e.prop]?"":t[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],t[e.prop]==o[e.prop]?o.createtime-t.createtime:(t[e.prop]>o[e.prop]?1:-1)*self.sortOrder})},setCurrentPool:function(){var e=this;JSON.parse(sessionStorage.getItem("panaPools")).filter(function(t){if(t.id===e.poolId)return sessionStorage.setItem("panaCurrentPool",n()(t)),!0})},moreOperateTooltip:function(e){return this.moreOperateDisabled(e)&&this.lang.resource.componentMoreOperateTooltip.hasOwnProperty(e)},netOperateTooltip:function(e){return this.netOperateDisabled(e)&&e in this.lang.resource.componentNetOperateTooltip},diskOperateTooltip:function(e){return this.diskOperateDisabled(e)&&e in this.lang.resource.diskOperateTooltip},selectedServerId:function(){if(this.multipleSelection[0])return this.multipleSelection[0].uid},closeAddNetwork:function(e){!0===e&&this.getList(),this.showAddNetwork=!1},closeRemoveNetwork:function(e){!0===e&&this.getList(),this.showRemoveNetwork=!1},closeUpdatePrivateIp:function(e){!0===e&&this.getList(),this.showUpdatePrivateIp=!1},closeUpdateMac:function(e){!0===e&&this.getList(),this.showUpdateMac=!1},closeNicSecurityConfig:function(e){!0===e&&this.getList(),this.showNicSecurityConfig=!1},closeMakeImage:function(e){!0===e&&this.getList(),this.showMakeImage=!1},closeTransparentEquipment:function(e){e&&this.getList(),this.showTransparentEquipment=!1},closeMountGpu:function(e){e&&this.getList(),this.showMountGpu=!1},closeComponentException:function(e){!0===e&&(this.loading=!0,this.multipleSelection=[]),this.showComponentException=!1},closeBootSequence:function(e){!0===e&&this.getList(),this.showBootSequence=!1},closeHotUpgrade:function(e){!0===e&&this.getList(),this.showHotUpgrade=!1},closeHotMigrate:function(e){!0===e&&this.getList(),this.showHotMigrate=!1},closeColdMigrate:function(e){!0===e&&this.getList(),this.showColdMigrate=!1},diskOperateDisabled:function(e){if(this.selectNotOne||this.rebuildStatus||this.errorStatus||this.isPoweringOff||this.isPoweringOn||this.isCreating)return!0;switch(e){case"loadCloudDisk":return this.multipleSelection.some(function(e){return"ACTIVE"!==e.status&&"SHUTOFF"!==e.status});case"unloadCloudDisk":if(!this.componentDetailData.hasOwnProperty("diskInfo"))return!0;if(1===this.componentDetailData.diskInfo.length)return!0;break;case"snapshotRollback":if("SHUTOFF"!==this.multipleSelection[0].status)return this.lang.resource.diskOperateTooltip.snapshotRollback=this.lang.resource.snapshotRollbackInfo[0],!0;if(!this.componentDetailData.hasOwnProperty("diskId"))return this.lang.resource.diskOperateTooltip.snapshotRollback=this.lang.resource.snapshotRollbackInfo[1],!0}},netOperateDisabled:function(e){if(this.selectNotOne||this.rebuildStatus||this.errorStatus||this.isPoweringOff||this.isPoweringOn||this.isCreating)return!0;switch(e){case"addPort":return this.multipleSelection.some(function(e){return e.fixedIps.length>=8});case"removePort":return this.multipleSelection.some(function(e){return e.fixedIps.length<=1});case"updateMac":return this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status});case"nicSecurityConfig":return this.multipleSelection.some(function(e){return"ACTIVE"!==e.status});case"bindPublicIp":return this.multipleSelection.some(function(e){return e.floatingIps.length>0});case"unbindPublicIp":return this.multipleSelection.some(function(e){return 0===e.floatingIps.length})}},moreOperateDisabled:function(e){var t=this;if(this.isCreating||"delete"!==e&&(this.isPoweringOff||this.isPoweringOn))return!0;switch(e){case"reboot":return!!this.notSelect||this.someNotActive;case"delete":if(this.notSelect)return!0;break;case"updateName":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"ACTIVE"!==e.status&&"SHUTOFF"!==e.status&&"PAUSED"!==e.status&&"SUSPENDED"!==e.status});case"suspend":case"pause":return!!this.notSelect||this.someNotActive;case"resume":return!!this.notSelect||this.multipleSelection.some(function(e){return"SUSPENDED"!==e.status});case"unpause":return!!this.notSelect||this.multipleSelection.some(function(e){return"PAUSED"!==e.status});case"resize":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status||e.passthroughDevices.length>0});case"updatePassword":return!!this.selectNotOne||this.someNotActive;case"discManagement":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status});case"transparentEquipment":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"ACTIVE"!==e.status&&"SHUTOFF"!==e.status});case"mountGpu":return this.mountGpu();case"unmountGpu":return delete this.lang.resource.componentMoreOperateTooltip.unmountGpu,!!this.selectNotOne||this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status?(t.lang.resource.componentMoreOperateTooltip.unmountGpu=t.lang.resource.unmountGpuInfo.wrongStatus,!0):"load"!==e.gpu_status});case"componentException":case"bootSequence":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status});case"hotMigrate":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"ACTIVE"!==e.status||e.passthroughDevices.length>0});case"coldMigrate":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status||e.passthroughDevices.length>0});case"hotUpgrade":return!(!this.selectNotOne&&!this.rebuildStatus)||(!("qga_support"in this.currentUsageData)||!this.currentUsageData.qga_support);case"revertResize":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"VERIFY_RESIZE"!==e.status});case"reset":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"ERROR"!==e.status});case"oneClickRecovery":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"ACTIVE"!==e.status&&"SHUTOFF"!==e.status});case"forceShutdown":return!!this.selectNotOne||this.multipleSelection.some(function(e){return"ERROR"!==e.status||(!e.hostName||void 0)});case"makeImage":if(this.selectNotOne||this.rebuildStatus||this.errorStatus)return!0}},open_vnc:function(){var e=this.multipleSelection[0].uid,t=this.common.formatMsg(this.api.cloud.post_pool_servers_detail_remote_console,{server_id:e}),o="",s=window.open("",e,"toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1200 height=900 left=200 top=50");this.checkError(this.$http({url:t,method:"post"}),function(e){o=e.data.console.url,s.location=o})},start:function(){this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_start,this.operate="os-start"},shutoff:function(){this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_shutoff,this.operate="os-stop"},netOperationChange:function(){switch(this.networkOperateValue){case"addPort":this.showAddNetwork=!0,this.networkOperateValue="";break;case"removePort":this.showRemoveNetwork=!0,this.networkOperateValue="";break;case"updatePrivateIp":this.showUpdatePrivateIp=!0,this.networkOperateValue="";break;case"bindPublicIp":this.showBindPublicIp=!0,this.networkOperateValue="";break;case"unbindPublicIp":this.showUnbindPublicIp=!0,this.networkOperateValue="";break;case"updateMac":this.showUpdateMac=!0,this.networkOperateValue="";break;case"releasePublicIp":this.showReleasePublicIp=!0,this.networkOperateValue="";break;case"nicSecurityConfig":this.showNicSecurityConfig=!0,this.networkOperateValue=""}},moreOperationChange:function(){switch(this.confirm_warning=!1,this.confirm_text_left=!1,this.moreOperateValue){case"updatePassword":this.updatePasswordDialogVisible=!0,this.moreOperateValue="";break;case"updateName":this.updateNameDialogVisible=!0,this.moreOperateValue="";break;case"makeImage":this.showMakeImage=!0,this.moreOperateValue="";break;case"discManagement":this.showDiscManagement=!0,this.moreOperateValue="";break;case"transparentEquipment":this.showTransparentEquipment=!0,this.moreOperateValue="";break;case"mountGpu":this.showMountGpu=!0,this.moreOperateValue="";break;case"unmountGpu":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirmUnmountGpu,this.gpuListLoading=0===this.gpuList.length;break;case"componentException":this.showComponentException=!0,this.moreOperateValue="";break;case"bootSequence":this.showBootSequence=!0,this.moreOperateValue="";break;case"hotMigrate":this.showHotMigrate=!0,this.moreOperateValue="";break;case"coldMigrate":this.showColdMigrate=!0,this.moreOperateValue="";break;case"hotUpgrade":this.showHotUpgrade=!0,this.moreOperateValue="";break;case"reset":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_reset;break;case"oneClickRecovery":this.confirm_warning=!0,this.confirm_text_left=!0,this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_one_click_recovery;break;case"forceShutdown":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_force_shutdown;break;case"resize":this.resizeDialogVisible=!0,this.moreOperateValue="";break;case"addSecurityGroup":break;case"pause":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_pause;break;case"unpause":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_unpause;break;case"reboot":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_reboot;break;case"delete":this.dialogVisible=!0,this.showDeleteSystemConfirm=!0,this.deleteSystemDisk=!0,this.tipDialogMsg=this.lang.resource.confirm_delete;break;case"resume":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_resume;break;case"suspend":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_suspend;break;case"revertResize":this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_revertResize}},getGpuList:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.gpu_device_list,method:"get"}),function(t){e.gpuList=t.data,e.gpuListLoading=!1})},diskOperationChange:function(){switch(this.diskOperateValue){case"loadCloudDisk":this.showLoadCloudDisk=!0,this.diskOperateValue="";break;case"unloadCloudDisk":this.showUnloadCloudDisk=!0,this.diskOperateValue="";break;case"snapshot":this.showSnapshot=!0,this.diskOperateValue="";break;case"snapshotRollback":this.showSnapshotRollback=!0,this.diskOperateValue=""}},closeUpdateName:function(e){!0===e&&this.getList(),this.updateNameDialogVisible=!1},dialogCancel:function(){this.dialogVisible=!1,this.showDeleteSystemConfirm=!1,this.moreOperateValue="",this.gpuListLoading=!1},getSystemDiskSnapshots:function(){var e=this,t=[];e.componentDetailData.diskInfo.filter(function(e){if(e.is_sys_disk)return t.push(e.id),!0}),this.checkError(this.$http({url:this.api.storage.snapshotDetail,method:"POST",data:{volume_id:t}}),function(t){null===t.data?e.oneClickRecovery():e.showNotRebuild=!0})},oneClickRecovery:function(){var e=this;this.checkError(this.$http({url:e.common.formatMsg(e.api.cloud.get_pool_servers_detail,{server_id:e.selectedServerId()}),method:"get"}),function(t){var o=t.data.imageId;e.actionData={rebuild:{imageRef:o}},e.actionSubmit()})},dialogConfirm:function(){switch(this.moreOperateValue&&(this.operate=this.moreOperateValue),this.operate){case"pause":this.actionData={pause:null};break;case"reset":this.actionData={"os-resetState":{state:"active"}};break;case"oneClickRecovery":this.getSystemDiskSnapshots();break;case"forceShutdown":this.actionData={"os-forceStop":null};break;case"unpause":this.actionData={unpause:null};break;case"reboot":this.actionData={reboot:{type:-1===this.lang.resource.HARD_REBOOT.indexOf(this.multipleSelection[0].status)?"SOFT":"HARD"}};break;case"delete":this.deleteComponent();break;case"unmountGpu":this.unmountGpu();break;case"resume":this.actionData={resume:null};break;case"suspend":this.actionData={suspend:null};break;case"revertResize":this.actionData={revertResize:null};break;case"os-start":this.actionData={"os-start":null};break;case"os-stop":this.actionData={"os-stop":null}}this.dialogVisible=!1,"delete"!==this.moreOperateValue&&"oneClickRecovery"!==this.moreOperateValue&&"unmountGpu"!==this.moreOperateValue&&this.actionSubmit()},unmountGpu:function(){if(this.multipleSelection.length>0){var e=this.multipleSelection[0].uid,t=this,o={};this.gpuList.some(function(t){if(t.server_id===e)return o={bus:t.bus,function:t.function,gpuId:t.gpuId,server_id:t.server_id,slot:t.slot},!0}),this.checkError(this.$http({url:this.api.cloud.gpu_unload,method:"post",data:o}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.gpuManage.unloadGpuSuccess}),t.getList()})}},getList:function(){var e=this;e.loading=!0;var t=this.common.formatMsg(this.api.cloud.get_pools_detail_servers,{pool_id:e.poolId});this.checkError(this.$http({url:t,method:"get"}),function(t){e.loading=!1;var o=[];o=t.data.filter(function(t){return"fixedImageInstanceName"!==t.name&&t.uid!==e.storageServerId}),e.tableData=o.sort(function(e,t){return t.createtime-e.createtime})},function(){e.loading=!1,e.tableData=[]})},actionSubmit:function(){var e=this,t="",o=this.moreOperateValue||this.operate,s=[],i=["os-start","suspend","resume","os-stop","reboot","delete","unpause","pause","oneClickRecovery"],a="",n=e.multipleSelection.length;this.moreOperateValue="",e.multipleSelection.forEach(function(r,l){t=r.uid,s.push(t),a=e.common.formatMsg(e.api.cloud.post_pool_servers_detail_action,{server_id:t}),-1!==i.indexOf(o)&&e.wsEventQueue.push(t),e.checkError(e.$http({url:a,method:"post",data:e.actionData}),function(){l===n-1&&e.getList(),-1===i.indexOf(o)&&e.$notify({title:e.lang.common.success,type:"success",message:e.lang.resource.operateSuccess})})}),-1!==["reboot","unpause","os-stop","pause","delete"].indexOf(o)&&e.setTimer(s,o)},setTimer:function(e,t){var o=this,s="",i={},a=(new Date).getTime();e.forEach(function(e){s=setInterval(function(){(new Date).getTime()-a<12e4?o.getStatus(e):clearInterval(s)},3e3),i[e]=s,i.operate=t,o.timerArray.push(i),o.timer.push(s)})},statusClass:function(e){switch(e){case"ACTIVE":return"cloud-success";case"ERROR":return"cloud-error";case"SUSPENDED":return"cloud-fault";case"SHUTOFF":return"cloud-info";case"PAUSED":case"RESIZE":case"REVERT_RESIZE":case"UNKNOWN":return"cloud-warning";default:return"cloud-default"}},showDetail:function(e){this.id=e,this.detailDialogVisible=!0},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){if(this.multipleSelection=e,0===this.multipleSelection.length?(this.gpuInfo={},this.gpuList=[]):(0===i()(this.gpuInfo).length&&this.getGpuAvail(),this.getGpuQuota()),1===this.multipleSelection.length){var t=this.multipleSelection[0].uid;this.getComponentDetail(t),this.current_usage(t),this.getGpuList()}else this.componentDetailData={},this.currentUsageData={}},getGpuQuota:function(){var e=this,t=this.common.formatMsg(this.api.cloud.get_gpu_pool_detail_check,{id:this.poolId});this.checkError(this.$http({url:t,method:"get"}),function(t){e.gpuQuota=t.data})},getComponentDetail:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.checkError(this.$http({url:o,method:"get"}),function(e){t.componentDetailData=e.data})},getStatus:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e}),s=[],i={},a="";t.timerArray.filter(function(t){if(t.hasOwnProperty(e))return a=t.operate,i=t,!0}),this.$http({url:o,method:"get"}).then(function(o){switch(a){case"reboot":case"unpause":s=["ACTIVE","ERROR"];break;case"os-stop":s=["SHUTOFF","ERROR"];break;case"pause":s=["PAUSED","ERROR"];break;case"delete":s=["SOFT_DELETED","ERROR"]}200303!==parseInt(o.data.code)&&-1===s.indexOf(o.data.data.status)||(t.getList(),clearInterval(i[e]))})},current_usage:function(e){var t=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.poolserver_current_usage,{server_id:e}),method:"get"}),function(e){t.currentUsageData=e.data})},getGpuAvail:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.gpu_available_list,method:"get"}),function(t){e.gpuInfo=t.data.avalibal})},handleShowTooltip:function(e){var t=e.target.querySelector(".tooltip-div .ellipsis");this.showTooltip=!(t.scrollWidth===t.offsetWidth&&t.scrollHeight===t.offsetHeight)},createCompont:function(){this.$router.push({name:"createComponent",params:{poolId:this.poolId}})},mountGpu:function(){var e=this.gpuInfo,t=this.multipleSelection.some(function(e){return"preload"===e.gpu_status}),o=this.gpuQuota||0,s=0;if(!0===t)return this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.preloadStatus,!0;if(0===i()(e).length)return this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.noData,!0;for(var a in e)e.hasOwnProperty(a)&&(s+=e[a].length);return 0===s?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.noGpu,!0):this.multipleSelection.length>s?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.noEnoughGpu,!0):(t=this.multipleSelection.some(function(e){return null!=e.gpu_status&&"load"===e.gpu_status}))?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.loadStatus,!0):this.multipleSelection.length>o?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.notEnoughGpuQuota,!0):(t=this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status}))?(this.lang.resource.componentMoreOperateTooltip.mountGpu=this.lang.resource.mountGpuInfo.wrongStatus,!0):void 0},deleteComponent:function(){var e=this,t=[];this.multipleSelection.forEach(function(o){e.wsEventQueue.push(o.uid),t.push(o.uid)}),this.checkError(this.$http({url:e.api.cloud.post_pool_servers_patch_delete,data:{ids:t,pool_id:this.poolId,flag:this.deleteSystemDisk},method:"post"}),function(e){})}},watch:{search:function(){this.pageNum=1}},computed:{notSelect:function(){return this.multipleSelection.length<=0},selectNotOne:function(){return 1!==this.multipleSelection.length},someNotActive:function(){return this.multipleSelection.some(function(e){return"ACTIVE"!==e.status})},rebuildStatus:function(){return this.multipleSelection.some(function(e){return"REBUILD"===e.status})},isPoweringOff:function(){return this.multipleSelection.some(function(e){return"powering-off"===e.task_state})},isPoweringOn:function(){return this.multipleSelection.some(function(e){return"powering-on"===e.task_state})},isCreating:function(){return this.multipleSelection.some(function(e){return"BUILD"===e.status})},errorStatus:function(){return this.multipleSelection.some(function(e){return"ERROR"===e.status})},startDisabled:function(){return!!(this.notSelect||this.isPoweringOff||this.isPoweringOn)||this.multipleSelection.some(function(e){return"SHUTOFF"!==e.status})},shutoffDisabled:function(){return!!(this.notSelect||this.isPoweringOff||this.isPoweringOn)||this.someNotActive},vncDisabled:function(){return!!(this.selectNotOne||this.isPoweringOff||this.isPoweringOn)||this.someNotActive},filterData:function(){var e=this,t=this.search,o=[];return o=""===t?this.tableData:this.common.cloudFilter(this.tableData,t),o.sort(function(t,o){return t[e.sortProp]=null==t[e.sortProp]?"":t[e.sortProp],o[e.sortProp]=null==o[e.sortProp]?"":o[e.sortProp],t[e.sortProp]==o[e.sortProp]?o.createtime-t.createtime:(t[e.sortProp]>o[e.sortProp]?1:-1)*e.sortOrder})},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},destroyed:function(){this.common.clearTimer(this)}},Le={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"component-list"}},[o("el-row",{staticClass:"cloud-btn-row",staticStyle:{"margin-bottom":"15px"},attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:20}},[o("el-tooltip",{attrs:{disabled:null!=e.currentPool.private_subnet_id&&""!==e.currentPool.private_subnet_id&&null!=e.currentPool.private_network_id&&""!==e.currentPool.private_network_id,content:e.lang.resource.noPoolSubnetInfo,placement:"top"}},[o("span",{staticStyle:{"margin-right":"10px"}},[o("el-button",{attrs:{disabled:null==e.currentPool.private_subnet_id||""===e.currentPool.private_subnet_id||null==e.currentPool.private_network_id||""===e.currentPool.private_network_id,type:"primary"},on:{click:function(t){return e.createCompont()}}},[e._v(e._s(e.lang.common.create))])],1)]),e._v(" "),o("el-button",{attrs:{disabled:e.startDisabled},on:{click:e.start}},[e._v(e._s(e.lang.resource.start))]),e._v(" "),o("el-button",{attrs:{disabled:e.shutoffDisabled},on:{click:e.shutoff}},[e._v(e._s(e.lang.resource.shutdown))]),e._v(" "),o("el-button",{attrs:{disabled:e.vncDisabled},on:{click:e.open_vnc}},[e._v(e._s(e.lang.common.console))]),e._v(" "),o("el-select",{staticClass:"more-operation",attrs:{disabled:e.notSelect,placeholder:e.lang.resource.netOperation,value:""},on:{change:e.netOperationChange},model:{value:e.networkOperateValue,callback:function(t){e.networkOperateValue=t},expression:"networkOperateValue"}},e._l(e.networkOperateOptions,function(t){return o("el-option",{key:t.value,attrs:{disabled:e.netOperateDisabled(t.value),value:t.value}},[e.netOperateTooltip(t.value)?o("div",[o("el-tooltip",{attrs:{content:e.lang.resource.componentNetOperateTooltip[t.value],placement:"left"}},[o("div",[e._v(e._s(t.label))])])],1):o("div",[o("div",[e._v(e._s(t.label))])])])}),1),e._v(" "),o("el-select",{staticClass:"more-operation",attrs:{disabled:e.notSelect,placeholder:e.lang.resource.diskOperation,value:""},on:{change:e.diskOperationChange},model:{value:e.diskOperateValue,callback:function(t){e.diskOperateValue=t},expression:"diskOperateValue"}},e._l(e.diskOperation,function(t){return o("el-option",{key:t.value,attrs:{disabled:e.diskOperateDisabled(t.value),value:t.value}},[e.diskOperateTooltip(t.value)?o("div",[o("el-tooltip",{attrs:{content:e.lang.resource.diskOperateTooltip[t.value],placement:"left"}},[o("div",[e._v(e._s(t.label))])])],1):o("div",[o("div",[e._v(e._s(t.label))])])])}),1),e._v(" "),o("el-select",{staticClass:"more-operation",attrs:{disabled:e.notSelect,placeholder:e.lang.common.moreOperation},on:{change:e.moreOperationChange},model:{value:e.moreOperateValue,callback:function(t){e.moreOperateValue=t},expression:"moreOperateValue"}},[o("el-row",[o("el-col",{attrs:{span:12}},e._l(e.moreOperation1,function(t){return o("el-option",{key:t.value,attrs:{disabled:e.moreOperateDisabled(t.value),value:t.value}},[e.moreOperateTooltip(t.value)?o("div",[o("el-tooltip",{attrs:{content:e.lang.resource.componentMoreOperateTooltip[t.value],placement:"left"}},[o("div",[e._v(e._s(t.label))])])],1):o("div",[o("div",[e._v(e._s(t.label))])])])}),1),e._v(" "),o("el-col",{attrs:{span:12}},e._l(e.moreOperation2,function(t){return o("el-option",{key:t.value,attrs:{disabled:e.moreOperateDisabled(t.value),value:t.value}},[e.moreOperateTooltip(t.value)?o("div",[o("el-tooltip",{attrs:{content:e.lang.resource.componentMoreOperateTooltip[t.value],placement:"left"}},[o("div",[e._v(e._s(t.label))])])],1):o("div",[o("div",[e._v(e._s(t.label))])])])}),1)],1)],1)],1),e._v(" "),o("el-col",{attrs:{span:4}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:20}},[o("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),o("el-col",{attrs:{span:4}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",label:e.lang.common.name,prop:"name"}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"status",label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"status",class:e.lang.resource.componentTaskState.hasOwnProperty(t.row.task_state)?"bg-blue":e.statusClass(t.row.status)},[e._v("\n                        "+e._s(e.lang.resource.componentTaskState.hasOwnProperty(t.row.task_state)?e.lang.resource.componentTaskState[t.row.task_state]:e.lang.resource.componentStatusArray[t.row.status])+"\n                        "),e.lang.resource.componentTaskState.hasOwnProperty(t.row.task_state)?o("i",{staticClass:"el-icon-loading"}):e._e()])]}}])}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"gpu_status",label:e.lang.resource.gpuStatus},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"status",class:{"cloud-btn-green":"load"===t.row.gpu_status,"cloud-btn-gray":"unload"===t.row.gpu_status,"cloud-btn-purple":"preload"===t.row.gpu_status,"cloud-btn-blue":"loading"===t.row.gpu_status}},[e._v(e._s(e.lang.resource.gpuStatusValue[t.row.gpu_status]))])]}}])}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"imageName",label:e.lang.resource.imageName}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"fixedIps",label:e.lang.outside.privateIp},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{domProps:{innerHTML:e._s(t.row.fixedIps.join("</br>"))}})]}}])}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"floatingIps",label:e.lang.outside.publicIp},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{domProps:{innerHTML:e._s(t.row.floatingIps.join("</br>"))}})]}}])}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"createtime",label:e.lang.common.create_time},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(e._f("utc2beijing")(t.row.createtime))+"\n            ")]}}])}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"hostName",label:e.lang.resource.hostName}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.operation,width:200},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){return e.showDetail(t.row.uid)}}},[e._v("\n                    "+e._s(e.lang.common.showDetail)+"\n                ")])]}}])})],1),e._v(" "),o("detail",{attrs:{show:e.detailDialogVisible,id:e.id},on:{closeModal:function(t){e.detailDialogVisible=!1}}}),e._v(" "),o("cloud-reset-password",{attrs:{show:e.updatePasswordDialogVisible,serverId:e.multipleSelection[0]&&e.multipleSelection[0].uid},on:{closeModal:function(t){e.updatePasswordDialogVisible=!1}}}),e._v(" "),o("cloud-update-name",{attrs:{show:e.updateNameDialogVisible,serverId:e.multipleSelection[0]&&e.multipleSelection[0].uid,vmName:e.multipleSelection[0]&&e.multipleSelection[0].name},on:{closeModal:e.closeUpdateName}}),e._v(" "),o("load-cloud-disk",{attrs:{serverId:e.selectedServerId(),show:e.showLoadCloudDisk},on:{getList:e.getList,closeModal:function(t){e.showLoadCloudDisk=!1}}}),e._v(" "),o("unload-cloud-disk",{attrs:{serverId:e.selectedServerId(),show:e.showUnloadCloudDisk,componentDetailData:e.componentDetailData},on:{getList:e.getList,closeModal:function(t){e.showUnloadCloudDisk=!1}}}),e._v(" "),o("cloud-snapshot",{attrs:{serverId:e.selectedServerId(),show:e.showSnapshot},on:{getList:e.getList,closeModal:function(t){e.showSnapshot=!1}}}),e._v(" "),o("cloud-snapshot-rollback",{attrs:{componentDetailData:e.componentDetailData,show:e.showSnapshotRollback},on:{getList:e.getList,closeModal:function(t){e.showSnapshotRollback=!1}}}),e._v(" "),o("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible,confirmDisabled:e.gpuListLoading,loading:e.gpuListLoading},on:{cancel:e.dialogCancel,confirm:e.dialogConfirm}},[o("p",{class:{"confirm-warning":e.confirm_warning,"confirm-text-left":e.confirm_text_left},staticStyle:{"margin-bottom":"5px"}},[e._v(e._s(e.tipDialogMsg))]),e._v(" "),e.showDeleteSystemConfirm?o("div",[o("el-checkbox",{staticClass:"pana-checkoutbox",model:{value:e.deleteSystemDisk,callback:function(t){e.deleteSystemDisk=t},expression:"deleteSystemDisk"}}),e._v(" "),o("span",{staticStyle:{"margin-left":"5px"}},[e._v(e._s(e.lang.resource.deleteSystemDiskConfirm))])],1):e._e()]),e._v(" "),o("cloud-add-network",{attrs:{server_id:e.selectedServerId(),pool_id:e.poolId,show:e.showAddNetwork},on:{getList:e.getList,closeModal:e.closeAddNetwork}}),e._v(" "),o("cloud-remove-network",{attrs:{server_id:e.selectedServerId(),show:e.showRemoveNetwork},on:{closeModal:e.closeRemoveNetwork,getList:e.getList}}),e._v(" "),o("cloud-update-private-ip",{attrs:{server_id:e.selectedServerId(),show:e.showUpdatePrivateIp},on:{closeModal:e.closeUpdatePrivateIp,getList:e.getList}}),e._v(" "),o("cloud-bind-public-ip",{attrs:{server_id:e.selectedServerId(),show:e.showBindPublicIp},on:{closeModal:function(t){e.showBindPublicIp=!1}}}),e._v(" "),o("cloud-unbind-public-ip",{attrs:{server_id:e.selectedServerId(),show:e.showUnbindPublicIp},on:{closeModal:function(t){e.showUnbindPublicIp=!1}}}),e._v(" "),o("cloud-update-mac",{attrs:{server_id:e.selectedServerId(),show:e.showUpdateMac},on:{closeModal:e.closeUpdateMac}}),e._v(" "),o("cloud-nic-security-config",{attrs:{server_id:e.selectedServerId(),show:e.showNicSecurityConfig},on:{closeModal:e.closeNicSecurityConfig,getList:e.getList}}),e._v(" "),o("cloud-make-image",{attrs:{show:e.showMakeImage,componentDetailData:e.componentDetailData},on:{closeModal:e.closeMakeImage}}),e._v(" "),o("cloud-ajust-configuration",{attrs:{selectdComponent:e.componentDetailData,show:e.resizeDialogVisible},on:{getList:e.getList,closeModal:function(t){e.resizeDialogVisible=!1}}}),e._v(" "),o("cloud-disc-management",{attrs:{server_id:e.multipleSelection[0]&&e.multipleSelection[0].uid,show:e.showDiscManagement},on:{closeModal:function(t){e.showDiscManagement=!1}}}),e._v(" "),o("cloud-transparent-equipment",{attrs:{server_id:e.multipleSelection[0]&&e.multipleSelection[0].uid,server_name:e.multipleSelection[0]&&e.multipleSelection[0].name,show:e.showTransparentEquipment},on:{closeModal:e.closeTransparentEquipment}}),e._v(" "),o("cloud-mount-gpu",{attrs:{components:e.multipleSelection,gpuInfo:e.gpuInfo,show:e.showMountGpu},on:{getList:e.getList,closeModal:e.closeMountGpu}}),e._v(" "),o("cloud-component-exception",{attrs:{server_id:e.multipleSelection[0]&&e.multipleSelection[0].uid,abnormalRestart:e.multipleSelection[0]&&e.multipleSelection[0].abnormalRestart,show:e.showComponentException},on:{closeModal:e.closeComponentException,getList:e.getList,setLoading:function(t){e.loading=!1}}}),e._v(" "),o("cloud-boot-sequence",{attrs:{server_id:e.multipleSelection[0]&&e.multipleSelection[0].uid,server_name:e.multipleSelection[0]&&e.multipleSelection[0].name,show:e.showBootSequence},on:{closeModal:e.closeBootSequence}}),e._v(" "),o("cloud-hot-migrate",{attrs:{server_id:e.multipleSelection[0]&&e.multipleSelection[0].uid,availabilityZone:e.multipleSelection[0]&&e.multipleSelection[0].availabilityZone,hostName:e.multipleSelection[0]&&e.multipleSelection[0].hostName,show:e.showHotMigrate},on:{closeModal:e.closeHotMigrate,getList:e.getList}}),e._v(" "),o("cloud-cold-migrate",{attrs:{server_id:e.multipleSelection[0]&&e.multipleSelection[0].uid,server:e.componentDetailData,show:e.showColdMigrate},on:{closeModal:e.closeColdMigrate,getList:e.getList}}),e._v(" "),o("cloud-hot-upgrade",{attrs:{server_id:e.multipleSelection[0]&&e.multipleSelection[0].uid,currentUsageData:e.currentUsageData,show:e.showHotUpgrade},on:{closeModal:e.closeHotUpgrade,getList:e.getList}}),e._v(" "),o("cloud-not-rebuild",{attrs:{show:e.showNotRebuild},on:{closeModal:function(t){e.showNotRebuild=!1}}}),e._v(" "),o("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1)},staticRenderFns:[]};var Ee=o("C7Lr")(Oe,Le,!1,function(e){o("c3+p")},null,null);t.default=Ee.exports},UIiB:function(e,t){},W4IG:function(e,t){},YSnw:function(e,t){},ZP0S:function(e,t){},bi95:function(e,t){},c18T:function(e,t){},"c3+p":function(e,t){},daod:function(e,t){},gaCa:function(e,t){},iPXr:function(e,t){},jTl5:function(e,t){},jmpZ:function(e,t){},laRw:function(e,t){},oEl3:function(e,t){},oIPs:function(e,t,o){"use strict";var s=o("aA9S"),i=o.n(s),a={props:{show:Boolean,isStorageServer:Boolean,serverId:String},components:{},data:function(){return{noSelectVolume:!1,timedSnapshot:!1,diskIds:{},systemOptions:[],dataDiskOptions:[],form:{systemDisk:[],dataDisk:[],holdNumber:1,frequency:"",unit:"",startTime:""},pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}}],disabledDate:function(e){return e.getTime()<Date.now()-864e5}},confirmDisabled:!1,rules:{startTime:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validateCurrentTime,message:this.lang.planTask.timeInvalid,trigger:"blur"}]},loading:!1}},methods:{validateTimeInterval:function(e){var t=this;e&&""!==t.form.frequency?setTimeout(function(){t.$refs.form.validateField("frequency",function(e){if(e)return!1})},0):t.$refs.form.clearValidate()},initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getDiskInfo()},getDiskInfo:function(){var e=this,t=e.common.formatMsg(e.api.cloud.server_snapshot_volumes,{server_id:e.serverId});this.loading=!0,this.checkError(this.$http({url:t,method:"get"}),function(t){var o=t.data.diskInfo;e.diskIds=t.data.diskId,(o=(o=(o=(o=o.filter(function(e){return"iso"!=e.diskFormat&&("in-use"==e.status||"available"==e.status)})).filter(function(e){return!e.magrationing})).filter(function(e){return e.storageLimit&&e.storageLimit.snapshots})).filter(function(e){return!(e.storageLimit&&!e.storageLimit.share_volumes_snapshots&&e.attachments.length>1)})).forEach(function(t){"true"===t.bootable&&t.device.endsWith("da")?e.systemOptions.push(t):e.dataDiskOptions.push(t)}),e.loading=!1},function(){e.loading=!1})},confirm:function(){var e=this,t=this,o={},s="",i=[],a="",n=t.form.systemDisk.concat(t.form.dataDisk);this.$refs.form.validate(function(r){if(r){if(0===n.length)return t.noSelectVolume=!0,!1;e.confirmDisabled=!0,t.timedSnapshot?(s=t.api.operation.post_jobs_add,o.volumeIds=n,o.serverId=t.serverId,o.startTime=t.moment(t.form.startTime).format("YYYY-MM-DD HH:mm"),o.unit=t.form.unit||"once",t.form.unit&&(o.holdNumber=t.form.holdNumber,o.frequency=t.form.frequency),a=t.lang.resource.operationSuccess):(s=t.api.storage.getSnapshot,n.forEach(function(e){i.push(t.diskIds[e])}),o.name=i,o.volume_id=n,a=t.lang.resource.snapshotCreateSuccess),t.closeModal(!1),t.checkError(t.$http({url:s,data:o,method:"POST"}),function(e){t.$emit("getList"),t.$notify({title:t.lang.common.success,type:"success",message:a})})}})},closeModal:function(){i()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{maxTimeInterval:function(){switch(this.form.unit){case"hour":return 168;case"day":return 31;case"week":case"month":return 99}}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{id:"component-snapshot",title:e.lang.resource.snapshot,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[e.timedSnapshot?o("el-alert",{attrs:{title:e.lang.resource.snapshotInfo,type:"bg-blue",closable:!1}}):e._e(),e._v(" "),o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"120px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.componentSystemDisk}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotDiskInfo)},slot:"content"}),e._v(" "),o("i",{staticClass:"el-icon-info"})])],1),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:"",multiple:"",disabled:0===e.systemOptions.length,placeholder:0===e.systemOptions.length?e.lang.resource.componentSystemDiskPlaceholder[1]:e.lang.resource.componentSystemDiskPlaceholder[0]},model:{value:e.form.systemDisk,callback:function(t){e.$set(e.form,"systemDisk",t)},expression:"form.systemDisk"}},e._l(e.systemOptions,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.componentDataDisk}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotDiskInfo)},slot:"content"}),e._v(" "),o("i",{staticClass:"el-icon-info"})])],1),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:"",multiple:"",disabled:e.isStorageServer||0===e.dataDiskOptions.length,placeholder:0===e.dataDiskOptions.length?e.lang.resource.dataDiskPlaceholder[1]:e.lang.resource.dataDiskPlaceholder[0]},model:{value:e.form.dataDisk,callback:function(t){e.$set(e.form,"dataDisk",t)},expression:"form.dataDisk"}},e._l(e.dataDiskOptions,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),e.noSelectVolume&&0===e.form.systemDisk.length&&0===e.form.dataDisk.length?o("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.noSelectSnapVolume))]):e._e()],1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.timedSnapshot}},[o("el-col",{attrs:{span:1}},[e._v("\n                 \n            ")]),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-switch",{model:{value:e.timedSnapshot,callback:function(t){e.timedSnapshot=t},expression:"timedSnapshot"}})],1)],1),e._v(" "),e.timedSnapshot?o("div",[o("el-form-item",{attrs:{label:e.lang.resource.executionFrequency}},[o("el-col",{attrs:{span:1}},[e._v("\n                     \n                ")]),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:""},on:{change:e.validateTimeInterval},model:{value:e.form.unit,callback:function(t){e.$set(e.form,"unit",t)},expression:"form.unit"}},e._l(e.lang.resource.executionFrequencyValue,function(e){return o("el-option",{key:e.unit,attrs:{label:e.name,value:e.unit}})}),1)],1)],1),e._v(" "),e.form.unit?o("el-form-item",{attrs:{label:e.lang.resource.timeInterval,prop:"frequency",rules:[{required:!0,message:e.lang.common.required_item,trigger:"blur"},{type:"integer",min:1,max:e.maxTimeInterval,message:e.common.formatMsg(e.lang.resource.invalidTimeInterval,{max:e.maxTimeInterval}),trigger:"blur"}]}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.timeIntervalInfo)},slot:"content"}),e._v(" "),o("i",{staticClass:"el-icon-info"})])],1),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{placeholder:e.lang.resource.timeIntervalPlaceholder,type:"number"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.frequency,callback:function(t){e.$set(e.form,"frequency",e._n(t))},expression:"form.frequency"}})],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:4}},[e._v("\n                    "+e._s(e.lang.resource.timeUnit[e.form.unit])+"\n                ")])],1):e._e(),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.executionFirstTime,prop:"startTime"}},[o("el-col",{attrs:{span:1}},[e._v("\n                     \n                ")]),e._v(" "),o("el-col",{attrs:{span:12}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:e.lang.resource.datePlaceholder,align:"right","picker-options":e.pickerOptions},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1)],1),e._v(" "),e.form.unit?o("el-form-item",{attrs:{label:e.lang.resource.snapshotsReservations}},[o("el-col",{attrs:{span:1}},[e._v("\n                     \n                ")]),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{attrs:{filterable:""},model:{value:e.form.holdNumber,callback:function(t){e.$set(e.form,"holdNumber",t)},expression:"form.holdNumber"}},e._l(e.lang.resource.snapshotsReservationsValue,function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1):e._e()],1):e._e()],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:e.confirmDisabled},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=o("C7Lr")(a,n,!1,function(e){o("8zeT"),o("rCO8")},"data-v-045a79f6",null);t.a=r.exports},rCO8:function(e,t){},rd24:function(e,t){},rhbP:function(e,t){},sYc6:function(e,t){},soUv:function(e,t){},"t/+v":function(e,t){},xrNV:function(e,t){},zLDf:function(e,t,o){"use strict";var s=o("aA9S"),i=o.n(s),a=o("ZLEe"),n=o.n(a),r={props:{show:Boolean,componentDetailData:Object},components:{},data:function(){return{noSelectSnap:!1,systemSnapshots:[],snapshots:[],systemSnapshotOptions:[],dataDiskSnapshots:[],dataDiskSnapshotOptions:[],form:{systemDisk:[],dataDisk:[]},confirmDisabled:!1,loading:!1}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getSnapshots()},systemSnapshotChange:function(e){e.length>0?this.systemSnapshotOptions=[]:this.systemSnapshotOptions=this.systemSnapshots,this.$refs.systemDisk.blur()},dataDiskSnapshotChange:function(e){var t=this,o="",s=t.dataDiskSnapshots;e.forEach(function(e){t.dataDiskSnapshots.filter(function(t){if(t.id===e)return o=t.volume_id,!0}),s=s.filter(function(e){return e.volume_id!==o})}),t.dataDiskSnapshotOptions=s,0===t.dataDiskSnapshotOptions.length&&this.$refs.dataDisk.blur()},getSnapshots:function(){var e=this,t=n()(this.componentDetailData.diskId);this.loading=!0,this.checkError(this.$http({url:this.api.storage.snapshotDetail,method:"POST",data:{volume_id:t}}),function(t){var o=t.data,s="";e.snapshots=o,e.componentDetailData.diskInfo.filter(function(e){e.is_sys_disk&&(s=e.id)}),o.forEach(function(t){t.volume_id===s?e.systemSnapshots.push(t):e.dataDiskSnapshots.push(t)}),e.systemSnapshotOptions=e.systemSnapshots,e.dataDiskSnapshotOptions=e.dataDiskSnapshots,e.loading=!1},function(){e.loading=!1})},confirm:function(){var e,t=!0,o=this,s=o.form.dataDisk.concat(o.form.systemDisk),i=[];return this.$refs.form.validate(function(e){e||(t=!1)}),!!t&&(0===s.length?(o.noSelectSnap=!0,!1):(this.confirmDisabled=!0,e=this.api.storage.snapshotRollback,o.snapshots.forEach(function(e){s.includes(e.id)&&i.push({volumeId:e.volume_id,snapshotId:e.id})}),o.closeModal(!1),void this.checkError(this.$http({url:e,data:{volume_snapshots:i},method:"POST"}),function(e){o.$emit("getList"),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.volume.snapshotRollbackSuccess})})))},closeModal:function(){i()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}}},l={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.resource.snapshotRollback,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"120px","element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-form-item",{attrs:{label:e.lang.resource.systemSnapshot}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotRollbackHelp)},slot:"content"}),e._v(" "),o("i",{staticClass:"el-icon-info"})])],1),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{ref:"systemDisk",attrs:{filterable:"",multiple:"",disabled:0===e.systemSnapshotOptions.length&&0===e.form.systemDisk.length,placeholder:0===e.systemSnapshotOptions.length?e.lang.resource.SystemDiskSnapshotPlaceholder[1]:e.lang.resource.SystemDiskSnapshotPlaceholder[0]},on:{change:e.systemSnapshotChange},model:{value:e.form.systemDisk,callback:function(t){e.$set(e.form,"systemDisk",t)},expression:"form.systemDisk"}},e._l(e.systemSnapshotOptions,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.dataDiskSnapshot}},[o("el-col",{attrs:{span:1}},[o("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[o("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.resource.snapshotRollbackHelp)},slot:"content"}),e._v(" "),o("i",{staticClass:"el-icon-info"})])],1),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-select",{ref:"dataDisk",attrs:{filterable:"",multiple:"",disabled:0===e.dataDiskSnapshotOptions.length&&0===e.form.dataDisk.length,placeholder:0===e.dataDiskSnapshotOptions.length?e.lang.resource.dataDiskSnapshotPlaceholder[1]:e.lang.resource.dataDiskSnapshotPlaceholder[0]},on:{change:e.dataDiskSnapshotChange},model:{value:e.form.dataDisk,callback:function(t){e.$set(e.form,"dataDisk",t)},expression:"form.dataDisk"}},e._l(e.dataDiskSnapshotOptions,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),e.noSelectSnap&&0===e.form.systemDisk.length&&0===e.form.dataDisk.length?o("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.noSelectSnap))]):e._e()],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:e.confirmDisabled},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var c=o("C7Lr")(r,l,!1,function(e){o("E8Uc")},"data-v-30c9e158",null);t.a=c.exports}});