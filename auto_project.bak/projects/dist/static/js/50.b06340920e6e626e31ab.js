webpackJsonp([50],{"53Zr":function(e,t){},"6c9O":function(e,t){},"9abR":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("ZLEe"),s=a.n(r),l=a("1JPr"),n={props:{show:Boolean,id:Array},data:function(){return{labelWidth:"120px",form:{proDescription:""}}},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},handleclick:function(){var e=this;e.id.length<1?this.checkError(this.$http({url:e.common.formatMsg(e.api.alarmManage.handlealarm,{alarm_id:e.id}),method:"put",data:{proDescription:this.form.proDescription,status:"processed"}}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:"处理成功"}),e.closeModal(!0)}):this.checkError(this.$http({url:e.api.alarmManage.batchProcessing+this.common.formatGetUrl({ids:e.id}),method:"put",data:{proDescription:this.form.proDescription,status:"processed"}}),function(t){e.$notify({title:e.lang.common.success,type:"success",message:"处理成功"}),e.closeModal(!0)},function(t){e.closeModal(!0)})},initForm:function(){null!=this.$refs.form&&this.$refs.form.resetFields()}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.alarmManage.alarmdesc,width:"45%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[a("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:e.lang.alarmManage.handledesc,"label-width":e.labelWidth,prop:"proDescription"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{type:"textarea",maxlength:"255",placeholder:e.lang.alarmManage.placeholderdesc},model:{value:e.form.proDescription,callback:function(t){e.$set(e.form,"proDescription",t)},expression:"form.proDescription"}})],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleclick}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var i=a("C7Lr")(n,o,!1,function(e){a("53Zr")},null,null).exports,c={props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},ensureignore:function(){this.closeModal(!0)}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:10}},[e._v(e._s(e.lang.alarmManage.ignorealarm))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.ensureignore}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var p=a("C7Lr")(c,u,!1,function(e){a("6c9O")},null,null).exports,m={components:{"pana-breadcrumb":l.a,"pana-handlealarm":i,"pana-ignorealarm":p},data:function(){return{activeName:"first",tableData:[],historyData:[],search:"",historySearch:"",pageNum:1,pageSize:10,pageNum2:1,showHandlealarm:!1,showIgnorealarm:!1,handleIds:[],alarmType:{healthcheck:"健康检查",threshold:"阈值",computeha:"高可用",planwork:"计划任务",hardware:"硬件故障",cephCheck:"ceph健康检查"},alarmStatus:{unprocessed:"未处理",processed:"已处理",ignored:"忽略"},severityLever:{1:"严重",2:"适中",3:"低"},options:[{label:"全部",value:"all"},{label:"阈值",value:"threshold"},{label:"健康检查",value:"healthcheck"},{label:"高可用",value:"computeha"},{label:"计划任务",value:"planwork"},{label:"硬件故障",value:"hardware"},{label:"ceph健康检查",value:"cephCheck"}],typevalue:"all",values:"all",filterType:[],historyfilterType:[],eventLoading:!1,historyLoading:!1}},methods:{toJson:function(e){return new Function("","return "+e)()},filteralarmType:function(e){var t=[];if("all"===e)this.tableData=this.filterType;else{for(var a=0;a<this.filterType.length;a++)this.filterType[a].alarmType===e&&t.push(this.filterType[a]);this.tableData=t}},filterhistoryAlarm:function(e){var t=[];if("all"===e)this.historyData=this.historyfilterType;else{for(var a=0;a<this.historyfilterType.length;a++)this.historyfilterType[a].alarmType===e&&t.push(this.historyfilterType[a]);this.historyData=t}},getalarmList:function(){var e=this;this.eventLoading=!0,this.checkError(this.$http({url:this.api.alarmManage.getalarmList+e.common.formatGetUrl({status:"new"}),method:"get"}),function(t){e.eventLoading=!1,e.tableData=t.data,e.filterType=t.data},function(){e.eventLoading=!1})},gethistoryalarmList:function(){var e=this;this.historyLoading=!0,this.checkError(this.$http({url:this.api.alarmManage.getalarmList+e.common.formatGetUrl({status:"old"}),method:"get"}),function(t){e.historyLoading=!1,e.historyData=t.data,e.historyfilterType=t.data},function(){e.historyLoading=!1})},handleClick:function(){switch(this.activeName){case"first":this.getalarmList();break;case"second":this.gethistoryalarmList()}},sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.tableData=this.tableData.sort(function(a,r){return(a[e.prop]>r[e.prop]?1:-1)*t})},sorthistoryChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.historyData=this.historyData.sort(function(a,r){return(a[e.prop]>r[e.prop]?1:-1)*t})},pageSelect:function(e){this.pageNum=e},historypageSelect:function(e){this.pageNum2=e},selectids:function(e){var t=[];e.forEach(function(e){t.push(e.id)}),this.handleIds=t},handleprop:function(){this.showHandlealarm=!0},closeHandlealarm:function(e){!0===e&&this.getalarmList(),this.showHandlealarm=!1},closeIgnorealarm:function(e){var t=this;this.showIgnorealarm=!1,!0===e&&(t.handleIds.length<1?this.checkError(this.$http({url:t.common.formatMsg(t.api.alarmManage.handlealarm,{alarm_id:t.handleIds}),method:"put",data:{status:"ignored",proDescription:"忽略"}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:"忽略成功"}),t.getalarmList()}):this.checkError(this.$http({url:t.api.alarmManage.batchProcessing+this.common.formatGetUrl({ids:t.handleIds}),method:"put",data:{proDescription:"忽略",status:"ignored"}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:"忽略成功"}),t.getalarmList()}))}},mounted:function(){this.getalarmList()},computed:{filterData:function(){var e=this,t=this.search,a=[];return a=""===t?this.tableData:this.tableData.filter(function(a){return s()(a).some(function(r){return"alarmType"===r?String(e.alarmType[a[r]]).indexOf(t)>-1:"severity"===r?String(e.severityLever[a[r]]).indexOf(t)>-1:"status"===r?String(e.alarmStatus[a[r]]).indexOf(t)>-1:"createtime"===r?String(e.moment(a[r]).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss")).indexOf(t)>-1:String(a[r]).toLowerCase().indexOf(t)>-1})}),a},historyfilterData:function(){var e=this,t=this.historySearch,a=[];return a=""===t?this.historyData:this.historyData.filter(function(a){return s()(a).some(function(r){return"alarmType"===r?String(e.alarmType[a[r]]).indexOf(t)>-1:"severity"===r?String(e.severityLever[a[r]]).indexOf(t)>-1:"status"===r?String(e.alarmStatus[a[r]]).indexOf(t)>-1:"createtime"===r?String(e.moment(a[r]).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss")).indexOf(t)>-1:"updateTime"===r?String(e.moment(a[r]).tz("Asia/Shanghai").format("YYYY-MM-DD HH:mm:ss")).indexOf(t)>-1:String(a[r]).toLowerCase().indexOf(t)>-1})}),a},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)},historypagedData:function(){return this.historyfilterData.length<=this.pageSize?this.historyfilterData:this.common.pagination(this.historyfilterData,this.pageSize,this.pageNum2)}},watch:{search:function(){this.pageNum=1},historySearch:function(){this.pageNum2=1}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticClass:"alarmdiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:[e.getalarmList,e.gethistoryalarmList]}}),e._v(" "),a("el-main",[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:e.lang.alarmManage.alarmEvent,name:"first"}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:14}},[a("el-button",{attrs:{disabled:0===e.handleIds.length},on:{click:e.handleprop}},[e._v("\n                            "+e._s(e.lang.alarmManage.handel)+"\n                        ")]),e._v(" "),a("el-button",{attrs:{disabled:0===e.handleIds.length},on:{click:function(t){e.showIgnorealarm=!0}}},[e._v("\n                            "+e._s(e.lang.alarmManage.ignore)+"\n                        ")])],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-select",{attrs:{filterable:""},on:{change:function(t){return e.filteralarmType(e.typevalue)}},model:{value:e.typevalue,callback:function(t){e.typevalue=t},expression:"typevalue"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getalarmList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.eventLoading,expression:"eventLoading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"selection-change":e.selectids,"sort-change":e.sortChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{prop:"hostname",label:e.lang.alarmManage.hostname,sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.alarmtype,prop:"alarmType",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n                                "+e._s(e.alarmType[t.row.alarmType])+"\n                            ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.alarmcause,prop:"reason",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[null==t.row.domainId?a("p",[e._v(e._s(e.toJson(t.row.reason).subject))]):e._e(),e._v(" "),null==t.row.domainId?a("p",[e._v(e._s(e.toJson(t.row.reason).detail))]):e._e(),e._v(" "),"default"===t.row.domainId?a("p",[e._v(e._s(e.lang.alarmManage.warningRules))]):e._e(),e._v(" "),"default"===t.row.domainId?a("p",[e._v(e._s(t.row.reason))]):e._e(),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[null==t.row.domainId?a("span",{staticStyle:{color:"#51a3ff",cursor:"pointer"}},[e._v(e._s(e.toJson(t.row.reason).subject))]):e._e(),e._v(" "),"default"===t.row.domainId?a("span",{staticStyle:{color:"#51a3ff",cursor:"pointer"}},[e._v(e._s(e.lang.alarmManage.warningRules))]):e._e()])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.severityGrade,prop:"severity",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[3===t.row.severity?a("span",{staticClass:"status severity_status1"},[e._v(e._s(e.severityLever[t.row.severity]))]):e._e(),e._v(" "),2===t.row.severity?a("span",{staticClass:"status severity_status2"},[e._v(e._s(e.severityLever[t.row.severity]))]):e._e(),e._v(" "),1===t.row.severity?a("span",{staticClass:"status severity_status3"},[e._v(e._s(e.severityLever[t.row.severity]))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.processingState,sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e.alarmStatus[t.row.status]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.alarmdate,prop:"createtime",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("utc2beijing")(t.row.createtime)))])]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:e.lang.alarmManage.historicalWarningEvents,name:"second"}},[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:4,offset:14}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:function(t){return e.filterhistoryAlarm(e.values)}},model:{value:e.values,callback:function(t){e.values=t},expression:"values"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.historySearch,callback:function(t){e.historySearch=t},expression:"historySearch"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.gethistoryalarmList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.historyLoading,expression:"historyLoading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":"加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.historypagedData},on:{"sort-change":e.sorthistoryChange}},[a("el-table-column",{attrs:{prop:"hostname",label:e.lang.alarmManage.hostname,sortable:"custom"}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.alarmtype,prop:"alarmType",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n                                "+e._s(e.alarmType[t.row.alarmType])+"\n                            ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.alarmcause,prop:"reason",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{trigger:"hover",placement:"top"}},[null==t.row.domainId?a("p",[e._v(e._s(e.toJson(t.row.reason).subject))]):e._e(),e._v(" "),null==t.row.domainId?a("p",[e._v(e._s(e.toJson(t.row.reason).index))]):e._e(),e._v(" "),"default"===t.row.domainId?a("p",[e._v(e._s(e.lang.alarmManage.warningRules))]):e._e(),e._v(" "),"default"===t.row.domainId?a("p",[e._v(e._s(t.row.reason))]):e._e(),e._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[null==t.row.domainId?a("span",{staticStyle:{color:"#51a3ff",cursor:"pointer"}},[e._v(e._s(e.toJson(t.row.reason).subject))]):e._e(),e._v(" "),"default"===t.row.domainId?a("span",{staticStyle:{color:"#51a3ff",cursor:"pointer"}},[e._v(e._s(e.lang.alarmManage.warningRules))]):e._e()])])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.alarmdate,prop:"createtime",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("utc2beijing")(t.row.createtime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.severityGrade,prop:"severity",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[3===t.row.severity?a("span",{staticClass:"status severity_status1"},[e._v(e._s(e.severityLever[t.row.severity]))]):e._e(),e._v(" "),2===t.row.severity?a("span",{staticClass:"status severity_status2"},[e._v(e._s(e.severityLever[t.row.severity]))]):e._e(),e._v(" "),1===t.row.severity?a("span",{staticClass:"status severity_status3"},[e._v(e._s(e.severityLever[t.row.severity]))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.processingState,prop:"status",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e.alarmStatus[t.row.status]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.alarmManage.handleDate,prop:"updateTime",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("utc2beijing")(t.row.updateTime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"proDescription",label:e.lang.alarmManage.handledesc,sortable:"custom"}})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.historyfilterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.historyfilterData.length,"current-page":e.pageNum2},on:{"current-change":e.historypageSelect}}):e._e()],1)],1)],1)],1),e._v(" "),a("pana-handlealarm",{attrs:{show:e.showHandlealarm,id:e.handleIds},on:{closeModal:e.closeHandlealarm}}),e._v(" "),a("pana-ignorealarm",{attrs:{show:e.showIgnorealarm},on:{closeModal:e.closeIgnorealarm}})],1)},staticRenderFns:[]};var d=a("C7Lr")(m,h,!1,function(e){a("vCCE")},null,null);t.default=d.exports},vCCE:function(e,t){}});