webpackJsonp([51],{"3ITk":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("1JPr"),l=a("/n4h"),o=a("aA9S"),n=a.n(o),i={props:{show:Boolean,id:String},data:function(){return{data:{},loading:!0}},methods:{initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getSnapshotDetail()},getSnapshotDetail:function(){var t=this,e=t.common.formatMsg(t.api.storage.getSnapshotDetail,{id:t.id});this.checkError(this.$http({url:e,method:"get"}),function(e){t.loading=!1,t.data=e.data[0]})},closeModal:function(){n()(this.$data,this.$options.data.call(this)),this.$emit("closeModal")}},computed:{}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:t.lang.volume.snapshotDetail,visible:t.show,modal:!0,top:"8vh",width:"40%"},on:{"update:visible":function(e){t.show=e},open:t.initForm,close:t.closeModal}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"cloud-detail cloud-detail-modal",attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[t.data.hasOwnProperty("name")?a("table",[a("tr",[a("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.volume.snapshotName))]),t._v(" "),a("td",[t._v(t._s(t.data.name))]),t._v(" "),a("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.volume.cloudDiskName))]),t._v(" "),a("td",[t._v(t._s(t.data.volumeName))])]),t._v(" "),a("tr",[a("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.volume.createTime))]),t._v(" "),a("td",[t._v(t._s(t._f("utc2beijing")(t.data.created)))]),t._v(" "),a("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.volume.sizeGB))]),t._v(" "),a("td",[t._v(t._s(t.data.size))])]),t._v(" "),a("tr",[a("td",{staticClass:"cloud-label"},[t._v(t._s(t.lang.volume.state))]),t._v(" "),a("td",[t._v(t._s(t.lang.volume.snapshotStatus[t.data.status]))]),t._v(" "),a("td",{staticClass:"cloud-label"}),t._v(" "),a("td")])]):t._e()]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:t.closeModal}},[t._v(t._s(t.lang.common.close))])],1)])},staticRenderFns:[]};var c=a("C7Lr")(i,r,!1,function(t){a("q/Q3")},"data-v-143bd11c",null).exports,d={data:function(){return{activeName:"dataDisk",snapshotData:{},snapshotId:"",showDetail:!1,loading:!0,dialogVisible:!1,tipDialogMsg:"",operate:"",tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10}},components:{"pana-breadcrumb":s.a,cloudTipDialog:l.a,panaDetail:c},mounted:function(){var t=this;this.getList(),this.$ws.setCallback(function(e){if(-1!==t.wsEventQueue.indexOf(e.resource_id)){var a=e.event_type.split(".");"snapshot"===a[0]&&"end"===a[2]&&t.getList()}})},methods:{detail:function(t){this.snapshotId=t,this.showDetail=!0},closeDetail:function(){this.showDetail=!1},tabChange:function(){"sysDisk"===this.activeName?this.tableData=this.snapshotData.sys_disks:this.tableData=this.snapshotData.data_disks},sort:function(t){this.tableData=this.common.sort(t,this.tableData,["size"])},getList:function(){var t=this;t.loading=!0,this.checkError(this.$http({url:this.api.storage.getSnapshot,method:"get"}),function(e){t.loading=!1,t.snapshotData=e.data,t.tabChange()})},deleteConfirm:function(){this.operate="delete",this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.deleteSnapshotConfirm},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"delete":this.delete()}},delete:function(){var t=this,e=[];this.multipleSelection.forEach(function(a){t.wsEventQueue.push(a.id),e.push(a.id)});var a=this.api.storage.deleteSnapshot;this.checkError(this.$http({url:a,method:"POST",data:{ids:e}}),function(e){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.deletingSnapshot})})},pageSelect:function(t){this.pageNum=t},handleSelectionChange:function(t){this.multipleSelection=t}},computed:{notSelect:function(){return 0===this.multipleSelection.length},filterData:function(){var t=this.search,e=[],a=this.tableData;return e=""===t?a:this.common.cloudFilter(a,t),e},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:t.getList}}),t._v(" "),a("el-main",[a("el-tabs",{on:{"tab-click":t.tabChange},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:t.lang.volume.dataDiskSnapshot,name:"dataDisk"}},[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:t.notSelect},on:{click:t.deleteConfirm}},[t._v("\n                            "+t._s(t.lang.common.delete)+"\n                        ")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getList}})],1)],1)],1)],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:t.lang.volume.sysDiskSnapshot,name:"sysDisk"}},[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:t.notSelect},on:{click:t.deleteConfirm}},[t._v("\n                            "+t._s(t.lang.common.delete)+"\n                        ")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getList}})],1)],1)],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:t.pagedData},on:{"sort-change":t.sort,"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:t.lang.volume.snapshotName},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.detail(e.row.id)}}},[t._v("\n                            "+t._s(e.row.name)+"\n                        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"volumeName",label:t.lang.volume.cloudDiskName}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"size",label:t.lang.volume.sizeGB}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"status",label:t.lang.volume.state},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticClass:"status",class:{"cloud-success":"available"===e.row.status||"in-use"===e.row.status,"bg-blue":"creating"===e.row.status||"deleting"===e.row.status||"attaching"===e.row.status||"detaching"===e.row.status||"error-deleting"===e.row.status,"cloud-warning":"inavailable"===e.row.status,"cloud-error":"error"===e.row.status}},[t._v(t._s(t.lang.volume.snapshotStatus[e.row.status]))])]}}])}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"description",label:t.lang.common.description},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{"popper-class":"description-tooltip",disabled:null==e.row.description||e.row.description.length<=30,effect:"light",content:e.row.description,placement:"top"}},[null==e.row.description||e.row.description.length<=30?a("span",[t._v("\n                                "+t._s(e.row.description)+"\n                            ")]):a("span",[t._v(t._s(e.row.description.substr(0,50))+" ...")])])]}}])}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"created",label:t.lang.volume.createTime},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                        "+t._s(t._f("utc2beijing")(e.row.created))+"\n                    ")]}}])})],1),t._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.filterData.length>t.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.filterData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1)],1)],1),t._v(" "),a("pana-detail",{attrs:{show:t.showDetail,id:t.snapshotId},on:{closeModal:t.closeDetail}}),t._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:t.dialogVisible},on:{cancel:function(e){t.dialogVisible=!1},confirm:t.dialogConfirm}},[t._v("\n        "+t._s(t.tipDialogMsg)+"\n    ")])],1)},staticRenderFns:[]};var p=a("C7Lr")(d,u,!1,function(t){a("wSwB"),a("sSbh")},"data-v-3e77077d",null);e.default=p.exports},"q/Q3":function(t,e){},sSbh:function(t,e){},wSwB:function(t,e){}});