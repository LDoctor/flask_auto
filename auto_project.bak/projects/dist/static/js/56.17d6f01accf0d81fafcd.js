webpackJsonp([56],{A2jg:function(e,t){},HA8A:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("3cXf"),a=o.n(n),i=o("1JPr"),l=o("aA9S"),s=o.n(l),r={name:"pana-load-device",props:{show:Boolean,device:Object},watch:{"form.currentPool":function(e){null!=e&&""!==e&&(this.form.componentId="",this.getComponentList(e))},"form.componentId":function(e){var t=this;this.currentComponent={},this.components.map(function(o){e===o.uid&&(t.currentComponent=o)})}},methods:{closeModal:function(e){e=e||!1,s()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate(),this.getPoolList(),this.form.deviceType=this.device.deviceType,this.form.deviceCompatibility=this.device.usbBus},getPoolList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_pools+"?size=1000",method:"get"}),function(t){e.pools=t.data.filter(function(e){return e.status<2}),t.data.length>0&&(e.form.currentPool=t.data[0].id,e.getPoolStorageServer()),e.loading=!1},function(){e.loading=!1})},getComponentList:function(e){var t=this;this.loading=!0,this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.get_pools_detail_servers,{pool_id:e}),method:"get"}),function(e){t.components=e.data.filter(function(e){return e.hostName===t.device.hostName&&e.uid!==t.storageServer&&"fixedImageInstanceName"!==e.name}),e.data.length>0&&(t.currentComponent=t.components[0],t.form.componentId=t.currentComponent.uid),t.loading=!1},function(){t.loading=!1})},loadGpu:function(){var e=this;this.disable=!0,this.$refs.form.validate(function(t){if(t){var o={};o.addressBus=e.device.addressBus,o.addressDevice=e.device.addressDevice,o.description=e.device.description,o.deviceType=e.device.deviceType,o.hostName=e.device.hostName,o.serverId=e.currentComponent.uid,o.serverName=e.currentComponent.name,o.usbBus=e.device.usbBus,e.checkError(e.$http({url:e.api.cloud.usb_load,method:"post",data:o}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.transmissionManage.loadDeviceSuccess}),e.closeModal(!0),e.disable=!1},function(){e.disable=!1})}else e.disable=!1})},getPoolStorageServer:function(){var e=this;this.pools.map(function(t){t.id===e.form.currentPool&&(e.storageServer=t.stor_server_id)})}},data:function(){return{labelWidth:"100px",pools:[],components:[],currentComponent:{},storageServer:null,deviceCompatibility:[{name:"USB2.0",value:"0"},{name:"USB3.0",value:"1"}],deviceTypes:[{name:"USB",value:"USB"}],form:{currentPool:"",componentId:"",deviceType:"USB",deviceCompatibility:0},rules:{currentPool:[{required:!0,message:this.lang.transmissionManage.requiredRule,trigger:"blur"}],componentId:[{required:!0,message:this.lang.transmissionManage.requiredRule,trigger:"blur"}]},disable:!1,loading:!0}}},c={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.transmissionManage.load,width:"30%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.transmissionManage.selectPool,"label-width":e.labelWidth,prop:"currentPool"}},[o("el-select",{attrs:{filterable:"",placeholder:e.lang.transmissionManage.poolSelectPlaceholder,width:"100%"},on:{change:e.getPoolStorageServer},model:{value:e.form.currentPool,callback:function(t){e.$set(e.form,"currentPool",t)},expression:"form.currentPool"}},e._l(e.pools,function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.transmissionManage.selectComponent,"label-width":e.labelWidth,prop:"componentId"}},[o("el-select",{attrs:{filterable:"",placeholder:e.lang.transmissionManage.componentSelectPlaceholder,width:"100%"},model:{value:e.form.componentId,callback:function(t){e.$set(e.form,"componentId",t)},expression:"form.componentId"}},e._l(e.components,function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.uid}})}),1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.transmissionManage.deviceType,"label-width":e.labelWidth}},[o("el-select",{attrs:{filterable:"",disabled:"",placeholder:e.lang.gpuManage.componentSelectPlaceholder,width:"100%"},model:{value:e.form.deviceType,callback:function(t){e.$set(e.form,"deviceType",t)},expression:"form.deviceType"}},e._l(e.deviceTypes,function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.value}})}),1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.transmissionManage.usbCompatibility,"label-width":e.labelWidth}},[o("el-select",{attrs:{filterable:"",disabled:"",placeholder:e.lang.transmissionManage.deviceTypePlaceholder,width:"100%"},model:{value:e.form.deviceCompatibility,callback:function(t){e.$set(e.form,"deviceCompatibility",t)},expression:"form.deviceCompatibility"}},e._l(e.deviceCompatibility,function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.value}})}),1)],1)],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.loadGpu}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var d=o("C7Lr")(r,c,!1,function(e){o("XL7W"),o("A2jg")},"data-v-2e7734af",null).exports,u={name:"pana-unload-gpu",props:{show:Boolean,gpu:Object},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},unloadDevice:function(){this.closeModal(!0)}}},m={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:12}},[e._v(e._s(e.lang.transmissionManage.unloadDeviceInfo))])],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.unloadDevice}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},p=o("C7Lr")(u,m,!1,null,null,null).exports,v={name:"device-manage",components:{"pana-breadcrumb":i.a,"pana-load-device":d,"pana-unload-device":p},computed:{deviceFilter:function(){var e=this;return this.deviceOrigin.filter(function(t){return""===e.deviceSearch||-1!==a()(t).search(e.deviceSearch)})},deviceTable:function(){return this.deviceFilter.length>this.pageSize?this.deviceFilter.slice((this.devicePage-1)*this.pageSize,this.devicePage*this.pageSize):this.deviceFilter}},data:function(){return{pageSize:10,deviceSearch:"",devicePage:1,deviceSelections:[],deviceOrigin:[],showLoadDevice:!1,showUnloadDevice:!1,compatibilityConf:{0:"USB2.0",1:"USB3.0"},loading:!1}},methods:{sortChange:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.deviceOrigin=this.deviceOrigin.sort(function(o,n){return o[e.prop]=null==o[e.prop]?"":o[e.prop],n[e.prop]=null==n[e.prop]?"":n[e.prop],(o[e.prop]>n[e.prop]?1:-1)*t})},switchDevicePage:function(e){this.devicePage=e},selectDevice:function(e){this.deviceSelections=e},getDeviceList:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.usb_device_list,method:"get"}),function(t){e.loading=!1,e.deviceOrigin=t.data},function(){e.loading=!1})},closeUnloadDevice:function(e){var t=this;this.showUnloadDevice=!1,!0===e&&(this.checkError(this.$http({url:this.api.cloud.usb_unload,method:"post",data:{addressBus:this.deviceSelections[0].addressBus,addressDevice:this.deviceSelections[0].addressDevice,serverId:this.deviceSelections[0].server_id,usbBus:this.deviceSelections[0].usbBus,usbPort:this.deviceSelections[0].usbPort}}),function(){t.$notify({title:t.lang.common.success,type:"success",message:t.lang.transmissionManage.unloadDeviceSuccess}),t.getDeviceList()}),t.deviceSelections=[])},closeLoadDevice:function(e){this.showLoadDevice=!1,!0===e&&this.getDeviceList()}},mounted:function(){this.getDeviceList()}},g={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",{attrs:{type:"flex",direction:"vertical"}},[o("pana-breadcrumb"),e._v(" "),o("el-main",[o("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:12}},[o("el-button",{attrs:{disabled:1!==e.deviceSelections.length||!0===e.deviceSelections[0].loading},on:{click:function(t){e.showLoadDevice=!0}}},[e._v("\n                    "+e._s(e.lang.transmissionManage.load)+"\n                ")]),e._v(" "),o("el-button",{attrs:{disabled:1!==e.deviceSelections.length||!1===e.deviceSelections[0].loading},on:{click:function(t){e.showUnloadDevice=!0}}},[e._v("\n                    "+e._s(e.lang.transmissionManage.unload)+"\n                ")])],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:22}},[o("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.deviceSearch,callback:function(t){e.deviceSearch=t},expression:"deviceSearch"}})],1),e._v(" "),o("el-col",{attrs:{span:2}},[o("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getDeviceList}})],1)],1)],1)],1),e._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:e.deviceTable,"tooltip-effect":"dark"},on:{"selection-change":e.selectDevice,"sort-change":e.sortChange}},[o("el-table-column",{attrs:{type:"selection"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.transmissionManage.deviceName,sortable:"custom",prop:"description"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.transmissionManage.hostName,sortable:"custom",prop:"hostName"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.transmissionManage.poolName,sortable:"custom",prop:"pool_name"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.transmissionManage.componentName,sortable:"custom",prop:"server_name"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.status,sortable:"custom",prop:"loading"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(!0===t.row.loading?e.lang.transmissionManage.loaded:e.lang.transmissionManage.unloaded)+"\n                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.type,sortable:"custom",prop:"deviceType"}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.transmissionManage.compatibility,sortable:"custom",prop:"usbBus"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.compatibilityConf[t.row.usbBus])+"\n                ")]}}])})],1),e._v(" "),o("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.deviceFilter.length>e.pageSize?o("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.deviceFilter.length,"page-size":e.pageSize},on:{"current-change":e.switchDevicePage}},[e._t("default",[o("span",{staticClass:"pagination-slot"},[e._v("\n                        "+e._s(e.common.formatMsg(e.lang.common.paginationMsg,{current:this.devicePage,total:this.deviceFilter.length}))+"\n                    ")])])],2):e._e()],1),e._v(" "),o("pana-load-device",{attrs:{show:e.showLoadDevice,device:e.deviceSelections[0]},on:{closeModal:e.closeLoadDevice}}),e._v(" "),o("pana-unload-device",{attrs:{show:e.showUnloadDevice},on:{closeModal:e.closeUnloadDevice}})],1)],1)},staticRenderFns:[]};var h=o("C7Lr")(v,g,!1,function(e){o("e3xp")},"data-v-014253b7",null);t.default=h.exports},XL7W:function(e,t){},e3xp:function(e,t){}});