webpackJsonp([59],{Adck:function(i,t,s){"use strict";(function(i){var e=s("1JPr");t.a={name:"poolinit",components:{"pana-breadcrumb":e.a},data:function(){return{disknum:[{value:"1",label:"1",disabled:!1},{value:"2",label:"2",disabled:!1},{value:"3",label:"3",disabled:!1},{value:"4",label:"4",disabled:!1},{value:"5",label:"5",disabled:!1},{value:"6",label:"6",disabled:!1},{value:"7",label:"7",disabled:!1},{value:"8",label:"8",disabled:!1},{value:"9",label:"9",disabled:!1},{value:"10",label:"10",disabled:!1},{value:"11",label:"11",disabled:!1},{value:"12",label:"12",disabled:!1},{value:"13",label:"13",disabled:!1},{value:"14",label:"14",disabled:!1},{value:"15",label:"15",disabled:!1},{value:"16",label:"16",disabled:!1},{value:"17",label:"17",disabled:!1},{value:"18",label:"18",disabled:!1},{value:"19",label:"19",disabled:!1},{value:"20",label:"20",disabled:!1},{value:"21",label:"21",disabled:!1},{value:"22",label:"22",disabled:!1},{value:"23",label:"23",disabled:!1},{value:"24",label:"24",disabled:!1},{value:"25",label:"25",disabled:!1},{value:"26",label:"26",disabled:!1}],diskstructure:[{value:"stripe",label:"条带",disabled:!1},{value:"mirror",label:"镜像",disabled:!1},{value:"raidz1",label:"单重校验",disabled:!1},{value:"raidz2",label:"双重校验",disabled:!1},{value:"raidz3",label:"三重校验",disabled:!1}],compressionLevels:[{value:"off",label:"关闭"},{value:"gzip-1",label:"gzip-1"},{value:"gzip-6",label:"gzip-6"},{value:"gzip-9",label:"gzip-9"},{value:"zle",label:"zle"},{value:"lzjb",label:"lzjb"},{value:"lz4",label:"lz4"}],zfsdelectData:[{value:"off",label:"禁用"},{value:"on",label:"启用"},{value:"verify",label:"验证"}],fuben:[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"}],fileblocksize:[{value:"1K",label:"1K"},{value:"2K",label:"2K"},{value:"3K",label:"4K"},{value:"4K",label:"8K"},{value:"16K",label:"16K"},{value:"32K",label:"32K"},{value:"64K",label:"64K"},{value:"128K",label:"128K"},{value:"256K",label:"256K"},{value:"512K",label:"512K"},{value:"1M",label:"1M"}],percentage:0,fileunit:"GB",objectunit:"GB",diskspaceoption:"GB",totalspaceoption:"GB",flagpietotalsize:"",total_redundancy:0,total_free:0,showexpGB:0,gateway_init_state:!1,flagfilesize:0,flagobjectsize:0,flagdisk:0,form:{file_and_object_storage_type:"ZFS",disk_num:"",pool_type:"stripe",disk_size:"",file_size:0,object_size:0,compression:"off",dedup:"off",copies:"1",recordsize:"128K",pooltotalSize:0,diskspace:0},block_size:"",labelWidth:"150px",isShow:!1,storage_id:"",open:!1,maxSize:"",allocate:0,distributableSize:0,showfilealert:!1,isinit:"",flagredundancy:"",poolDetail:{},loading:!0,flagDisknum:"",disabled:!1,originalData:""}},methods:{getexpmaxSize:function(){var i=this;this.checkError(this.$http({url:this.api.storage.getexpmaxSize,method:"get"}),function(t){i.maxSize=t.data.free})},getpoolSize:function(){var t=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.storage.get_poolsize,{pool_id:this.poolsizeId}),method:"get"}),function(s){if(t.loading=!1,t.originalData=s.data,t.form.pooltotalSize=t.common.switchCapacity(s.data.total_size,"B","GB",1),t.flagpietotalsize=t.common.switchCapacity(s.data.total_size,"B","GB",1),t.block_size=t.common.switchCapacity(s.data.block_size,"B","GB",1),t.form.file_size=t.common.switchCapacity(s.data.file_size,"B","GB",0),t.form.object_size=t.common.switchCapacity(s.data.object_size,"B","GB",0),t.total_redundancy=t.common.switchCapacity(s.data.total_redundancy,"B","GB",1),t.flagredundancy=t.common.switchCapacity(s.data.total_redundancy,"B","GB",1),t.total_free=t.common.switchCapacity(s.data.block_free,"B","GB",1),t.showexpGB=t.common.switchCapacity(s.data.block_free,"B","GB",1),t.form.disk_size=t.common.switchCapacity(s.data.disk_size,"B","GB",1),t.percentage=t.form.file_size/(t.form.file_size+t.form.object_size)*100,""!==s.data.pool_type&&(t.form.pool_type=s.data.pool_type),t.form.compression=s.data.compression,t.form.dedup=s.data.dedup,t.form.copies=s.data.copies,0!=s.data.recordsize&&(t.form.recordsize=t.common.switchCapacity(s.data.recordsize,"B","KB")+"K"),t.gateway_init_state=s.data.gateway_init_state,1==s.data.gateway_init_state){if(t.form.diskspace=t.form.disk_size*s.data.disk_num,t.flagdisk=t.form.disk_size*s.data.disk_num,t.flagfilesize=t.form.file_size,t.flagobjectsize=t.form.object_size,t.form.disk_num=s.data.disk_num,t.flagDisknum=s.data.disk_num,t.distributableSize=t.common.switchCapacity(s.data.block_free,"B","GB",1),t.open=!0,"stripe"===s.data.pool_type)for(var e=0;e<t.disknum.length;e++)t.disknum[e].value<s.data.disk_num?t.disknum[e].disabled=!0:t.disknum[e].value>Math.floor((t.distributableSize+t.form.diskspace)/t.form.disk_size)&&(t.disknum[e].disabled=!0);else if("mirror"===s.data.pool_type)for(var a=0;a<t.disknum.length;a++)t.disknum[a].value<s.data.disk_num+2?t.disknum[a].disabled=!0:t.disknum[a].value>Math.floor((t.distributableSize+t.form.diskspace)/t.form.disk_size)?t.disknum[a].disabled=!0:t.disknum[a].disabled=!1;else if("raidz1"===s.data.pool_type)for(var o=0;o<t.disknum.length;o++)t.disknum[o].value<s.data.disk_num+3?t.disknum[o].disabled=!0:t.disknum[o].value>Math.floor((t.distributableSize+t.form.diskspace)/t.form.disk_size)?t.disknum[o].disabled=!0:t.disknum[o].disabled=!1;else if("raidz2"===s.data.pool_type)for(var l=0;l<t.disknum.length;l++)t.disknum[l].value<s.data.disk_num+4?t.disknum[l].disabled=!0:t.disknum[l].value>Math.floor((t.distributableSize+t.form.diskspace)/t.form.disk_size)?t.disknum[l].disabled=!0:t.disknum[l].disabled=!1;else if("raidz3"===s.data.pool_type)for(var r=0;r<t.disknum.length;r++)t.disknum[r].value<s.data.disk_num+5?t.disknum[r].disabled=!0:t.disknum[r].value>Math.floor((t.distributableSize+t.form.diskspace)/t.form.disk_size)?t.disknum[r].disabled=!0:t.disknum[r].disabled=!1}else t.form.compression="off",t.form.dedup="off",t.form.copies="1",t.form.recordsize="128K",t.form.disk_num="1",t.form.diskspace=1,t.form.disk_size=1,t.allocate=1,t.distributableSize=t.common.switchCapacity(s.data.block_free,"B","GB",1)-t.form.diskspace-10;0===s.data.object_size&&0===s.data.file_size?i(".ratios .el-progress-bar__outer").css("background","#d7e1e3"):i(".ratios .el-progress-bar__outer").css("background","#9577ef"),t.drawchart(t.form.pooltotalSize,t.block_size,t.form.file_size,t.form.object_size,t.total_redundancy)},function(i){t.loading=!1})},changeswitch:function(){if(1==this.open){this.form.compression="off",this.form.dedup="off",this.form.copies="1",this.form.recordsize="128K",this.form.disk_num="1",this.form.diskspace=1,this.form.disk_size=1,this.allocate=1,this.distributableSize=this.form.pooltotalSize-this.flagpietotalsize+this.total_free-11;var i=this.form.pooltotalSize-this.form.diskspace;this.total_redundancy=0,this.drawchart(this.form.pooltotalSize,i,this.form.file_size,this.form.object_size,this.total_redundancy)}else{var t=this.form.pooltotalSize;this.form.file_size=0,this.form.object_size=0,this.total_redundancy=0,this.drawchart(this.form.pooltotalSize,t,this.form.file_size,this.form.object_size,this.total_redundancy)}},addsize:function(){if(this.form.pooltotalSize>this.flagpietotalsize||this.form.pooltotalSize==this.flagpietotalsize){var i=void 0;this.showexpGB=this.form.pooltotalSize-this.flagpietotalsize+this.total_free,1==this.gateway_init_state?this.distributableSize=this.form.pooltotalSize-this.flagpietotalsize+this.total_free-this.allocate:this.distributableSize=this.form.pooltotalSize-this.flagpietotalsize+this.total_free-10-this.form.diskspace,i=0==this.open?this.form.pooltotalSize:(1==this.open&&this.gateway_init_state,this.form.pooltotalSize-this.form.diskspace),"raidz"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):this.total_redundancy=0,this.drawchart(this.form.pooltotalSize,i,this.form.file_size,this.form.object_size,this.total_redundancy)}if(1==this.gateway_init_state)if("stripe"===this.form.pool_type)for(var t=0;t<this.disknum.length;t++)this.disknum[t].value<this.flagDisknum?this.disknum[t].disabled=!0:this.disknum[t].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[t].disabled=!0:this.disknum[t].disabled=!1;else if("mirror"===this.form.pool_type)for(var s=0;s<this.disknum.length;s++)this.disknum[s].value<this.flagDisknum+2?this.disknum[s].disabled=!0:this.disknum[s].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[s].disabled=!0:this.disknum[s].disabled=!1;else if("raidz1"===this.form.pool_type)for(var e=0;e<this.disknum.length;e++)this.disknum[e].value<this.flagDisknum+3?this.disknum[e].disabled=!0:this.disknum[e].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[e].disabled=!0:this.disknum[e].disabled=!1;else if("raidz2"===this.form.pool_type)for(var a=0;a<this.disknum.length;a++)this.disknum[a].value<this.flagDisknum+4?this.disknum[a].disabled=!0:this.disknum[a].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[a].disabled=!0:this.disknum[a].disabled=!1;else if("raidz3"===this.form.pool_type)for(var o=0;o<this.disknum.length;o++)this.disknum[o].value<this.flagDisknum+5?this.disknum[o].disabled=!0:this.disknum[o].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[o].disabled=!0:this.disknum[o].disabled=!1},sigledisksize:function(i){var t=this;if(0==this.gateway_init_state){this.form.disk_size=(this.form.diskspace/this.form.disk_num).toFixed(2),"1"===i?(this.diskstructure[1].disabled=!0,this.diskstructure[2].disabled=!0,this.diskstructure[3].disabled=!0,this.diskstructure[4].disabled=!0):"2"===i?(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!0,this.diskstructure[3].disabled=!0,this.diskstructure[4].disabled=!0):"3"===i?(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!1,this.diskstructure[3].disabled=!0,this.diskstructure[4].disabled=!0):"4"===i?(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!1,this.diskstructure[3].disabled=!1,this.diskstructure[4].disabled=!0):(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!1,this.diskstructure[3].disabled=!1,this.diskstructure[4].disabled=!1),"raidz"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):"mirror"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*(this.form.disk_num-1)).toFixed(2):this.total_redundancy=0;var s=this.form.pooltotalSize-this.form.diskspace;(this.form.diskspace-this.flagdisk<this.showexpGB||this.form.diskspace-this.flagdisk==this.showexpGB)&&this.drawchart(this.form.pooltotalSize,s,this.form.file_size,this.form.object_size,this.total_redundancy)}else{"raidz"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):"mirror"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*(this.form.disk_num-1)).toFixed(2):this.total_redundancy=0,this.$nextTick(function(){t.$refs.diskinput.$el.children[0].focus()}),this.form.diskspace=this.form.disk_size*this.form.disk_num,this.allocate=this.form.diskspace-this.flagdisk,this.distributableSize=this.showexpGB-(this.form.diskspace-this.flagdisk);var e=void 0;e=(this.form.diskspace,this.form.file_size,this.form.object_size,this.form.pooltotalSize-this.form.diskspace),(this.form.diskspace-this.flagdisk<this.showexpGB||this.form.diskspace-this.flagdisk==this.showexpGB)&&this.drawchart(this.form.pooltotalSize,e,this.form.file_size,this.form.object_size,this.total_redundancy)}},changespace:function(){this.distributableSize=this.form.pooltotalSize-this.flagpietotalsize+this.total_free-this.form.diskspace-10,this.allocate=this.form.diskspace-this.flagdisk,this.form.disk_size=(this.form.diskspace/this.form.disk_num).toFixed(2);var i=this.form.pooltotalSize-this.form.diskspace;"raidz1"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):"mirror"===this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*(this.form.disk_num-1)).toFixed(2):this.total_redundancy=0,(this.form.diskspace<this.showexpGB||this.form.diskspace===this.showexpGB)&&this.drawchart(this.form.pooltotalSize,i,this.form.file_size,this.form.object_size,this.total_redundancy)},changediskstructure:function(i){if("stripe"===i){this.form.pooltotalSize,this.form.diskspace;this.disknum[0].disabled=!1,this.disknum[1].disabled=!1,this.disknum[2].disabled=!1,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1,this.drawchart(this.form.pooltotalSize,this.form.diskspace,this.form.file_size,this.form.object_size,0)}else if("mirror"===i){this.disknum[0].disabled=!0,this.disknum[1].disabled=!1,this.disknum[2].disabled=!1,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1;var t=this.form.pooltotalSize-this.form.diskspace,s=(this.form.diskspace/this.form.disk_num*(this.form.disk_num-1)).toFixed(2);this.drawchart(this.form.pooltotalSize,t,this.form.file_size,this.form.object_size,s)}else if("raidz1"===i){this.disknum[0].disabled=!0,this.disknum[1].disabled=!0,this.disknum[2].disabled=!1,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1;var e=this.form.pooltotalSize-this.form.diskspace,a=(this.form.diskspace/this.form.disk_num).toFixed(2);this.drawchart(this.form.pooltotalSize,e,this.form.file_size,this.form.object_size,a)}else if("raidz2"===i){this.disknum[0].disabled=!0,this.disknum[1].disabled=!0,this.disknum[2].disabled=!0,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1;var o=this.form.pooltotalSize-this.form.diskspace,l=(this.form.diskspace/this.form.disk_num*2).toFixed(2);this.drawchart(this.form.pooltotalSize,o,this.form.file_size,this.form.object_size,l)}else if("raidz3"===i){this.disknum[0].disabled=!0,this.disknum[1].disabled=!0,this.disknum[2].disabled=!0,this.disknum[3].disabled=!0,this.disknum[4].disabled=!1;var r=this.form.pooltotalSize-this.form.diskspace,d=(this.form.diskspace/this.form.disk_num*3).toFixed(2);this.drawchart(this.form.pooltotalSize,r,this.form.file_size,this.form.object_size,d)}},changefilevalue:function(){this.form.file_size>this.form.diskspace&&(this.form.file_size=this.form.diskspace),this.form.file_size=Math.round(this.form.file_size),this.form.object_size=this.form.diskspace-this.form.file_size,this.form.object_size=Math.round(this.form.object_size),this.allocate=0,this.form.diskspace==this.form.file_size+this.form.object_size&&(this.showfilealert=!1),this.percentage=Math.round(this.form.file_size/(this.form.file_size+this.form.object_size)*100),0==this.form.file_size&&0==this.form.object_size?i(".ratios .el-progress-bar__outer").css("background","#d7e1e3"):i(".ratios .el-progress-bar__outer").css("background","#9577ef"),"raidz1"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raid2"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raid3"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):this.total_redundancy=0;var t=this.form.pooltotalSize-this.form.diskspace;this.drawchart(this.form.pooltotalSize,t,this.form.file_size,this.form.object_size,this.total_redundancy)},changeobjectvalue:function(){this.form.object_size>this.form.diskspace&&(this.form.object_size=this.form.diskspace),this.form.file_size=this.form.diskspace-this.form.object_size,this.form.file_size=Math.round(this.form.file_size),this.allocate=0,this.form.diskspace==this.form.file_size+this.form.object_size&&(this.showfilealert=!1),this.percentage=Math.round(this.form.file_size/(this.form.file_size+this.form.object_size)*100),0==this.form.file_size&&0==this.form.object_size?i(".ratios .el-progress-bar__outer").css("background","#d7e1e3"):i(".ratios .el-progress-bar__outer").css("background","#9577ef");var t=this.form.pooltotalSize-this.form.diskspace;"raidz1"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raid2"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raid3"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):this.total_redundancy=0,this.drawchart(this.form.pooltotalSize,t,this.form.file_size,this.form.object_size,this.total_redundancy)},drawchart:function(i,t,s,e,a){this.$echarts.init(document.getElementById("platechart")).setOption({tooltip:{trigger:"item",formatter:"{b}"},legend:{orient:"vertical",left:40,bottom:0,data:["块   占用"+t+"GB","文件  占用"+s+"GB","对象  占用"+e+"GB"]},color:["#60abfc","#576cdd","#9577ef","#d7e1e4"],graphic:{type:"text",top:"center",left:"center",style:{text:i+"GB \n 冗余:"+a+"GB",fill:"#A2ACBA",fontSize:14,lineHeight:20}},series:[{name:"池的总量",type:"pie",radius:["50%","60%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:t,name:"块   占用"+t+"GB"},{value:s,name:"文件  占用"+s+"GB"},{value:e,name:"对象  占用"+e+"GB"}]}]})},isshow:function(){this.isShow=!this.isShow},router_to_poollist:function(){this.$router.push({path:"/storage/spaceManage"})},submitData:function(i){var t=this,s=this,e=void 0;if(e=0==this.open?{storage_id:this.storage_id,total_size:this.common.switchCapacity(this.form.pooltotalSize,"GB","B")}:{storage_id:this.storage_id,total_size:this.common.switchCapacity(this.form.pooltotalSize,"GB","B"),file_size:this.common.switchCapacity(this.form.file_size,"GB","B"),object_size:this.common.switchCapacity(this.form.object_size,"GB","B"),file_and_object_storage_type:"zfs",pool_type:this.form.pool_type,disk_size:Math.round(this.common.switchCapacity(this.form.disk_size,"GB","B")),disk_num:this.form.disk_num,compression:this.form.compression,dedup:this.form.dedup,copies:this.form.copies,recordsize:this.form.recordsize},1==this.open&&this.form.diskspace>this.form.file_size+this.form.object_size)return this.showfilealert=!0,!1;this.$refs.form.validate(function(i){i&&(s.disabled=!0,t.checkError(t.$http({url:t.common.formatMsg(t.api.storage.get_poolsize,{pool_id:t.poolsizeId}),method:"post",data:e}),function(i){s.router_to_poollist(),s.disabled=!1,s.wsEventQueue.push(s.poolsizeId.toString())},function(i){s.disabled=!1}))})},init:function(){this.chart1=this.$echarts.init(this.$refs.myEchart),this.chart1.resize()},getPoolDetail:function(){var i=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.get_pools_detail,{pool_id:this.poolsizeId}),method:"get"}),function(t){i.poolDetail=t.data})}},mounted:function(){this.poolsizeId=this.$route.params.id,this.isinit=this.$route.params.isinit,this.getPoolDetail(),this.getpoolSize(),this.getexpmaxSize(),window.addEventListener("resize",this.init,20);var i=this;this.$http({url:this.api.storage.get_pools,method:"get"}).then(function(t){i.storage_id=t.data.data[0].volumeTypeId})},watch:{isinit:function(){return this.$route.params.isinit},"form.pooltotalSize":function(){if(this.flagpietotalsize=this.common.switchCapacity(this.originalData.total_size,"B","GB",1),this.block_size=this.common.switchCapacity(this.originalData.block_size,"B","GB",1),this.form.file_size=this.common.switchCapacity(this.originalData.file_size,"B","GB",0),this.form.object_size=this.common.switchCapacity(this.originalData.object_size,"B","GB",0),this.total_redundancy=this.common.switchCapacity(this.originalData.total_redundancy,"B","GB",1),this.flagredundancy=this.common.switchCapacity(this.originalData.total_redundancy,"B","GB",1),this.total_free=this.common.switchCapacity(this.originalData.block_free,"B","GB",1),this.showexpGB=this.common.switchCapacity(this.originalData.block_free,"B","GB",1),this.form.disk_size=this.common.switchCapacity(this.originalData.disk_size,"B","GB",1),this.percentage=this.form.file_size/(this.form.file_size+this.form.object_size)*100,""!==this.originalData.pool_type&&(this.form.pool_type=this.originalData.pool_type),this.form.compression=this.originalData.compression,this.form.dedup=this.originalData.dedup,this.form.copies=this.originalData.copies,0!=this.originalData.recordsize&&(this.form.recordsize=this.common.switchCapacity(this.originalData.recordsize,"B","KB")+"K"),this.gateway_init_state=this.originalData.gateway_init_state,1==this.originalData.gateway_init_state){if(this.form.diskspace=this.form.disk_size*this.originalData.disk_num,this.flagdisk=this.form.disk_size*this.originalData.disk_num,this.flagfilesize=this.form.file_size,this.flagobjectsize=this.form.object_size,this.form.disk_num=this.originalData.disk_num,this.flagDisknum=this.originalData.disk_num,this.distributableSize=this.common.switchCapacity(this.originalData.block_free,"B","GB",1),this.open=!0,"stripe"===this.originalData.pool_type)for(var t=0;t<this.disknum.length;t++)this.disknum[t].value<this.originalData.disk_num?this.disknum[t].disabled=!0:this.disknum[t].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)&&(this.disknum[t].disabled=!0);else if("mirror"===this.originalData.pool_type)for(var s=0;s<this.disknum.length;s++)this.disknum[s].value<this.originalData.disk_num+2?this.disknum[s].disabled=!0:this.disknum[s].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[s].disabled=!0:this.disknum[s].disabled=!1;else if("raidz1"===this.originalData.pool_type)for(var e=0;e<this.disknum.length;e++)this.disknum[e].value<this.originalData.disk_num+3?this.disknum[e].disabled=!0:this.disknum[e].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[e].disabled=!0:this.disknum[e].disabled=!1;else if("raidz2"===this.originalData.pool_type)for(var a=0;a<this.disknum.length;a++)this.disknum[a].value<this.originalData.disk_num+4?this.disknum[a].disabled=!0:this.disknum[a].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[a].disabled=!0:this.disknum[a].disabled=!1;else if("raidz3"===this.originalData.pool_type)for(var o=0;o<this.disknum.length;o++)this.disknum[o].value<this.originalData.disk_num+5?this.disknum[o].disabled=!0:this.disknum[o].value>Math.floor((this.distributableSize+this.form.diskspace)/this.form.disk_size)?this.disknum[o].disabled=!0:this.disknum[o].disabled=!1}else this.form.compression="off",this.form.dedup="off",this.form.copies="1",this.form.recordsize="128K",this.form.disk_num="1",this.form.diskspace=1,this.form.disk_size=1,this.allocate=1,this.distributableSize=this.common.switchCapacity(this.originalData.block_free,"B","GB",1)-this.form.diskspace-10;0===this.originalData.object_size&&0===this.originalData.file_size?i(".ratios .el-progress-bar__outer").css("background","#d7e1e3"):i(".ratios .el-progress-bar__outer").css("background","#9577ef"),this.drawchart(this.common.switchCapacity(this.originalData.total_size,"B","GB",1),this.block_size,this.form.file_size,this.form.object_size,this.total_redundancy)}},destroyed:function(){window.removeEventListener("resize",this.init,20)}}}).call(t,s("qqHy"))},HPmm:function(i,t){},IPpu:function(i,t){},t5A5:function(i,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=s("Adck"),a={render:function(){var i=this,t=i.$createElement,s=i._self._c||t;return s("el-container",{staticClass:"initcontent",attrs:{type:"flex",direction:"vertical"}},[s("pana-breadcrumb",{attrs:{back:!0}}),i._v(" "),s("el-main",[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:i.loading,expression:"loading"}],ref:"form",attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.6)","label-width":"100px","label-position":"right",model:i.form}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{staticClass:"poolconfig",attrs:{span:19}},[s("div",{staticClass:"totalstorage"},[s("div",{staticClass:"totaltitle"},[i._v("\n\t\t\t\t\t\t\t\t"+i._s(i.lang.storagePool.poolExp)+"\n\t\t\t\t\t\t\t")]),i._v(" "),s("div",{staticClass:"totalinfo"},[s("el-row",[s("el-col",{attrs:{span:2}},[s("div",{staticClass:"totalimg"},[s("img",{attrs:{src:"/static/image/totalicon.png"}})])]),i._v(" "),s("el-col",{staticClass:"totalslider",attrs:{span:8,offset:1}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,"show-text":!1,percentage:100,color:"#60ABFC"}})],1),i._v(" "),s("el-col",{staticClass:"expvalue",attrs:{span:7}},[s("el-form-item",{attrs:{label:i.lang.storagePool.quota,prop:"pooltotalSize",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:this.common.validateNumberRange,min:this.flagpietotalsize,max:this.flagpietotalsize+this.maxSize,message:this.common.formatMsg(this.lang.storagePool.maxexpRange,{min:this.flagpietotalsize,max:this.flagpietotalsize+this.maxSize}),trigger:"blur"},{validator:this.common.validateIntegerType,message:"请输入数字",trigger:"blur"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{width:"100%"},on:{change:i.addsize},nativeOn:{mousewheel:function(i){i.preventDefault()}},model:{value:i.form.pooltotalSize,callback:function(t){i.$set(i.form,"pooltotalSize",i._n(t))},expression:"form.pooltotalSize"}})],1)],1),i._v(" "),s("el-col",{attrs:{span:1}},[s("span",{staticStyle:{"line-height":"104px","padding-left":"5px"}},[i._v("GB")])])],1)],1)]),i._v(" "),0==i.gateway_init_state||0==i.isinit?s("div",[s("span",[i._v("启用文件和对象存储")]),i._v(" "),s("el-tooltip",{attrs:{disabled:null!=i.poolDetail.private_subnet_id&&""!==i.poolDetail.private_subnet_id&&null!=i.poolDetail.private_network_id&&""!==i.poolDetail.private_network_id,content:i.lang.storagePool.noPoolSubnetInfo,placement:"top"}},[s("span",{staticStyle:{"margin-right":"10px"}},[s("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#dcdfe6",disabled:0==i.showexpGB||i.showexpGB<0||""===i.poolDetail.private_network_id||null==i.poolDetail.private_network_id||""===i.poolDetail.private_subnet_id||null==i.poolDetail.private_subnet_id},on:{change:i.changeswitch},model:{value:i.open,callback:function(t){i.open=t},expression:"open"}})],1)])],1):i._e(),i._v(" "),1==i.isinit||i.open?s("div",{staticClass:"filestorage"},[s("div",{staticClass:"filetitle"},[i._v("\n\t\t\t\t\t\t\t\t"+i._s(i.lang.storagePool.fileandobject)+"\n\t\t\t\t\t\t\t\t"),s("span",{staticStyle:{color:"#60abfc","font-size":"14px"}},[i._v("(可分配"+i._s(i.distributableSize)+"GB)")])]),i._v(" "),s("p",{staticClass:"creatspace"},[i._v(i._s(i.lang.storagePool.creatSpace))]),i._v(" "),s("el-row",[s("el-col",{staticStyle:{"margin-top":"40px"},attrs:{span:12}},[1==i.gateway_init_state?s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:i.lang.storagePool.spacesize,labelWidth:i.labelWidth,prop:"diskspace",rules:[{type:"integer",validator:this.common.validateNumberRange,min:this.flagdisk,max:this.showexpGB+this.flagdisk,message:this.common.formatMsg(this.lang.storagePool.spanceabled,{min:this.flagdisk,max:this.showexpGB+this.flagdisk}),trigger:"blur,change"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],ref:"diskinput",attrs:{type:"number",width:"100%",disabled:""},on:{change:i.changespace},nativeOn:{mousewheel:function(i){i.preventDefault()}},model:{value:i.form.diskspace,callback:function(t){i.$set(i.form,"diskspace",i._n(t))},expression:"form.diskspace"}})],1)],1)],1):i._e(),i._v(" "),0==i.gateway_init_state?s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:i.lang.storagePool.spacesize,labelWidth:i.labelWidth,prop:"diskspace",rules:[{type:"integer",validator:this.common.validateNumberRange,min:1,max:this.showexpGB-10,message:this.common.formatMsg(this.lang.storagePool.spanceabled,{min:1,max:this.showexpGB-10}),trigger:"blur"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],ref:"diskinput",attrs:{type:"number",width:"100%"},on:{change:i.changespace},nativeOn:{mousewheel:function(i){i.preventDefault()}},model:{value:i.form.diskspace,callback:function(t){i.$set(i.form,"diskspace",i._n(t))},expression:"form.diskspace"}})],1)],1)],1):i._e(),i._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:i.lang.storagePool.disksnum,labelWidth:i.labelWidth,prop:"disk_num"}},[s("el-select",{attrs:{filterable:"",width:"100%"},on:{change:function(t){return i.sigledisksize(i.form.disk_num)}},model:{value:i.form.disk_num,callback:function(t){i.$set(i.form,"disk_num",i._n(t))},expression:"form.disk_num"}},i._l(i.disknum,function(i){return s("el-option",{key:i.value,attrs:{label:i.label,value:i.value,disabled:i.disabled}})}),1)],1)],1)],1),i._v(" "),0==i.gateway_init_state?s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:i.lang.storagePool.diskstructure,labelWidth:i.labelWidth,prop:"pool_type"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},on:{change:function(t){return i.changediskstructure(i.form.pool_type)}},model:{value:i.form.pool_type,callback:function(t){i.$set(i.form,"pool_type",t)},expression:"form.pool_type"}},i._l(i.diskstructure,function(i){return s("el-option",{key:i.value,attrs:{label:i.label,value:i.value,disabled:i.disabled}})}),1)],1)],1)],1):i._e(),i._v(" "),1==i.gateway_init_state?s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:i.lang.storagePool.diskstructure,labelWidth:i.labelWidth,prop:"pool_type"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%",disabled:""},on:{change:function(t){return i.changediskstructure(i.form.pool_type)}},model:{value:i.form.pool_type,callback:function(t){i.$set(i.form,"pool_type",t)},expression:"form.pool_type"}},i._l(i.diskstructure,function(i){return s("el-option",{key:i.value,attrs:{label:i.label,value:i.value,disabled:i.disabled}})}),1)],1)],1)],1):i._e(),i._v(" "),s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:i.lang.storagePool.sigledisk,labelWidth:i.labelWidth,prop:"disk_size"}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",width:"100%",disabled:""},nativeOn:{mousewheel:function(i){i.preventDefault()}},model:{value:i.form.disk_size,callback:function(t){i.$set(i.form,"disk_size",t)},expression:"form.disk_size"}})],1)],1)],1)],1),i._v(" "),s("el-col",{staticClass:"destable",attrs:{span:10}},[s("div",{staticClass:"ruletitle"},[i._v(i._s(i.lang.storagePool.zfsconfigstruct))]),i._v(" "),s("div",{staticClass:"ruledes"},[s("ul",{staticClass:"diskdistr"},[s("li",[i._v(i._s(i.lang.storagePool.diskstructure))]),i._v(" "),s("li",[i._v(i._s(i.lang.storagePool.strip))]),i._v(" "),s("li",[i._v(i._s(i.lang.storagePool.mirror))]),i._v(" "),s("li",[i._v("单重校验")]),i._v(" "),s("li",[i._v("双重校验")]),i._v(" "),s("li",[i._v("三重校验")])]),i._v(" "),s("ul",{staticClass:"diskdistr"},[s("li",[i._v(i._s(i.lang.storagePool.leastdisk))]),i._v(" "),s("li",[i._v("1")]),i._v(" "),s("li",[i._v("2")]),i._v(" "),s("li",[i._v("3")]),i._v(" "),s("li",[i._v("4")]),i._v(" "),s("li",[i._v("5")])]),i._v(" "),s("ul",{staticClass:"diskdistr"},[s("li",[i._v(i._s(i.lang.storagePool.securitymechanism))]),i._v(" "),s("li",[i._v(i._s(i.lang.storagePool.nothing))]),i._v(" "),s("li",[i._v(i._s(i.lang.storagePool.diskisbacked))]),i._v(" "),s("li",[i._v(i._s(i.lang.storagePool.redundantDisk))]),i._v(" "),s("li",[i._v(i._s(i.lang.storagePool.redundantTwodisks))]),i._v(" "),s("li",[i._v(i._s(i.lang.storagePool.redundantThreedisks))])])])])],1),i._v(" "),s("p",{staticClass:"allocationspace"},[i._v("\n\t\t\t\t\t\t\t\t"+i._s(i.lang.storagePool.allocationSpace)+"\n\t\t\t\t\t\t\t\t"),s("span",{staticStyle:{color:"#60abfc","font-size":"14px"}},[i._v("(待分配"+i._s(i.allocate)+"GB)")])]),i._v(" "),s("el-row",{staticStyle:{height:"130px",overflow:"hidden",margin:"0 auto 20px","text-align":"center","min-width":"882px","border-bottom":"1px solid #ced7e6","padding-bottom":"20px"}},[s("div",{staticClass:"fileicons"},[s("img",{attrs:{src:"/static/image/fileicon.png",alt:""}}),i._v(" "),s("p",[i._v(i._s(i.lang.storagePool.filename))])]),i._v(" "),s("div",{staticClass:"processstyle"},[s("el-progress",{staticClass:"ratios",attrs:{"text-inside":!0,"stroke-width":18,"show-text":!1,percentage:i.percentage,color:"#576cdd"}}),i._v(" "),s("p",{staticStyle:{"margin-top":"10px",color:"#c0c4cc"}},[i._v(i._s(i.lang.storagePool.fileandobjectpre))])],1),i._v(" "),s("div",{staticClass:"objecticons"},[s("img",{attrs:{src:"/static/image/objecticon.png",alt:""}}),i._v(" "),s("p",[i._v(i._s(i.lang.storagePool.objectname))])])]),i._v(" "),s("div",{staticClass:"quotabox"},[s("el-row",[s("el-col",{attrs:{span:7}},[s("el-form-item",{attrs:{label:i.lang.storagePool.fileexpspace,labelWidth:i.labelWidth,prop:"file_size",rules:[{type:"integer",validator:this.common.validateNumberRange,min:this.common.switchCapacity(this.flagfilesize,"GB",this.fileunit,0),max:this.common.switchCapacity(this.form.diskspace,this.diskspaceoption,this.fileunit,0)-this.common.switchCapacity(this.flagobjectsize,"GB",this.fileunit,0),message:this.common.formatMsg(this.lang.storagePool.filesizeRage,{min:this.common.switchCapacity(this.flagfilesize,"GB",this.fileunit,0),max:this.common.switchCapacity(this.form.diskspace,this.diskspaceoption,this.fileunit,0)-this.common.switchCapacity(this.flagobjectsize,"GB",this.fileunit,0)}),trigger:"blur"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",width:"100%"},nativeOn:{mousewheel:function(i){i.preventDefault()},keyup:function(t){return t.preventDefault(),i.changefilevalue()}},model:{value:i.form.file_size,callback:function(t){i.$set(i.form,"file_size",i._n(t))},expression:"form.file_size"}})],1)],1)],1),i._v(" "),s("el-row",[s("el-col",{attrs:{span:7}},[s("el-form-item",{attrs:{label:i.lang.storagePool.objectexpspace,labelWidth:i.labelWidth,prop:"object_size",rules:[{type:"integer",validator:this.common.validateNumberRange,min:this.common.switchCapacity(this.flagobjectsize,"GB",this.objectunit,0),max:this.common.switchCapacity(this.form.diskspace,this.diskspaceoption,this.objectunit,0),message:this.common.formatMsg(this.lang.storagePool.objectsizeRage,{min:this.common.switchCapacity(this.flagobjectsize,"GB",this.objectunit,0),max:this.common.switchCapacity(this.form.diskspace,this.diskspaceoption,this.objectunit,0)-this.common.switchCapacity(this.flagfilesize,"GB",this.objectunit,0)}),trigger:"blur"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",width:"100%"},nativeOn:{mousewheel:function(i){i.preventDefault()},keyup:function(t){return t.preventDefault(),i.changeobjectvalue(t)}},model:{value:i.form.object_size,callback:function(t){i.$set(i.form,"object_size",i._n(t))},expression:"form.object_size"}})],1)],1)],1),i._v(" "),s("el-form-item",{attrs:{labelWidth:i.labelWidth}},[s("el-button",{attrs:{type:"text"},on:{click:i.isshow}},[i._v(i._s(i.lang.storagePool.advancedOptions))]),i._v(" "),i.isShow?i._e():s("i",{staticClass:"el-icon-d-arrow-right",staticStyle:{color:"#007bff"}}),i._v(" "),i.isShow?s("i",{staticClass:"el-icon-d-arrow-right",staticStyle:{color:"#007bff",transform:"rotateZ(90deg)"}}):i._e()],1),i._v(" "),i.isShow?s("div",[s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:i.lang.storagePool.compressionLevel,labelWidth:"132px",prop:"compression"}},[s("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[s("div",{attrs:{slot:"content"},domProps:{innerHTML:i._s(i.lang.storagePool.info)},slot:"content"}),i._v(" "),s("i",{staticClass:"el-icon-question"})]),i._v(" "),s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:i.form.compression,callback:function(t){i.$set(i.form,"compression",t)},expression:"form.compression"}},i._l(i.compressionLevels,function(i){return s("el-option",{key:i.value,attrs:{label:i.label,value:i.value}})}),1)],1)],1)],1),i._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:i.lang.storagePool.zfsoprate,labelWidth:i.labelWidth,prop:"dedup"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:i.form.dedup,callback:function(t){i.$set(i.form,"dedup",t)},expression:"form.dedup"}},i._l(i.zfsdelectData,function(i){return s("el-option",{key:i.value,attrs:{label:i.label,value:i.value}})}),1)],1)],1)],1),i._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:i.lang.storagePool.copynum,labelWidth:i.labelWidth,prop:"copies"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:i.form.copies,callback:function(t){i.$set(i.form,"copies",t)},expression:"form.copies"}},i._l(i.fuben,function(i){return s("el-option",{key:i.value,attrs:{label:i.label,value:i.value}})}),1)],1)],1)],1),i._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:i.lang.storagePool.fileobjectSize,labelWidth:i.labelWidth,prop:"recordsize"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:i.form.recordsize,callback:function(t){i.$set(i.form,"recordsize",t)},expression:"form.recordsize"}},i._l(i.fileblocksize,function(i){return s("el-option",{key:i.value,attrs:{label:i.label,value:i.value}})}),1)],1)],1)],1)],1):i._e()],1),i._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:i.showfilealert,expression:"showfilealert"}],staticStyle:{color:"#f56c6c"}},[i._v("请输入文件配额和对象配额")])],1):i._e(),i._v(" "),s("el-form-item",{staticClass:"footer-btn",staticStyle:{"margin-top":"30px"}},[s("el-button",{on:{click:i.router_to_poollist}},[i._v(i._s(i.lang.common.cancel))]),i._v(" "),s("el-button",{attrs:{type:"primary",disabled:i.disabled},on:{click:function(t){return i.submitData(i.form)}}},[i._v(i._s(i.lang.common.confirm))])],1)],1),i._v(" "),s("el-col",{staticClass:"poolplate",attrs:{span:5}},[s("div",{staticClass:"plate-box"},[s("p",{staticClass:"palettitle"},[i._v(i._s(i.lang.storagePool.datapalet))]),i._v(" "),s("div",{ref:"myEchart",attrs:{id:"platechart"}})])])],1)],1)],1)],1)},staticRenderFns:[]};var o=function(i){s("IPpu"),s("HPmm")},l=s("C7Lr")(e.a,a,!1,o,"data-v-28e7e7d2",null);t.default=l.exports}});