webpackJsonp([6],{"13eb":function(e,t){},"3Nye":function(e,t,o){"use strict";var a=o("aA9S"),r=o.n(a),s={name:"pana-create-qos",props:{show:Boolean},methods:{closeModal:function(e){e=e||!1,r()(this.$data,this.$options.data.call(this)),this.$emit("closeModal",e)},initForm:function(){null!=this.$refs.form&&this.$refs.form.clearValidate()},createSafeGroup:function(){var e=this;this.disable=!0;var t=this.form;this.$refs.form.validate(function(o){o?(t=e.common.dropEmptyParameter(t),e.checkError(e.$http({url:e.api.cloud.post_security_groups,method:"post",data:t}),function(){e.$notify({title:e.lang.common.success,type:"success",message:e.lang.safeGroup.createGroupSuccess}),e.closeModal(!0)},function(){e.disable=!1})):e.disable=!1})}},data:function(){return{labelWidth:"100px",form:{name:"",description:""},rules:{name:[{required:!0,message:this.lang.safeGroup.nameRequiredRule,trigger:"blur"},{min:1,max:32,message:this.lang.safeGroup.nameLengthRule,trigger:"blur"},{validator:this.common.validateNetworkName,message:this.lang.safeGroup.nameFormatRule,trigger:"blur"}],description:[{min:1,max:80,message:this.lang.safeGroup.descriptionLengthRule,trigger:"blur"}]},groupLoading:!0,disable:!1}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.groupLoading,expression:"groupLoading"}],attrs:{title:e.lang.safeGroup.createGroup,width:"40%",visible:e.show,modal:!0},on:{open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{"label-position":"right",model:e.form,rules:e.rules}},[o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.common.name,"label-width":e.labelWidth,prop:"name"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{required:"",placeholder:e.lang.safeGroup.groupNamePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1)],1)],1),e._v(" "),o("el-row",{attrs:{type:"flex",justify:"center"}},[o("el-col",{attrs:{span:20}},[o("el-form-item",{attrs:{label:e.lang.common.description,"label-width":e.labelWidth,prop:"description"}},[o("el-col",{attrs:{span:16}},[o("el-input",{attrs:{type:"textarea",rows:3,required:"",placeholder:e.lang.safeGroup.groupDescPlaceholder},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.createSafeGroup}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var i=o("C7Lr")(s,n,!1,function(e){o("dM8T")},"data-v-0f802745",null);t.a=i.exports},"4F9u":function(e,t){},"5uZj":function(e,t,o){o("at0p"),o("f1e3"),e.exports=o("ZuHZ").Array.from},WIfE:function(e,t){},XZbo:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("zsLt"),r=o.n(a),s=o("kfHR"),n=o.n(s),i=o("rVsN"),l=o.n(i),c=o("yRx0"),u=o("Cj+A"),m=o("3Nye"),p=o("zAAO"),d={components:{"pana-info":c.a,ipInput:u.a},props:{isGpuEnough:Boolean},data:function(){var e=this;return{usedIp:[],disable:!1,advanceExpand:!1,flavor:"general",flavorExist:!0,flavorShowButton:"more",osType:"Linux",systemStructure:"x86_64",imageType:"public",activeConfig:"customConfig",availHost:0,timerObj:{},noImageCache:!1,imageIsLinux:!0,gpuLoading:!0,gpuNode:"",gpuInfo:{},mountGpu:2,tableHeight:250,is_system_admin:!0,poolDetail:{},networkDetail:{},subnetDetail:{},componentStartSource:"startCloudDisk",assignIpAddress:!1,poolId:"",groups:[],activeComponentSource:"cloud_disk",flavors:[],images:[],storagePools:[],safeGroupOptions:[],keypairNameOptions:[],availabilityZoneOptions:[],label:"",ipValidMessage:"",ipRange:"",disabledArr:"",placeholderArr:"",form:{name:"",count:1,admin_pass:"",confirm_pass:"",image_id:"",hostname:"",use_local:"cloud_disk"==this.activeComponentSource,flavor:"",os_type:"",block_device_mapping:{disk_bus:""},availability_zone:"",node:"",root_volume:{volume_type:"",volume_size:5},group_id:"",security_groups:[{id:""}],networks:[],subnetSegment:"",ip_address:"",keypair_name:""},selectedFlavor:"",customLoading:!0,rules:{name:[{required:!0,message:"请输入组件名称",trigger:"blur"},{min:1,max:64,message:"长度为1-64个字符",trigger:"blur"},{validator:this.common.validateName2,trigger:"blur"}],hostname:[{validator:this.common.validateHostname,trigger:"blur"}],admin_pass:[{validator:this.common.validatePassword,trigger:"blur"}],confirm_pass:[{validator:function(t,o,a){e.form.admin_pass&&""===o?a(new Error("请再次输入密码")):o!==e.form.admin_pass?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}],count:[{type:"integer",min:1,max:10,message:"请输入小于等于10的正整数",trigger:"change"}],subnetSegment:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],ip_address:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]},groupIsFull:!1,imageName:"",safeGroupName:"",cpuE:"",ramE:"",groupName:"",cpuLave:"",rawLave:"",gigabytes:""}},mounted:function(){var e=this;e.is_system_admin=e.common.is_system_admin(),this.poolId=this.$route.params.poolId,this.checkError(this.$http({url:this.api.cloud.get_server_groups,method:"get"}),function(t){e.groups=t.data}),this.get_flavors(),this.getGpuAvail(),this.checkError(this.$http({url:this.api.cloud.get_images_server,method:"get"}),function(t){e.images=t.data.filter(function(e){return-1===e.tags.indexOf("storage_gateway")})}),this.checkError(this.$http({url:this.api.storage.get_pools,method:"get"}),function(t){e.storagePools=t.data,e.storagePools[0]&&(e.form.root_volume.volume_type=e.storagePools[0].volumeTypeId)}),this.getSafeGroup(),this.getPoolDetail(),this.checkError(this.$http({url:this.api.cloud.get_os_availability_zone,method:"get"}),function(t){if(e.availabilityZoneOptions=t.data,e.availabilityZoneOptions=e.availabilityZoneOptions.filter(function(e){return"internal"!==e.zoneName}),e.availHost=0,e.availabilityZoneOptions.length>0){var o=e.availabilityZoneOptions[0];for(var a in o.hosts)o.hosts[a]["nova-compute"]&&o.hosts[a]["nova-compute"].available&&e.availHost++}}),this.getKeypair(),this.alarmFn()},methods:{mountGpuChange:function(){this.setNode()},gpuNodeChange:function(){this.setNode()},setNode:function(){this.form.node=this.gpuNode,this.form.availability_zone=this.availabilityZoneOptions[0].zoneName},advanceExpandChange:function(){this.advanceExpand=!this.advanceExpand},alarmFn:function(){var e=this;e.checkError(e.$http({method:"get",url:e.api.quota.get_pool_quota}),function(t){var o=t.data,a=Number(o.gigabytes_total-o.gigabytes_used);e.cpuLave=o.cpu_free,e.rawLave=Math.floor(o.memory_free/1024),e.gigabytes=a>0?a:0},function(e){})},fnChange:function(e){this.cpuE=e.vcpus,this.ramE=e.ram/1024},selectedBetterFlavor:function(e){var t,o,a=this.flavors,r=this.lang.resource.betterFlavorOptions;this.flavorExist=!1,t=r[e].cpu,o=1024*r[e].memory,this.cpuE=r[e].cpu,this.ramE=r[e].memory;for(var s=0,n=a.length;s<n;s++)if(a[s].ram===o&&a[s].vcpus===t){this.form.flavor=a[s].id,this.flavor=e,this.flavorExist=!0;break}},safeGroupOptionsFn:function(e){var t=this.safeGroupOptions.filter(function(t){return t.id==e});this.safeGroupName=t[0].name},imageFn:function(e){var t=this.images.filter(function(t){return t.id==e});this.imageName=t[0].name},sort:function(e){this.flavors=this.common.sort(e,this.flavors,["vcpus","ram"])},switchFlavor:function(e){var t=this.flavors,o=this.lang.resource.betterFlavorOptions,a="",r="";if(this.flavorExist=!0,this.flavorShowButton=e,this.flavor="","more"===e){for(var s=0,n=t.length;s<n;s++)if(this.form.flavor===t[s].id){a=t[s].vcpus,r=t[s].ram;break}for(var i in o)if(o[i].cpu===a&&1024*o[i].memory===r){this.flavor=i,this.cpuE=this.lang.resource.betterFlavorOptions[this.flavor].cpu,this.ramE=this.lang.resource.betterFlavorOptions[this.flavor].memory;break}}},groupChange:function(){this.emptyNode(),this.judgeGroupFull()},judgeGroupFull:function(){var e=this,t=this.form.count,o=this.form.group_id;if(e.groupIsFull=!1,o){var a=e.groups.filter(function(e){return e.id==o});e.groupName=a[0]?a[0].name:"",this.groups.filter(function(a){if(a.id===o)return"anti-affinity"===a.policies[0]&&(e.groupIsFull=t>e.availHost-a.members.length),!0})}},countChange:function(){var e=this.form.count;this.judgeGroupFull(),e>1&&(this.mountGpu=2,this.emptyNode())},emptyNode:function(){if(this.form.count>1&&""!==this.form.availability_zone){var e;(e=this.selectedAffinityGroup()).length>0&&"anti-affinity"===e[0].policies[0]&&(this.form.node="",this.form.availability_zone="")}},startNodeChange:function(){var e=[];this.form.count>1&&""!==this.form.node&&(e=this.selectedAffinityGroup()).length>0&&"anti-affinity"===e[0].policies[0]&&(this.form.count=1,this.$notify({duration:1e4,title:this.lang.common.info,type:"error",message:this.lang.resource.componentCountToOneInfo}))},selectedAffinityGroup:function(){var e=this;return this.groups.filter(function(t){return t.id===e.form.group_id})},getPoolDetail:function(){var e=this,t=e.common.formatMsg(this.api.cloud.get_pools_detail,{pool_id:e.poolId});this.checkError(this.$http({url:t,method:"get"}),function(t){e.poolDetail=t.data,e.getNetworkDetail(),e.getSubnetDetail()})},getNetworkDetail:function(){var e=this,t=e.common.formatMsg(this.api.cloud.get_networks_detail,{network_id:e.poolDetail.private_network_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.networkDetail=t.data,e.getUsedIp(t.data.id)})},getSubnetDetail:function(){var e=this,t=e.common.formatMsg(this.api.cloud.get_subnets_subnet_id,{subnet_id:e.poolDetail.private_subnet_id});this.checkError(this.$http({url:t,method:"get"}),function(t){if(e.subnetDetail=t.data,e.subnetDetail.hasOwnProperty("allocation_pools")&&e.subnetDetail.allocation_pools.length>0){e.form.subnetSegment=0;var o=e.subnetDetail.allocation_pools[0],a=o.start,r=o.end;e.setIp(a,r)}})},getSafeGroup:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_security_groups,method:"get"}),function(t){e.safeGroupOptions=t.data,e.safeGroupOptions.filter(function(t){"default"===t.name&&(e.form.security_groups[0].id=t.id,e.safeGroupName=t.name)})})},getKeypair:function(){var e=this;this.checkError(e.$http({url:this.api.cloud.get_keypairs,method:"get"}),function(t){e.keypairNameOptions=t.data})},subnetSegmentChange:function(){var e=this.subnetDetail.allocation_pools[this.form.subnetSegment],t=e.start,o=e.end;this.setIp(t,o)},get_flavors:function(){var e=this;this.checkError(this.$http({url:this.api.management.get_flavors,method:"get"}),function(t){e.customLoading=!1,e.flavors=t.data,e.selectedBetterFlavor(e.flavor)},function(t){e.customLoading=!1})},getGpuAvail:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.gpu_available_list,method:"get"}),function(t){e.gpuInfo=t.data.avalibal;var o=e.gpuInfo;for(var a in o){0===o[a].length&&delete o[a]}for(var r in o){e.gpuNode=r;break}e.gpuLoading=!1})},getImageCache:function(e){var t=this,o=this.form.root_volume.volume_type,a="",r=t.common.formatMsg(t.api.cloud.post_image_cache,{id:e});this.storagePools.filter(function(e){if(e.volumeTypeId===o)return a=e.name,!0}),this.checkError(this.$http({url:r,method:"post",data:{name:a}}),function(e){201603===e.code?t.noImageCache=!0:t.noImageCache=!1})},router_to_component:function(){this.$router.push({name:"resourceDashboard",params:{id:this.poolId}})},create:function(){var e=this,t={},o=e.common.deepCopyByJson(e.form);this.disable=!0,this.$refs.form.validate(function(a){if(a){""!==o.group_id&&"pleaseSelect"!==o.group_id||delete o.group_id,""!==o.keypair_name&&"pleaseSelect"!==o.keypair_name||delete o.keypair_name,1===e.mountGpu&&1===o.count&&e.gpuNode&&(e.gpuInfo.hasOwnProperty(e.gpuNode)&&(t=e.gpuInfo[e.gpuNode][0]),t.host=e.gpuNode+".node.consul",o.meta=t);var r={uuid:e.poolDetail.private_network_id,subnet_id:e.poolDetail.private_subnet_id};e.assignIpAddress&&(r.fixed_ip=o.ip_address),delete o.ip_address,delete o.subnetSegment,o.networks.push(r),o.os_type=e.getImageOsType();var s=e.common.formatMsg(e.api.cloud.get_pools_detail_servers,{pool_id:e.poolId});e.checkError(e.$http({url:s,method:"post",data:o}),function(t){e.router_to_component();var a="",r=(new Date).getTime();e.Hub.$emit("getComponentList"),t.data.forEach(function(t){a=setInterval(function(){(new Date).getTime()-r<12e4?e.getStatus(t):clearInterval(a)},3e3),e.timerObj[t]=a,e.timer.push(a)}),e.$notify({title:e.lang.common.success,type:"success",message:e.common.formatMsg(e.lang.resource.createComponentNaming,{name:o.name})})},function(){e.disable=!1})}else e.disable=!1})},getStatus:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.$http({url:o,method:"get"}).then(function(o){200303!==o.data.code&&"ACTIVE"!==o.data.data.status&&"ERROR"!==o.data.data.status||(t.Hub.$emit("getComponentList"),t.$notify({title:t.lang.common.success,type:"success",message:o.data.data.name+t.lang.resource.createComponentNameSuccess}),clearInterval(t.timerObj[e]))})},getImageOsType:function(){var e,t=this;if((e=this.images.filter(function(e){return e.id==t.form.image_id}))[0])return e[0].os_type},cpuTopo:function(e){var t="";return e["hw:cpu_sockets"]&&""!=e["hw:cpu_sockets"]&&(t=t+this.lang.resource.sockets+this.lang.resource.cpuTopoSepa1+e["hw:cpu_sockets"]+this.lang.resource.cpuTopoSepa2),e["hw:cpu_cores"]&&""!=e["hw:cpu_cores"]&&(t=t+this.lang.resource.cores+this.lang.resource.cpuTopoSepa1+e["hw:cpu_cores"]+this.lang.resource.cpuTopoSepa2),e["hw:cpu_threads"]&&""!=e["hw:cpu_threads"]&&(t=t+this.lang.resource.threads+this.lang.resource.cpuTopoSepa1+e["hw:cpu_threads"]+this.lang.resource.cpuTopoSepa2),t},setIp:function(e,t){this.ipValidMessage=this.common.formatMsg(this.lang.resource.ipRangeRule,{start:e,end:t});var o=e.split("."),a=t.split("."),r={},s="",n=[],i=[],l=!0;o.map(function(e,t){e===a[t]?(r[t]=e,s=s+e+".",n.push(t),i.push("")):(r[t]={start:e,end:a[t]},!0===l?(l=!1,i.push(o[t]+"~"+a[t])):i.push("0~255"))}),this.form.ip_address=s,this.ipRange=r,this.disabledArr=n,this.placeholderArr=i},getUsedIp:function(e){var t=this;this.checkError(this.$http({url:t.common.formatMsg(t.api.cloud.get_networks_detail_used_ips,{network_id:e}),method:"get"}),function(e){var o=[];e.data.map(function(e){o=o.concat(e.ip)}),t.usedIp=o},function(){})},validateIpUsed:function(e,t,o){this.usedIp.join(",").indexOf(t)>-1?o(Error(this.lang.outside.ipUsed)):o()},validateIp:function(e,t,o){var a=t.split("."),r=!0,s=!0;for(var n in this.ipRange)if(this.ipRange.hasOwnProperty(n)){var i=parseInt(a[parseInt(n)]);if("[object Object]"===this.ipRange[n].toString()){if(!a[parseInt(n)]){s=!1;break}if(!0===r){if(r=!1,i<this.ipRange[n].start||i>this.ipRange[n].end){s=!1;break}}else if(3===parseInt(n)){if(i<0||i>this.ipRange[n].end){s=!1;break}}else if(i<0||i>255){s=!1;break}}}!0===s?o():o(new Error(e.message))}},computed:{imageMinDisk:function(){var e=this,t="";return e.noImageCache=!1,this.images.filter(function(o){if(o.id===e.form.image_id)return e.imageIsLinux="Linux"===o.os_type,e.form.count>1&&"qcow2"===o.disk_format&&e.getImageCache(o.id),t=o.min_disk,!0}),e.form.root_volume.volume_size=t,t},imageOptions:function(){var e,t=this;return(e=this.images.filter(function(e){return("Windows"===e.os_type?"windows":e.os_type)===t.osType&&e.arch===t.systemStructure&&e.visibility===t.imageType})).length>0?(t.form.image_id=e[0].id,t.imageName=e[0].name):(t.form.image_id="",t.imageName=""),e},gpuOptionShow:{get:function(){return 1===this.mountGpu&&1===this.form.count},set:function(e){return e}},nodeOptions:function(){var e=this.form.availability_zone,t=[];return this.availabilityZoneOptions.filter(function(t){return t.zoneName==e}).forEach(function(e){for(var o in e.hosts)e.hosts[o]["nova-compute"]&&e.hosts[o]["nova-compute"].available&&t.push({name:o,value:o})}),t},storageCapacity:function(){var e=this,t=[];this.storagePools&&(t=this.storagePools.filter(function(t){return t.volumeTypeId==e.form.root_volume.volume_type}));var o=t[0]&&t[0].capabilities;if(o&&"total_capacity_gb"in o){var a=e.common.switchCapacity(o.total_capacity_gb,"GB","TB",3),r=o.total_capacity_gb-o.free_capacity_gb,s=e.common.switchCapacity(r,"GB","TB",3),n=Math.ceil(s/a),i=e.common.switchCapacity(o.max_allocated_capacity_gb,"GB","TB",3),l=e.common.switchCapacity(o.allocated_capacity_gb,"GB","TB",3);return{used:s,total:a,allocated:l,max_allocated:i,usedPercentage:n,allocatedPercentage:Math.ceil(l/i)}}},getStoragePool:function(){var e="",t=this;return this.storagePools.filter(function(o){if(t.form.root_volume.volume_type===o.volumeTypeId)return e=o.disPlayName,!0}),e}}},g={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"col",attrs:{id:"quick-create"}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.customLoading,expression:"customLoading"}],ref:"form",staticClass:"config-form",attrs:{"label-width":"100px",model:e.form,rules:e.rules}},[o("h2",[e._v(e._s(e.lang.common.generalInfo))]),e._v(" "),o("el-row",{staticStyle:{"margin-bottom":"20px"}},[o("pana-info",{directives:[{name:"show",rawName:"v-show",value:e.form.count*e.ramE>e.rawLave||e.form.count*e.cpuE>e.cpuLave,expression:"form.count*ramE > rawLave || form.count*cpuE > cpuLave"}],attrs:{content:(e.form.count*e.cpuE>e.cpuLave?e.lang.resource.quotaCpu:"")+"  "+(e.form.count*e.ramE>e.rawLave?e.lang.resource.quotaRam:""),bgStyle:"error"}})],1),e._v(" "),o("div",{attrs:{id:"general-info"}},[o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.resource.componentName,prop:"name"}},[o("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{label:e.lang.common.amount,prop:"count"}},[o("el-input-number",{attrs:{min:1,max:10},on:{change:e.countChange},model:{value:e.form.count,callback:function(t){e.$set(e.form,"count",e._n(t))},expression:"form.count"}})],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.common.password,prop:"admin_pass"}},[o("el-input",{attrs:{type:"password",placeholder:e.lang.common.passwordPlaceholder},model:{value:e.form.admin_pass,callback:function(t){e.$set(e.form,"admin_pass","string"==typeof t?t.trim():t)},expression:"form.admin_pass"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:9,offset:1}},[o("el-form-item",{attrs:{label:e.lang.resource.affinityGroup}},[o("el-select",{attrs:{filterable:"",placeholder:e.lang.resource.affinityGroupPlaceholder},on:{change:e.groupChange},model:{value:e.form.group_id,callback:function(t){e.$set(e.form,"group_id",t)},expression:"form.group_id"}},[o("el-option",{attrs:{label:e.lang.common.pleaseSelect,value:"pleaseSelect"}}),e._v(" "),e._l(e.groups,function(t){return o("el-option",{key:t.id,attrs:{label:t.name+"("+e.lang.resource.affinityRuleObj[t.policies[0]]+")",value:t.id}})})],2),e._v(" "),e.groupIsFull?o("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.groupIsFull))]):e._e()],1)],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.common.confirmPassword,prop:"confirm_pass"}},[o("el-input",{attrs:{type:"password",placeholder:e.lang.common.confirmPasswordPlaceholder},model:{value:e.form.confirm_pass,callback:function(t){e.$set(e.form,"confirm_pass","string"==typeof t?t.trim():t)},expression:"form.confirm_pass"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{label:e.lang.resource.mountGpu}},[o("el-popover",{attrs:{"popper-class":"mount-gpu tooltipWid el-col-6",placement:"bottom-start",trigger:"manual"},model:{value:e.gpuOptionShow,callback:function(t){e.gpuOptionShow=t},expression:"gpuOptionShow"}},[o("div",{staticClass:"gpu-div"},e._l(e.gpuInfo,function(t,a){return o("el-row",{key:a},[o("span",{staticClass:"gpu-node"},[e._v(e._s(a)+":")]),e._v(" "),o("el-radio",{attrs:{label:a},on:{change:e.gpuNodeChange},model:{value:e.gpuNode,callback:function(t){e.gpuNode=t},expression:"gpuNode"}},[e._v(e._s(t.length)+"个GPU")])],1)}),1),e._v(" "),o("el-tooltip",{attrs:{slot:"reference",disabled:!(!e.gpuLoading&&0===Object.keys(e.gpuInfo).length||!1===e.isGpuEnough),content:e.lang.resource.mountGpuInfo.noGpus,placement:"top"},slot:"reference"},[o("el-radio",{attrs:{disabled:e.form.count>1||0===Object.keys(e.gpuInfo).length||!1===e.isGpuEnough,label:1},on:{change:e.mountGpuChange},model:{value:e.mountGpu,callback:function(t){e.mountGpu=t},expression:"mountGpu"}},[e._v(e._s(e.lang.resource.mount))])],1)],1),e._v(" "),o("el-radio",{staticStyle:{"margin-left":"30px"},attrs:{disabled:e.form.count>1,label:2},model:{value:e.mountGpu,callback:function(t){e.mountGpu=t},expression:"mountGpu"}},[e._v(e._s(e.lang.resource.notMount))])],1)],1)],1),e._v(" "),o("h2",[e._v(e._s(e.lang.resource.selectImage))]),e._v(" "),o("el-form-item",{staticClass:"row-no-margin",attrs:{label:e.lang.resource.systemStructure}},[o("el-radio-group",{staticStyle:{"margin-bottom":"10px"},model:{value:e.systemStructure,callback:function(t){e.systemStructure=t},expression:"systemStructure"}},e._l(e.lang.resource.systemStructureOptions,function(t,a){return o("el-radio-button",{key:a,attrs:{label:t.value}},[e._v("\n                    "+e._s(t.label)+"\n                ")])}),1)],1),e._v(" "),o("el-form-item",{staticClass:"row-no-margin",attrs:{label:e.lang.resource.imageType}},[o("el-radio-group",{staticStyle:{"margin-bottom":"10px"},model:{value:e.imageType,callback:function(t){e.imageType=t},expression:"imageType"}},e._l(e.lang.resource.imageTypeOptions,function(t,a){return o("el-radio-button",{key:a,attrs:{label:a}},[e._v("\n                    "+e._s(t)+"\n                ")])}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.type,prop:"os_type"}},[o("el-col",{attrs:{span:5}},[o("el-select",{attrs:{filterable:""},model:{value:e.osType,callback:function(t){e.osType=t},expression:"osType"}},e._l(e.lang.resource.osTypeOptions,function(e,t){return o("el-option",{key:t,attrs:{label:e,value:t}})}),1)],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:10}},[o("el-select",{attrs:{filterable:"",disabled:0===e.imageOptions.length},on:{change:e.imageFn},model:{value:e.form.image_id,callback:function(t){e.$set(e.form,"image_id",t)},expression:"form.image_id"}},e._l(e.imageOptions,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),e.noImageCache?o("div",{staticClass:"el-form-item__error"},[e._v("\n                    "+e._s(e.lang.resource.imageError.noImageCache)+"\n                ")]):e._e()],1)],1),e._v(" "),o("h2",[e._v(e._s(e.lang.resource.configuration_type))]),e._v(" "),"more"===e.flavorShowButton?o("el-form-item",{staticClass:"row-no-margin",attrs:{label:e.lang.resource.betterFlavor}},e._l(e.lang.resource.betterFlavorOptions,function(t,a){return o("el-col",{key:a,attrs:{span:5}},[o("div",{staticClass:"better-flavor-item",class:{active:e.flavor===a},on:{click:function(t){return e.selectedBetterFlavor(a)}}},[o("div",{staticClass:"flavor-descp"},[e._v("\n                        "+e._s(t.descp)+"\n                    ")]),e._v(" "),o("div",{staticClass:"descp-detail"},[e._v("\n                        "+e._s(t.detail)+"\n                    ")])])])}),1):e._e(),e._v(" "),"better"===e.flavorShowButton?o("el-form-item",{staticClass:"row-no-margin",attrs:{label:e.lang.resource.selectFlavor}},[o("el-table",{ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.flavors,"max-height":e.tableHeight,"default-sort":{prop:"vcpus",order:"ascending"},"highlight-current-row":""},on:{"sort-change":e.sort}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-radio",{attrs:{label:t.row.id},on:{change:function(o){return e.fnChange(t.row)}},model:{value:e.form.flavor,callback:function(t){e.$set(e.form,"flavor",t)},expression:"form.flavor"}},[e._v(e._s(e.label)+"\n                        ")])]}}],null,!1,1782271148)}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.common.name}}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"vcpus",label:e.lang.common.cpu},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.vcpus+e.lang.resource.core)+"\n                    ")]}}],null,!1,797977248)}),e._v(" "),o("el-table-column",{attrs:{sortable:"custom",prop:"ram",label:e.lang.common.memory},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.ram/1024+e.lang.common.gb)+"\n                    ")]}}],null,!1,1344897292)}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.resource.cpuTopo},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.extra&&e.cpuTopo(t.row.extra))+"\n                    ")]}}],null,!1,3081725374)})],1)],1):e._e(),e._v(" "),o("el-form-item",{attrs:{label:""}},["more"===e.flavorShowButton?o("el-button",{attrs:{type:"text"},on:{click:function(t){return e.switchFlavor("better")}}},[e._v("\n                "+e._s(e.lang.resource.moreFlavor)+"\n            ")]):e._e(),e._v(" "),"better"===e.flavorShowButton?o("el-button",{attrs:{type:"text"},on:{click:function(t){return e.switchFlavor("more")}}},[e._v("\n                "+e._s(e.lang.resource.betterFlavor)+"\n            ")]):e._e(),e._v(" "),e.flavorExist?e._e():o("span",{staticClass:"el-form-item__error flavor-error"},[e._v(e._s(e.lang.resource.notFoundFlavor))])],1),e._v(" "),o("h2",[e._v(e._s(e.lang.resource.nicSet))]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.networkName}},[e._v("\n            "+e._s(e.networkDetail.name)+"\n        ")]),e._v(" "),o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.nav.safeGroup}},[o("el-select",{attrs:{filterable:""},on:{change:e.safeGroupOptionsFn},model:{value:e.form.security_groups[0].id,callback:function(t){e.$set(e.form.security_groups[0],"id",t)},expression:"form.security_groups[0].id"}},e._l(e.safeGroupOptions,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.subnetName}},[e._v("\n            "+e._s(e.subnetDetail.name)+"\n        ")]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.assignIpAddress}},[o("el-checkbox",{attrs:{disabled:e.form.count>1},model:{value:e.assignIpAddress,callback:function(t){e.assignIpAddress=t},expression:"assignIpAddress"}})],1),e._v(" "),e.assignIpAddress?o("div",{staticClass:"ip_address"},[o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.router.subnetSegment,prop:"subnetSegment"}},[o("el-select",{attrs:{filterable:""},on:{change:e.subnetSegmentChange},model:{value:e.form.subnetSegment,callback:function(t){e.$set(e.form,"subnetSegment",t)},expression:"form.subnetSegment"}},e._l(e.subnetDetail.hasOwnProperty("allocation_pools")&&e.subnetDetail.allocation_pools,function(t,a){return o("el-option",{key:a,attrs:{label:e.common.formatMsg(e.lang.resource.subnetSegmentLabel,{subnet:e.subnetDetail.name,start:t.start,end:t.end}),value:a}})}),1)],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.resource.ip,prop:"ip_address",rules:[{validator:this.validateIp,message:this.ipValidMessage,trigger:"blur"},{validator:this.validateIpUsed,trigger:"blur"}]}},[o("ip-input",{attrs:{disable:e.disabledArr,placeholder:e.placeholderArr},model:{value:e.form.ip_address,callback:function(t){e.$set(e.form,"ip_address",t)},expression:"form.ip_address"}})],1)],1)],1)],1):e._e(),e._v(" "),o("h2",[e._v(e._s(e.lang.resource.storageSet))]),e._v(" "),o("el-row",{staticStyle:{"margin-bottom":"20px"}},[o("pana-info",{directives:[{name:"show",rawName:"v-show",value:e.form.count*Number(e.form.root_volume.volume_size)>e.gigabytes,expression:"form.count*Number(form.root_volume.volume_size) > gigabytes"}],attrs:{content:e.lang.resource.quotaNo,bgStyle:"error"}})],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.componentStartSource}},[o("el-radio-group",{model:{value:e.componentStartSource,callback:function(t){e.componentStartSource=t},expression:"componentStartSource"}},[o("el-radio-button",{attrs:{label:"startCloudDisk"}},[e._v("云硬盘")])],1)],1),e._v(" "),o("el-row",[o("el-form-item",{staticClass:"row-no-margin",attrs:{label:e.lang.resource.storageDevice}},["startCloudDisk"===e.componentStartSource?o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{prop:"root_volume.volume_type",rules:{required:!0,message:"必填项",trigger:"change"}}},[o("el-select",{attrs:{filterable:"",placeholder:e.lang.resource.storagePlaceholder},model:{value:e.form.root_volume.volume_type,callback:function(t){e.$set(e.form.root_volume,"volume_type",t)},expression:"form.root_volume.volume_type"}},e._l(e.storagePools,function(e){return o("el-option",{key:e.volumeTypeId,attrs:{label:e.disPlayName,value:e.volumeTypeId}})}),1)],1)],1):e._e(),e._v(" "),e.form.image_id?o("div",[o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:3}},[o("el-form-item",{attrs:{prop:"root_volume.volume_size",rules:{type:"integer",min:e.imageMinDisk,max:1e3,message:e.common.formatMsg(e.lang.resource.invalid_root_volume_size,{min_disk:e.imageMinDisk}),trigger:"blur"}}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",disabled:"local"===e.componentStartSource},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.root_volume.volume_size,callback:function(t){e.$set(e.form.root_volume,"volume_size",e._n(t))},expression:"form.root_volume.volume_size"}})],1)],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:1}},[e._v("\n                        "+e._s(e.lang.common.GB)+"\n                    ")]),e._v(" "),o("el-col",{staticStyle:{color:"#8D9BB5"},attrs:{span:6}},[e._v("\n                        "+e._s(e.lang.resource.systemDiskMin)+"\n                        "),o("span",{staticStyle:{color:"#51a3ff"}},[e._v(e._s(e.imageMinDisk)+"GB")])])],1):e._e()],1)],1),e._v(" "),o("el-row",[e.storageCapacity?o("el-form-item",{staticClass:"label-color",attrs:{label:""}},[e._v("\n                "+e._s(e.lang.resource.storageCapacity)+"\n                "),o("el-row",{staticClass:"progress-row"},[o("el-col",{attrs:{span:9}},[o("el-progress",{attrs:{"stroke-width":18,percentage:e.storageCapacity.usedPercentage,"show-text":!1}})],1),e._v(" "),o("el-col",{staticClass:"el-progress__text label-color",attrs:{span:6}},[e._v("\n                        已使用"),o("span",{staticClass:"storage-text"},[e._v(e._s(e.storageCapacity.used)+"/"+e._s(e.storageCapacity.total))])])],1),e._v(" "),o("el-row",{staticClass:"progress-row"},[o("el-col",{attrs:{span:9}},[o("el-progress",{attrs:{"stroke-width":18,percentage:e.storageCapacity.allocatedPercentage,"show-text":!1,status:"exception"}})],1),e._v(" "),o("el-col",{staticClass:"el-progress__text label-color",attrs:{span:6}},[e._v("\n                        已分配"),o("span",{staticClass:"storage-text"},[e._v(e._s(e.storageCapacity.allocated)+"/"+e._s(e.storageCapacity.max_allocated))])])],1)],1):e._e()],1),e._v(" "),o("h2",{class:{"cloud-expand-icon":e.advanceExpand},staticStyle:{cursor:"pointer"},on:{click:e.advanceExpandChange}},[e._v("\n            "+e._s(e.lang.resource.advanceOption)+"\n            "),o("i",{staticClass:"el-icon-arrow-right",attrs:{"aria-hidden":"true"}})]),e._v(" "),e.advanceExpand?o("div",[o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.resource.hostname,prop:"hostname"}},[o("el-input",{attrs:{placeholder:e.lang.common.input+e.lang.resource.hostname},model:{value:e.form.hostname,callback:function(t){e.$set(e.form,"hostname","string"==typeof t?t.trim():t)},expression:"form.hostname"}})],1)],1)],1),e._v(" "),e.imageIsLinux?o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.resource.keypair_name}},[o("el-select",{attrs:{filterable:"",placeholder:e.lang.resource.keypairPlaceholder},model:{value:e.form.keypair_name,callback:function(t){e.$set(e.form,"keypair_name",t)},expression:"form.keypair_name"}},[o("el-option",{attrs:{label:e.lang.resource.keypairPlaceholder,value:""}}),e._v(" "),e._l(e.keypairNameOptions,function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})],2)],1)],1)],1):e._e(),e._v(" "),e.is_system_admin?o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.resource.startRegion}},[o("el-select",{attrs:{filterable:"",disabled:1===e.mountGpu},on:{change:function(t){e.form.node=""}},model:{value:e.form.availability_zone,callback:function(t){e.$set(e.form,"availability_zone",t)},expression:"form.availability_zone"}},[o("el-option",{key:Date.now(),attrs:{label:e.lang.resource.systemScheduling,value:""}}),e._v(" "),e._l(e.availabilityZoneOptions,function(e){return o("el-option",{key:e.zoneName,attrs:{label:e.zoneName,value:e.zoneName}})})],2)],1)],1)],1):e._e(),e._v(" "),e.is_system_admin?o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.resource.startNode}},[o("el-select",{attrs:{filterable:"",disabled:1===e.mountGpu},on:{change:e.startNodeChange},model:{value:e.form.node,callback:function(t){e.$set(e.form,"node",t)},expression:"form.node"}},[o("el-option",{key:Date.now(),attrs:{label:e.lang.resource.systemScheduling,value:""}}),e._v(" "),e._l(e.nodeOptions,function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.value}})})],2)],1)],1)],1):e._e()],1):e._e(),e._v(" "),o("el-row",[o("el-form-item",{staticClass:"footer-btn",attrs:{label:""}},[o("el-button",{staticStyle:{"border-color":"#409EFF"},attrs:{disabled:e.disable},on:{click:e.router_to_component}},[e._v("\n                    "+e._s(e.lang.common.cancel)+"\n                ")]),e._v(" "),o("el-button",{attrs:{type:"primary",disabled:!e.form.image_id||e.noImageCache||!e.flavorExist||e.groupIsFull||e.disable},on:{click:e.create}},[e._v("\n                    "+e._s(e.lang.resource.confirm)+"\n                ")])],1)],1)],1),e._v(" "),o("el-card",{staticClass:"box-card",staticStyle:{width:"18%",position:"fixed",right:"20px",top:"250px","z-index":"1"}},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[e._v(e._s(e.lang.resource.quotaDetails))])]),e._v(" "),o("div",{staticStyle:{padding:"15px 5px"}},[o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.cloudComponentName)+"：")]),e._v(" "),o("span",{class:e.form.name||"card-gray"},[e._v(e._s(e.form.name||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.num)+"：")]),e._v(" "),o("span",{class:e.form.count||"card-gray"},[e._v(e._s(e.form.count||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.affinityGroup)+"：")]),e._v(" "),o("span",{class:e.groupName||"card-gray"},[e._v(e._s(e.groupName||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v("CPU：")]),e._v(" "),o("span",{class:e.cpuE||"card-gray"},[e._v(e._s(e.cpuE?e.form.count*e.cpuE+"核/剩余"+e.cpuLave+"核":e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.ram)+"：")]),e._v(" "),o("span",{class:e.ramE||"card-gray"},[e._v(e._s(e.ramE?e.form.count*e.ramE+"GB/剩余"+e.rawLave+"GB":e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.imageName)+"：")]),e._v(" "),o("span",{class:e.imageName||"card-gray"},[e._v(e._s(e.imageName||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.systemDiskC)+"：")]),e._v(" "),o("span",{class:e.form.root_volume.volume_size||"card-gray"},[e._v(e._s(e.form.root_volume.volume_size?e.form.count*e.form.root_volume.volume_size+"GB":e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.ipAddress)+"：")]),e._v(" "),o("span",{class:e.assignIpAddress||"card-gray"},[e._v(e._s(e.assignIpAddress?e.form.ip_address:e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.keypair_name)+"：")]),e._v(" "),o("span",{class:e.form.keypair_name||"card-gray"},[e._v(e._s(e.form.keypair_name||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.safeGroup)+"：")]),e._v(" "),o("span",{class:e.safeGroupName||"card-gray"},[e._v(e._s(e.safeGroupName||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.startRegion)+"：")]),e._v(" "),o("span",{class:e.form.availability_zone||"card-gray"},[e._v(e._s(e.form.availability_zone||e.lang.resource.noSelect))])])])])],1)},staticRenderFns:[]};var v=o("C7Lr")(d,g,!1,function(e){o("13eb"),o("dfFt")},"data-v-27bbc050",null).exports,_={name:"createComponent",components:{"pana-info":c.a,ipInput:u.a,panaCreateGroup:m.a,panaCreateKeypair:p.a,quickCreate:v},data:function(){var e=this;return{usedIp:[],poolStorageQuota:0,customLoading:!0,activeConfig:"customConfig",availHost:0,timerObj:{},noImageCache:!1,imageIsLinux:!0,gpuLoading:!0,gpuNode:"",gpuInfo:{},mountGpu:2,tableHeight:250,snapshots:[],snapshot_id:"",is_system_admin:!0,poolDetail:{},networkDetail:{},subnetDetail:{},componentStartSource:"startCloudDisk",image_min_disk:0,showCreateGroup:!1,showCreateKeypair:!1,addFlavorForm:{name:"",vcpus:1,ram:1,is_public:!0,disk:0,ram_max:2,vcpus_max:2},diskSizeArray:[],diskSize:"",addFlavor:!1,serverVolumes:[],diskList:[],volume_id:"",image_id:"",operateValue:"",network:[],assignIpAddress:!1,poolId:"",groups:[],activeComponentSource:"cloud_disk",flavors:[],source:"image",images:[],storagePools:[],safeGroupOptions:[],keypairNameOptions:[],availabilityZoneOptions:[],label:"",ipValidMessage:"",ipRange:"",disabledArr:"",placeholderArr:"",createComponentForm:{name:"",count:1,admin_pass:"",confirm_pass:"",hostname:"",use_local:"cloud_disk"===this.activeComponentSource,flavor:"",os_type:"",block_device_mapping:{disk_bus:""},availability_zone:"",node:"",data_volumes:[],root_volume:{volume_type:"",volume_size:5},group_id:"",security_groups:[{id:""}],networks:[],subnetSegment:"",ip_address:"",keypair_name:""},active:1,lastStep:4,selectedCpu:1,selectedMemory:2,cpuOptions:[],selectedFlavor:"",rules:{name:[{required:!0,message:"请输入组件名称",trigger:"blur"},{min:1,max:64,message:"长度为1-64个字符",trigger:"blur"},{validator:this.common.validateName2,trigger:"blur"}],hostname:[{validator:this.common.validateHostname,trigger:"blur"}],admin_pass:[{validator:this.common.validatePassword,trigger:"blur"}],confirm_pass:[{validator:function(t,o,a){e.createComponentForm.admin_pass&&""===o?a(new Error("请再次输入密码")):o!==e.createComponentForm.admin_pass?a(new Error("两次输入密码不一致")):a()},trigger:"blur"}],count:[{type:"integer",min:1,max:10,message:"请输入小于等于10的正整数",trigger:"change"}],subnetSegment:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}],ip_address:[{required:!0,message:this.lang.resource.required_item,trigger:"change"}]},flavorsRule:{name:[{required:!0,message:"请输入规格名称",trigger:"blur"},{min:1,max:32,message:"长度为1-32个字符",trigger:"blur"}],vcpus:[{validator:this.common.validateCpu,trigger:"blur"}],ram:[{type:"integer",min:1,max:4e3,message:"请输入1-4000的整数",trigger:"blur"}]},createTag:!1,groupIsFull:!1,selectSource:{image:"镜像",snapShot:"快照",cloudDisk:"云硬盘"},imageName:"",snapShotName:"",cloudDiskName:"",safeGroupName:"",groupName:"",cpuLave:"",rawLave:"",gigabytes:"",isGpuQuotaEnough:!1}},mounted:function(){var e=this;e.is_system_admin=e.common.is_system_admin(),this.poolId=this.$route.params.poolId,this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var o=t.event_type.split(".");"compute"===o[0]&&"error"===o[3]&&e.Hub.$emit("getComponentList")}}),this.checkError(this.$http({url:this.api.cloud.get_server_groups,method:"get"}),function(t){e.groups=t.data}),l.a.all([e.alarmFn(),e.get_flavors()]).then(function(){e.customLoading=!1}).catch(function(){e.customLoading=!1}),this.getGpuAvail(),this.getStoragePoolFree(),this.checkGpuQuota(),this.checkError(this.$http({url:this.api.cloud.get_images_server,method:"get"}),function(t){e.images=t.data.filter(function(e){return-1===e.tags.indexOf("storage_gateway")&&""!==e.os_distro&&"unknown"!==e.os_distro.toLowerCase()&&""!==e.arch})}),this.checkError(this.$http({url:this.api.storage.get_sever_volumes,method:"get"}),function(t){e.serverVolumes=t.data,e.serverVolumes.length>0&&(e.volume_id=e.serverVolumes[0].id)}),this.checkError(this.$http({url:this.api.storage.get_pools,method:"get"}),function(t){e.storagePools=t.data,e.storagePools[0]&&(e.createComponentForm.root_volume.volume_type=e.storagePools[0].volumeTypeId)}),this.checkError(this.$http({url:this.api.storage.get_volumes,method:"get"}),function(t){e.diskList=t.data.data_disks,e.diskSize=e.diskList&&e.diskList[0].size}),this.getSafeGroup(),this.getPoolDetail(),this.checkError(this.$http({url:this.api.cloud.get_os_availability_zone,method:"get"}),function(t){if(e.availabilityZoneOptions=t.data,e.availabilityZoneOptions=e.availabilityZoneOptions.filter(function(e){return"internal"!==e.zoneName}),e.availHost=0,e.availabilityZoneOptions.length>0){var o=e.availabilityZoneOptions[0];for(var a in o.hosts)o.hosts[a]["nova-compute"]&&o.hosts[a]["nova-compute"].available&&e.availHost++}}),this.getKeypair(),this.getSnapshot()},methods:{groupChange:function(){this.judgeGroupFull()},judgeGroupFull:function(){var e=this,t=this.createComponentForm.count,o=this.createComponentForm.group_id;if(e.groupIsFull=!1,o){var a=e.groups.filter(function(e){return e.id==o});e.groupName=a[0]?a[0].name:"",this.groups.filter(function(a){if(a.id===o)return"anti-affinity"===a.policies[0]&&(e.groupIsFull=t>e.availHost-a.members.length),!0})}},alarmFn:function(){var e=this;return new l.a(function(t,o){e.checkError(e.$http({method:"get",url:e.api.quota.get_pool_quota}),function(o){var a=o.data,r=Number(a.gigabytes_total-a.gigabytes_used);e.cpuLave=a.cpu_free,e.rawLave=Math.floor(a.memory_free/1024),e.gigabytes=r>0?r:0,t(o.data)},function(e){o()})})},safeGroupOptionsFn:function(e){var t=this.safeGroupOptions.filter(function(t){return t.id==e});this.safeGroupName=t[0].name},countChange:function(){var e=this.createComponentForm.count;this.judgeGroupFull(),e>1&&(this.mountGpu=2)},startNodeChange:function(){var e=[];this.createComponentForm.count>1&&""!==this.createComponentForm.node&&(e=this.selectedAffinityGroup()).length>0&&"anti-affinity"===e[0].policies[0]&&(this.createComponentForm.count=1,this.$notify({duration:1e4,title:this.lang.common.info,type:"error",message:this.lang.resource.componentCountToOneInfo}))},selectedAffinityGroup:function(){var e=this;return this.groups.filter(function(t){return t.id===e.createComponentForm.group_id})},getSnapshot:function(){var e=this;this.checkError(this.$http({url:this.api.storage.getSnapshot,method:"get"}),function(t){e.snapshots=t.data.sys_disks,e.snapshots=e.snapshots.filter(function(e){return"available"===e.status&&"智能存储引擎"!=e.name}),e.snapshots.length>0&&(e.snapshot_id=e.snapshots[0].id)})},getPoolDetail:function(){var e=this,t=e.common.formatMsg(this.api.cloud.get_pools_detail,{pool_id:e.poolId});this.checkError(this.$http({url:t,method:"get"}),function(t){e.poolDetail=t.data,e.getNetworkDetail(),e.getSubnetDetail()})},getNetworkDetail:function(){var e=this,t=e.common.formatMsg(this.api.cloud.get_networks_detail,{network_id:e.poolDetail.private_network_id});this.checkError(this.$http({url:t,method:"get"}),function(t){e.networkDetail=t.data,e.getUsedIp(t.data.id)})},getSubnetDetail:function(){var e=this,t=e.common.formatMsg(this.api.cloud.get_subnets_subnet_id,{subnet_id:e.poolDetail.private_subnet_id});this.checkError(this.$http({url:t,method:"get"}),function(t){if(e.subnetDetail=t.data,e.subnetDetail.hasOwnProperty("allocation_pools")&&e.subnetDetail.allocation_pools.length>0){e.createComponentForm.subnetSegment=0;var o=e.subnetDetail.allocation_pools[0],a=o.start,r=o.end;e.setIp(a,r)}})},getSafeGroup:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_security_groups,method:"get"}),function(t){e.safeGroupOptions=t.data,e.safeGroupOptions.filter(function(t){"default"===t.name&&(e.createComponentForm.security_groups[0].id=t.id,e.safeGroupName=t.name)})})},getKeypair:function(){var e=this;this.checkError(e.$http({url:this.api.cloud.get_keypairs,method:"get"}),function(t){e.keypairNameOptions=t.data})},closeCreateGroup:function(e){!0===e&&this.getSafeGroup(),this.showCreateGroup=!1},closeCreateKeypair:function(e){e&&this.getKeypair(),this.showCreateKeypair=!1},subnetSegmentChange:function(){var e=this.subnetDetail.allocation_pools[this.createComponentForm.subnetSegment],t=e.start,o=e.end;this.setIp(t,o)},tabChange:function(){this.image_min_disk=0,"cloudDisk"===this.source?(this.serverVolumes.length>0&&(this.volume_id=this.serverVolumes[0].id,this.cloudDiskName=this.serverVolumes[0].name),this.createComponentForm.root_volume.volume_size=this.serverVolumes[0]&&this.serverVolumes[0].size):"image"===this.source?(this.image_id=this.images[0]&&this.images[0].id,this.imageName=this.images[0]&&this.images[0].name,this.createComponentForm.root_volume.volume_size=this.images[0]&&this.images[0].min_disk,this.image_min_disk=this.images[0]&&this.images[0].min_disk):(this.snapshots.length>0&&(this.snapshot_id=this.snapshots[0].id,this.snapShotName=this.snapshots[0].name),this.createComponentForm.root_volume.volume_size=this.snapshots[0]&&this.snapshots[0].size)},componentStartChange:function(){"local"===this.componentStartSource&&(this.source="image",this.imageChange(this.image_id))},get_flavors:function(e){var t=this;return new l.a(function(o,a){t.checkError(t.$http({url:t.api.management.get_flavors,method:"get"}),function(a){t.flavors=a.data,t.flavors.forEach(function(e){t.cpuOptions.push(e.vcpus)}),t.cpuOptions=n()(new r.a(t.cpuOptions)).sort(t.common.sortNumber),null==e?t.selectedCpu=t.cpuOptions[0]:e(),o(a.data)},function(){a()})})},getGpuAvail:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.gpu_available_list,method:"get"}),function(t){e.gpuInfo=t.data.avalibal;var o=e.gpuInfo;for(var a in o){0===o[a].length&&delete o[a]}for(var r in o){e.gpuNode=r;break}e.gpuLoading=!1})},getStoragePoolFree:function(){var e=this;this.checkError(this.$http({url:this.api.storage.get_pool_free,method:"get"}),function(t){e.poolStorageQuota=t.data.free})},addFlavorShow:function(){this.$refs.addFlavorForm&&this.$refs.addFlavorForm.resetFields(),this.addFlavor=!0},createFlavor:function(e){var t=this,o=this;this.$refs[e].validate(function(e){if(!e)return!1;t.addFlavor=!1,t.addFlavorForm.ram=1024*t.addFlavorForm.ram,t.addFlavorForm.ram_max=2*t.addFlavorForm.ram,t.addFlavorForm.vcpus_max=2*t.addFlavorForm.vcpus,t.checkError(t.$http({url:t.api.management.get_flavors,method:"post",data:t.addFlavorForm}),function(e){o.get_flavors(function(){o.createComponentForm.flavor=e.data.id,o.selectCpuCore(e.data.vcpus),o.selectMemory(e.data.ram)}),o.$notify({title:o.lang.common.success,type:"success",message:o.lang.resource.createFlavorSuccess})})})},cloudDiskChange:function(e){var t;(t=this.serverVolumes.filter(function(t){return t.id===e})).length>0&&(this.cloudDiskName=t[0].name),this.createComponentForm.root_volume.volume_size=t[0]&&t[0].size},snapshotChange:function(e){var t;(t=this.snapshots.filter(function(t){return t.id===e})).length>0&&(this.snapShotName=t[0].name),this.createComponentForm.root_volume.volume_size=t[0]&&t[0].size},imageChange:function(e){var t;this.noImageCache=!1,(t=this.images.filter(function(t){return t.id===e})).length>0&&(this.imageName=t[0].name,this.createComponentForm.count>1&&"qcow2"===t[0].disk_format&&this.getImageCache(e),this.imageIsLinux="Linux"===t[0].os_type,this.createComponentForm.root_volume.volume_size=t[0]&&t[0].min_disk,this.image_min_disk=t[0]&&t[0].min_disk)},getImageCache:function(e){var t=this,o=this.createComponentForm.root_volume.volume_type,a="",r=t.common.formatMsg(t.api.cloud.post_image_cache,{id:e});this.storagePools.filter(function(e){if(e.volumeTypeId===o)return a=e.name,!0}),this.checkError(this.$http({url:r,method:"post",data:{name:a}}),function(e){t.noImageCache=201603===e.code})},router_to_component:function(){this.$router.push({name:"resourceDashboard",params:{id:this.poolId}})},create:function(){this.createTag=!0;var e=this,t={},o=e.common.deepCopyByJson(e.createComponentForm);""!==o.group_id&&"pleaseSelect"!==o.group_id||delete o.group_id,1===this.mountGpu&&1===o.count&&this.gpuNode&&(this.gpuInfo.hasOwnProperty(this.gpuNode)&&(t=this.gpuInfo[this.gpuNode][0]),t.host=this.gpuNode+".node.consul",o.meta=t);var a={uuid:this.poolDetail.private_network_id,subnet_id:this.poolDetail.private_subnet_id};switch(this.assignIpAddress&&(a.fixed_ip=o.ip_address),delete o.ip_address,delete o.subnetSegment,o.networks.push(a),o.os_type=this.getImageOsType(),this.source){case"image":o.image_id=e.image_id;break;case"cloudDisk":o.volumeId=e.volume_id;break;case"snapShot":o.snapshot_id=e.snapshot_id}o.data_volumes.forEach(function(e){delete e.key,"selectCurrentDataDisk"===e.volume_type?(delete e.volume_type,delete e.volume_size):delete e.volume_id});var r=this.common.formatMsg(this.api.cloud.get_pools_detail_servers,{pool_id:e.poolId});this.checkError(this.$http({url:r,method:"post",data:o}),function(t){e.router_to_component();var a="",r=(new Date).getTime();e.Hub.$emit("getComponentList"),t.data.forEach(function(t){a=setInterval(function(){(new Date).getTime()-r<12e4?e.getStatus(t):clearInterval(a)},3e3),e.timerObj[t]=a,e.timer.push(a)}),e.$notify({title:e.lang.common.success,type:"success",message:e.common.formatMsg(e.lang.resource.createComponentNaming,{name:o.name})})},function(){e.createTag=!1})},getStatus:function(e){var t=this,o=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.$http({url:o,method:"get"}).then(function(o){200303!==o.data.code&&"ACTIVE"!==o.data.data.status&&"ERROR"!==o.data.data.status||(t.Hub.$emit("getComponentList"),t.$notify({title:t.lang.common.success,type:"success",message:o.data.data.name+t.lang.resource.createComponentNameSuccess}),clearInterval(t.timerObj[e]))})},getImageOsType:function(){var e,t=this;if((e=this.images.filter(function(e){return e.id===t.image_id}))[0])return e[0].os_type},id2name:function(e,t){var o;return(o=t.filter(function(t){return t.id===e}))[0]&&o[0].name},addStorage:function(){this.createComponentForm.data_volumes.length<5&&this.createComponentForm.data_volumes.push({volume_type:this.storagePools[0]&&this.storagePools[0].volumeTypeId,volume_size:1,volume_id:this.diskList[0]&&this.diskList[0].id,key:Date.now()})},removeStorage:function(e){var t=this.createComponentForm.data_volumes.indexOf(e);-1!==t&&(this.createComponentForm.data_volumes.splice(t,1),this.diskSizeArray.splice(t,1))},next:function(e){var t=this;this.$refs[e].validate(function(e){var o=!1;if(1===t.active&&(t.createComponentForm.count*t.selectedMemory/1024>t.rawLave||t.createComponentForm.count*t.selectedCpu>t.cpuLave))return!1;if(2===t.active&&t.createComponentForm.count*(Number(t.createComponentForm.root_volume.volume_size)+Number(t.dataDiskSum()))>t.gigabytes)return!1;if(!e)return!1;if(t.active++>3&&(t.active=3),2===t.active&&(t.image_id=t.images[0]&&t.images[0].id,t.imageChange(t.image_id),t.createComponentForm.count>1&&(t.createComponentForm.data_volumes.filter(function(e){if("selectCurrentDataDisk"===e.volume_type)return o=!0,!0}),o&&(t.createComponentForm.data_volumes=[]))),3===t.active){1===t.mountGpu&&(t.createComponentForm.node=t.gpuNode,t.createComponentForm.availability_zone=t.availabilityZoneOptions[0].zoneName);var a=[];t.createComponentForm.count>1&&""!==t.createComponentForm.node&&(a=t.selectedAffinityGroup()).length>0&&"anti-affinity"===a[0].policies[0]&&(t.createComponentForm.node="",t.createComponentForm.availability_zone="")}})},prev:function(){this.active--<1&&(this.active=1)},selectCpuCore:function(e){this.selectedCpu=e},selectMemory:function(e){this.selectedMemory=e},cpuTopo:function(e){var t="";return e.sockets&&""!==e.sockets&&(t=t+this.lang.resource.sockets+this.lang.resource.cpuTopoSepa1+e.sockets+this.lang.resource.cpuTopoSepa2),e.cores&&""!==e.cores&&(t=t+this.lang.resource.cores+this.lang.resource.cpuTopoSepa1+e.cores+this.lang.resource.cpuTopoSepa2),e.threads&&""!==e.threads&&(t=t+this.lang.resource.threads+this.lang.resource.cpuTopoSepa1+e.threads+this.lang.resource.cpuTopoSepa2),""!==t&&t},selectedDiskSize:function(e){var t,o=this.createComponentForm.data_volumes[e].volume_id;t=this.diskList.filter(function(e){return e.id===o}),this.diskSizeArray[e]=t[0]&&t[0].size},dataDiskSum:function(){var e=0,t=this;return this.createComponentForm.data_volumes.forEach(function(o,a){if("selectCurrentDataDisk"===o.volume_type){var r=t.diskSizeArray[a]?t.diskSizeArray[a]:t.diskSize;e+=parseInt(r)}else e+=parseInt(o.volume_size)}),e},setIp:function(e,t){this.ipValidMessage=this.common.formatMsg(this.lang.resource.ipRangeRule,{start:e,end:t});var o=e.split("."),a=t.split("."),r={},s="",n=[],i=[],l=!0;o.map(function(e,t){e===a[t]?(r[t]=e,s=s+e+".",n.push(t),i.push("")):(r[t]={start:e,end:a[t]},!0===l?(l=!1,i.push(o[t]+"~"+a[t])):i.push("0~255"))}),this.createComponentForm.ip_address=s,this.ipRange=r,this.disabledArr=n,this.placeholderArr=i},getUsedIp:function(e){var t=this;this.checkError(this.$http({url:t.common.formatMsg(t.api.cloud.get_networks_detail_used_ips,{network_id:e}),method:"get"}),function(e){var o=[];e.data.map(function(e){o=o.concat(e.ip)}),t.usedIp=o},function(){})},validateIpUsed:function(e,t,o){this.usedIp.join(",").indexOf(t)>-1?o(Error(this.lang.outside.ipUsed)):o()},validateIp:function(e,t,o){var a=t.split("."),r=!0,s=!0;for(var n in this.ipRange)if(this.ipRange.hasOwnProperty(n)){var i=parseInt(a[parseInt(n)]);if("[object Object]"===this.ipRange[n].toString()){if(!a[parseInt(n)]){s=!1;break}if(!0===r){if(r=!1,i<this.ipRange[n].start||i>this.ipRange[n].end){s=!1;break}}else if(3===parseInt(n)){if(i<0||i>this.ipRange[n].end){s=!1;break}}else if(i<0||i>255){s=!1;break}}}!0===s?o():o(new Error(e.message))},checkGpuQuota:function(){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.cloud.get_gpu_pool_detail_check,{id:this.poolId}),method:"get"}),function(t){e.isGpuQuotaEnough=!(null===t.data||0===t.data)})}},computed:{poolStorageQuotaCompute:function(){if(this.poolStorageQuota){var e=0,t=this.createComponentForm.data_volumes.length;return this.createComponentForm.data_volumes.forEach(function(o,a){a<t-1&&"selectCurrentDataDisk"!==o.volume_type&&(e+=parseInt(o.volume_size))}),this.poolStorageQuota-e}return 0},gpuOptionShow:{get:function(){return 1===this.active&&1===this.mountGpu&&1===this.createComponentForm.count},set:function(e){return e}},startSourceErrorShow:function(){switch(this.source){case"image":return 0===this.images.length?(this.lang.resource.componentStartSourceError.image=this.lang.resource.imageError.noImage,!0):!!this.noImageCache&&(this.lang.resource.componentStartSourceError.image=this.lang.resource.imageError.noImageCache,!0);case"cloudDisk":return 0===this.serverVolumes.length;case"snapShot":return 0===this.snapshots.length}},nodeOptions:function(){var e=this.createComponentForm.availability_zone,t=[];return this.availabilityZoneOptions.filter(function(t){return t.zoneName===e}).forEach(function(e){for(var o in e.hosts)e.hosts[o]["nova-compute"]&&e.hosts[o]["nova-compute"].available&&t.push({name:o,value:o})}),t},storageCapacity:function(){var e=this,t=[];this.storagePools&&(t=this.storagePools.filter(function(t){return t.volumeTypeId===e.createComponentForm.root_volume.volume_type}));var o=t[0]&&t[0].capabilities;if(o&&"total_capacity_gb"in o){var a=e.common.switchCapacity(o.total_capacity_gb,"GB","TB",3),r=o.total_capacity_gb-o.free_capacity_gb,s=e.common.switchCapacity(r,"GB","TB",3),n=this.common.formatMsg(this.lang.resource.storageUsed,{used:s,total:a}),i=Math.ceil(s/a),l=e.common.switchCapacity(o.max_allocated_capacity_gb,"GB","TB",3),c=e.common.switchCapacity(o.allocated_capacity_gb,"GB","TB",3);return{usedText:n,usedPercentage:i,allocatedText:this.common.formatMsg(this.lang.resource.storageAllocated,{allocated:c,max_allocated:l}),allocatedPercentage:Math.ceil(c/l*100)}}},filterFlavors:function(){var e,t=this;return e=this.flavors.filter(function(e){return e.vcpus===t.selectedCpu&&e.ram===t.selectedMemory}),t.createComponentForm.flavor=e[0]&&e[0].id,e},memoryOptions:function(){var e=this,t=[];return this.flavors&&this.flavors.forEach(function(o){e.selectedCpu===o.vcpus&&t.push(o.ram)}),t=n()(new r.a(t)).sort(e.common.sortNumber),e.selectedMemory=t[0],t},safeGroup:function(){return this.id2name(this.createComponentForm.security_groups[0].id,this.safeGroupOptions)},configuration:function(){var e,t=this;if((e=this.filterFlavors.filter(function(e){return e.id===t.createComponentForm.flavor}))[0])return e[0].name+this.lang.resource.configSepa+e[0].vcpus+this.lang.resource.core+this.lang.common.cpu+this.lang.resource.configSepa+this.common.switchCapacity(e[0].ram,"MB","GB",3)+this.lang.common.GB+this.lang.common.memory},getStoragePool:function(){var e="",t=this;return this.storagePools.filter(function(o){if(t.createComponentForm.root_volume.volume_type===o.volumeTypeId)return e=o.disPlayName,!0}),e},selectedSource:function(){var e={label:"",name:""};switch(this.source){case"image":e.name=this.id2name(this.image_id,this.images),e.label=this.lang.resource.imageName;break;case"cloudDisk":e.name=this.id2name(this.volume_id,this.serverVolumes),e.label=this.lang.resource.cloudDiskName;break;case"snapShot":e.name=this.id2name(this.snapshot_id,this.snapshots),e.label=this.lang.resource.snapshotName}return e},cloudDiskDisable:function(){return"local"===this.componentStartSource||this.createComponentForm.count>1}}},f={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"col",attrs:{id:"component-create"}},[o("el-main",[o("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right",type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:18}},[o("el-breadcrumb-item",{attrs:{to:{path:"/cloudCenter/resource"}}},[e._v(e._s(e.lang.resource.resourceManage)+"\n                    ")]),e._v(" "),o("el-breadcrumb-item",[o("span",{staticClass:"el-breadcrumb__inner is-link",on:{click:e.router_to_component}},[e._v("\n                        "+e._s(e.lang.resource.resourcePoolDash)+"\n                    ")])]),e._v(" "),o("el-breadcrumb-item",[e._v(e._s(e.lang.resource.createComponent))])],1),e._v(" "),o("el-col",{attrs:{span:6}},[o("el-row",{attrs:{type:"flex",justify:"end"}},[o("span",{staticClass:"el-breadcrumb__inner is-link",staticStyle:{"text-align":"right"},on:{click:e.router_to_component}},[e._v("\n                        "+e._s(e.lang.common.back)+"\n                    ")])])],1)],1),e._v(" "),o("el-tabs",{model:{value:e.activeConfig,callback:function(t){e.activeConfig=t},expression:"activeConfig"}},[o("el-tab-pane",{attrs:{label:e.lang.resource.customConfig,name:"customConfig"}},[o("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.customLoading,expression:"customLoading"}],staticClass:"config-form",attrs:{"label-width":"100px",id:"custom-config-form"}},[o("el-steps",{attrs:{active:e.active}},[o("el-step",{attrs:{title:e.lang.common.generalInfo}}),e._v(" "),o("el-step",{attrs:{title:e.lang.resource.selectPool}}),e._v(" "),o("el-step",{attrs:{title:e.lang.resource.selectNetwork}}),e._v(" "),o("el-step",{attrs:{title:e.lang.resource.confirmInfo}})],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:1==e.active,expression:"active==1"}],staticStyle:{width:"85%"},attrs:{id:"generalInfo"}},[o("el-form",{ref:"createComponentForm1",attrs:{model:e.createComponentForm,rules:e.rules,"label-width":"100px"}},[o("section",{attrs:{id:"section1"}},[o("el-row",{staticStyle:{"margin-bottom":"20px"}},[o("pana-info",{directives:[{name:"show",rawName:"v-show",value:e.createComponentForm.count*e.selectedMemory/1024>e.rawLave||e.createComponentForm.count*e.selectedCpu>e.cpuLave,expression:"createComponentForm.count*selectedMemory/1024 > rawLave || createComponentForm.count*selectedCpu > cpuLave"}],attrs:{content:(e.createComponentForm.count*e.selectedCpu>e.cpuLave?e.lang.resource.quotaCpu:"")+"  "+(e.createComponentForm.count*e.selectedMemory/1024>e.rawLave?e.lang.resource.quotaRam:""),bgStyle:"error"}})],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.resource.componentName,prop:"name"}},[o("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.createComponentForm.name,callback:function(t){e.$set(e.createComponentForm,"name","string"==typeof t?t.trim():t)},expression:"createComponentForm.name"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{label:e.lang.resource.hostname,prop:"hostname"}},[o("el-input",{attrs:{placeholder:e.lang.common.input+e.lang.resource.hostname},model:{value:e.createComponentForm.hostname,callback:function(t){e.$set(e.createComponentForm,"hostname","string"==typeof t?t.trim():t)},expression:"createComponentForm.hostname"}})],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.common.password,prop:"admin_pass"}},[o("el-input",{attrs:{type:"password",placeholder:e.lang.common.passwordPlaceholder},model:{value:e.createComponentForm.admin_pass,callback:function(t){e.$set(e.createComponentForm,"admin_pass","string"==typeof t?t.trim():t)},expression:"createComponentForm.admin_pass"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{label:e.lang.common.confirmPassword,prop:"confirm_pass"}},[o("el-input",{attrs:{type:"password",placeholder:e.lang.common.confirmPasswordPlaceholder},model:{value:e.createComponentForm.confirm_pass,callback:function(t){e.$set(e.createComponentForm,"confirm_pass","string"==typeof t?t.trim():t)},expression:"createComponentForm.confirm_pass"}})],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.common.amount,prop:"count"}},["cloudDisk"===e.source?o("div",[o("el-tooltip",{attrs:{content:e.lang.resource.componentCloudDiskInfo,placement:"top"}},[o("el-input-number",{attrs:{min:1,max:10},on:{change:e.countChange},model:{value:e.createComponentForm.count,callback:function(t){e.$set(e.createComponentForm,"count",e._n(t))},expression:"createComponentForm.count"}})],1)],1):o("div",[o("el-input-number",{attrs:{min:1,max:10},on:{change:e.countChange},model:{value:e.createComponentForm.count,callback:function(t){e.$set(e.createComponentForm,"count",e._n(t))},expression:"createComponentForm.count"}})],1)])],1),e._v(" "),o("el-col",{attrs:{span:11,offset:1}},[o("el-form-item",{attrs:{label:e.lang.resource.affinityGroup}},[o("el-select",{attrs:{placeholder:e.lang.resource.affinityGroupPlaceholder},on:{change:e.groupChange},model:{value:e.createComponentForm.group_id,callback:function(t){e.$set(e.createComponentForm,"group_id",t)},expression:"createComponentForm.group_id"}},[o("el-option",{attrs:{label:e.lang.common.pleaseSelect,value:"pleaseSelect"}}),e._v(" "),e._l(e.groups,function(t){return o("el-option",{key:t.id,attrs:{label:t.name+"("+e.lang.resource.affinityRuleObj[t.policies[0]]+")",value:t.id}})})],2),e._v(" "),e.groupIsFull?o("span",{staticClass:"el-form-item__error"},[e._v(e._s(e.lang.resource.groupIsFull))]):e._e()],1)],1)],1),e._v(" "),o("el-row",{class:{"gpu-row":e.gpuOptionShow}},[o("el-col",{attrs:{span:11}},[o("el-form-item",{attrs:{label:e.lang.resource.mountGpu}},[o("el-popover",{attrs:{"popper-class":"mount-gpu el-col-6",placement:"bottom-start",trigger:"manual"},model:{value:e.gpuOptionShow,callback:function(t){e.gpuOptionShow=t},expression:"gpuOptionShow"}},[o("div",{staticClass:"gpu-div"},e._l(e.gpuInfo,function(t,a){return o("el-row",{key:a},[o("span",{staticClass:"gpu-node"},[e._v(e._s(a)+":")]),e._v(" "),o("el-radio",{attrs:{label:a},model:{value:e.gpuNode,callback:function(t){e.gpuNode=t},expression:"gpuNode"}},[e._v("\n                                                                "+e._s(t.length)+"个GPU\n                                                            ")])],1)}),1),e._v(" "),o("el-tooltip",{attrs:{slot:"reference",disabled:!(0===Object.keys(e.gpuInfo).length||!1===e.isGpuQuotaEnough),content:e.lang.resource.mountGpuInfo.noGpus,placement:"top"},slot:"reference"},[o("el-radio",{attrs:{disabled:e.createComponentForm.count>1||0===Object.keys(e.gpuInfo).length||!1===e.isGpuQuotaEnough,label:1},model:{value:e.mountGpu,callback:function(t){e.mountGpu=t},expression:"mountGpu"}},[e._v(e._s(e.lang.resource.mount)+"\n                                                        ")])],1)],1),e._v(" "),o("el-radio",{staticStyle:{"margin-left":"30px"},attrs:{disabled:e.createComponentForm.count>1,label:2},model:{value:e.mountGpu,callback:function(t){e.mountGpu=t},expression:"mountGpu"}},[e._v(e._s(e.lang.resource.notMount)+"\n                                                ")])],1)],1)],1)],1),e._v(" "),o("section",{attrs:{id:"section2"}},[o("el-form-item",{attrs:{label:e.lang.common.cpu}},e._l(e.cpuOptions,function(t){return o("el-button",{key:t,staticClass:"cloud-btn",class:{active:t===e.selectedCpu},attrs:{size:"small"},on:{click:function(o){return e.selectCpuCore(t)}}},[e._v(e._s(t+e.lang.resource.core)+"\n                                        ")])}),1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.common.memory}},e._l(e.memoryOptions,function(t){return o("el-button",{key:t,staticClass:"cloud-btn",class:{active:t===e.selectedMemory},attrs:{size:"small"},on:{click:function(o){return e.selectMemory(t)}}},[e._v(e._s(e.common.switchCapacity(t,"MB","GB",3)+"G")+"\n                                        ")])}),1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.componentFormat}},[o("el-table",{ref:"flavorTable",staticClass:"cloud-table flavor-table",staticStyle:{width:"100%"},attrs:{"max-height":e.tableHeight,data:e.filterFlavors,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-radio",{attrs:{label:t.row.id},model:{value:e.createComponentForm.flavor,callback:function(t){e.$set(e.createComponentForm,"flavor",t)},expression:"createComponentForm.flavor"}},[e._v(e._s(e.label)+"\n                                                    ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:e.lang.common.name}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.cpu},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                    "+e._s(t.row.vcpus+e.lang.resource.core)+"\n                                                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.common.memory},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                    "+e._s(t.row.ram/1024+e.lang.common.gb)+"\n                                                ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.resource.cpuTopo},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                    "+e._s(t.row.extra&&e.cpuTopo(t.row)||e.lang.resource.unsettled)+"\n                                                ")]}}])})],1),e._v(" "),o("el-button",{attrs:{type:"text"},on:{click:e.addFlavorShow}},[e._v(e._s(e.lang.resource.addCustomFormat)+"\n                                        ")])],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.region}},[e._v("\n                                        default\n                                    ")])],1)])],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:2==e.active,expression:"active==2"}],staticStyle:{width:"85%"},attrs:{id:"selectStorage"}},[o("el-form",{ref:"createComponentForm2",attrs:{model:e.createComponentForm,rules:e.rules,"label-width":"110px"}},[o("h2",[e._v(e._s(e.lang.resource.source))]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.componentStartSource}},[o("el-radio-group",{on:{change:e.componentStartChange},model:{value:e.componentStartSource,callback:function(t){e.componentStartSource=t},expression:"componentStartSource"}},[o("el-radio-button",{attrs:{label:"startCloudDisk"}},[e._v("云硬盘")])],1)],1),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.selectSource}},[o("el-radio-group",{staticStyle:{"margin-bottom":"10px"},on:{change:e.tabChange},model:{value:e.source,callback:function(t){e.source=t},expression:"source"}},[o("el-radio-button",{attrs:{label:"image"}},[e._v("\n                                            "+e._s(e.lang.resource.componentStartSourceOptions[0])+"\n                                        ")]),e._v(" "),o("el-radio-button",{attrs:{label:"cloudDisk",disabled:e.cloudDiskDisable}},[e.cloudDiskDisable?o("div",[o("el-tooltip",{attrs:{content:e.lang.resource.componentCloudDiskInfo,placement:"top"}},[o("div",[e._v(e._s(e.lang.resource.componentStartSourceOptions[1]))])])],1):o("div",[e._v("\n                                                "+e._s(e.lang.resource.componentStartSourceOptions[1])+"\n                                            ")])]),e._v(" "),o("el-radio-button",{attrs:{label:"snapShot",disabled:"local"===e.componentStartSource}},[e._v("\n                                            "+e._s(e.lang.resource.componentStartSourceOptions[2])+"\n                                        ")])],1),e._v(" "),o("el-table",{directives:[{name:"show",rawName:"v-show",value:"image"===e.source,expression:"source === 'image'"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"max-height":e.tableHeight,data:e.images,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-radio",{attrs:{label:t.row.id},on:{change:e.imageChange},model:{value:e.image_id,callback:function(t){e.image_id=t},expression:"image_id"}},[e._v(e._s(e.label)+"\n                                                ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:e.lang.imageManage.imageName}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.imageManage.imageType},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                "+e._s(e.lang.resource.publicPrivate[t.row.visibility])+"\n                                            ")]}}])}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.imageManage.osArch},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                "+e._s("i686"===t.row.arch?e.lang.resource.osArchArray[1]:e.lang.resource.osArchArray[0])+"\n                                            ")]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"os_distro",label:e.lang.imageManage.osSystem}}),e._v(" "),o("el-table-column",{attrs:{label:e.lang.resource.min_disk},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                                "+e._s(t.row.min_disk+"GB")+"\n                                            ")]}}])})],1),e._v(" "),o("el-table",{directives:[{name:"show",rawName:"v-show",value:"cloudDisk"===e.source,expression:"source === 'cloudDisk'"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.serverVolumes,"max-height":e.tableHeight,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-radio",{attrs:{label:t.row.id},on:{change:e.cloudDiskChange},model:{value:e.volume_id,callback:function(t){e.volume_id=t},expression:"volume_id"}},[e._v("\n                                                    "+e._s(e.label)+"\n                                                ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:e.lang.resource.cloudDiskName}}),e._v(" "),o("el-table-column",{attrs:{prop:"size",label:e.lang.cloudDisk.sizeGB}})],1),e._v(" "),o("el-table",{directives:[{name:"show",rawName:"v-show",value:"snapShot"===e.source,expression:"source === 'snapShot'"}],ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.snapshots,"max-height":e.tableHeight,"highlight-current-row":""}},[o("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-radio",{attrs:{label:t.row.id},on:{change:e.snapshotChange},model:{value:e.snapshot_id,callback:function(t){e.snapshot_id=t},expression:"snapshot_id"}},[e._v("\n                                                    "+e._s(e.label)+"\n                                                ")])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:e.lang.resource.snapshotName}}),e._v(" "),o("el-table-column",{attrs:{prop:"volumeName",label:e.lang.resource.cloudDiskName}}),e._v(" "),o("el-table-column",{attrs:{prop:"size",label:e.lang.cloudDisk.sizeGB}}),e._v(" "),o("el-table-column",{attrs:{prop:"status",label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",{staticClass:"status cloud-success"},[e._v("\n                                                    可用\n                                                ")])]}}])})],1),e._v(" "),e.startSourceErrorShow?o("div",{staticClass:"el-form-item__error"},[e._v("\n                                        "+e._s(e.lang.resource.componentStartSourceError[e.source])+"\n                                    ")]):e._e()],1),e._v(" "),o("h2",[e._v(e._s(e.lang.resource.storage))]),e._v(" "),o("el-row",{staticStyle:{"margin-bottom":"20px"}},[o("pana-info",{directives:[{name:"show",rawName:"v-show",value:e.createComponentForm.count*(Number(e.createComponentForm.root_volume.volume_size)+Number(e.dataDiskSum()))>e.gigabytes,expression:"(createComponentForm.count*(Number(createComponentForm.root_volume.volume_size) + Number(dataDiskSum()))) > gigabytes"}],attrs:{content:e.lang.resource.quotaNo,bgStyle:"error"}})],1),e._v(" "),o("el-row",[o("el-form-item",{attrs:{label:e.lang.common.systemDisk}},["startCloudDisk"===e.componentStartSource?o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{prop:"root_volume.volume_type",rules:{required:!0,message:"必填项",trigger:"change"}}},[o("el-select",{attrs:{disabled:"image"!==e.source,placeholder:e.lang.resource.storagePlaceholder},model:{value:e.createComponentForm.root_volume.volume_type,callback:function(t){e.$set(e.createComponentForm.root_volume,"volume_type",t)},expression:"createComponentForm.root_volume.volume_type"}},e._l(e.storagePools,function(e){return o("el-option",{key:e.volumeTypeId,attrs:{label:e.disPlayName,value:e.volumeTypeId}})}),1)],1)],1):e._e(),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:3}},[o("el-form-item",{attrs:{prop:"root_volume.volume_size",rules:{type:"integer",min:e.image_min_disk,max:1e3,message:e.common.formatMsg(e.lang.resource.invalid_root_volume_size,{min_disk:e.image_min_disk}),trigger:"blur"}}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",disabled:"image"!==e.source||"local"===e.componentStartSource||0===e.images.length},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.createComponentForm.root_volume.volume_size,callback:function(t){e.$set(e.createComponentForm.root_volume,"volume_size",e._n(t))},expression:"createComponentForm.root_volume.volume_size"}})],1)],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:1}},[e._v("\n                                            "+e._s(e.lang.common.GB)+"\n                                        ")])],1)],1),e._v(" "),o("el-row",[o("el-form-item",{attrs:{label:e.lang.resource.storageCapacity}},[e.storageCapacity?o("el-col",{attrs:{span:11}},[e._v("\n                                            "+e._s(e.storageCapacity.usedText)+"\n                                            "),o("el-progress",{attrs:{"stroke-width":18,percentage:e.storageCapacity.usedPercentage,"show-text":!1}}),e._v("\n                                            "+e._s(e.storageCapacity.allocatedText)+"\n                                            "),o("el-progress",{attrs:{"stroke-width":18,percentage:e.storageCapacity.allocatedPercentage,"show-text":!1,status:"exception"}})],1):e._e()],1)],1),e._v(" "),"startCloudDisk"===e.componentStartSource?o("div",[o("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:e.lang.resource.dataDisk}},[e._v("\n                                        "+e._s(e.lang.resource.dataDiskInfo)+"\n                                    ")]),e._v(" "),o("el-row",e._l(e.createComponentForm.data_volumes,function(t,a){return o("el-form-item",{key:t.key},[o("el-col",{attrs:{span:6}},[o("el-select",{model:{value:t.volume_type,callback:function(o){e.$set(t,"volume_type",o)},expression:"item.volume_type"}},[e._l(e.storagePools,function(e){return o("el-option",{key:e.volumeTypeId,attrs:{label:e.disPlayName,value:e.volumeTypeId}})}),e._v(" "),o("el-option",{key:"selectCurrentDataDisk",attrs:{disabled:e.createComponentForm.count>1,label:e.lang.resource.selectCurrentDataDisk,value:"selectCurrentDataDisk"}},[o("el-tooltip",{attrs:{disabled:1===e.createComponentForm.count,content:e.lang.resource.notSupportExistingDiscs,placement:"bottom"}},[o("span",[e._v(e._s(e.lang.resource.selectCurrentDataDisk))])])],1)],2)],1),e._v(" "),"selectCurrentDataDisk"!==t.volume_type?o("div",[o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:4}},[o("el-form-item",{attrs:{prop:"data_volumes."+a+".volume_size",rules:[{type:"integer",min:1,message:"请输入非0的正整数",trigger:"blur"},{type:"integer",max:e.poolStorageQuotaCompute,message:e.common.formatMsg(e.lang.resource.invalidQutoa,{max:e.poolStorageQuotaCompute}),trigger:"blur"}]}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",placeholder:e.lang.common.quotaPlaceholder},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:t.volume_size,callback:function(o){e.$set(t,"volume_size",e._n(o))},expression:"item.volume_size"}})],1)],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:1}},[e._v("\n                                                    "+e._s(e.lang.common.gb)+"\n                                                ")])],1):e._e(),e._v(" "),"selectCurrentDataDisk"===t.volume_type?o("div",[o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:6}},[o("el-form-item",{attrs:{label:"",prop:"data_volumes."+a+".volume_id",rules:[{required:!0,message:e.lang.common.required_item,trigger:"blur"}]}},[o("el-select",{on:{change:function(t){return e.selectedDiskSize(a)}},model:{value:t.volume_id,callback:function(o){e.$set(t,"volume_id",o)},expression:"item.volume_id"}},e._l(e.diskList,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:3}},[e._v("\n                                                    磁盘容量:\n                                                    "+e._s((e.diskSizeArray[a]?e.diskSizeArray[a]:e.diskSize)+e.lang.common.GB)+"\n                                                ")])],1):e._e(),e._v(" "),o("el-col",{attrs:{span:2}},[o("el-form-item",{staticClass:"selectStorageBtn"},[o("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(o){return e.removeStorage(t)}}},[e._v("\n                                                        "+e._s(e.lang.common.delete)+"\n                                                    ")])],1)],1)],1)}),1),e._v(" "),o("el-form-item",[o("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addStorage}},[e._v("\n                                            "+e._s(e.lang.resource.addDataDisk)+"\n                                        ")])],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:9}},[o("el-form-item",{attrs:{label:e.lang.resource.disk_bus}},[o("el-select",{model:{value:e.createComponentForm.block_device_mapping.disk_bus,callback:function(t){e.$set(e.createComponentForm.block_device_mapping,"disk_bus",t)},expression:"createComponentForm.block_device_mapping.disk_bus"}},e._l(e.lang.resource.disk_bus_options,function(e,t){return o("el-option",{key:e,attrs:{label:e,value:t}})}),1)],1)],1)],1)],1):e._e(),e._v(" "),"local"===e.componentStartSource?o("el-row",{staticStyle:{"margin-bottom":"20px"}},[o("el-col",{attrs:{span:9}},[o("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{label:e.lang.resource.dataDiskGB}},[o("el-input",{attrs:{placeholder:"请输入1-1000的整数"}})],1)],1)],1):e._e()],1)],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:3==e.active,expression:"active==3"}],staticStyle:{width:"85%"},attrs:{id:"selectNetwork"}},[o("el-form",{ref:"createComponentForm3",attrs:{model:e.createComponentForm,rules:e.rules,"label-width":"100px"}},[o("h2",[e._v(e._s(e.lang.resource.nicSet))]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.networkName}},[e._v("\n                                    "+e._s(e.networkDetail.name)+"\n                                ")]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.subnetName}},[e._v("\n                                    "+e._s(e.subnetDetail.name)+"\n                                ")]),e._v(" "),o("el-form-item",{attrs:{label:e.lang.resource.assignIpAddress}},[o("el-checkbox",{attrs:{disabled:e.createComponentForm.count>1},model:{value:e.assignIpAddress,callback:function(t){e.assignIpAddress=t},expression:"assignIpAddress"}})],1),e._v(" "),e.assignIpAddress?o("div",{staticClass:"ip_address"},[o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.router.subnetSegment,prop:"subnetSegment"}},[o("el-select",{on:{change:e.subnetSegmentChange},model:{value:e.createComponentForm.subnetSegment,callback:function(t){e.$set(e.createComponentForm,"subnetSegment",t)},expression:"createComponentForm.subnetSegment"}},e._l(e.subnetDetail.hasOwnProperty("allocation_pools")&&e.subnetDetail.allocation_pools,function(t,a){return o("el-option",{key:a,attrs:{label:e.common.formatMsg(e.lang.resource.subnetSegmentLabel,{subnet:e.subnetDetail.name,start:t.start,end:t.end}),value:a}})}),1)],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.resource.ip,prop:"ip_address",rules:[{validator:this.validateIp,message:this.ipValidMessage,trigger:"blur"},{validator:this.validateIpUsed,trigger:"blur"}]}},[o("ip-input",{attrs:{disable:e.disabledArr,placeholder:e.placeholderArr},model:{value:e.createComponentForm.ip_address,callback:function(t){e.$set(e.createComponentForm,"ip_address",t)},expression:"createComponentForm.ip_address"}})],1)],1)],1)],1):e._e(),e._v(" "),o("h2",[e._v(e._s(e.lang.common.advanceSetting))]),e._v(" "),"image"===e.source&&e.imageIsLinux||"image"!==e.source?o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.resource.keypair_name}},[o("el-select",{attrs:{placeholder:e.lang.resource.keypairPlaceholder},model:{value:e.createComponentForm.keypair_name,callback:function(t){e.$set(e.createComponentForm,"keypair_name",t)},expression:"createComponentForm.keypair_name"}},[o("el-option",{attrs:{label:e.lang.resource.keypairPlaceholder,value:""}}),e._v(" "),e._l(e.keypairNameOptions,function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})],2)],1)],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:11}},[o("el-button",{attrs:{type:"text"},on:{click:function(t){e.showCreateKeypair=!0}}},[e._v(e._s(e.lang.resource.newKeypair)+"\n                                        ")])],1)],1):e._e(),e._v(" "),o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.nav.safeGroup}},[o("el-select",{on:{change:e.safeGroupOptionsFn},model:{value:e.createComponentForm.security_groups[0].id,callback:function(t){e.$set(e.createComponentForm.security_groups[0],"id",t)},expression:"createComponentForm.security_groups[0].id"}},e._l(e.safeGroupOptions,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1),e._v(" "),o("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:11}},[o("el-button",{attrs:{type:"text"},on:{click:function(t){e.showCreateGroup=!0}}},[e._v(e._s(e.lang.resource.newSafeGroup)+"\n                                        ")])],1)],1),e._v(" "),e.is_system_admin?o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.resource.startRegion}},[o("el-select",{attrs:{disabled:1===e.mountGpu},on:{change:function(t){e.createComponentForm.node=""}},model:{value:e.createComponentForm.availability_zone,callback:function(t){e.$set(e.createComponentForm,"availability_zone",t)},expression:"createComponentForm.availability_zone"}},[o("el-option",{key:Date.now(),attrs:{label:e.lang.resource.systemScheduling,value:""}}),e._v(" "),e._l(e.availabilityZoneOptions,function(e){return o("el-option",{key:e.zoneName,attrs:{label:e.zoneName,value:e.zoneName}})})],2)],1)],1)],1):e._e(),e._v(" "),e.is_system_admin?o("el-row",[o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:e.lang.resource.startNode}},[o("el-select",{attrs:{disabled:1===e.mountGpu},on:{change:e.startNodeChange},model:{value:e.createComponentForm.node,callback:function(t){e.$set(e.createComponentForm,"node",t)},expression:"createComponentForm.node"}},[o("el-option",{key:Date.now(),attrs:{label:e.lang.resource.systemScheduling,value:""}}),e._v(" "),e._l(e.nodeOptions,function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.value}})})],2)],1)],1)],1):e._e()],1)],1),e._v(" "),o("el-card",{directives:[{name:"show",rawName:"v-show",value:e.active<4,expression:"active < 4"}],staticClass:"box-card",staticStyle:{width:"18%",position:"fixed",right:"20px",top:"250px"}},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[e._v(e._s(e.lang.resource.quotaDetails))])]),e._v(" "),o("div",{staticStyle:{padding:"15px 5px"}},[o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.cloudComponentName)+"：")]),e._v(" "),o("span",{class:e.createComponentForm.name||"card-gray"},[e._v(e._s(e.createComponentForm.name||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.num)+"：")]),e._v(" "),o("span",{class:e.createComponentForm.count||"card-gray"},[e._v(e._s(e.createComponentForm.count||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.affinityGroup)+"：")]),e._v(" "),o("span",{class:e.groupName||"card-gray"},[e._v(e._s(e.groupName||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v("CPU：")]),e._v(" "),o("span",{class:e.selectedCpu||"card-gray"},[e._v(e._s(e.selectedCpu?e.createComponentForm.count*e.selectedCpu+"核/剩余"+e.cpuLave+"核":e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.ram)+"：")]),e._v(" "),o("span",{class:e.selectedMemory||"card-gray"},[e._v(e._s(e.selectedMemory?e.createComponentForm.count*e.selectedMemory/1024+"GB/剩余"+e.rawLave+"GB":e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.selectSource[e.source])+"名称：")]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:"image"===e.source,expression:"source === 'image'"}],class:e.imageName||"card-gray"},[e._v(e._s(e.imageName||e.lang.resource.noSelect))]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:"snapShot"===e.source,expression:"source === 'snapShot'"}],class:e.snapShotName||"card-gray"},[e._v(e._s(e.snapShotName||e.lang.resource.noSelect))]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:"cloudDisk"===e.source,expression:"source === 'cloudDisk'"}],class:e.cloudDiskName||"card-gray"},[e._v(e._s(e.cloudDiskName||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.systemDiskC)+"：")]),e._v(" "),o("span",{class:e.createComponentForm.root_volume.volume_size||"card-gray"},[e._v(e._s(e.createComponentForm.root_volume.volume_size?e.createComponentForm.count*e.createComponentForm.root_volume.volume_size+"GB":e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.dataDisk)+"：")]),e._v(" "),o("span",{class:e.dataDiskSum()||"card-gray"},[e._v(e._s(e.dataDiskSum()?e.createComponentForm.count*e.dataDiskSum()+"GB":e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.ipAddress)+"：")]),e._v(" "),o("span",{class:e.assignIpAddress||"card-gray"},[e._v(e._s(e.assignIpAddress?e.createComponentForm.ip_address:e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.keypair_name)+"：")]),e._v(" "),o("span",{class:e.createComponentForm.keypair_name||"card-gray"},[e._v(e._s(e.createComponentForm.keypair_name?e.createComponentForm.keypair_name:e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.safeGroup)+"：")]),e._v(" "),o("span",{class:e.safeGroupName||"card-gray"},[e._v(e._s(e.safeGroupName||e.lang.resource.noSelect))])]),e._v(" "),o("div",{staticClass:"card-text"},[o("span",[e._v(e._s(e.lang.resource.startRegion)+"：")]),e._v(" "),o("span",{class:e.createComponentForm.availability_zone||"card-gray"},[e._v(e._s(e.createComponentForm.availability_zone||e.lang.resource.noSelect))])])])]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:4==e.active,expression:"active==4"}],staticClass:"cloud-detail",attrs:{id:"confirm"}},[o("table",[o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.componentName))]),e._v(" "),o("td",[e._v(e._s(e.createComponentForm.name))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.componentCount))]),e._v(" "),o("td",[e._v(e._s(e.createComponentForm.count))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.common.systemDisk))]),e._v(" "),o("td",[e._v(e._s(e.createComponentForm.root_volume.volume_size+e.lang.common.GB))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.dataDisk))]),e._v(" "),o("td",[e._v(e._s(e.dataDiskSum()+e.lang.common.GB))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.selectedSource.label))]),e._v(" "),o("td",[e._v(e._s(e.selectedSource.name))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.hostname))]),e._v(" "),o("td",[e._v(e._s(e.createComponentForm.hostname))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.ipAddress))]),e._v(" "),o("td",[e._v(e._s(e.assignIpAddress?e.createComponentForm.ip_address:""))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.keypair_name))]),e._v(" "),o("td",[e._v(e._s(e.createComponentForm.keypair_name))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.startMode))]),e._v(" "),o("td",[e._v(e._s(e.lang.resource.startModeArray[e.activeComponentSource]))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.safeGroup))]),e._v(" "),o("td",[e._v(e._s(e.safeGroup))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.storageResourcePool))]),e._v(" "),o("td",[e._v(e._s(e.getStoragePool))]),e._v(" "),o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.startRegion))]),e._v(" "),o("td",[e._v(e._s(e.createComponentForm.availability_zone))])]),e._v(" "),o("tr",[o("td",{staticClass:"cloud-label"},[e._v(e._s(e.lang.resource.configuration_type))]),e._v(" "),o("td",[e._v(e._s(e.configuration))]),e._v(" "),o("td",{staticClass:"cloud-label"}),e._v(" "),o("td")])])]),e._v(" "),o("el-row",[o("el-form-item",{staticClass:"footer-btn",attrs:{label:""}},[e.active>1?o("el-button",{staticStyle:{"margin-top":"12px","border-color":"#409EFF"},attrs:{disabled:e.createTag},on:{click:e.prev}},[e._v("\n                                    "+e._s(e.lang.common.prevStep)+"\n                                ")]):e._e(),e._v(" "),e.active!==e.lastStep?o("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary",disabled:2===e.active&&(e.startSourceErrorShow||"cloudDisk"===e.source&&e.cloudDiskDisable)||1===e.active&&e.groupIsFull},on:{click:function(t){return e.next("createComponentForm"+e.active)}}},[e._v("\n                                    "+e._s(e.lang.common.nextStep)+"\n                                ")]):e._e(),e._v(" "),e.active===e.lastStep?o("el-button",{staticStyle:{"margin-top":"12px"},attrs:{type:"primary",disabled:e.createTag},on:{click:e.create}},[e._v("\n                                    "+e._s(e.lang.common.complete)+"\n                                ")]):e._e(),e._v(" "),e.active===e.lastStep?o("el-button",{staticStyle:{"margin-top":"12px"},attrs:{disabled:e.createTag,type:"primary"},on:{click:e.router_to_component}},[e._v(e._s(e.lang.common.cancel)+"\n                                ")]):e._e()],1)],1)],1)],1),e._v(" "),o("el-tab-pane",{attrs:{label:e.lang.resource.simpleConfig,name:"simpleConfig"}},["simpleConfig"==e.activeConfig?o("quick-create",{attrs:{isGpuEnough:e.isGpuQuotaEnough}}):e._e()],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.lang.resource.createFlavor,visible:e.addFlavor,width:"40%"},on:{"update:visible":function(t){e.addFlavor=t}}},[o("div",{staticStyle:{margin:"20px"}},[o("el-form",{ref:"addFlavorForm",attrs:{"label-width":"110px",model:e.addFlavorForm,rules:e.flavorsRule}},[o("el-form-item",{attrs:{label:e.lang.common.name,prop:"name"}},[o("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.addFlavorForm.name,callback:function(t){e.$set(e.addFlavorForm,"name",t)},expression:"addFlavorForm.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"CPU核数(核)",prop:"vcpus"}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",placeholder:"CPU核数"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.addFlavorForm.vcpus,callback:function(t){e.$set(e.addFlavorForm,"vcpus",e._n(t))},expression:"addFlavorForm.vcpus"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"内存(GB)",prop:"ram"}},[o("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",placeholder:"内存容量"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.addFlavorForm.ram,callback:function(t){e.$set(e.addFlavorForm,"ram",e._n(t))},expression:"addFlavorForm.ram"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"是否公用"}},[o("el-checkbox",{model:{value:e.addFlavorForm.is_public,callback:function(t){e.$set(e.addFlavorForm,"is_public",t)},expression:"addFlavorForm.is_public"}})],1)],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.addFlavor=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.createFlavor("addFlavorForm")}}},[e._v("确 定")])],1)]),e._v(" "),o("pana-create-group",{attrs:{show:e.showCreateGroup},on:{closeModal:e.closeCreateGroup}}),e._v(" "),o("pana-create-keypair",{attrs:{show:e.showCreateKeypair},on:{getList:e.getKeypair,closeModal:e.closeCreateKeypair}})],1)},staticRenderFns:[]};var h=o("C7Lr")(_,f,!1,function(e){o("gZts"),o("4F9u")},"data-v-06494256",null);t.default=h.exports},dM8T:function(e,t){},dfFt:function(e,t){},f1e3:function(e,t,o){"use strict";var a=o("VfK5"),r=o("Wtcz"),s=o("WXuS"),n=o("f9MG"),i=o("9Ntz"),l=o("n/58"),c=o("yBLB"),u=o("PsHI");r(r.S+r.F*!o("6sPN")(function(e){Array.from(e)}),"Array",{from:function(e){var t,o,r,m,p=s(e),d="function"==typeof this?this:Array,g=arguments.length,v=g>1?arguments[1]:void 0,_=void 0!==v,f=0,h=u(p);if(_&&(v=a(v,g>2?arguments[2]:void 0,2)),void 0==h||d==Array&&i(h))for(o=new d(t=l(p.length));t>f;f++)c(o,f,_?v(p[f],f):p[f]);else for(m=h.call(p),o=new d;!(r=m.next()).done;f++)c(o,f,_?n(m,v,[r.value,f],!0):r.value);return o.length=f,o}})},gZts:function(e,t){},kfHR:function(e,t,o){e.exports={default:o("5uZj"),__esModule:!0}},yBLB:function(e,t,o){"use strict";var a=o("hHwa"),r=o("gwUl");e.exports=function(e,t,o){t in e?a.f(e,t,r(0,o)):e[t]=o}},zAAO:function(e,t,o){"use strict";var a=o("aA9S"),r=o.n(a),s={props:{show:Boolean},data:function(){return{showDownload:!1,privateKey:"",form:{name:""},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:32,message:this.lang.common.validateLength32,trigger:"blur"},{validator:this.common.validateName4,trigger:"blur"}]}}},methods:{download:function(){var e=document.getElementById("download-keypair"),t=this.form.name+".pem",o=this.privateKey,a=new Blob([o],{type:"application/json;charset=UTF-8"});e.download=t,e.href=URL.createObjectURL(a),e.click(),URL.revokeObjectURL(a),this.showDownload=!1,r()(this.$data,this.$options.data.call(this))},confirm:function(){var e=this,t={keypair:{name:this.form.name}};this.$refs.form.validate(function(o){o&&(e.wsEventQueue.push(e.form.name),e.checkError(e.$http({url:e.api.cloud.post_keypairs,method:"post",data:t}),function(t){e.showDownload=!0,e.privateKey=t.data.private_key,e.closeModal(!0)}))})},closeModal:function(e){this.$emit("closeModal",e)},initForm:function(){this.$refs.form&&this.$refs.form.resetFields()}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-dialog",{attrs:{id:"load",title:e.lang.resource.createKeypair,visible:e.show,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.show=t},open:e.initForm,close:e.closeModal}},[o("el-form",{ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules}},[o("el-form-item",{attrs:{label:e.lang.resource.keypairName,prop:"name"}},[o("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.lang.resource.downloadKeypair,visible:e.showDownload,modal:!0,top:"8vh",width:"35%"},on:{"update:visible":function(t){e.showDownload=t}}},[o("p",{staticClass:"downloadTip"},[e._v(e._s(e.lang.resource.downloadKeypairConfirm))]),e._v(" "),o("a",{attrs:{id:"download-keypair",hidden:""}}),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.download()}}},[e._v(e._s(e.lang.resource.download))])],1)])],1)},staticRenderFns:[]};var i=o("C7Lr")(s,n,!1,function(e){o("WIfE")},"data-v-7baa6fba",null);t.a=i.exports}});