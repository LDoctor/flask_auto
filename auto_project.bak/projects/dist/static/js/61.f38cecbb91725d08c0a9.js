webpackJsonp([61],{L44U:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("OQqS"),i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"col",attrs:{id:"resource-create"}},[s("pana-breadcrumb",{attrs:{back:!0}}),e._v(" "),s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[s("el-form",{ref:"createform",staticClass:"main",attrs:{model:e.createForm,rules:e.rules,"label-width":"80px"}},[s("el-steps",{attrs:{active:e.stepIndex}},e._l(e.langStepConfig,function(e,t){return s("el-step",{key:t,attrs:{title:e}})}),1),e._v(" "),0==e.stepIndex?s("div",{staticClass:"card-right-space"},[e.create1?s("div",{attrs:{id:"create1"}},[s("el-form",{ref:"baseform",attrs:{model:e.baseForm,rules:e.rules}},[s("h2",[e._v(e._s(e.lang.common.generalInfo))]),e._v(" "),s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.common.name,prop:"name",labelWidth:e.labelWidth}},[s("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder},model:{value:e.baseForm.name,callback:function(t){e.$set(e.baseForm,"name","string"==typeof t?t.trim():t)},expression:"baseForm.name"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:11,offset:1}},[s("el-form-item",{attrs:{label:e.lang.resource.cpu,prop:"cpu_limit",labelWidth:e.labelWidth}},[s("el-input",{attrs:{placeholder:e.lang.resource.cpuPlaceholder},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.baseForm.cpu_limit,callback:function(t){e.$set(e.baseForm,"cpu_limit",t)},expression:"baseForm.cpu_limit"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.resource.memory,prop:"memory_limit",labelWidth:e.labelWidth}},[s("el-input",{attrs:{placeholder:e.lang.resource.quotaPlaceholder},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.baseForm.memory_limit,callback:function(t){e.$set(e.baseForm,"memory_limit",t)},expression:"baseForm.memory_limit"}})],1)],1),e._v(" "),s("el-col",{staticStyle:{"white-space":"nowrap"},attrs:{span:11,offset:1}},[s("el-form-item",{attrs:{label:e.lang.resource.GPUQuota,prop:"gpu_limit",labelWidth:e.labelWidth}},[s("el-input",{attrs:{placeholder:e.lang.resource.gpuPlaceholder},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.baseForm.gpu_limit,callback:function(t){e.$set(e.baseForm,"gpu_limit",t)},expression:"baseForm.gpu_limit"}}),e._v(" "),s("span",{staticClass:"gpuTip"},[e._v("\n\t\t\t\t\t\t\t\t\t\t注：GPU总数\n\t\t\t\t\t\t\t\t\t\t"),s("span",{staticClass:"cloud-color-blue"},[e._v(e._s(e.gpu.totalNum))]),e._v("个，可用\n\t\t\t\t\t\t\t\t\t\t"),s("span",{staticClass:"cloud-color-blue"},[e._v(e._s(e.gpu.availNum))]),e._v("个\n\t\t\t\t\t\t\t\t\t\t")])],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.common.description,prop:"description",labelWidth:e.labelWidth}},[s("el-input",{attrs:{type:"textarea",placeholder:e.lang.common.descPlaceholder},model:{value:e.baseForm.description,callback:function(t){e.$set(e.baseForm,"description",t)},expression:"baseForm.description"}})],1)],1)],1)],1),e._v(" "),s("h2",[e._v(e._s(e.lang.resource.networkset))]),e._v(" "),s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.outside.networkType,prop:"network.network_type",labelWidth:e.labelWidth}},[s("el-select",{attrs:{filterable:"",placeholder:e.lang.router.attachPlaceholder},on:{change:function(t){e.currentNetworkType=e.createForm.network.network_type}},model:{value:e.createForm.network.network_type,callback:function(t){e.$set(e.createForm.network,"network_type",t)},expression:"createForm.network.network_type"}},e._l(e.networkType,function(e,t){return s("el-option",{key:t,attrs:{label:e.type,value:e.type}})}),1)],1)],1),e._v(" "),s("el-col",{attrs:{span:11,offset:1}},[s("el-form-item",{attrs:{label:e.lang.outside.physicalNetwork,labelWidth:e.labelWidth,prop:"network.physical_network"}},[s("el-select",{attrs:{filterable:"",placeholder:e.lang.router.attachPlaceholder,width:"100%"},on:{change:e.checkPhysicNetwork},model:{value:e.physicNetwork,callback:function(t){e.physicNetwork=t},expression:"physicNetwork"}},e._l(e.physics,function(e,t){return s("el-option",{key:t,attrs:{label:e.name,value:t}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:9}},[s("el-form-item",{attrs:{label:e.lang.outside.subnet,"label-width":e.labelWidth,prop:"subnetIp"}},[s("pana-ip-input",{nativeOn:{"!blur":function(t){return e.changesubnetIp(t)}},model:{value:e.createForm.subnetIp,callback:function(t){e.$set(e.createForm,"subnetIp",t)},expression:"createForm.subnetIp"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:9,offset:3}},[s("el-form-item",{attrs:{label:e.lang.common.netmask,"label-width":e.labelWidth,prop:"subnetMask"}},[s("pana-ip-input",{nativeOn:{"!blur":function(t){return e.changesubnetMask(t)}},model:{value:e.createForm.subnetMask,callback:function(t){e.$set(e.createForm,"subnetMask",t)},expression:"createForm.subnetMask"}})],1)],1)],1),e._v(" "),"vlan"===e.currentNetworkType?s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.pool.vlanId,"label-width":e.labelWidth,prop:"network.segmentation_id",rules:[{validator:this.common.validateNumberType,trueValue:this.createForm.network.segmentation_id,message:this.lang.pool.segmentationNumberRule,trigger:"blur"},{validator:this.common.validateNumberRange,min:this.min,max:this.max,message:this.common.formatMsg(this.lang.pool.vlanIdRangeRule,{min:this.min,max:this.max}),trigger:"blur"},{validator:this.validateUnused,message:this.lang.pool.usedVlanIdRule}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"text",placeholder:e.lang.pool.vlanIdPlaceholder},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.createForm.network.segmentation_id,callback:function(t){e.$set(e.createForm.network,"segmentation_id",e._n(t))},expression:"createForm.network.segmentation_id"}})],1)],1)],1):e._e(),e._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:e.lang.outside.availableAddress,labelWidth:e.labelWidth}},[s("el-checkbox",{attrs:{disabled:!e.enableIpRange},model:{value:e.availableAddress,callback:function(t){e.availableAddress=t},expression:"availableAddress"}})],1)],1)],1),e._v(" "),e.availableAddress?s("div",[e._l(e.createForm.subnet.allocation_pools,function(t,a){return s("el-row",{key:a},[s("el-col",{attrs:{span:24}},[s("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.start,prop:"subnet.allocation_pools."+a+".start",rules:[{required:!0,message:e.lang.outside.startRequiredRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.outside.ipFormatRule,trigger:"blur"},{validator:e.validateNetworkAddress,trigger:"blur"},{validator:e.validateipRage,trigger:"blur"},{validator:e.validateIpCross,message:e.lang.resource.noCanCross,key:a,trigger:"blur"}]}},[s("el-input",{staticStyle:{width:"100%"},on:{focus:e.changestartIp},model:{value:t.start,callback:function(s){e.$set(t,"start",s)},expression:"item.start"}})],1),e._v(" "),s("el-form-item",{staticClass:"address-range",attrs:{label:e.lang.common.end,prop:"subnet.allocation_pools."+a+".end",rules:[{required:!0,message:e.lang.outside.endRequiredRule,trigger:"blur"},{validator:e.validateIpEndRange,start:t.start,message:e.lang.outside.endRangeRule,trigger:"blur"},{validator:e.common.validateIpAddress,message:e.lang.outside.ipFormatRule,trigger:"blur"},{validator:e.validateipRage,trigger:"blur"},{validator:e.validateIpCross,message:e.lang.resource.noCanCross,key:a,trigger:"blur"}]}},[s("el-input",{staticClass:"address",staticStyle:{width:"100%"},on:{focus:e.changeendIp},model:{value:t.end,callback:function(s){e.$set(t,"end",s)},expression:"item.end"}})],1),e._v(" "),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger",disabled:1===e.createForm.subnet.allocation_pools.length},on:{click:function(t){return e.deleteAddress(a)}}},[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(e.lang.common.delete)+"\n\t\t\t\t\t\t\t\t\t")])],1)],1)}),e._v(" "),e.occupied?s("el-row",[s("el-col",[s("span",{staticClass:"errorText"},[e._v(e._s(e.errorText))])])],1):e._e(),e._v(" "),s("el-row",[s("el-form-item",{staticClass:"address-range-button"},[s("el-button",{attrs:{type:"primary"},on:{click:e.newAddress}},[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(e.lang.common.new)+"\n\t\t\t\t\t\t\t\t\t")])],1)],1)],2):e._e(),e._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:e.lang.outside.enableDhcp,labelWidth:e.labelWidth}},[s("el-checkbox",{model:{value:e.createForm.subnet.enable_dhcp,callback:function(t){e.$set(e.createForm.subnet,"enable_dhcp",t)},expression:"createForm.subnet.enable_dhcp"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:e.lang.outside.enableGateway,labelWidth:e.labelWidth}},[s("el-checkbox",{model:{value:e.enableGateway,callback:function(t){e.enableGateway=t},expression:"enableGateway"}})],1)],1)],1),e._v(" "),e.enableGateway?s("el-row",[s("el-col",{attrs:{span:13}},[s("el-form-item",{attrs:{label:e.lang.outside.gatewayIp,labelWidth:e.labelWidth,prop:"subnet.gateway_ip",rules:[{validator:this.common.validateIpAddress,message:this.lang.pool.ipFormatRule,trigger:"blur"},{validator:this.validateGatewayRange,range:this.gatewayRange,message:this.common.formatMsg(this.lang.pool.gatewayRangeRule,this.gatewayRange),trigger:"blur"}]}},[s("el-input",{attrs:{placeholder:e.lang.outside.gatewayPlaceholder},model:{value:e.createForm.subnet.gateway_ip,callback:function(t){e.$set(e.createForm.subnet,"gateway_ip",t)},expression:"createForm.subnet.gateway_ip"}})],1)],1)],1):e._e(),e._v(" "),s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.outside.dnsServer,labelWidth:e.labelWidth,prop:"dnsNameservers"}},[s("el-input",{attrs:{type:"textarea",rows:4,placeholder:e.lang.outside.dnsServerPlaceholder},model:{value:e.createForm.dnsNameservers,callback:function(t){e.$set(e.createForm,"dnsNameservers",t)},expression:"createForm.dnsNameservers"}})],1)],1)],1),e._v(" "),!0===e.createForm.subnet.enable_dhcp?s("el-row",[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.pool.addRouter,"label-width":e.labelWidth,prop:"hostRoutes"}},[s("el-input",{attrs:{type:"textarea",rows:4,placeholder:e.lang.pool.addRouterPlaceholder},model:{value:e.createForm.hostRoutes,callback:function(t){e.$set(e.createForm,"hostRoutes",t)},expression:"createForm.hostRoutes"}})],1)],1)],1):e._e()],1):e._e(),e._v(" "),e.create2?s("div",{attrs:{id:"create2"}},[s("el-row",{staticStyle:{"margin-top":"30px"}},[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.resource.concurrent}},[s("el-input",{attrs:{placeholder:e.lang.common.namePlaceholder}})],1)],1)],1),e._v(" "),s("el-row",{attrs:{type:"flex",justify:"space-between"}},[s("el-col",{attrs:{span:11}},[s("el-form-item",{attrs:{label:e.lang.resource.selectTemplate}})],1),e._v(" "),s("el-col",{attrs:{span:6}},[s("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1)],1),e._v(" "),s("el-form-item",[s("el-table",{ref:"singleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{data:e.filterData,"highlight-current-row":""},on:{"current-change":e.handleCurrentChange,"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{width:"45"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-radio",{attrs:{label:t.row.name},model:{value:e.templateRadio,callback:function(t){e.templateRadio=t},expression:"templateRadio"}},[e._v(e._s(e.label))])]}}],null,!1,705873913)}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:e.lang.common.name},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{staticClass:"name",on:{click:function(t){e.detailDialogVisible=!0}}},[e._v(e._s(t.row.name))])]}}],null,!1,4124626324)}),e._v(" "),s("el-table-column",{attrs:{prop:"image_type",label:e.lang.common.create_time}}),e._v(" "),s("el-table-column",{attrs:{label:e.lang.common.description}})],1)],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:e.addDomain}},[e._v("自定义模板")])],1),e._v(" "),s("el-form-item",{attrs:{label:e.lang.resource.componentList}},[s("el-table",{ref:"singleTable",staticClass:"cloud-table component",staticStyle:{width:"100%"},attrs:{data:e.filterData,"highlight-current-row":""},on:{"current-change":e.handleCurrentChange,"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{prop:"name",label:e.lang.resource.component},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{staticClass:"name",on:{click:function(t){e.detailDialogVisible=!0}}},[e._v(e._s(t.row.name))])]}}],null,!1,4124626324)}),e._v(" "),s("el-table-column",{attrs:{prop:"image_type",label:e.lang.resource.scheme}}),e._v(" "),s("el-table-column",{attrs:{label:e.lang.resource.image}}),e._v(" "),s("el-table-column",{attrs:{label:e.lang.resource.storage}}),e._v(" "),s("el-table-column",{attrs:{label:e.lang.resource.ip},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",{attrs:{type:"text"},on:{click:function(s){return e.handleEdit(t.$index,t.row)}}},[e._v("192.168.8.111\n\t\t\t\t\t\t\t\t")])]}}],null,!1,2765312955)})],1)],1),e._v(" "),s("el-form-item",[s("el-button",{on:{click:e.prevStep}},[e._v(e._s(e.lang.common.prevStep))]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.addDomain}},[e._v("确定")])],1)],1):e._e()]):e._e(),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:1==e.stepIndex,expression:"stepIndex==1"}],staticClass:"card-right-space",attrs:{id:"twostep"}},[s("el-form",{ref:"form",attrs:{"label-width":"120px","label-position":"right",model:e.form,rules:e.rules}},[s("el-row",{attrs:{gutter:20}},[s("el-col",{staticClass:"poolconfig",attrs:{span:19}},[s("div",{staticClass:"totalstorage"},[s("div",{staticClass:"totaltitle"},[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(e.lang.storagePool.poolExp)+"\n\t\t\t\t\t\t\t\t\t")]),e._v(" "),s("div",{staticClass:"totalinfo"},[s("el-row",[s("el-col",{attrs:{span:2}},[s("div",{staticClass:"totalimg"},[s("img",{attrs:{src:"/static/image/totalicon.png"}})])]),e._v(" "),s("el-col",{staticClass:"totalslider",attrs:{span:8}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,"show-text":!1,percentage:e.capacityexp_percentage,color:"#409EFF"}})],1),e._v(" "),s("el-col",{staticClass:"expvalue",attrs:{span:9}},[s("el-form-item",{attrs:{label:e.lang.storagePool.quota,prop:"capacityexp_size",rules:[{required:!0,message:"必填项",trigger:"blur"},{validator:this.validateNumberRange,min:11,max:this.maxSize,trigger:"blur"},{validator:this.common.validateIntegerType,message:"请输入数字",trigger:"blur"}]}},[s("el-input",{ref:"totalinput",attrs:{width:"100%"},on:{change:e.addsize},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.capacityexp_size,callback:function(t){e.$set(e.form,"capacityexp_size",e._n(t))},expression:"form.capacityexp_size"}})],1)],1),e._v(" "),s("el-col",{staticStyle:{"margin-left":"-20px"},attrs:{span:1}},[s("span",{staticStyle:{"line-height":"98px"}},[e._v("GB")])])],1)],1)]),e._v(" "),s("div",[s("span",[e._v("启用文件和对象存储")]),e._v(" "),s("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#dcdfe6",disabled:""==e.form.capacityexp_size||e.form.capacityexp_size<11},on:{change:e.changeswitch},model:{value:e.open,callback:function(t){e.open=t},expression:"open"}})],1),e._v(" "),e.open?s("div",{staticClass:"filestorage"},[s("div",{staticClass:"filetitle"},[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(e.lang.storagePool.fileandobject)+"\n\t\t\t\t\t\t\t\t\t\t"),s("span",{staticStyle:{color:"#60abfc","font-size":"14px"}},[e._v("(可分配"+e._s(e.distributableSize)+"GB)")])]),e._v(" "),s("p",{staticClass:"creatspace"},[e._v(e._s(e.lang.storagePool.creatSpace))]),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-row",{staticStyle:{"margin-top":"40px"}},[s("el-col",{attrs:{span:23}},[s("el-form-item",{attrs:{label:e.lang.storagePool.spacesize,labelWidth:e.labelWidth,prop:"diskspace",rules:[{type:"integer",validator:this.common.validateNumberRange,min:1,max:e.form.capacityexp_size-10,message:this.common.formatMsg(this.lang.storagePool.spanceabled,{min:1,max:this.form.capacityexp_size-10}),trigger:"blur"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{step:"0.01",type:"number",width:"100%"},on:{change:e.changespace},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.diskspace,callback:function(t){e.$set(e.form,"diskspace",e._n(t))},expression:"form.diskspace"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:e.lang.storagePool.disksnum,labelWidth:e.labelWidth,prop:"disk_num"}},[s("el-select",{attrs:{filterable:"",width:"100%"},on:{change:function(t){return e.sigledisksize(e.form.disk_num)}},model:{value:e.form.disk_num,callback:function(t){e.$set(e.form,"disk_num",t)},expression:"form.disk_num"}},e._l(e.disknum,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[s("el-form-item",{attrs:{label:e.lang.storagePool.diskstructure,labelWidth:e.labelWidth,prop:"pool_type"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},on:{change:function(t){return e.changediskstructure(e.form.pool_type)}},model:{value:e.form.pool_type,callback:function(t){e.$set(e.form,"pool_type",t)},expression:"form.pool_type"}},e._l(e.diskstructure,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:23}},[s("el-form-item",{attrs:{label:e.lang.storagePool.sigledisk,labelWidth:e.labelWidth,prop:"disk_size"}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",width:"100%",disabled:""},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.disk_size,callback:function(t){e.$set(e.form,"disk_size",t)},expression:"form.disk_size"}})],1)],1)],1)],1),e._v(" "),s("el-col",{staticClass:"destable",attrs:{span:10}},[s("div",{staticClass:"ruletitle"},[e._v(e._s(e.lang.storagePool.zfsconfigstruct))]),e._v(" "),s("div",{staticClass:"ruledes"},[s("ul",{staticClass:"diskdistr"},[s("li",[e._v(e._s(e.lang.storagePool.diskstructure))]),e._v(" "),s("li",[e._v(e._s(e.lang.storagePool.strip))]),e._v(" "),s("li",[e._v(e._s(e.lang.storagePool.mirror))]),e._v(" "),s("li",[e._v("单重校验")]),e._v(" "),s("li",[e._v("双重校验")]),e._v(" "),s("li",[e._v("三重校验")])]),e._v(" "),s("ul",{staticClass:"diskdistr"},[s("li",[e._v(e._s(e.lang.storagePool.leastdisk))]),e._v(" "),s("li",[e._v("1")]),e._v(" "),s("li",[e._v("2")]),e._v(" "),s("li",[e._v("3")]),e._v(" "),s("li",[e._v("4")]),e._v(" "),s("li",[e._v("5")])]),e._v(" "),s("ul",{staticClass:"diskdistr"},[s("li",[e._v(e._s(e.lang.storagePool.securitymechanism))]),e._v(" "),s("li",[e._v(e._s(e.lang.storagePool.nothing))]),e._v(" "),s("li",[e._v(e._s(e.lang.storagePool.diskisbacked))]),e._v(" "),s("li",[e._v(e._s(e.lang.storagePool.redundantDisk))]),e._v(" "),s("li",[e._v(e._s(e.lang.storagePool.redundantTwodisks))]),e._v(" "),s("li",[e._v(e._s(e.lang.storagePool.redundantThreedisks))])])])])],1),e._v(" "),s("p",{staticClass:"allocationspace"},[e._v("\n\t\t\t\t\t\t\t\t\t\t"+e._s(e.lang.storagePool.allocationSpace)+"\n\t\t\t\t\t\t\t\t\t\t"),s("span",{staticStyle:{color:"#60abfc","font-size":"14px"}},[e._v("(待分配"+e._s(e.allocate)+"GB)")])]),e._v(" "),s("el-row",{staticStyle:{height:"130px",overflow:"hidden",margin:"0 auto 20px","text-align":"center","min-width":"882px","border-bottom":"1px solid #ced7e6","padding-bottom":"20px"}},[s("div",{staticClass:"fileicons"},[s("img",{attrs:{src:"/static/image/fileicon.png",alt:""}}),e._v(" "),s("p",[e._v(e._s(e.lang.storagePool.filename))])]),e._v(" "),s("div",{staticClass:"processstyle"},[s("el-progress",{staticClass:"ratios",attrs:{"text-inside":!0,"stroke-width":18,"show-text":!1,percentage:e.percentage,color:"#576cdd"}}),e._v(" "),s("p",{staticStyle:{"margin-top":"10px",color:"#c0c4cc"}},[e._v(e._s(e.lang.storagePool.fileandobjectpre))])],1),e._v(" "),s("div",{staticClass:"objecticons"},[s("img",{attrs:{src:"/static/image/objecticon.png",alt:""}}),e._v(" "),s("p",[e._v(e._s(e.lang.storagePool.objectname))])])]),e._v(" "),s("div",{staticClass:"quotabox"},[s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:e.lang.storagePool.fileexpspace,labelWidth:e.labelWidth,prop:"file_size",rules:[{type:"integer",validator:this.common.validateNumberRange,min:0,max:this.form.diskspace,message:this.common.formatMsg(this.lang.storagePool.filesizeRage,{min:0,max:this.form.diskspace}),trigger:"blur"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{step:"0.01",type:"number",width:"100%"},nativeOn:{mousewheel:function(e){e.preventDefault()},keyup:function(t){return t.preventDefault(),e.changefilevalue()}},model:{value:e.form.file_size,callback:function(t){e.$set(e.form,"file_size",e._n(t))},expression:"form.file_size"}})],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:14}},[s("el-form-item",{attrs:{label:e.lang.storagePool.objectexpspace,labelWidth:e.labelWidth,prop:"object_size",rules:[{type:"integer",validator:this.common.validateNumberRange,min:0,max:this.form.diskspace,message:this.common.formatMsg(this.lang.storagePool.objectsizeRage,{min:0,max:this.form.diskspace}),trigger:"blur"}]}},[s("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{step:"0.01",type:"number",width:"100%"},nativeOn:{mousewheel:function(e){e.preventDefault()},keyup:function(t){return t.preventDefault(),e.changeobjectvalue(t)}},model:{value:e.form.object_size,callback:function(t){e.$set(e.form,"object_size",e._n(t))},expression:"form.object_size"}})],1)],1)],1),e._v(" "),s("el-form-item",{attrs:{labelWidth:e.labelWidth}},[s("el-button",{attrs:{type:"text"},on:{click:e.isshow}},[e._v(e._s(e.lang.storagePool.advancedOptions))]),e._v(" "),e.isShow?e._e():s("i",{staticClass:"el-icon-d-arrow-right",staticStyle:{color:"#007bff"}}),e._v(" "),e.isShow?s("i",{staticClass:"el-icon-d-arrow-right",staticStyle:{color:"#007bff",transform:"rotateZ(90deg)"}}):e._e()],1),e._v(" "),e.isShow?s("div",[s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:e.lang.storagePool.compressionLevel,labelWidth:"132px",prop:"compression"}},[s("el-tooltip",{staticClass:"item",attrs:{placement:"bottom",effect:"dark"}},[s("div",{attrs:{slot:"content"},domProps:{innerHTML:e._s(e.lang.storagePool.info)},slot:"content"}),e._v(" "),s("i",{staticClass:"el-icon-question"})]),e._v(" "),s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:e.form.compression,callback:function(t){e.$set(e.form,"compression",t)},expression:"form.compression"}},e._l(e.compressionLevels,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:e.lang.storagePool.zfsoprate,labelWidth:e.labelWidth,prop:"dedup"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:e.form.dedup,callback:function(t){e.$set(e.form,"dedup",t)},expression:"form.dedup"}},e._l(e.zfsdelectData,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:e.lang.storagePool.copynum,labelWidth:e.labelWidth,prop:"copies"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:e.form.copies,callback:function(t){e.$set(e.form,"copies",t)},expression:"form.copies"}},e._l(e.fuben,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:e.lang.storagePool.fileobjectSize,labelWidth:e.labelWidth,prop:"recordsize"}},[s("el-select",{attrs:{filterable:"",required:"",width:"100%"},model:{value:e.form.recordsize,callback:function(t){e.$set(e.form,"recordsize",t)},expression:"form.recordsize"}},e._l(e.fileblocksize,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1)],1):e._e()],1),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.showfilealert,expression:"showfilealert"}],staticStyle:{color:"#f56c6c"}},[e._v("请输入文件配额和对象配额")])],1):e._e()]),e._v(" "),s("el-col",{staticClass:"poolplate",attrs:{span:5}},[s("div",{staticClass:"plate-box"},[s("p",{staticClass:"palettitle"},[e._v(e._s(e.lang.storagePool.datapalet))]),e._v(" "),s("div",{ref:"myEchart",attrs:{id:"platechart"}})])])],1)],1)],1),e._v(" "),2==e.stepIndex?s("div",{attrs:{id:"threestep"}},[s("div",{staticClass:"stepthree"},[s("i",{staticClass:"el-icon-circle-check-outline different"}),e._v(" "),s("p",[e._v(e._s(e.lang.resource.initsuccess))])])]):e._e(),e._v(" "),s("el-card",{directives:[{name:"show",rawName:"v-show",value:0==e.stepIndex,expression:"stepIndex==0"}],staticClass:"box-card",staticStyle:{width:"15%",position:"fixed",right:"20px",top:"250px"}},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[e._v(e._s(e.lang.resource.quotaDetails))])]),e._v(" "),s("div",{staticStyle:{padding:"15px 5px"}},[s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.namePool)+"：")]),e._v(" "),s("span",{class:e.baseForm.name||"card-gray"},[e._v(e._s(e.baseForm.name||e.lang.resource.noSelect))])]),e._v(" "),s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.cpuPool)+"：")]),e._v(" "),s("span",{class:e.baseForm.cpu_limit||"card-gray"},[e._v(e._s(e.baseForm.cpu_limit?e.baseForm.cpu_limit+"核/可用"+e.coresLave+"核":e.lang.resource.noSelect))])]),e._v(" "),s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.memoryPool)+"：")]),e._v(" "),s("span",{class:e.baseForm.memory_limit||"card-gray"},[e._v(e._s(e.baseForm.memory_limit?e.baseForm.memory_limit+"GB/可用"+e.ramLave+"GB":e.lang.resource.noSelect))])]),e._v(" "),s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.gpuPool)+"：")]),e._v(" "),s("span",{class:e.baseForm.gpu_limit||"card-gray"},[e._v(e._s(e.baseForm.gpu_limit?e.baseForm.gpu_limit+"个/可用"+e.gpu.totalNum+"个":e.lang.resource.noSelect))])]),e._v(" "),s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.netType)+"：")]),e._v(" "),s("span",{class:e.createForm.network.network_type||"card-gray"},[e._v(e._s(e.createForm.network.network_type||e.lang.resource.noSelect))])]),e._v(" "),s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.physicalNet)+"：")]),e._v(" "),s("span",{class:""!==e.physicNetwork||"card-gray"},[e._v(e._s(""!==e.physicNetwork&&e.physics[e.physicNetwork]?e.physics[e.physicNetwork].name:e.lang.resource.noSelect))])]),e._v(" "),s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.childNet)+"：")]),e._v(" "),s("span",{class:e.createForm.subnetIp||"card-gray"},[e._v(e._s(e.createForm.subnetIp?e.createForm.subnetIp.split(".").filter(function(e){return""!=e}).join("."):e.lang.resource.noSelect))])]),e._v(" "),s("div",{staticClass:"card-text"},[s("span",[e._v(e._s(e.lang.resource.childNetSeg)+"：")]),e._v(" "),s("span",{class:e.createForm.subnetMask||"card-gray"},[e._v(e._s(e.createForm.subnetMask?e.createForm.subnetMask.split(".").filter(function(e){return""!=e}).join("."):e.lang.resource.noSelect))])])])])],1),e._v(" "),s("span",{staticClass:"dialog-footer footerright",attrs:{slot:"footer"},slot:"footer"},[0==e.stepIndex?s("el-button",{on:{click:e.router_to_resource}},[e._v(e._s(e.lang.common.cancel))]):e._e(),e._v(" "),e.stepIndex>0&&e.stepIndex<2?s("el-button",{attrs:{disabled:e.disable},on:{click:function(t){return e.checkStep(-1)}}},[e._v(e._s(e.lang.common.prevStep))]):e._e(),e._v(" "),e.stepIndex<1?s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.checkStep(1)}}},[e._v(e._s(e.lang.common.nextStep))]):e._e(),e._v(" "),1==e.stepIndex?s("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.submitData}},[e._v(e._s(e.lang.common.confirm))]):e._e()],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.lang.common.info,visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("span",[e._v(e._s(e.lang.resource.initalert))]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),s("el-button",{attrs:{type:"primary",disabled:e.disable},on:{click:e.lastsubmit}},[e._v(e._s(e.lang.common.confirm))])],1)])],1)},staticRenderFns:[]};var r=function(e){s("vXa4"),s("v/A0")},o=s("C7Lr")(a.a,i,!1,r,"data-v-b87fcfcc",null);t.default=o.exports},OQqS:function(e,t,s){"use strict";(function(e){var a=s("Cj+A"),i=s("1JPr");t.a={components:{"pana-ip-input":a.a,panaBreadcrumb:i.a},data:function(){return{disable:!1,gpu:{availNum:"",totalNum:""},gpuUse:"",createTag:!1,loading:!0,create1:!0,create2:!1,baseForm:{name:"",cpu_limit:"",memory_limit:"",gpu_limit:"",description:"",storage:[]},createForm:{is_external:!1,network:{name:"default",network_type:"vlan",physical_network:null,segmentation_id:null},subnet:{name:"default",cidr:"",ip_version:4,gateway_ip:"",enable_dhcp:!0,dns_nameservers:[],host_routes:[],allocation_pools:[{start:null,end:null}]},subnetIp:null,subnetMask:null,dnsNameservers:"",hostRoutes:""},originPhysics:[],physics:[],physicNetwork:"",currentNetworkType:"vlan",networkType:[],subnetMask:"",availableAddress:!1,enableGateway:!0,gatewayRange:{start:null,end:null},enableIpRange:!1,min:0,max:255,storageCountArray:[],storageCount:0,storagePools:[],currentRow:null,templateRadio:"",label:"",operateValue:"",rules:{name:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{min:1,max:30,message:this.lang.common.validateLength30,trigger:"blur"},{validator:this.common.validateName2,trigger:"blur"},{validator:this.validateNameExist,trigger:"blur"}],cpu_limit:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validateIntegerType,message:this.lang.resource.integerRule,trigger:"blur"},{validator:this.validateCpu,trigger:"blur"}],memory_limit:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validateIntegerType,message:this.lang.resource.integerRule,trigger:"blur"},{validator:this.validateMemory,trigger:"blur"}],gpu_limit:[{validator:this.validateGpu,trigger:"blur"},{validator:this.common.validateIntegerType,message:this.lang.resource.integerRule,trigger:"blur"}],description:[{min:0,max:100,message:"不能超过100个字符",trigger:"blur"}],"network.network_type":[{required:!0,message:this.lang.outside.typeRequiredRule,trigger:"blur"}],"network.physical_network":[{required:!0,message:this.lang.outside.typeRequiredRule,trigger:"change"}],subnetIp:[{required:!0,message:this.lang.outside.subnetRequiredRule,trigger:"blur"},{validator:this.common.validateIpAddress,message:this.lang.outside.ipFormatRule,trigger:"blur"}],subnetMask:[{required:!0,message:this.lang.outside.netmaskRequiredRule,trigger:"blur"},{validator:this.common.validateNetMask,message:this.lang.outside.netmaskFormatRule,trigger:"blur"},{validator:this.validateNetmaskRange,message:this.lang.outside.netmaskRangeRule,trigger:"blur"}],dnsNameservers:[{validator:this.common.validateDnsServers,message:this.lang.outside.dnsFormatRule,trigger:"blur"}],hostRoutes:[{validator:this.common.validateHostRoutes,message:this.lang.outside.hostRoutesFormatRule,trigger:"blur"}]},stepIndex:0,langStepConfig:[this.lang.poolinit.baseconfig,this.lang.poolinit.poolinit],currentVlanIds:[],existVlanIds:[],disknum:[{value:"1",label:"1",disabled:!1},{value:"2",label:"2",disabled:!1},{value:"3",label:"3",disabled:!1},{value:"4",label:"4",disabled:!1},{value:"5",label:"5",disabled:!1},{value:"6",label:"6",disabled:!1},{value:"7",label:"7",disabled:!1},{value:"8",label:"8",disabled:!1},{value:"9",label:"9",disabled:!1},{value:"10",label:"10",disabled:!1},{value:"11",label:"11",disabled:!1},{value:"12",label:"12",disabled:!1},{value:"13",label:"13",disabled:!1},{value:"14",label:"14",disabled:!1},{value:"15",label:"15",disabled:!1},{value:"16",label:"16",disabled:!1},{value:"17",label:"17",disabled:!1},{value:"18",label:"18",disabled:!1},{value:"19",label:"19",disabled:!1},{value:"20",label:"20",disabled:!1},{value:"21",label:"21",disabled:!1},{value:"22",label:"22",disabled:!1},{value:"23",label:"23",disabled:!1},{value:"24",label:"24",disabled:!1},{value:"25",label:"25",disabled:!1},{value:"26",label:"26",disabled:!1}],diskstructure:[{value:"stripe",label:"条带",disabled:!1},{value:"mirror",label:"镜像",disabled:!0},{value:"raidz1",label:"单重校验",disabled:!0},{value:"raidz2",label:"双重校验",disabled:!0},{value:"raidz3",label:"三重校验",disabled:!0}],compressionLevels:[{value:"off",label:"关闭"},{value:"gzip-1",label:"gzip-1"},{value:"gzip-6",label:"gzip-6"},{value:"gzip-9",label:"gzip-9"},{value:"zle",label:"zle"},{value:"lzjb",label:"lzjb"},{value:"lz4",label:"lz4"}],zfsdelectData:[{value:"off",label:"禁用"},{value:"on",label:"启用"},{value:"verify",label:"验证"}],fuben:[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"}],fileblocksize:[{value:"1K",label:"1K"},{value:"2K",label:"2K"},{value:"3K",label:"4K"},{value:"4K",label:"8K"},{value:"16K",label:"16K"},{value:"32K",label:"32K"},{value:"64K",label:"64K"},{value:"128K",label:"128K"},{value:"256K",label:"256K"},{value:"512K",label:"512K"},{value:"1M",label:"1M"}],percentage:0,total_redundancy:0,capacityexp_percentage:100,form:{block_size:"",file_and_object_storage_type:"ZFS",disk_num:"",pool_type:"stripe",disk_size:0,file_size:0,object_size:0,compression:"off",dedup:"off",copies:"1",recordsize:"128K",capacityexp_size:"",diskspace:!0===this.open?1:0},labelWidth:"150px",isShow:!1,storage_id:"",dialogVisible:!1,open:!1,maxSize:"",distributableSize:0,allocate:1,showfilealert:!1,occupied:!1,errorText:"",poolNames:[],ramLave:0,coresLave:"",gigabytesLave:""}},mounted:function(){var e=this;this.getPoolNames(),this.$http({url:this.api.storage.get_pools,method:"get"}).then(function(t){e.storagePools=t.data.data,e.storage_id=t.data.data[0].volumeTypeId}),this.getGpuAvail(),this.drawchart(0,0,0,0,0),this.getPhysicsNetwork(),this.getExistVlanIds(),this.getNetworkTypes(),window.addEventListener("resize",this.init,20),this.getQuotaMsg()},methods:{getQuotaMsg:function(){var e=this;e.checkError(e.$http({method:"get",url:this.api.alarm.getQuotaPlatform}),function(t){e.loading=!1;var s=t.data;e.ramLave=Math.floor((s.total_ram-s.used_ram)/1024),e.coresLave=Math.floor(s.total_cores-s.used_cores),e.maxSize=Math.floor(s.total_gigabytes-s.used_gigabytes),e.gpuUse=Math.floor(s.total_gpu-s.used_gpu)},function(t){e.loading=!1})},getGpuAvail:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.gpu_available_list,method:"get"}),function(t){e.loading=!1;var s=t.data.avalibal,a=t.data.total,i=0,r=0;for(var o in s)i+=s[o].length;for(var l in a)r+=a[l].length;e.gpu.availNum=i,e.gpu.totalNum=r},function(){e.loading=!1})},getPoolNames:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.pool_names,method:"get"}),function(t){e.poolNames=t.data})},twoDecimal:function(e,t){return e%t==0?(e/t).toFixed(2):1===(e/t).toString().split(".")[1].length?e/t+"0":Math.floor(e/t*100)/100},getPhysicsNetwork:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_networks_availablePrivateNetwork,method:"get"}),function(t){e.originPhysics=t.data,e.physics=e.originPhysics.filter(function(t){return t.networkType.toLowerCase()===e.currentNetworkType}).map(function(e){var t=e.networkName.split(":");return e.name=t[0]+":"+t[1]+"-"+t[2],e})})},newAddress:function(){this.createForm.subnet.allocation_pools.push({start:"",end:""})},deleteAddress:function(e){this.createForm.subnet.allocation_pools.splice(e,1)},FormatRouters:function(e){for(var t=e.split(/\n/g),s=[],a=0;a<t.length;a++){var i={},r=t[a].split(",");i.destination=r[0].replace(/(^\s*)|(\s*$)/g,""),i.nexthop=r[1].replace(/(^\s*)|(\s*$)/g,""),s.push(i)}return s},validateNameExist:function(e,t,s){-1!=this.poolNames.indexOf(t)?s(Error(this.lang.resource.poolNameAlreadyExist)):s()},validateGpu:function(e,t,s){var a=this.gpu.totalNum;(""===t||null==t||isNaN(t))&&s(),0===a&&s(Error(this.lang.resource.noAvailGpu)),t>=0&&t<=a?s():s(Error(this.common.formatMsg(this.lang.resource.invalidGpu,{min:0,max:a})))},validateCpu:function(e,t,s){var a=this.coresLave;(""===t||null==t||isNaN(t))&&s(),t>=1&&t<=a?s():s(t>a?Error(this.common.formatMsg(this.lang.resource.invalidQutoa,{max:this.coresLave||0})):Error(this.common.formatMsg(this.lang.resource.invalidMin,{min:1})))},validateMemory:function(e,t,s){var a=this.ramLave;(""===t||null==t||isNaN(t))&&s(),t>=1&&t<=a?s():s(t>a?Error(this.common.formatMsg(this.lang.resource.invalidQutoa,{max:this.ramLave})):Error(this.common.formatMsg(this.lang.resource.invalidMin,{min:1})))},validateipRage:function(e,t,s){var a=this.common.getRangeInCidr(this.createForm.subnetIp+"/"+this.common.switchToNumberCount(this.createForm.subnetMask)).start,i=this.common.getRangeInCidr(this.createForm.subnetIp+"/"+this.common.switchToNumberCount(this.createForm.subnetMask)).end;""!==t&&null!=t||s(),this.common.getLargerIp(a,t)===t&&this.common.getLargerIp(t,i)===i?s():s(Error(this.lang.resource.ipRage))},validateIpCross:function(e,t,s){var a=this,i=!0;this.createForm.subnet.allocation_pools.forEach(function(r,o){e.key!=o&&(r.start==t||r.end==t||a.common.getLargerIp(r.start,t)==t&&a.common.getLargerIp(r.end,t)==r.end)&&(s(Error(e.message)),i=!1)}),i&&s()},validateipGateway:function(){var e=this,t=(this.common.getRangeInCidr(this.createForm.subnetIp+"/"+this.common.switchToNumberCount(this.createForm.subnetMask)).start,this.common.getRangeInCidr(this.createForm.subnetIp+"/"+this.common.switchToNumberCount(this.createForm.subnetMask)).end,this.common.getRangeInCidr(this.createForm.subnetIp+"/"+this.common.switchToNumberCount(this.createForm.subnetMask)).start),s=this.createForm.subnet.gateway_ip,a=this.createForm.subnet.allocation_pools;if(console.log(t,s),e.availableAddress)if(s)for(var i=0;i<a.length;i++)if(a[i].start&&a[i].end){if(e.common.getLargerIp(a[i].start,s)===s&&e.common.getLargerIp(s,a[i].end)===a[i].end){e.occupied=!0,e.errorText=e.lang.resource.gatewayOccupancy+s;break}e.occupied=!1,e.errorText=""}else e.occupied=!1,e.errorText="";else a.forEach(function(s){s.start&&s.end&&(s.start==t||s.end==t)?(e.occupied=!0,e.errorText=e.lang.resource.gatewayOccupancy+t):(e.occupied=!1,e.errorText="")});else e.occupied=!1,e.errorText=""},binaryAndComputing:function(e,t){return e&t},validateNetworkAddress:function(e,t,s){var a=this.createForm.subnetIp.split("."),i=this.createForm.subnetMask.split(".");t==this.binaryAndComputing(a[0],i[0]).toString()+"."+this.binaryAndComputing(a[1],i[1]).toString()+"."+this.binaryAndComputing(a[2],i[2]).toString()+"."+this.binaryAndComputing(a[3],i[3]).toString()?s(Error(this.lang.resource.networkAddress)):s()},changestartIp:function(){this.occupied=!1,this.errorText=""},changeendIp:function(){this.occupied=!1,this.errorText=""},validateAllocation:function(e){for(var t=[],s=0;s<e.length;s++)null!=e[s].start&&null!=e[s].end&&t.push(e[s]);return t.length>0?t:[{start:null,end:null}]},validateTotalsize:function(e,t,s){var a=this.maxSize||0;(""===t||null==t||isNaN(t))&&s(),t<=a?s():s(Error(this.common.formatMsg(this.lang.storagePool.totalsizeRage,{max:this.maxSize||0})))},validateNumberRange:function(e,t,s){var a=null==e.min||""===e.min||isNaN(e.min)?-1/0:e.min,i=null==e.max||""===e.max||isNaN(e.max)?1/0:e.max;(""===t||null==t||isNaN(t))&&s(),t>=a&&t<=i?s():this.maxSize<11?s(Error(this.common.formatMsg(this.lang.resource.availableSpace,{available:this.maxSize}))):s(Error(this.common.formatMsg(this.lang.storagePool.spanceabled,{min:11,max:this.maxSize})))},checkPhysicNetwork:function(){var e=this.physics[this.physicNetwork];this.createForm.network.physical_network=e.networkName.split(":")[0];var t=e.networkName.split(":");this.min=t[1],this.max=t[2]},validateIpEndRange:function(e,t,s){null!=e.start&&""!==e.start&&null!=t&&""!==t||s(),this.common.getLargerIp(e.start,t)===e.start?s(Error(e.message)):s()},validateNetmaskRange:function(e,t,s){var a=null==e.min?"255.128.0.0":e.min,i=null==e.max?"255.255.255.248":e.max;this.common.getLargerIp(a,t)===t&&this.common.getLargerIp(t,i)===i?s():s(new Error(e.message))},validateUnused:function(e,t,s){null==t||""===t||-1===this.currentVlanIds.indexOf(t)?s():s(new Error(e.message))},validateGatewayRange:function(e,t,s){null==t||""===t||this.common.getLargerIp(t,e.range.start)===t&&this.common.getLargerIp(t,e.range.end)===e.range.end?s():s(new Error(e.message))},setGatewayRange:function(){var e=/^(?=(\b|\D))(((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))\.){3}((\d{1,2})|(1\d{1,2})|(2[0-4]\d)|(25[0-5]))(?=(\b|\D))$/;return e.test(this.createForm.subnetIp)&&e.test(this.createForm.subnetMask)?(this.enableIpRange=!0,this.common.getRangeInCidr(this.createForm.subnetIp+"/"+this.common.switchToNumberCount(this.createForm.subnetMask))):(this.enableIpRange=!1,this.availableAddress=!1,{start:null,end:null})},getExistVlanIds:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_networks_vlanids_inuse,method:"get"}),function(t){e.existVlanIds=t.data.segment_vlan_availabilities})},router_to_resource:function(){this.$router.push({name:"resourceList"})},getNetworkTypes:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_private_networktype,method:"get"}),function(t){e.networkType=[t.data],e.currentNetworkType=t.data.type})},addStorage:function(){this.storageCountArray.push({id:this.storageCount++})},removeStorage:function(e){this.storageCountArray=this.storageCountArray.filter(function(t){return t.id!=e})},showAutoAllocation:function(){this.create1=!1,this.create2=!0},prevStep:function(){this.create2=!1,this.create1=!0},handleCurrentChange:function(e){this.currentRow=e,this.templateRadio=this.currentRow.name},checkStep:function(e){var t=this;e>0?t.$refs.baseform.validate(function(s){return!!s&&(null!==t.createForm.subnetMask&&t.validateipGateway(),1!=t.occupied&&void t.$refs.createform.validate(function(s){s&&(t.stepIndex+=e)}))}):(t.stepIndex+=e,null!=this.$refs.createform&&this.$refs.createform.clearValidate())},changeswitch:function(){if(1==this.open){this.form.disk_num="1",this.form.pool_type="stripe",this.form.disk_size=1,this.form.file_size=0,this.form.object_size=0,this.form.compression="off",this.form.dedup="off",this.form.copies="1",this.form.recordsize="128K",this.form.diskspace=1,this.allocate=1,this.distributableSize=this.form.capacityexp_size-this.form.diskspace-10;var e=this.form.capacityexp_size-this.form.diskspace;this.total_redundancy=0,this.drawchart(this.form.capacityexp_size,e,this.form.file_size,this.form.object_size,this.total_redundancy)}else{var t=this.form.capacityexp_size;this.form.file_size=0,this.form.object_size=0,this.total_redundancy=0,this.form.diskspace=1,this.drawchart(this.form.capacityexp_size,t,this.form.file_size,this.form.object_size,this.total_redundancy)}},addsize:function(){var e=this.form.capacityexp_size-this.form.diskspace;"raidz1"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):this.total_redundancy=0,""==this.form.capacityexp_size&&(this.open=!1),(this.form.capacityexp_size<this.maxSize||this.form.capacityexp_size==this.maxSize)&&(this.distributableSize=this.form.capacityexp_size-this.form.diskspace-10,this.drawchart(this.form.capacityexp_size,e,this.form.file_size,this.form.object_size,this.total_redundancy))},sigledisksize:function(e){this.form.disk_size=this.twoDecimal(this.form.diskspace,this.form.disk_num),"1"==e?(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!0,this.diskstructure[2].disabled=!0,this.diskstructure[3].disabled=!0,this.diskstructure[4].disabled=!0):"2"==e?(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!0,this.diskstructure[3].disabled=!0,this.diskstructure[4].disabled=!0):"3"==e?(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!1,this.diskstructure[3].disabled=!0,this.diskstructure[4].disabled=!0):"4"==e?(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!1,this.diskstructure[3].disabled=!1,this.diskstructure[4].disabled=!0):(this.diskstructure[0].disabled=!1,this.diskstructure[1].disabled=!1,this.diskstructure[2].disabled=!1,this.diskstructure[3].disabled=!1,this.diskstructure[4].disabled=!1);var t=this.form.capacityexp_size-this.form.diskspace;"raidz1"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):"mirror"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*(this.form.disk_num-1)).toFixed(2):this.total_redundancy=0,(this.form.diskspace<this.form.capacityexp_size||this.form.diskspace==this.form.capacityexp_size)&&this.drawchart(this.form.capacityexp_size,t,this.form.file_size,this.form.object_size,this.total_redundancy)},changespace:function(){this.distributableSize=this.form.capacityexp_size-this.form.diskspace-10,this.allocate=this.form.diskspace,this.form.disk_size=this.twoDecimal(this.form.diskspace,this.form.disk_num);var e=this.form.capacityexp_size-this.form.diskspace;"raidz1"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):"mirror"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*(this.form.disk_num-1)).toFixed(2):this.total_redundancy=0,(this.form.diskspace<this.form.capacityexp_size||this.form.diskspace==this.form.capacityexp_size)&&this.drawchart(this.form.capacityexp_size,e,this.form.file_size,this.form.object_size,this.total_redundancy)},changediskstructure:function(e){if("stripe"==e){var t=this.form.capacityexp_size-this.form.diskspace;this.disknum[0].disabled=!1,this.disknum[1].disabled=!1,this.disknum[2].disabled=!1,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1,this.drawchart(this.form.capacityexp_size,t,this.form.file_size,this.form.object_size,0)}else if("mirror"==e){this.disknum[0].disabled=!0,this.disknum[1].disabled=!1,this.disknum[2].disabled=!1,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1;var s=this.form.capacityexp_size-this.form.diskspace,a=(this.form.diskspace/this.form.disk_num*(this.form.disk_num-1)).toFixed(2);this.drawchart(this.form.capacityexp_size,s,this.form.file_size,this.form.object_size,a)}else if("raidz1"==e){this.disknum[0].disabled=!0,this.disknum[1].disabled=!0,this.disknum[2].disabled=!1,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1;var i=this.form.capacityexp_size-this.form.diskspace,r=(this.form.diskspace/this.form.disk_num).toFixed(2);this.drawchart(this.form.capacityexp_size,i,this.form.file_size,this.form.object_size,r)}else if("raidz2"==e){this.disknum[0].disabled=!0,this.disknum[1].disabled=!0,this.disknum[2].disabled=!0,this.disknum[3].disabled=!1,this.disknum[4].disabled=!1;var o=this.form.capacityexp_size-this.form.diskspace,l=(this.form.diskspace/this.form.disk_num*2).toFixed(2);this.drawchart(this.form.capacityexp_size,o,this.form.file_size,this.form.object_size,l)}else if("raidz3"==e){this.disknum[0].disabled=!0,this.disknum[1].disabled=!0,this.disknum[2].disabled=!0,this.disknum[3].disabled=!0,this.disknum[4].disabled=!1;var n=this.form.capacityexp_size-this.form.diskspace,c=(this.form.diskspace/this.form.disk_num*3).toFixed(2);this.drawchart(this.form.capacityexp_size,n,this.form.file_size,this.form.object_size,c)}},changefilevalue:function(){this.form.file_size>this.form.diskspace&&(this.form.file_size=this.form.diskspace),this.form.object_size=this.form.diskspace-this.form.file_size,this.allocate=this.form.diskspace-this.form.file_size-this.form.object_size,this.form.diskspace==this.form.file_size+this.form.object_size&&(this.showfilealert=!1),this.percentage=Math.round(this.form.file_size/(this.form.file_size+this.form.object_size)*100),""==this.form.file_size&&""==this.form.object_size?e(".ratios .el-progress-bar__outer").css("background","#d7e1e3"):e(".ratios .el-progress-bar__outer").css("background","#9577ef"),"raidz1"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):this.total_redundancy=0;var t=this.form.capacityexp_size-this.form.diskspace;this.drawchart(this.form.capacityexp_size,t,this.form.file_size,this.form.object_size,this.total_redundancy)},changeobjectvalue:function(){this.form.object_size>this.form.diskspace&&(this.form.object_size=this.form.diskspace),this.form.file_size=this.form.diskspace-this.form.object_size,this.allocate=this.form.diskspace-this.form.file_size-this.form.object_size,this.form.diskspace==this.form.file_size+this.form.object_size&&(this.showfilealert=!1),this.percentage=Math.round(this.form.file_size/(this.form.file_size+this.form.object_size)*100),""==this.form.file_size&&""==this.form.object_size?e(".ratios .el-progress-bar__outer").css("background","#d7e1e3"):e(".ratios .el-progress-bar__outer").css("background","#9577ef"),"raidz1"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num).toFixed(2):"raidz2"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*2).toFixed(2):"raidz3"==this.form.pool_type?this.total_redundancy=(this.form.diskspace/this.form.disk_num*3).toFixed(2):this.total_redundancy=0;var t=this.form.capacityexp_size-this.form.diskspace;this.drawchart(this.form.capacityexp_size,t,this.form.file_size,this.form.object_size,this.total_redundancy)},isshow:function(){this.isShow=!this.isShow},router_to_poollist:function(){this.$router.push({name:"storagepoolIndex"})},getstatus:function(e){var t=this;this.$http({url:this.common.formatMsg(this.api.cloud.getpoolstatus,{pool_id:e}),method:"get"}).then(function(e){0!==e.data.data&&2!==e.data.data||(t.Hub.$emit("getResource"),clearInterval(t.timercreatePool),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.createResourceSuccess}))})},submitData:function(e){var t=this;if(1==this.open){if(this.form.diskspace!=this.form.file_size+this.form.object_size)return this.showfilealert=!0,!1;this.showfilealert=!1}this.$refs.form.validate(function(e){e&&(t.dialogVisible=!0)})},lastsubmit:function(){var e=this,t=void 0,s=e.common.deepCopyByJson(e.createForm);if(this.disable=!0,this.dialogVisible=!1,0==this.availableAddress&&(s.subnet.allocation_pools=[{start:null,end:null}]),1==this.open&&this.form.diskspace>this.form.file_size+this.form.object_size)return this.showfilealert=!0,!1;s.subnet.cidr=s.subnetIp+"/"+e.common.switchToNumberCount(s.subnetMask),""!==s.dnsNameservers&&null!=s.dnsNameservers&&(s.subnet.dns_nameservers=s.dnsNameservers.split(/\n/g)),""!==s.hostRoutes&&null!=s.hostRoutes&&(s.subnet.host_routes=e.FormatRouters(s.hostRoutes)),s.subnet.allocation_pools=e.validateAllocation(s.subnet.allocation_pools),s=e.common.dropEmptyParameter(s),e.baseForm=e.common.dropEmptyParameter(e.baseForm),!1===e.enableGateway&&(s.subnet.gateway_ip=null),t=1==this.open?{storage_id:this.storage_id,total_size:this.common.switchCapacity(this.form.capacityexp_size,"GB","B"),file_size:this.common.switchCapacity(this.form.file_size,"GB","B"),object_size:this.common.switchCapacity(this.form.object_size,"GB","B"),pool_type:this.form.pool_type,disk_size:Math.round(this.common.switchCapacity(this.form.disk_size,"GB","B")),disk_num:this.form.disk_num,compression:this.form.compression,dedup:this.form.dedup,copies:this.form.copies,recordsize:this.form.recordsize,file_and_object_storage_type:"zfs"}:{storage_id:this.storage_id,total_size:this.common.switchCapacity(this.form.capacityexp_size,"GB","B")};var a={is_external:!1,network:s.network,subnet:s.subnet};this.checkError(this.$http({url:this.api.cloud.get_pools,method:"post",data:{name:this.baseForm.name,cpu_limit:parseInt(this.baseForm.cpu_limit),gpu_quota:this.baseForm.gpu_limit,memory_limit:this.common.switchCapacity(this.baseForm.memory_limit,"GB","MB",0),description:this.baseForm.description,init_info:t,network_info:a}}),function(t){var s=(new Date).getTime();e.timercreatePool=setInterval(function(){(new Date).getTime()-s<12e4?e.getstatus(t.data.id):clearInterval(e.timercreatePool)},3e3),e.timer.push(e.timercreatePool),e.router_to_resource(),e.$notify({title:e.lang.common.success,type:"success",message:"正在创建"})},function(t){e.disable=!1})},drawchart:function(e,t,s,a,i){var r=this.$echarts.init(document.getElementById("platechart"));r.clear(),r.setOption({tooltip:{trigger:"item",formatter:"{b}"},legend:{orient:"vertical",left:40,bottom:0,data:["块   占用"+t+"GB","文件  占用"+s+"GB","对象  占用"+a+"GB"]},color:["#60abfc","#576cdd","#9577ef","#d7e1e4"],graphic:{type:"text",top:"center",left:"center",style:{text:e+"GB \n 冗余:"+i+"GB",fill:"#A2ACBA",fontSize:14,lineHeight:20}},series:[{name:"池的总量",type:"pie",radius:["50%","60%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:t,name:"块   占用"+t+"GB"},{value:s,name:"文件  占用"+s+"GB"},{value:a,name:"对象  占用"+a+"GB"}]}]})},init:function(){this.chart1=this.$echarts.init(this.$refs.myEchart),this.chart1.resize()},changesubnetIp:function(){this.$refs.createform.validateField("subnetIp")},changesubnetMask:function(){this.$refs.createform.validateField("subnetMask")}},watch:{currentNetworkType:function(){var e=this;this.physicNetwork=null,this.physics=this.originPhysics.filter(function(t){return t.networkType.toLowerCase()===e.currentNetworkType})},physicNetwork:function(){null==this.physicNetwork?this.currentVlanIds=[]:this.currentVlanIds=this.existVlanIds[0].vlan_id_used},"createForm.subnetIp":function(){this.gatewayRange=this.setGatewayRange(),this.$refs.createform.validateField("subnet.gateway_ip")},"createForm.subnetMask":function(){this.gatewayRange=this.setGatewayRange(),this.$refs.createform.validateField("subnet.gateway_ip")}},destroyed:function(){window.removeEventListener("resize",this.init,20)}}}).call(t,s("qqHy"))},"v/A0":function(e,t){},vXa4:function(e,t){}});