webpackJsonp([69],{"72Dr":function(t,e){},entb:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o={name:"storagePool",components:{"pana-breadcrumb":a("1JPr").a},data:function(){return{poolUser:[],poolData:[],tableData:[],pageNum:1,pageSize:10,drawChart:!1,search:"",poolid:"",pooldetail:"",blockused:"",block_free:"",block_redundancy:"",totalblock:"",file_used:"",file_free:"",file_redundancy:"",totalfile:"",object_used:"",object_free:"",object_redundancy:"",totalobject:"",loading:!1,loadingTable:!1,total_redundancy:""}},methods:{getPoolList:function(){var t=this;this.common.is_system_admin()?(t.loadingTable=!0,this.checkError(this.$http({url:this.api.storage.get_storagepool,method:"get"}),function(e){t.loadingTable=!1,t.poolData=e.data},function(e){t.loadingTable=!1})):(t.loadingTable=!0,this.checkError([this.$http({url:t.api.management.pool_user+t.common.formatGetUrl({pool_id:0}),method:"get"}),this.$http({url:this.api.storage.get_storagepool,method:"get"})],function(e){t.loadingTable=!1,t.poolUser=e[0].data,t.poolData=e[1].data},function(e){t.loadingTable=!1}))},pageSelect:function(t){this.pageNum=t},showCurrentChart:function(t,e){this.poolid=t,this.loading=!0,this.getpoolDetail(this.poolid,e)},getpoolDetail:function(t,e){var a=this;this.checkError(this.$http({url:a.common.formatMsg(a.api.storage.get_poolusedetail,{pool_id:t}),method:"get"}),function(e){if(a.loading=!1,a.poolid!==t)return!1;a.pooldetail=e.data,a.blockused=a.common.switchCapacity(e.data.block_used,"B","GB",2),a.block_free=a.common.switchCapacity(e.data.block_free,"B","GB",2),a.block_redundancy=a.common.switchCapacity(e.data.block_redundancy,"B","GB",2),a.totalblock=a.common.switchCapacity(e.data.block_size,"B","GB",2),a.file_used=a.common.switchCapacity(e.data.file_used,"B","GB",2),a.file_free=a.common.switchCapacity(e.data.file_free,"B","GB",2),a.file_redundancy=a.common.switchCapacity(e.data.file_redundancy,"B","GB",2),a.totalfile=a.common.switchCapacity(e.data.file_size,"B","GB",2),a.object_used=a.common.switchCapacity(e.data.object_used,"B","GB",2),a.object_free=a.common.switchCapacity(e.data.object_free,"B","GB",2),a.object_redundancy=a.common.switchCapacity(e.data.object_redundancy,"B","GB",2),a.totalobject=a.common.switchCapacity(e.data.object_size,"B","GB",2),a.total_redundancy=a.common.switchCapacity(e.data.total_redundancy,"B","GB",2)})},permissionManage:function(t){var e=!0;return!!this.common.is_system_admin()||(this.poolUser.filter(function(a){if(a.pool===t)return e=a.is_admin,!0}),e)},sortChange:function(t){var e=null==t.order?0:"ascending"===t.order?1:-1;this.poolData=this.poolData.sort(function(a,o){return(a[t.prop]>o[t.prop]?1:-1)*e})}},computed:{filterData:function(){var t=this.search,e=[];return e=""===t?this.poolData:this.common.cloudFilter(this.poolData,t),e},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},mounted:function(){var t=this;this.getPoolList(),this.$ws.setCallback(function(e){var a=t.wsEventQueue.indexOf(e.resource_id);if(-1!==a){var o=e.event_type.split(".");"storage"===o[1]&&"end"===o[3]&&(t.getPoolList(),t.wsEventQueue.splice(a,1))}})},watch:{search:function(){this.pageNum=1}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb"),t._v(" "),a("el-main",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col"),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getPoolList}})],1)],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingTable,expression:"loadingTable"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:t.pagedData,"tooltip-effect":"dark"},on:{"sort-change":t.sortChange}},[a("el-table-column",{attrs:{label:t.lang.common.name,prop:"name",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{label:t.lang.storagePool.spaceRatio},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"usespace"},[a("el-popover",{attrs:{trigger:"hover",placement:"right"},on:{show:function(a){return t.showCurrentChart(e.row.pool_id,e.$index)}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("div",{staticClass:"blockDescription"},[a("span",[t._v("块：")]),t._v("已用"+t._s(t.blockused)+"GB,可用"+t._s(t.block_free)+"GB")]),t._v(" "),a("div",{staticClass:"fileDescription"},[a("span",[t._v("文件：")]),t._v("已用"+t._s(t.file_used)+"GB,可用"+t._s(t.file_free)+"GB")]),t._v(" "),a("div",{staticClass:"objectDescription"},[a("span",[t._v("对象：")]),t._v("已用"+t._s(t.object_used)+"GB,可用"+t._s(t.object_free)+"GB")]),t._v(" "),a("div",{staticClass:"redundancyDescription"},[a("span",[t._v("冗余：")]),t._v(t._s(t.total_redundancy)+"GB")])]),t._v(" "),a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("div",{staticClass:"unallocated"},[a("div",{staticClass:"block",style:"width:"+e.row.block_ratio+"%"}),t._v(" "),a("div",{staticClass:"file",style:"width:"+e.row.file_ratio+"%"}),t._v(" "),a("div",{staticClass:"object",style:"width:"+e.row.object_ratio+"%"})])])])],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[0==e.row.status?a("span",{staticClass:"status normal"},[t._v("正常")]):t._e(),t._v(" "),2==e.row.status?a("span",{staticClass:"status error"},[t._v("错误")]):t._e(),t._v(" "),1==e.row.status?a("span",{staticClass:"status exception"},[t._v("异常")]):t._e(),t._v(" "),3==e.row.status?a("span",{staticClass:"status other"},[t._v("其他")]):t._e(),t._v(" "),4==e.row.status?a("span",{staticClass:"status creating"},[t._v("创建中")]):t._e(),t._v(" "),5==e.row.status?a("span",{staticClass:"status creating"},[t._v("扩容中")]):t._e(),t._v(" "),6==e.row.status?a("span",{staticClass:"status deleting"},[t._v("删除中")]):t._e()]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:t.lang.common.createTime,sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("utc2beijing")(e.row.create_time))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{label:t.lang.common.operation},scopedSlots:t._u([{key:"default",fn:function(e){return[t.permissionManage(e.row.pool_id)?a("el-button",{attrs:{type:"text",disabled:6==e.row.status||4==e.row.status},on:{click:function(a){return t.$router.push({name:"poolinit",params:{id:e.row.pool_id,isinit:e.row.gateway_init_state}})}}},[t._v("\n                        "+t._s(t.lang.storagePool.poolmanage)+"\n                    ")]):t._e(),t._v(" "),1==e.row.gateway_init_state?a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.$router.push({name:"poolMonitor",params:{id:e.row.pool_id}})}}},[t._v("\n                        "+t._s(t.lang.storagePool.poolMonitor)+"\n                    ")]):t._e()]}}])})],1),t._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.filterData.length>t.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.filterData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1)],1)],1)},staticRenderFns:[]};var n=a("C7Lr")(o,s,!1,function(t){a("tNc1"),a("72Dr")},"data-v-773fd91c",null);e.default=n.exports},tNc1:function(t,e){}});