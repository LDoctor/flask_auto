webpackJsonp([73],{"1xah":function(e,t){},GELB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("3cXf"),o=a.n(s),r=a("1JPr"),i=a("/n4h"),n={data:function(){return{sortOrder:0,sortProp:"",loading:!0,dialogVisible:!1,tipDialogMsg:"",tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,operate:"",id:"",detailId:"",timerforceDelete:"",clearName:"",ids:[],quotaNotEnough:!1,disable:!1,disableArr:[]}},created:function(){this.getList()},components:{panaBreadcrumb:r.a,cloudTipDialog:i.a},mounted:function(){var e=this;this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var a=t.event_type.split(".");"compute"===a[0]&&"end"===a[3]&&e.getList()}})},methods:{selectable:function(e,t){return"deleting"!=e.status&&"restoring"!=e.status},dialogClose:function(){this.dialogVisible=!1,this.ids=[],this.disableArr=[],this.quotaNotEnough=!1,this.tipDialogMsg=""},sort:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.sortProp=e.prop,this.sortOrder=t,this.tableData=this.tableData.sort(function(a,s){return a[e.prop]=null==a[e.prop]?"":a[e.prop],s[e.prop]=null==s[e.prop]?"":s[e.prop],a[e.prop]==s[e.prop]?s.created-a.created:(a[e.prop]>s[e.prop]?1:-1)*t})},clearConfirm:function(){this.operate="clear",this.dialogVisible=!0,this.tipDialogMsg=this.lang.resource.confirm_clear,this.disable=!1},rescueConfirm:function(e){var t=this,a="",s=0,o=0,r=0,i=0,n=JSON.parse(sessionStorage.getItem("panaCurrentPool")).id,l=[];this.disable=!1,e?(this.ids.push(e),this.disableArr.push(e)):this.ids=this.multipleSelection.map(function(e){return e.id}),this.ids.forEach(function(e){a=t.common.formatMsg(t.api.cloud.get_pool_servers_detail,{server_id:e}),l.push(t.$http({url:a,method:"get"}))}),l.push(this.$http({url:this.common.formatMsg(this.api.cloud.get_pools_detail,{pool_id:n}),method:"get"})),this.checkError(l,function(e){var a=e.length,n=e[a-1].data;r=n.cpu_limit-n.cpu_used,i=n.memory_limit-n.memory_used;for(var l=0;l<a-1;l++)s+=e[l].data.vcpus,o+=e[l].data.ram;s>r&&(t.tipDialogMsg="业务池CPU配额不足</br>",t.quotaNotEnough=!0),o>i&&(t.tipDialogMsg+="业务池内存配额不足</br>",t.quotaNotEnough=!0),""===t.tipDialogMsg&&(t.tipDialogMsg=t.lang.resource.confirm_rescue),t.operate="rescue",t.dialogVisible=!0})},forceDeleteConfirm:function(e){e?(this.ids.push(e),this.disableArr.push(e)):this.ids=this.multipleSelection.map(function(e){return e.id}),this.operate="forceDelete",this.dialogVisible=!0,this.disable=!1,this.tipDialogMsg=this.lang.resource.confirm_force_delete},dialogConfirm:function(){var e=this,t=e.ids;switch(e.disable=!0,this.operate){case"clear":var a=[];this.multipleSelection.forEach(function(e){a.push(e.id)});var s=this.common.formatGetUrl({id:a});sessionStorage.setItem("selectRecyles",o()(this.multipleSelection)),e.detailId=a;var r=(new Date).getTime();this.checkError(this.$http({url:this.api.cloud.recovery+s,method:"delete"}),function(t){e.dialogVisible=!1,e.$notify({title:e.lang.common.success,type:"success",message:"正在清除"}),e.pagedData.forEach(function(t){e.detailId.forEach(function(e){e===t.id&&(t.status="deleting")})}),e.$set(e.pagedData,e.pagedData),e.detailId.forEach(function(t,a){var s=setInterval(function(){(new Date).getTime()-r<12e4?e.getstatus(t,s):clearInterval(s)},3e3);e.timer.push(s)})},function(){e.disable=!1});break;case"rescue":this.checkError(this.$http({url:this.api.cloud.recovery,method:"post",data:{action:"restore",id:e.ids}}),function(){e.dialogVisible=!1,t.forEach(function(t){e.wsEventQueue.push(t)}),e.pagedData.forEach(function(t){e.ids.forEach(function(e){e===t.id&&(t.status="restoring")})}),e.$set(e.pagedData,e.pagedData)},function(){e.disable=!1,this.disableArr=[]});break;case"forceDelete":this.checkError(this.$http({url:this.api.cloud.recovery,method:"post",data:{action:"force",id:e.ids}}),function(a){e.dialogVisible=!1,t.forEach(function(t){e.wsEventQueue.push(t)}),e.pagedData.forEach(function(t){e.ids.forEach(function(e){e===t.id&&(t.status="deleting")})}),e.$set(e.pagedData,e.pagedData)},function(){e.disable=!1,this.disableArr=[]})}},notSelect:function(){return this.multipleSelection.length<=0},getforcedeleteStatus:function(e){var t=this;this.$http({url:this.common.formatMsg(this.api.cloud.getcompoentstatus,{server_id:e}),method:"get"}).then(function(e){200303===e.data.code&&(clearInterval(t.timerforceDelete),t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.resource.forceDeleteRecycleSuccess}))})},getstatus:function(e,t){var a=this;this.$http({url:this.common.formatMsg(this.api.cloud.getcompoentstatus,{server_id:e}),method:"get"}).then(function(s){200303===s.data.code&&(JSON.parse(sessionStorage.getItem("selectRecyles")).forEach(function(t){t.id===e&&(a.clearName=t.name)}),a.getList(),a.$notify({title:a.lang.common.success,type:"success",message:a.clearName+"清除成功"}),clearInterval(t))})},getList:function(){var e=this,t=[];e.loading=!0,this.checkError(this.$http({url:this.api.cloud.recovery,method:"get"}),function(a){e.loading=!1,e.tableData=a.data,e.tableData.map(function(e){for(var a in t=[],e.image_name=e.image.image_name,e.addresses)e.addresses[a].forEach(function(e){e.addr&&t.push(e.addr)});e.ips=t})},function(t){e.loading=!1})},pageSelect:function(e){this.pageNum=e},handleSelectionChange:function(e){this.multipleSelection=e}},computed:{clearDisabled:function(){if(this.notSelect())return!0},filterData:function(){var e=this.search,t=this,a=[];return a=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),a.sort(function(e,a){return e[t.sortProp]=null==e[t.sortProp]?"":e[t.sortProp],a[t.sortProp]=null==a[t.sortProp]?"":a[t.sortProp],e[t.sortProp]==a[t.sortProp]?a.created-e.created:(e[t.sortProp]>a[t.sortProp]?1:-1)*t.sortOrder})},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}},destroyed:function(){for(var e=0;e<this.timer.length;e++)clearInterval(this.timer[e]);sessionStorage.removeItem("selectRecyles")}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mainDiv",attrs:{id:"rescyle"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-row",[a("el-alert",{attrs:{title:e.lang.resource.recyle_info,type:"bg-orange",closable:!1}})],1),e._v(" "),a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:e.clearDisabled,type:"primary"},on:{click:e.clearConfirm}},[e._v(e._s(e.lang.resource.clear))]),e._v(" "),a("el-button",{attrs:{disabled:e.clearDisabled},on:{click:function(t){return e.rescueConfirm()}}},[e._v(e._s(e.lang.resource.rescue)+"\n                ")]),e._v(" "),a("el-button",{attrs:{disabled:e.clearDisabled},on:{click:function(t){return e.forceDeleteConfirm()}}},[e._v(e._s(e.lang.resource.forceDelete)+"\n                ")])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45",selectable:e.selectable}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:e.lang.resource.componentName}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"status",label:e.lang.common.status},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"status",class:e.common.statusClass(t.row.status)},[e._v(e._s(e.lang.resource.componentStatusArray[t.row.status])+"\n                    ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"image_name",label:e.lang.resource.imageName}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"ips",label:e.lang.outside.privateIp},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{innerHTML:e._s(t.row.ips.join("</br>"))}})]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"created",label:e.lang.common.create_time},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e._f("utc2beijing")(t.row.created))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"updated",label:e.lang.resource.delete_time},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e._f("utc2beijing")(t.row.updated))+"\n                ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation,width:200},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",disabled:"restoring"===t.row.status||"deleting"===t.row.status},on:{click:function(a){return e.rescueConfirm(t.row.id)}}},[e._v(e._s(e.lang.resource.rescue)+"\n                    ")]),e._v(" "),a("el-button",{attrs:{type:"text",disabled:"restoring"===t.row.status||"deleting"===t.row.status},on:{click:function(a){return e.forceDeleteConfirm(t.row.id)}}},[a("span",{staticClass:"force-delete"},[e._v(e._s(e.lang.resource.forceDelete))])])]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:e.dialogVisible,confirmDisabled:e.quotaNotEnough||e.disable},on:{cancel:e.dialogClose,confirm:e.dialogConfirm}},[a("div",{class:{"quota-error":e.quotaNotEnough},domProps:{innerHTML:e._s(e.tipDialogMsg)}})])],1)},staticRenderFns:[]};var c=a("C7Lr")(n,l,!1,function(e){a("jE+Y"),a("1xah")},"data-v-4ec3bb6b",null);t.default=c.exports},"jE+Y":function(e,t){}});