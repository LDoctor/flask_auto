webpackJsonp([74],{iN3p:function(e,t){},mmQy:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("1JPr"),i=a("aA9S"),s=a.n(i),l={props:{show:Boolean},data:function(){return{publicShow:!0,form:{image_name:"",os_type:"windows",os_distro:"Windows7",source_image_id:"",network_id:"",flavor:"",disk_size:"",is_private:!1,attach_iso:[]},additional_tool_disk:!1,isoOptions:[],networks:[],flavors:[],gigabytes_total:0,gigabytes_used:0,gigabytes_used_val:0,volumeQuota:0,gigabytesPercent:0,gigabytesPercentVal:0,rules:{image_name:[{required:!0,message:this.lang.common.required_item,trigger:"blur"},{validator:this.common.validateName7,trigger:"blur"}],source_image_id:[{required:!0,message:this.lang.common.required_item,trigger:"chang"}],network_id:[{required:!0,message:this.lang.common.required_item,trigger:"chang"}],flavor:[{required:!0,message:this.lang.common.required_item,trigger:"chang"}],disk_size:[{required:!0,message:this.lang.common.validateNumber,trigger:"blur"},{min:1,max:50,type:"integer",message:this.lang.imageManage.validDiskSize,trigger:"blur"},{validator:this.validatorDisk,trigger:"blur"}]},loading:!1}},methods:{newSizeFn:function(){this.gigabytes_used_val=this.form.disk_size/1+this.gigabytes_used/1,this.gigabytesPercentVal=this.gigabytes_used_val/this.gigabytes_total*100},validatorDisk:function(e,t,a){t>this.volumeQuota?a(new Error("不能超出磁盘剩余可用"+this.volumeQuota)):a()},getQuotaDetail:function(){var e=this;this.checkError(this.$http({method:"get",url:e.api.quota.get_pool_quota,params:{check:"stg"}}),function(t){var a=t.data;e.gigabytes_total=a.gigabytes_total,e.gigabytes_used=a.gigabytes_used,e.gigabytes_used_val=a.gigabytes_used;var o=Number(a.gigabytes_total-a.gigabytes_used);e.gigabytesPercent=a.gigabytes_used/a.gigabytes_total*100,e.gigabytesPercentVal=e.gigabytesPercent,e.volumeQuota=o>0?o:0},function(){})},initForm:function(){this.$refs.form&&this.$refs.form.resetFields(),this.getQuotaDetail(),this.getImages(),this.getNetworks(),this.getFlavors(),this.permitionManage()},permitionManage:function(){var e=this,t=JSON.parse(sessionStorage.getItem("panaCurrentPool"));this.common.is_system_admin()||(e.publicShow=!0,this.common.permissionManage(e,t.id,function(){e.publicShow=!1,e.form.is_private=!0}))},getImages:function(){var e=this;this.checkError(this.$http({url:this.api.cloud.get_images,method:"get"}),function(t){e.isoOptions=t.data,e.isoOptions=e.isoOptions.filter(function(e){return"iso"===e.disk_format})})},getNetworks:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.cloud.get_networks,method:"get"}),function(t){e.networks=t.data,e.networks.length>0&&(e.form.network_id=e.networks[0].id),e.loading=!1},function(){e.loading=!1})},getFlavors:function(){var e=this;this.loading=!0,this.checkError(this.$http({url:this.api.management.get_flavors,method:"get"}),function(t){e.flavors=t.data,e.flavors.length>0&&(e.form.flavor=e.flavors[0].id),e.loading=!1},function(){e.loading=!1})},confirm:function(){var e=this,t=this.form;this.$refs.form.validate(function(a){a&&(e.closeModal(),e.checkError(e.$http({url:e.api.cloud.get_make_image,method:"post",data:t}),function(t){e.$emit("getList"),e.wsEventQueue.push(t.data.instance_id),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.imageManage.makingImage})}))})},closeModal:function(e){s()(this.$data,this.$options.data.call(this)),e=e||!1,this.$emit("closeModal",e)}},computed:{operateSystems:function(){var e=[],t=this.form.os_type;return this.lang.imageManage.osTypeOptions.forEach(function(a){a.value==t&&(e=a.os)}),this.form.os_distro=e[0],e},isoFilter:function(){var e,t=this;return(e=this.isoOptions.filter(function(e){return e.os_type===t.form.os_type})).length>0?t.form.source_image_id=e[0].id:t.form.source_image_id="",e},attachIsoFilter:function(){var e=this;return this.isoOptions.filter(function(t){return t.id!==e.form.source_image_id})}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:e.lang.imageManage.newImage,visible:e.show,modal:!0,top:"8vh",width:"40%"},on:{open:e.initForm,close:e.closeModal}},[a("el-alert",{attrs:{title:e.lang.imageManage.makeImageInfo,type:"bg-blue",closable:!1}}),e._v(" "),a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"form",attrs:{model:e.form,"label-width":"100px",rules:e.rules,"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)"}},[a("el-form-item",{attrs:{label:e.lang.imageManage.imageName,prop:"image_name"}},[a("el-input",{attrs:{placeholder:e.lang.imageManage.imageNamePlaceholder},model:{value:e.form.image_name,callback:function(t){e.$set(e.form,"image_name",t)},expression:"form.image_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.imageManage.osType}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.os_type,callback:function(t){e.$set(e.form,"os_type",t)},expression:"form.os_type"}},e._l(e.lang.imageManage.osTypeOptions,function(e,t){return a("el-option",{key:t,attrs:{label:e.text,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.imageManage.osSystem}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.os_distro,callback:function(t){e.$set(e.form,"os_distro",t)},expression:"form.os_distro"}},e._l(e.operateSystems,function(e,t){return a("el-option",{key:t,attrs:{value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.imageManage.ISO,prop:"source_image_id"}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.source_image_id,callback:function(t){e.$set(e.form,"source_image_id",t)},expression:"form.source_image_id"}},e._l(e.isoFilter,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.imageManage.network,prop:"network_id"}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.network_id,callback:function(t){e.$set(e.form,"network_id",t)},expression:"form.network_id"}},e._l(e.networks,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.imageManage.configuration_type,prop:"flavor"}},[a("el-select",{attrs:{filterable:""},model:{value:e.form.flavor,callback:function(t){e.$set(e.form,"flavor",t)},expression:"form.flavor"}},e._l(e.flavors,function(t){return a("el-option",{key:t.id,attrs:{label:e.common.formatMsg(e.lang.imageManage.flavorLabel,{name:t.name,cpu:t.vcpus,ram:e.common.switchCapacity(t.ram,"MB","GB")}),value:t.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.imageManage.disk,prop:"disk_size"}},[a("el-input",{directives:[{name:"disbledScroll",rawName:"v-disbledScroll"}],attrs:{type:"number",placeholder:e.lang.imageManage.diskPlaceholder},on:{input:e.newSizeFn},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.form.disk_size,callback:function(t){e.$set(e.form,"disk_size",e._n(t))},expression:"form.disk_size"}})],1),e._v(" "),a("el-form-item",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"clearfix"},[a("span",{staticClass:"fl"},[e._v(e._s(e.lang.cloudDisk.diskQuata))]),e._v(" "),a("span",{staticClass:"fr"},[e._v(e._s(e.lang.cloudDisk.used)+e._s(e.gigabytes_used_val)+"/"+e._s(e.gigabytes_total))])]),e._v(" "),a("el-progress",{attrs:{percentage:e.gigabytesPercentVal,"show-text":!1}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-radio-group",{model:{value:e.form.is_private,callback:function(t){e.$set(e.form,"is_private",t)},expression:"form.is_private"}},[e.publicShow?a("el-radio",{attrs:{label:!1}},[e._v(e._s(e.lang.imageManage.public))]):e._e(),e._v(" "),a("el-radio",{attrs:{label:!0}},[e._v(e._s(e.lang.imageManage.private))])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:e.lang.imageManage.additional_tool_disk}},[a("el-checkbox",{model:{value:e.additional_tool_disk,callback:function(t){e.additional_tool_disk=t},expression:"additional_tool_disk"}})],1),e._v(" "),e.additional_tool_disk?a("el-form-item",{attrs:{label:e.lang.imageManage.tool_disk}},[a("el-select",{attrs:{filterable:"",multiple:"","multiple-limit":2},model:{value:e.form.attach_iso,callback:function(t){e.$set(e.form,"attach_iso",t)},expression:"form.attach_iso"}},e._l(e.attachIsoFilter,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]};var r=a("C7Lr")(l,n,!1,function(e){a("iN3p")},"data-v-1cdee025",null).exports,c={props:{show:Boolean,imageDetail:Object,ids:Array},methods:{closeModal:function(e){e=e||!1,this.$emit("closeModal",e)},confirm:function(){var e=this,t=this.api.cloud.make_image_register;e.closeModal(),this.checkError(this.$http({url:t,method:"POST",data:e.imageDetail}),function(t){e.$emit("getList"),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.imageManage.registerImageSuccess})})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"cloud-tipDialog",attrs:{title:e.lang.common.info,visible:e.show,width:"30%",modal:!0},on:{close:e.closeModal}},[a("el-row",{attrs:{type:"flex",justify:"center"}},[a("el-col",{attrs:{span:16}},[e._v(e._s(e.lang.imageManage.registerInfo))])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeModal}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.lang.common.confirm))])],1)],1)},staticRenderFns:[]},m=a("C7Lr")(c,g,!1,null,null,null).exports,u={data:function(){return{sortOrder:0,sortProp:"",tableData:[],multipleSelection:[],search:"",pageNum:1,pageSize:10,showCreate:!1,showRegister:!1,loading:!0,fileName:"",deleteDialogVisible:!1,consoleDialogVisible:!1,deleteItem:"",consoleUrl:"",info:{content:"",bgStyle:"primary"},componentDetailData:{},currentImage:null}},components:{panaBreadcrumb:o.a,panaCreate:r,panaRegister:m},mounted:function(){var e=this;this.getList(),this.$ws.setCallback(function(t){if(-1!==e.wsEventQueue.indexOf(t.resource_id)){var a=t.event_type.split(".");("compute"===a[0]&&"instance"===a[1]&&("end"===a[3]||"error"===a[3])||"compute_task"===a[0]&&"build_instances"===a[1])&&e.getList()}})},methods:{selectNotOne:function(){return 1!==this.multipleSelection.length},startServer:function(){var e=this.imageDetail.instance_id,t=this.common.formatMsg(this.api.cloud.post_pool_servers_detail_action,{server_id:e});this.consoleDialogVisible=!1,this.$refs.multipleTable.clearSelection(),this.checkError(this.$http({url:t,method:"post",data:{"os-start":null}}))},open_vnc:function(){var e=this.imageDetail.instance_id;"SHUTOFF"===this.componentDetailData.status?this.consoleDialogVisible=!0:window.open("_blank",e,"toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1200 height=900 left=200 top=50").location=this.consoleUrl},getList:function(){this.loading=!1;var e=this;this.checkError(this.$http({url:this.api.cloud.get_make_image,method:"get"}),function(t){e.loading=!1,e.tableData=t.data},function(t){e.loading=!1})},sort:function(e){var t=null==e.order?0:"ascending"===e.order?1:-1;this.sortProp=e.prop,this.sortOrder=t,this.tableData=this.tableData.sort(function(a,o){return a[e.prop]=null==a[e.prop]?"":a[e.prop],o[e.prop]=null==o[e.prop]?"":o[e.prop],(a[e.prop]>o[e.prop]?1:-1)*t})},closeCreate:function(){this.showCreate=!1},closeRegister:function(){this.showRegister=!1},pageSelect:function(e){this.pageNum=e},handleChange:function(e){this.fileName=e.name},handleSelectionChange:function(e){if(this.multipleSelection=e,1===this.multipleSelection.length&&2===this.multipleSelection[0].os_status){var t=this.multipleSelection[0].instance_id;this.getComponentDetail(t),this.getConsole(t)}else this.consoleUrl="",this.componentDetailData={}},getComponentDetail:function(e){var t=this,a=this.common.formatMsg(this.api.cloud.get_pool_servers_detail,{server_id:e});this.checkError(this.$http({url:a,method:"get"}),function(e){t.componentDetailData=e.data})},deleteConfirm:function(){this.deleteDialogVisible=!0},deleteMethod:function(){var e=this;e.deleteDialogVisible=!1,this.checkError(this.$http({url:e.api.cloud.make_image_delete,method:"POST",data:e.currentImage}),function(t){e.getList(),e.$notify({title:e.lang.common.success,type:"success",message:e.lang.imageManage.deleteImageSuccess})})},getConsole:function(){var e=this,t=this.imageDetail.instance_id,a=this.common.formatMsg(e.api.cloud.post_pool_servers_detail_remote_console,{server_id:t});this.checkError(this.$http({url:a,method:"post"}),function(t){e.consoleUrl=t.data.console.url})},deleteImage:function(e){this.deleteDialogVisible=!0,this.currentImage=e}},watch:{search:function(){this.pageNum=1}},computed:{imageDetail:function(){return this.multipleSelection.length>0?this.multipleSelection[0]:{}},vncDisabled:function(){return!!this.selectNotOne()||(!this.consoleUrl||!this.componentDetailData.hasOwnProperty("status"))},registerDisabled:function(){return!!this.selectNotOne()||2!==this.multipleSelection[0].os_status},deleteDisabled:function(){return!!this.selectNotOne()||1===this.multipleSelection[0].os_status},filterData:function(){var e=this.search,t=this,a=[];return a=""===e?this.tableData:this.common.cloudFilter(this.tableData,e),a.sort(function(e,a){return e[t.sortProp]=null==e[t.sortProp]?"":e[t.sortProp],a[t.sortProp]=null==a[t.sortProp]?"":a[t.sortProp],(e[t.sortProp]>a[t.sortProp]?1:-1)*t.sortOrder})},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"col mainDiv",attrs:{id:"image-list"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:e.getList}}),e._v(" "),a("el-main",[a("el-row",{attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCreate=!0}}},[e._v(e._s(e.lang.common.create))]),e._v(" "),a("el-button",{attrs:{disabled:e.vncDisabled},on:{click:e.open_vnc}},[e._v(e._s(e.lang.common.console))]),e._v(" "),a("el-button",{attrs:{disabled:e.registerDisabled},on:{click:function(t){e.showRegister=!0}}},[e._v(e._s(e.lang.imageManage.registerImage))])],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:e.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:e.getList}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":e.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:e.pagedData},on:{"sort-change":e.sort,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"image_name",label:e.lang.imageManage.imageName}}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"os_status",label:e.lang.imageManage.status},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"status",class:{"cloud-success":2===t.row.os_status||4===t.row.os_status||5===t.row.os_status,"bg-blue":1===t.row.os_status||3===t.row.os_status,"cloud-warning":6===t.row.os_status||7===t.row.os_status}},[e._v(e._s(e.lang.imageManage.os_status[t.row.os_status]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"is_private",label:e.lang.imageManage.is_private},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                        "+e._s(t.row.is_private?e.lang.imageManage.yes:e.lang.imageManage.no)+"\n                    ")]}}])}),e._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"os_type",label:e.lang.imageManage.osSystem}}),e._v(" "),a("el-table-column",{attrs:{label:e.lang.common.operation},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{disabled:1===t.row.os_status,type:"text"},on:{click:function(a){return e.deleteImage(t.row)}}},[e._v(e._s(e.lang.common.delete))])]}}])})],1),e._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[e.filterData.length>e.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":e.lang.common.prevPage,"next-text":e.lang.common.nextPage,total:e.filterData.length,"current-page":e.pageNum},on:{"current-change":e.pageSelect}}):e._e()],1)],1),e._v(" "),a("pana-create",{attrs:{show:e.showCreate},on:{closeModal:e.closeCreate,getList:e.getList}}),e._v(" "),a("pana-register",{attrs:{show:e.showRegister,imageDetail:e.imageDetail},on:{closeModal:e.closeRegister,getList:e.getList}}),e._v(" "),a("el-dialog",{staticClass:"cloud-tipDialog",attrs:{title:e.lang.imageManage.tip,visible:e.deleteDialogVisible,width:"35%"},on:{"update:visible":function(t){e.deleteDialogVisible=t}}},[e._v("\n            "+e._s(e.lang.imageManage.confirm_delete)+"\n            "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.deleteDialogVisible=!1}}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.deleteMethod}},[e._v(e._s(e.lang.common.confirm))])],1)]),e._v(" "),a("el-dialog",{staticClass:"cloud-tipDialog",attrs:{title:e.lang.imageManage.tip,visible:e.consoleDialogVisible,width:"35%"},on:{"update:visible":function(t){e.consoleDialogVisible=t}}},[e._v("\n            "+e._s(e.lang.imageManage.console_tip)+"\n            "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.consoleDialogVisible=!1}}},[e._v(e._s(e.lang.common.cancel))]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.startServer}},[e._v(e._s(e.lang.common.confirm))])],1)])],1)},staticRenderFns:[]};var p=a("C7Lr")(u,d,!1,function(e){a("vbS4")},"data-v-87728dc8",null);t.default=p.exports},vbS4:function(e,t){}});