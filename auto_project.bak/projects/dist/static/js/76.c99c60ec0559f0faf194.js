webpackJsonp([76],{"2UPV":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("1JPr"),o={props:{show:Boolean,containerid:String},data:function(){return{labelWidth:"120px",tableData:[],pageNum:1,pageSize:10}},computed:{pagedData:function(){return this.tableData.length<=this.pageSize?this.tableData:this.common.pagination(this.tableData,this.pageSize,this.pageNum)}},methods:{closeModal:function(t){t=t||!1,this.$emit("closeModal",t)},sortChange:function(t){var e=null==t.order?0:"ascending"===t.order?1:-1;this.tableData=this.tableData.sort(function(s,a){return(s[t.prop]>a[t.prop]?1:-1)*e})},getallpeocess:function(){var t=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.osMonitor.getprocessDetail,{container_id:this.containerid}),method:"get"}),function(e){t.tableData=e.data.use_cpu})},pageSelect:function(t){this.pageNum=t},initForm:function(){null!=this.$refs.form&&this.$refs.form.resetFields(),this.getallpeocess()}}},i={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{title:"进程详情",width:"45%",visible:t.show,modal:!0},on:{open:t.initForm,close:t.closeModal}},[s("el-form",{ref:"form",attrs:{"label-position":"right"}},[s("el-table",{ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedData},on:{"sort-change":t.sortChange}},[s("el-table-column",{attrs:{label:t.lang.osMonitor.username,prop:"user",sortable:"custom"}}),t._v(" "),s("el-table-column",{attrs:{label:t.lang.osMonitor.cpu,prop:"cpu",sortable:"custom"}}),t._v(" "),s("el-table-column",{attrs:{label:t.lang.osMonitor.memCompany,prop:"mem",sortable:"custom"}}),t._v(" "),s("el-table-column",{attrs:{label:t.lang.osMonitor.processcpu,prop:"cpu_time",sortable:"custom"}}),t._v(" "),s("el-table-column",{attrs:{label:t.lang.osMonitor.processName,prop:"name",sortable:"custom"}}),t._v(" "),s("el-table-column",{attrs:{label:t.lang.osMonitor.processId,prop:"pid",sortable:"custom"}})],1),t._v(" "),s("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.tableData.length>t.pageSize?s("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.tableData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1)],1),t._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:t.closeModal}},[t._v(t._s(t.lang.common.cancel))])],1)],1)},staticRenderFns:[]};var n=s("C7Lr")(o,i,!1,function(t){s("v1bm")},null,null).exports,r={components:{"pana-breadcrumb":a.a,"pana-detail":n},data:function(){return{showDetail:!1,poolId:"",containerInfo:"",memTotal:"",memUsed:"",selectedOptions2:[],bigdataPool:[],props:{value:"id",label:"name",children:"containerlist"},activeName:"first",useMem:[],cpu:[],containerId:"",diskInfo:"",diskusedSort:"",containerlist:[],noData:!1,operatingSystem:"",systemVersion:"",poolList:[],occupancyResources:!0}},methods:{showmore:function(){this.showDetail=!0},closeDetail:function(t){this.showDetail=!1},getpoollist:function(){var t=this;this.checkError([this.$http({url:this.api.osMonitor.getbigdatalist,method:"get"}),this.$http({url:this.api.osMonitor.getpanaocsPools,method:"get"})],function(e){t.selectedOptions2=[];for(var s=[],a=0;a<e.length;a++)e[a].data.forEach(function(t){s.push(t)});s.forEach(function(e,s){t.bigdataPool.push({value:e.id,label:e.name}),t.$set(t.bigdataPool[s],"children",[])}),t.selectedOptions2.push(t.bigdataPool[0].value),t.getcontainerList(t.bigdataPool[0].value),t.operatingSystem=s[0].operating_system,t.systemVersion=s[0].system_version,t.poolList=s})},getcontainerList:function(t){var e=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.osMonitor.getcontainer,{pool_id:t}),method:"get"}),function(s){for(var a=[],o=0;o<s.data.length;o++)a.push({value:s.data[o].id,label:s.data[o].hostname});e.containerlist=a;for(var i=0;i<e.bigdataPool.length;i++)if(e.bigdataPool[i].value==t){e.$set(e.bigdataPool[i],"children",e.containerlist);break}1==e.selectedOptions2.length&&(e.selectedOptions2=[],e.selectedOptions2.push(t,e.containerlist[0].value),e.containerId=e.containerlist[0].value,e.getcontainerInfo(),e.getdiskInfo(),e.getprocessInfo())})},getcontainerInfo:function(){var t=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.osMonitor.getcontainerInfo,{container_id:this.containerId}),method:"get"}),function(e){t.containerInfo=e.data,t.memTotal=e.data.mem.total,t.memUsed=e.data.mem.used,t.memEchart(t.memTotal,t.memUsed)})},memEchart:function(t,e){var s=this.$echarts.init(document.getElementById("memchart"));s.clear();var a={tooltip:{trigger:"item",confine:!0,formatter:function(t){return t.seriesName+"<br>"+t.name+":"+t.value+"GB("+t.percent+"%)"}},color:["#60abfc","#30c9ad"],graphic:{type:"text",top:"center",left:"center",style:{text:"内存使用情况",fill:"#A2ACBA",fontSize:14,fontWeight:"bold"}},series:[{name:"内存使用情况",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:this.common.switchCapacity(e,"B","GB",2),name:"已用"},{value:(this.common.switchCapacity(t,"B","GB",2)-this.common.switchCapacity(e,"B","GB",2)).toFixed(2),name:"剩余"}]}]};s.setOption(a,!0)},getprocessInfo:function(){var t=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.osMonitor.getprocessDetail,{container_id:this.containerId})+this.common.formatGetUrl({top:"5"}),method:"get"}),function(e){t.occupancyResources=!0,t.useMem=e.data.use_mem,t.cpu=e.data.use_cpu},function(e){t.occupancyResources=!1})},getdiskInfo:function(){var t=this;this.checkError(this.$http({url:this.common.formatMsg(this.api.osMonitor.getdiskInfo,{container_id:this.containerId}),method:"get"}),function(e){t.diskInfo=e.data.disk,t.diskusedSort=e.data.mount_point,0==e.data.mount_point.length?t.noData=!0:t.noData=!1,t.gethistogram(t.diskusedSort)})},handleItemChange:function(t){var e=this,s=t[0];this.getcontainerList(s),this.poolList.forEach(function(t){s===t.id&&(e.operatingSystem=t.operating_system,e.systemVersion=t.system_version)})},getmodelValue:function(t){this.containerId=t[1],this.getcontainerInfo(),this.getprocessInfo(),this.getdiskInfo()},gethistogram:function(t){var e=this.$echarts.init(document.getElementById("histogram"));e.clear();for(var s=[],a=[],o=[],i=0;i<t.length;i++)s.push(t[i].filesystem),a.push(this.common.switchCapacity(t[i].used,"KB","GB",2)),o.push(this.common.switchCapacity(t[i].size,"KB","GB",2));var n={color:["#3398DB","red"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:"3%",left:"3%",right:"4%",containLabel:!0},xAxis:[{type:"category",data:s,axisTick:{alignWithLabel:!0},axisLabel:{formatter:function(t){return t.length>6?t.slice(0,6)+"...":t}}}],yAxis:[{type:"value",yAxis:{splitLine:{show:!1}}}],series:[{name:"配额",type:"bar",itemStyle:{normal:{color:"#d7e1e3"}},silent:!0,barWidth:40,barGap:"-100%",data:o},{name:"已使用",type:"bar",barWidth:40,z:10,data:a}]};e.setOption(n,!0)},init:function(){var t=this;["memchart","histogram"].forEach(function(e){t.$echarts.init(t.$refs[e]).resize()})}},mounted:function(){var t=this;this.getpoollist(),this.interval=setInterval(function(){t.containerId&&t.getprocessInfo()},1e4),window.addEventListener("resize",this.init,20)},destroyed:function(){window.removeEventListener("resize",this.init,20),clearInterval(this.interval)}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-container",{staticClass:"cephdiv",attrs:{type:"flex",direction:"vertical"}},[s("pana-breadcrumb"),t._v(" "),s("el-main",{staticStyle:{"margin-top":"4px"}},[s("el-row",[s("el-col",{staticStyle:{"min-width":"74px"},attrs:{span:1}},[s("span",[t._v(t._s(t.lang.osMonitor.selectNode))])]),t._v(" "),s("el-col",{staticStyle:{"margin-top":"-8px"},attrs:{span:4}},[s("el-cascader",{attrs:{options:t.bigdataPool,prop:t.props},on:{"active-item-change":t.handleItemChange,change:t.getmodelValue},model:{value:t.selectedOptions2,callback:function(e){t.selectedOptions2=e},expression:"selectedOptions2"}})],1)],1),t._v(" "),s("el-row",{staticStyle:{"margin-top":"10px"},attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("div",{staticClass:"resourceinfo"},[s("div",{staticClass:"resourcetop"},[s("div",{staticClass:"title"},[t._v(t._s(t.lang.osMonitor.containerinfo))])]),t._v(" "),s("div",{staticClass:"containerinfo"},[s("div",{staticStyle:{width:"48%",height:"240px",float:"left"}},[s("ul",[s("li",[t._v(t._s(t.lang.osMonitor.hostName)+":\n\t\t\t\t\t\t\t\t\t"),s("span",[t._v(t._s(t.containerInfo.name))])]),t._v(" "),s("li",[t._v(t._s(t.lang.osMonitor.cpuname)+": "),s("span",[t._v(t._s(t.containerInfo.cpu)+t._s(t.lang.osMonitor.nucleus))])]),t._v(" "),s("li",[t._v(t._s(t.lang.osMonitor.mem)+": "),s("span",[t._v(t._s(this.common.switchCapacity(t.memTotal,"B","GB",2))+"GB")])]),t._v(" "),s("li",[t._v(t._s(t.lang.osMonitor.ipaddress)+": "),s("span",[t._v(t._s(t.containerInfo.ip))])]),t._v(" "),t.operatingSystem?s("li",[t._v(t._s(t.lang.osMonitor.operatingSystem)+": "),s("span",[t._v(t._s(t.operatingSystem))])]):t._e(),t._v(" "),t.systemVersion?s("li",[t._v(t._s(t.lang.osMonitor.systemVersion)+": "),s("span",[t._v(t._s(t.systemVersion))])]):t._e()])]),t._v(" "),s("div",{staticStyle:{width:"50%"},attrs:{id:"containerechart"}},[s("div",{staticClass:"container-div"},[s("div",{staticClass:"memBox"},[s("div",{ref:"memchart",attrs:{id:"memchart"}})]),t._v(" "),s("div",{staticClass:"memuse-detail"},[s("ul",[s("li",[s("span"),t._v(" "+t._s(t.lang.osMonitor.used)),s("i",[t._v(t._s(this.common.switchCapacity(t.memUsed,"B","GB",2))+"GB")])]),t._v(" "),s("li",[s("span"),t._v(" "+t._s(t.lang.osMonitor.surplus)),s("i",[t._v(t._s(this.common.switchCapacity(t.memTotal-t.memUsed,"B","GB",2))+"GB")])])])])])])])])]),t._v(" "),s("el-col",{attrs:{span:12}},[s("div",{staticClass:"resourcetop5"},[s("div",{staticClass:"toptitle"},[s("div",{staticClass:"title"},[t._v(t._s(t.lang.osMonitor.top5))]),t._v(" "),s("div",{staticClass:"lookdetail",staticStyle:{cursor:"pointer","margin-right":"10px"},on:{click:t.showmore}},[t._v(t._s(t.lang.osMonitor.showmore))])]),t._v(" "),s("el-tabs",{staticStyle:{padding:"0 10px"},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:t.lang.osMonitor.occupiedMemory,name:"first"}},[!0===t.occupancyResources?s("div",{staticClass:"memoryprocess"},t._l(t.useMem,function(e){return s("div",{staticClass:"top5detail"},[s("div",{staticClass:"proceedetail"},[s("span"),t._v(t._s(e.name)+" "+t._s(Number(e.mem).toFixed(2))+"%")]),t._v(" "),s("div",{staticClass:"memandcpuprocess"},[s("div",{staticClass:"process",style:"width:"+e.mem+"%"})])])}),0):t._e(),t._v(" "),!1===t.occupancyResources?s("div",{staticClass:"memoryprocess"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.lang.osMonitor.noData)+"\n\t\t\t\t\t\t\t")]):t._e()]),t._v(" "),s("el-tab-pane",{attrs:{label:t.lang.osMonitor.occupiedcpu,name:"second"}},[!0===t.occupancyResources?s("div",{staticClass:"memoryprocess"},t._l(t.cpu,function(e){return s("div",{staticClass:"top5detail"},[s("div",{staticClass:"proceedetail"},[s("span"),t._v(t._s(e.name)+" "+t._s(Number(e.cpu).toFixed(2))+"%")]),t._v(" "),s("div",{staticClass:"memandcpuprocess"},[s("div",{staticClass:"process",style:"width:"+e.cpu+"%"})])])}),0):t._e(),t._v(" "),!1===t.occupancyResources?s("div",{staticClass:"memoryprocess"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.lang.osMonitor.noData)+"\n\t\t\t\t\t\t\t")]):t._e()])],1)],1)])],1),t._v(" "),s("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[s("el-col",{attrs:{span:12}},[s("div",{staticClass:"diskusedInfo"},[s("div",{staticClass:"title"},[t._v(t._s(t.lang.osMonitor.diskused))]),t._v(" "),s("p",{staticStyle:{padding:"10px 20px"}},[t._v(t._s(t.lang.osMonitor.disktotal)+": "+t._s(this.common.switchCapacity(t.diskInfo.total,"B","GB",2))+"GB, "+t._s(t.lang.osMonitor.used)+": "),s("span",{staticStyle:{color:"#51a3ff"}},[t._v(t._s(this.common.switchCapacity(t.diskInfo.used,"B","GB",2))+"GB")])]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.noData,expression:"!noData"}],ref:"histogram",attrs:{id:"histogram"}}),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:t.noData,expression:"noData"}],staticClass:"nodata"},[t._v(t._s(t.lang.osMonitor.noData))])])]),t._v(" "),s("el-col",{attrs:{span:12}},[s("div",{staticClass:"diskusedtop5"},[s("div",{staticClass:"toptitle"},[s("div",{staticClass:"title"},[t._v(t._s(t.lang.osMonitor.diskusedSort))]),t._v(" "),s("ul",[t._l(t.diskusedSort,function(e,a){return t.diskusedSort.length>0?s("li",[s("div",{staticClass:"left"},[s("span",{class:[{active:a>2}]},[t._v(t._s(a+1))]),t._v(" "),s("i",[t._v(t._s(e.filesystem))])]),t._v(" "),s("div",{staticClass:"right"},[s("p",[t._v(t._s(t.common.switchCapacity(e.used,"KB","GB",2))+" "),s("span",[t._v("/"+t._s(t.common.switchCapacity(e.size,"KB","GB",2))+"GB")])])])]):t._e()}),t._v(" "),0==t.diskusedSort.length?s("li",{staticStyle:{border:"none","text-align":"center","margin-top":"10px"}},[t._v(t._s(t.lang.osMonitor.noData))]):t._e()],2)])])])],1)],1),t._v(" "),s("pana-detail",{attrs:{show:t.showDetail,containerid:t.containerId},on:{closeModal:t.closeDetail}})],1)},staticRenderFns:[]};var c=s("C7Lr")(r,l,!1,function(t){s("y1cP")},"data-v-74c2251c",null);e.default=c.exports},v1bm:function(t,e){},y1cP:function(t,e){}});