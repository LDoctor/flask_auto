webpackJsonp([86],{"1nnc":function(t,e){},fgAE:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=a("1JPr"),n=a("/n4h"),o={data:function(){return{loading:!0,dialogVisible:!1,tipDialogMsg:"",operate:"",tableData:[],volumeData:[],volumeId:"",multipleSelection:[],search:"",pageNum:1,pageSize:10,canRollBack:!1}},mounted:function(){this.getList(),this.getVolumeList()},components:{"pana-breadcrumb":l.a,cloudTipDialog:n.a},methods:{sort:function(t){this.tableData=this.common.sort(t,this.tableData,["size","used"])},getVolumeList:function(){var t=this;this.checkError(this.$http({url:this.api.storage.dataset,method:"get"}),function(e){t.volumeData=e.data})},getList:function(){var t=this;t.loading=!0;var e="";this.volumeId&&"all"!==this.volumeId&&(e=this.common.formatGetUrl({source:this.volumeId})),this.checkError(this.$http({url:this.api.storage.dataset_snapshot+e,method:"get"}),function(e){t.loading=!1,t.tableData=e.data})},selectVolume:function(){this.getList()},rollbackConfirm:function(){this.operate="rollback",this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.rollbackConfirm},deleteConfirm:function(){this.operate="delete",this.dialogVisible=!0,this.tipDialogMsg=this.lang.volume.deleteSnapshotConfirm},dialogConfirm:function(){switch(this.dialogVisible=!1,this.operate){case"rollback":this.rollback();break;case"delete":this.delete()}},rollback:function(){var t=this,e=this.multipleSelection[0].guid,a=this.common.formatMsg(this.api.storage.dataset_snapshot_rollback,{snap_id:e});this.checkError(this.$http({url:a,method:"POST"}),function(e){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.lang.volume.snapshotRollbackSuccess})})},delete:function(){var t=this,e=this.multipleSelection[0].guid,a=this.common.formatMsg(this.api.storage.dataset_snapshot_detail,{snap_id:e});this.checkError(this.$http({url:a,method:"DELETE"}),function(e){t.getList(),t.$notify({title:t.lang.common.success,type:"success",message:t.common.formatMsg(t.lang.volume.deleteSnapshotSuccess,{name:t.multipleSelection[0].name})})})},notSelect:function(){return this.multipleSelection.length<=0},pageSelect:function(t){this.pageNum=t},handleSelectionChange:function(t){this.multipleSelection=t;var e=[],a=this;1===t.length&&(this.tableData.forEach(function(l){l.parent===t[0].parent&&l.name!==t[0].name&&e.push({name:l.name,creation:a.moment(l.creation).valueOf(),guid:l.guid,parent:l.parent})}),this.canRollBack=this.moment(t[0].creation).valueOf()>Math.max.apply(Math,e.map(function(t){return t.creation})))}},computed:{selectNotOne:function(){return 1!==this.multipleSelection.length},filterData:function(){var t=this.search,e=[],a=this.tableData;return e=""===t?a:this.common.cloudFilter(a,t),e},pagedData:function(){return this.filterData.length<=this.pageSize?this.filterData:this.common.pagination(this.filterData,this.pageSize,this.pageNum)}},watch:{search:function(){this.pageNum=1}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticClass:"mainDiv",attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:t.getList}}),t._v(" "),a("el-main",[a("el-row",{staticClass:"cloud-btn-row",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:18}},[a("el-button",{attrs:{disabled:t.selectNotOne||!1===t.selectNotOne&&!1===t.canRollBack},on:{click:t.rollbackConfirm}},[!1===t.canRollBack&&1===t.multipleSelection.length?a("div",[a("el-tooltip",{attrs:{content:t.lang.volume.supportLatestSnapshot,placement:"top"}},[a("div",[t._v(t._s(t.lang.volume.rollback))])])],1):t._e(),t._v(" "),0===t.multipleSelection.length?a("div",[a("el-tooltip",{attrs:{content:t.lang.volume.selectLeastOne,placement:"top"}},[a("div",[t._v(t._s(t.lang.volume.rollback))])])],1):t._e(),t._v(" "),t.multipleSelection.length>1?a("div",[a("el-tooltip",{attrs:{content:t.lang.volume.selcetOne,placement:"top"}},[a("div",[t._v(t._s(t.lang.volume.rollback))])])],1):t._e(),t._v(" "),1===t.multipleSelection.length&&!0===t.canRollBack?a("div",[t._v("\n                    \t"+t._s(t.lang.volume.rollback)+"\n                    ")]):t._e()]),t._v(" "),a("el-button",{attrs:{disabled:t.selectNotOne},on:{click:t.deleteConfirm}},[t._v("\n                    "+t._s(t.lang.common.delete)+"\n                ")]),t._v(" "),a("el-select",{attrs:{placeholder:t.lang.volume.selectVolume},on:{change:t.selectVolume},model:{value:t.volumeId,callback:function(e){t.volumeId=e},expression:"volumeId"}},[a("el-option",{attrs:{label:t.lang.volume.all,value:"all"}}),t._v(" "),t._l(t.volumeData,function(t){return a("el-option",{key:t.guid,attrs:{label:t.name,value:t.guid}})})],2)],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getList}})],1)],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.8)",data:t.pagedData},on:{"sort-change":t.sort,"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"45"}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"name",label:t.lang.common.name}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"parent",label:t.lang.volume.vloumeName}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"creation",label:t.lang.volume.createTime}})],1),t._v(" "),a("el-row",{staticClass:"row-bg pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.filterData.length>t.pageSize?a("el-pagination",{attrs:{background:"",layout:"prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.filterData.length,"current-page":t.pageNum},on:{"current-change":t.pageSelect}}):t._e()],1)],1),t._v(" "),a("cloud-tip-dialog",{attrs:{dialogVisible:t.dialogVisible},on:{cancel:function(e){t.dialogVisible=!1},confirm:t.dialogConfirm}},[a("div",{domProps:{innerHTML:t._s(t.tipDialogMsg)}})])],1)},staticRenderFns:[]};var s=a("C7Lr")(o,i,!1,function(t){a("1nnc")},"data-v-6e21eda9",null);e.default=s.exports}});