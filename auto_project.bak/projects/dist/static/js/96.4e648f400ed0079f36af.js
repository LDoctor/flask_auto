webpackJsonp([96],{"3qx/":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("aA9S"),n=a.n(o),r={components:{"pana-breadcrumb":a("1JPr").a},data:function(){return{sortParam:"",downloadClick:!1,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},form:{operator_name:"",audit_type:"",description:"",state:"",create_time:"",update_time:""},pageSize:10,auditSearch:"",auditOrigin:[],auditSelectionIds:[],auditPage:1,auditTypes:{1:this.lang.auditLog.auditTypeUser,2:this.lang.auditLog.auditTypeDepartment,3:this.lang.auditLog.auditTypeRole,4:this.lang.auditLog.auditTypePermission,5:this.lang.auditLog.auditTypeLogin},loading:!1,role:"normal",auth:["audit"],total:0,advanceSearchExpand:!1}},methods:{advanceSearch:function(){this.auditPage=1,this.getAuditLogs()},downloadLog:function(){var t=this;t.downloadClick=!0,this.$http({url:this.api.management.download_logs,method:"get"}).then(function(e){if(t.downloadClick=!1,null!=e.data.code&&0!==e.data.code)t.$notify({title:t.lang.common.error,type:"error",message:e.data.message});else{var a=new Blob(["\ufeff"+e.data],{type:"text/csv;charset=utf-8"}),o=document.createElement("a"),n=window.URL.createObjectURL(a),r=e.headers["content-disposition"],i=/filename="?([^"^;]+)"?/.exec(decodeURIComponent(r));t.common.isArray(i)?o.download=i[1]:o.download="file",o.href=n,document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(n)}})},switchAuditPage:function(t){this.auditPage=t,this.getAuditLogs()},sortChange:function(t){t.order?"ascending"===t.order?this.sortParam=t.prop:this.sortParam="-"+t.prop:this.sortParam="",this.getAuditLogs()},getAuditLogs:function(){var t,e=this,a={type:1,search:this.auditSearch,page:this.auditPage};if(e.sortParam&&(a.sort=e.sortParam),e.advanceSearchExpand){n()(a,e.form),null!==e.form.state?a.state=e.form.state.replace(/( |^)[a-z]/g,function(t){return t.toUpperCase()}):e.form.state;var o=e.form.update_time;o&&o.length>1&&(o[0]===o[1]&&(o[1]=o[1]+864e5),a.create_time=Math.round(o[0]/1e3)+"_"+Math.round(o[1]/1e3)),delete a.update_time}t=this.common.formatGetUrl(a),this.loading=!0,this.checkError(this.$http({url:this.api.management.get_logs+t,method:"get"}),function(t){e.auditOrigin=t.data,e.total=t.total,e.loading=!1},function(){e.loading=!1})},selectAuditIds:function(t){var e=[];t.forEach(function(t){e.push(t.id)}),this.auditSelectionIds=e},formatRole:function(t){return this.auditTypes[t.audit_type]},search:function(){this.auditPage=1,this.getAuditLogs()},advanceSearchExpandChange:function(){this.advanceSearchExpand=!this.advanceSearchExpand,this.resetForm("form")},resetForm:function(t){this.$refs[t]&&this.$refs[t].resetFields()}},mounted:function(){this.role=JSON.parse(sessionStorage.getItem("panaUser")).role,this.getAuditLogs()}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{attrs:{type:"flex",direction:"vertical"}},[a("pana-breadcrumb",{attrs:{changePool:!0,callback:t.getAuditLogs}}),t._v(" "),a("el-main",[a("el-row",{staticClass:"pana-btn-group",attrs:{type:"flex",justify:"space-between"}},[a("el-col",{attrs:{span:12}},[t.auth.indexOf(t.role)>-1?a("div"):t._e(),t._v(" "),a("el-button",{attrs:{type:"primary",disabled:t.downloadClick},on:{click:t.downloadLog}},[t._v("\n                    "+t._s(t.lang.auditLog.export)+"\n                ")])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-row",{staticClass:"search-row",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:t.lang.common.search,"suffix-icon":"el-icon-search"},on:{change:t.search},model:{value:t.auditSearch,callback:function(e){t.auditSearch=e},expression:"auditSearch"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("el-button",{staticClass:"fa fa-refresh",attrs:{type:"text",circle:""},on:{click:t.getAuditLogs}})],1),t._v(" "),a("el-col",{class:{"cloud-expand-icon":t.advanceSearchExpand},attrs:{span:6}},[a("el-button",{attrs:{type:"text"},on:{click:t.advanceSearchExpandChange}},[t._v("\n                            "+t._s(t.lang.auditLog.advanceSearch)+"\n                            "),a("i",{staticClass:"el-icon-arrow-right",attrs:{"aria-hidden":"true"}})])],1)],1)],1)],1),t._v(" "),t.advanceSearchExpand?a("el-form",{ref:"form",staticClass:"advance-search-form",attrs:{model:t.form,"label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.auditLog.operator,prop:"operator_name"}},[a("el-input",{attrs:{placeholder:t.lang.auditLog.input+t.lang.auditLog.operator},model:{value:t.form.operator_name,callback:function(e){t.$set(t.form,"operator_name",e)},expression:"form.operator_name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.auditLog.operationType,prop:"audit_type"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:t.form.audit_type,callback:function(e){t.$set(t.form,"audit_type",e)},expression:"form.audit_type"}},t._l(t.auditTypes,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})}),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.common.description,prop:"description"}},[a("el-input",{attrs:{placeholder:t.lang.auditLog.placeholder},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1)],1)],1),t._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.common.status,prop:"state"}},[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:t.form.state,callback:function(e){t.$set(t.form,"state",e)},expression:"form.state"}},t._l(t.lang.auditLog.statusObj,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:e}})}),1)],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:t.lang.auditLog.updateTime,prop:"update_time"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":t.pickerOptions},model:{value:t.form.update_time,callback:function(e){t.$set(t.form,"update_time",e)},expression:"form.update_time"}})],1)],1)],1),t._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary"},on:{click:t.advanceSearch}},[t._v(t._s(t.lang.auditLog.inquire))]),t._v(" "),a("el-button",{on:{click:function(e){return t.resetForm("form")}}},[t._v("\n                            "+t._s(t.lang.auditLog.reset)+"\n                        ")])],1)],1)],1)],1):t._e(),t._v(" "),a("form",{attrs:{method:"GET",hidden:"",id:"download-form"}}),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"multipleTable",staticClass:"cloud-table",staticStyle:{width:"100%"},attrs:{"element-loading-text":t.lang.common.loading,"element-loading-spinner":"el-icon-loading","element-loading-background":"rgb(255, 255, 255)",data:t.auditOrigin,"tooltip-effect":"dark"},on:{"selection-change":t.selectAuditIds,"sort-change":t.sortChange}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"operator_name",label:t.lang.auditLog.operator}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"audit_type",label:t.lang.auditLog.operationType,formatter:t.formatRole,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"ip",label:t.lang.auditLog.ip,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"description",label:t.lang.common.description,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"state",label:t.lang.common.status},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{class:{"cloud-color-green":e.row.state}},[t._v(t._s(t.lang.auditLog.statusObj[e.row.state]))])]}}])}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"create_time",label:t.lang.auditLog.actionTime},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("utc2beijing")(e.row.create_time))+"\n                ")]}}])}),t._v(" "),a("el-table-column",{attrs:{sortable:"custom",prop:"update_time",label:t.lang.auditLog.updateTime},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(t._f("utc2beijing")(e.row.update_time))+"\n                ")]}}])})],1),t._v(" "),a("el-row",{staticClass:"pana-pagination-row",attrs:{type:"flex",justify:"end"}},[t.total>t.pageSize?a("el-pagination",{attrs:{background:"",layout:"slot, prev, pager, next","prev-text":t.lang.common.prevPage,"next-text":t.lang.common.nextPage,total:t.total,"current-page":t.auditPage},on:{"current-change":t.switchAuditPage}},[t._t("default",[a("span",{staticClass:"pagination-slot"},[t._v("\n                        "+t._s(t.common.formatMsg(t.lang.common.paginationMsg,{current:this.auditPage,total:this.total}))+"\n                    ")])])],2):t._e()],1)],1)],1)},staticRenderFns:[]};var l=a("C7Lr")(r,i,!1,function(t){a("oovX")},"data-v-5b94467a",null);e.default=l.exports},oovX:function(t,e){}});